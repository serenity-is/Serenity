(function(e,t){var n={Identity:function(e){return e},True:function(){return true},Blank:function(){}};var r={Boolean:typeof true,Number:typeof 0,String:typeof"",Object:typeof{},Undefined:typeof t,Function:typeof function(){}};var u={createLambda:function(e){if(e==null)return n.Identity;if(typeof e==r.String){if(e==""){return n.Identity}else if(e.indexOf("=>")==-1){var t=new RegExp("[$]+","g");var u=0;var i;while(i=t.exec(e)){var o=i[0].length;if(o>u){u=o}}var a=[];for(var f=1;f<=u;f++){var c="";for(var s=0;s<f;s++){c+="$"}a.push(c)}var l=Array.prototype.join.call(a,",");return new Function(l,"return "+e)}else{var p=e.match(/^[(\s]*([^()]*?)[)\s]*=>(.*)/);return new Function(p[1],"return "+p[2])}}return e},isIEnumerable:function(e){if(typeof Enumerator!==r.Undefined){try{new Enumerator(e);return true}catch(t){}}return false},defineProperty:Object.defineProperties!=null?function(e,t,n){Object.defineProperty(e,t,{enumerable:false,configurable:true,writable:true,value:n})}:function(e,t,n){e[t]=n},compare:function(e,t){return e===t?0:e>t?1:-1},dispose:function(e){if(e!=null)e.dispose()}};var i={Before:0,Running:1,After:2};var o=function(e,t,n){var r=new f;var u=i.Before;this.current=r.current;this.reset=function(){throw new Error("Reset is not supported")};this.moveNext=function(){try{switch(u){case i.Before:u=i.Running;e();case i.Running:if(t.apply(r)){return true}else{this.dispose();return false}case i.After:return false}}catch(n){this.dispose();throw n}};this.dispose=function(){if(u!=i.Running)return;try{n()}finally{u=i.After}}};var a={};ss.initAssembly(a,"linq");ss.initClass(o,a,{},null,[ss.IDisposable]);var f=function(){var e=null;this.current=function(){return e};this.yieldReturn=function(t){e=t;return true};this.yieldBreak=function(){return false}};var c=function(e){this.getEnumerator=e};ss.initClass(c,a,{},null,[ss.IEnumerable]);c.Utils={};c.Utils.createLambda=function(e){return u.createLambda(e)};c.Utils.createEnumerable=function(e){return new c(e)};c.Utils.createEnumerator=function(e,t,n){return new o(e,t,n)};c.Utils.extendTo=function(e){var t=e.prototype;var n;if(e===Array){n=h.prototype;u.defineProperty(t,"getSource",function(){return this})}else{n=c.prototype;u.defineProperty(t,"getEnumerator",function(){return c.from(this).getEnumerator()})}for(var r in n){var i=n[r];if(t[r]==i)continue;if(t[r]!=null){r=r+"ByLinq";if(t[r]==i)continue}if(i instanceof Function){u.defineProperty(t,r,i)}}};c.choice=function(){var e=arguments;return new c(function(){return new o(function(){e=e[0]instanceof Array?e[0]:e[0].getEnumerator!=null?e[0].toArray():e},function(){return this.yieldReturn(e[Math.floor(Math.random()*e.length)])},n.Blank)})};c.cycle=function(){var e=arguments;return new c(function(){var t=0;return new o(function(){e=e[0]instanceof Array?e[0]:e[0].getEnumerator!=null?e[0].toArray():e},function(){if(t>=e.length)t=0;return this.yieldReturn(e[t++])},n.Blank)})};c.empty=function(){return new c(function(){return new o(n.Blank,function(){return false},n.Blank)})};c.from=function(e){if(e==null){return c.empty()}if(e instanceof c){return e}if(typeof e==r.Number||typeof e==r.Boolean){return c.repeat(e,1)}if(typeof e==r.String){return new c(function(){var t=0;return new o(n.Blank,function(){return t<e.length?this.yieldReturn(e.charAt(t++)):false},n.Blank)})}var t=ss.safeCast(e,ss.IEnumerable);if(t){var i;return new c(function(){return new o(function(){i=ss.getEnumerator(t)},function(){var e=i.moveNext();return e?this.yieldReturn(i.current()):false},function(){var e=ss.safeCast(i,ss.IDisposable);if(e){e.dispose()}})})}if(typeof e!=r.Function){if(typeof e.length==r.Number){return new h(e)}if(!(e instanceof Object)&&u.isIEnumerable(e)){return new c(function(){var t=true;var r;return new o(function(){r=new Enumerator(e)},function(){if(t)t=false;else r.moveNext();return r.atEnd()?false:this.yieldReturn(r.item())},n.Blank)})}if(typeof Windows===r.Object&&typeof e.first===r.Function){return new c(function(){var t=true;var r;return new o(function(){r=e.first()},function(){if(t)t=false;else r.moveNext();return r.hasCurrent?this.yieldReturn(r.current):this.yieldBreak()},n.Blank)})}}return new c(function(){var t=[];var r=0;return new o(function(){for(var n in e){var r=e[n];if(!(r instanceof Function)&&Object.prototype.hasOwnProperty.call(e,n)){t.push({key:n,value:r})}}},function(){return r<t.length?this.yieldReturn(t[r++]):false},n.Blank)})},c.make=function(e){return c.repeat(e,1)};c.matches=function(e,t,r){if(r==null)r="";if(t instanceof RegExp){r+=t.ignoreCase?"i":"";r+=t.multiline?"m":"";t=t.source}if(r.indexOf("g")===-1)r+="g";return new c(function(){var u;return new o(function(){u=new RegExp(t,r)},function(){var t=u.exec(e);return t?this.yieldReturn(t):false},n.Blank)})};c.range=function(e,t,r){if(r==null)r=1;return new c(function(){var u;var i=0;return new o(function(){u=e-r},function(){return i++<t?this.yieldReturn(u+=r):this.yieldBreak()},n.Blank)})};c.rangeDown=function(e,t,r){if(r==null)r=1;return new c(function(){var u;var i=0;return new o(function(){u=e+r},function(){return i++<t?this.yieldReturn(u-=r):this.yieldBreak()},n.Blank)})};c.rangeTo=function(e,t,r){if(r==null)r=1;if(e<t){return new c(function(){var u;return new o(function(){u=e-r},function(){var e=u+=r;return e<=t?this.yieldReturn(e):this.yieldBreak()},n.Blank)})}else{return new c(function(){var u;return new o(function(){u=e+r},function(){var e=u-=r;return e>=t?this.yieldReturn(e):this.yieldBreak()},n.Blank)})}};c.repeat=function(e,t){if(t!=null)return c.repeat(e).take(t);return new c(function(){return new o(n.Blank,function(){return this.yieldReturn(e)},n.Blank)})};c.repeatWithFinalize=function(e,t){e=u.createLambda(e);t=u.createLambda(t);return new c(function(){var n;return new o(function(){n=e()},function(){return this.yieldReturn(n)},function(){if(n!=null){t(n);n=null}})})};c.generate=function(e,t){if(t!=null)return c.generate(e).take(t);e=u.createLambda(e);return new c(function(){return new o(n.Blank,function(){return this.yieldReturn(e())},n.Blank)})};c.toInfinity=function(e,t){if(e==null)e=0;if(t==null)t=1;return new c(function(){var r;return new o(function(){r=e-t},function(){return this.yieldReturn(r+=t)},n.Blank)})};c.toNegativeInfinity=function(e,t){if(e==null)e=0;if(t==null)t=1;return new c(function(){var r;return new o(function(){r=e+t},function(){return this.yieldReturn(r-=t)},n.Blank)})};c.unfold=function(e,t){t=u.createLambda(t);return new c(function(){var r=true;var u;return new o(n.Blank,function(){if(r){r=false;u=e;return this.yieldReturn(u)}u=t(u);return this.yieldReturn(u)},n.Blank)})};c.defer=function(e){return new c(function(){var t;return new o(function(){t=c.from(e()).getEnumerator()},function(){return t.moveNext()?this.yieldReturn(t.current()):this.yieldBreak()},function(){u.dispose(t)})})};c.prototype.traverseBreadthFirst=function(e,t){var n=this;e=u.createLambda(e);t=u.createLambda(t);return new c(function(){var r;var i=0;var a=[];return new o(function(){r=n.getEnumerator()},function(){while(true){if(r.moveNext()){a.push(r.current());return this.yieldReturn(t(r.current(),i))}var n=c.from(a).selectMany(function(t){return e(t)});if(!n.any()){return false}else{i++;a=[];u.dispose(r);r=n.getEnumerator()}}},function(){u.dispose(r)})})};c.prototype.traverseDepthFirst=function(e,t){var n=this;e=u.createLambda(e);t=u.createLambda(t);return new c(function(){var r=[];var i;return new o(function(){i=n.getEnumerator()},function(){while(true){if(i.moveNext()){var n=t(i.current(),r.length);r.push(i);i=c.from(e(i.current())).getEnumerator();return this.yieldReturn(n)}if(r.length<=0)return false;u.dispose(i);i=r.pop()}},function(){try{u.dispose(i)}finally{c.from(r).forEach(function(e){e.dispose()})}})})};c.prototype.flatten=function(){var e=this;return new c(function(){var t;var r=null;return new o(function(){t=e.getEnumerator()},function(){while(true){if(r!=null){if(r.moveNext()){return this.yieldReturn(r.current())}else{r=null}}if(t.moveNext()){if(t.current()instanceof Array){u.dispose(r);r=c.from(t.current()).selectMany(n.Identity).flatten().getEnumerator();continue}else{return this.yieldReturn(t.current())}}return false}},function(){try{u.dispose(t)}finally{u.dispose(r)}})})};c.prototype.pairwise=function(e){var t=this;e=u.createLambda(e);return new c(function(){var n;return new o(function(){n=t.getEnumerator();n.moveNext()},function(){var t=n.current();return n.moveNext()?this.yieldReturn(e(t,n.current())):false},function(){u.dispose(n)})})};c.prototype.scan=function(e,t){var n;if(t==null){t=u.createLambda(e);n=false}else{t=u.createLambda(t);n=true}var r=this;return new c(function(){var i;var a;var f=true;return new o(function(){i=r.getEnumerator()},function(){if(f){f=false;if(!n){if(i.moveNext()){return this.yieldReturn(a=i.current())}}else{return this.yieldReturn(a=e)}}return i.moveNext()?this.yieldReturn(a=t(a,i.current())):false},function(){u.dispose(i)})})};c.prototype.select=function(e){e=u.createLambda(e);if(e.length<=1){return new v(this,null,e)}else{var t=this;return new c(function(){var n;var r=0;return new o(function(){n=t.getEnumerator()},function(){return n.moveNext()?this.yieldReturn(e(n.current(),r++)):false},function(){u.dispose(n)})})}};c.prototype.selectMany=function(e,n){var r=this;e=u.createLambda(e);if(n==null)n=function(e,t){return t};n=u.createLambda(n);return new c(function(){var i;var a=t;var f=0;return new o(function(){i=r.getEnumerator()},function(){if(a===t){if(!i.moveNext())return false}do{if(a==null){var r=e(i.current(),f++);a=c.from(r).getEnumerator()}if(a.moveNext()){return this.yieldReturn(n(i.current(),a.current()))}u.dispose(a);a=null}while(i.moveNext());return false},function(){try{u.dispose(i)}finally{u.dispose(a)}})})};c.prototype.where=function(e){e=u.createLambda(e);if(e.length<=1){return new y(this,e)}else{var t=this;return new c(function(){var n;var r=0;return new o(function(){n=t.getEnumerator()},function(){while(n.moveNext()){if(e(n.current(),r++)){return this.yieldReturn(n.current())}}return false},function(){u.dispose(n)})})}};c.prototype.choose=function(e){e=u.createLambda(e);var t=this;return new c(function(){var n;var r=0;return new o(function(){n=t.getEnumerator()},function(){while(n.moveNext()){var t=e(n.current(),r++);if(t!=null){return this.yieldReturn(t)}}return this.yieldBreak()},function(){u.dispose(n)})})};c.prototype.ofType=function(e){var t=this;return new c(function(){var n;return new o(function(){n=ss.getEnumerator(t)},function(){while(n.moveNext()){var t=ss.safeCast(n.current(),e);if(ss.isValue(t)){return this.yieldReturn(t)}}return false},function(){u.dispose(n)})})};c.prototype.zip=function(){var e=arguments;var t=u.createLambda(arguments[arguments.length-1]);var n=this;if(arguments.length==2){var r=arguments[0];return new c(function(){var e;var i;var a=0;return new o(function(){e=n.getEnumerator();i=c.from(r).getEnumerator()},function(){if(e.moveNext()&&i.moveNext()){return this.yieldReturn(t(e.current(),i.current(),a++))}return false},function(){try{u.dispose(e)}finally{u.dispose(i)}})})}else{return new c(function(){var r;var i=0;return new o(function(){var t=c.make(n).concat(c.from(e).takeExceptLast().select(c.from)).select(function(e){return e.getEnumerator()}).toArray();r=c.from(t)},function(){if(r.all(function(e){return e.moveNext()})){var e=r.select(function(e){return e.current()}).toArray();e.push(i++);return this.yieldReturn(t.apply(null,e))}else{return this.yieldBreak()}},function(){c.from(r).forEach(u.dispose)})})}};c.prototype.merge=function(){var e=arguments;var t=this;return new c(function(){var n;var r=-1;return new o(function(){n=c.make(t).concat(c.from(e).select(c.from)).select(function(e){return e.getEnumerator()}).toArray()},function(){while(n.length>0){r=r>=n.length-1?0:r+1;var e=n[r];if(e.moveNext()){return this.yieldReturn(e.current())}else{e.dispose();n.splice(r--,1)}}return this.yieldBreak()},function(){c.from(n).forEach(u.dispose)})})};c.prototype.join=function(e,r,i,a,f){r=u.createLambda(r);i=u.createLambda(i);a=u.createLambda(a);var s=this;return new c(function(){var l;var p;var h=null;var y=0;return new o(function(){l=s.getEnumerator();p=c.from(e).toLookup(i,n.Identity,f)},function(){while(true){if(h!=null){var e=h[y++];if(e!==t){return this.yieldReturn(a(l.current(),e))}e=null;y=0}if(l.moveNext()){var n=r(l.current());h=p.get(n).toArray()}else{return false}}},function(){u.dispose(l)})})};c.prototype.groupJoin=function(e,t,r,i,a){t=u.createLambda(t);r=u.createLambda(r);i=u.createLambda(i);var f=this;return new c(function(){var s=f.getEnumerator();var l=null;return new o(function(){s=f.getEnumerator();l=c.from(e).toLookup(r,n.Identity,a)},function(){if(s.moveNext()){var e=l.get(t(s.current()));return this.yieldReturn(i(s.current(),e))}return false},function(){u.dispose(s)})})};c.prototype.all=function(e){e=u.createLambda(e);var t=true;this.forEach(function(n){if(!e(n)){t=false;return false}});return t};c.prototype.any=function(e){e=u.createLambda(e);var t=this.getEnumerator();try{if(arguments.length==0)return t.moveNext();while(t.moveNext()){if(e(t.current()))return true}return false}finally{u.dispose(t)}};c.prototype.isEmpty=function(){return!this.any()};c.prototype.concat=function(){var e=this;if(arguments.length==1){var t=arguments[0];return new c(function(){var n;var r;return new o(function(){n=e.getEnumerator()},function(){if(r==null){if(n.moveNext())return this.yieldReturn(n.current());r=c.from(t).getEnumerator()}if(r.moveNext())return this.yieldReturn(r.current());return false},function(){try{u.dispose(n)}finally{u.dispose(r)}})})}else{var n=arguments;return new c(function(){var t;return new o(function(){t=c.make(e).concat(c.from(n).select(c.from)).select(function(e){return e.getEnumerator()}).toArray()},function(){while(t.length>0){var e=t[0];if(e.moveNext()){return this.yieldReturn(e.current())}else{e.dispose();t.splice(0,1)}}return this.yieldBreak()},function(){c.from(t).forEach(u.dispose)})})}};c.prototype.insert=function(e,t){var n=this;return new c(function(){var r;var i;var a=0;var f=false;return new o(function(){r=n.getEnumerator();i=c.from(t).getEnumerator()},function(){if(a==e&&i.moveNext()){f=true;return this.yieldReturn(i.current())}if(r.moveNext()){a++;return this.yieldReturn(r.current())}if(!f&&i.moveNext()){return this.yieldReturn(i.current())}return false},function(){try{u.dispose(r)}finally{u.dispose(i)}})})};c.prototype.alternate=function(e){var t=this;return new c(function(){var n;var r;var i;var a;return new o(function(){if(e instanceof Array||e.getEnumerator!=null){i=c.from(c.from(e).toArray())}else{i=c.make(e)}r=t.getEnumerator();if(r.moveNext())n=r.current()},function(){while(true){if(a!=null){if(a.moveNext()){return this.yieldReturn(a.current())}else{a=null}}if(n==null&&r.moveNext()){n=r.current();a=i.getEnumerator();continue}else if(n!=null){var e=n;n=null;return this.yieldReturn(e)}return this.yieldBreak()}},function(){try{u.dispose(r)}finally{u.dispose(a)}})})};c.prototype.contains=function(e,t){t=t||ss.EqualityComparer.def;var n=this.getEnumerator();try{while(n.moveNext()){if(t.areEqual(n.current(),e))return true}return false}finally{u.dispose(n)}};c.prototype.defaultIfEmpty=function(e){var n=this;if(e===t)e=null;return new c(function(){var t;var r=true;return new o(function(){t=n.getEnumerator()},function(){if(t.moveNext()){r=false;return this.yieldReturn(t.current())}else if(r){r=false;return this.yieldReturn(e)}return false},function(){u.dispose(t)})})};c.prototype.distinct=function(e){return this.except(c.empty(),e)};c.prototype.distinctUntilChanged=function(e){e=u.createLambda(e);var t=this;return new c(function(){var n;var r;var i;return new o(function(){n=t.getEnumerator()},function(){while(n.moveNext()){var t=e(n.current());if(i){i=false;r=t;return this.yieldReturn(n.current())}if(r===t){continue}r=t;return this.yieldReturn(n.current())}return this.yieldBreak()},function(){u.dispose(n)})})};c.prototype.except=function(e,t){var n=this;return new c(function(){var r;var i;return new o(function(){r=n.getEnumerator();i=new(ss.makeGenericType(ss.Dictionary$2,[Object,Object]))(null,t);c.from(e).forEach(function(e){i.add(e)})},function(){while(r.moveNext()){var e=r.current();if(!i.containsKey(e)){i.add(e);return this.yieldReturn(e)}}return false},function(){u.dispose(r)})})};c.prototype.intersect=function(e,t){var n=this;return new c(function(){var r;var i;var a;return new o(function(){r=n.getEnumerator();i=new(ss.makeGenericType(ss.Dictionary$2,[Object,Object]))(null,t);c.from(e).forEach(function(e){i.add(e)});a=new(ss.makeGenericType(ss.Dictionary$2,[Object,Object]))(null,t)},function(){while(r.moveNext()){var e=r.current();if(!a.containsKey(e)&&i.containsKey(e)){a.add(e);return this.yieldReturn(e)}}return false},function(){u.dispose(r)})})};c.prototype.sequenceEqual=function(e,t){t=t||ss.EqualityComparer.def;var n=this.getEnumerator();try{var r=c.from(e).getEnumerator();try{while(n.moveNext()){if(!r.moveNext()||!t.areEqual(n.current(),r.current())){return false}}if(r.moveNext())return false;return true}finally{u.dispose(r)}}finally{u.dispose(n)}};c.prototype.union=function(e,n){var r=this;return new c(function(){var i;var a;var f;return new o(function(){i=r.getEnumerator();f=new(ss.makeGenericType(ss.Dictionary$2,[Object,Object]))(null,n)},function(){var n;if(a===t){while(i.moveNext()){n=i.current();if(!f.containsKey(n)){f.add(n);return this.yieldReturn(n)}}a=c.from(e).getEnumerator()}while(a.moveNext()){n=a.current();if(!f.containsKey(n)){f.add(n);return this.yieldReturn(n)}}return false},function(){try{u.dispose(i)}finally{u.dispose(a)}})})};c.prototype.orderBy=function(e,t){return new s(this,e,t,false)};c.prototype.orderByDescending=function(e,t){return new s(this,e,t,true)};c.prototype.reverse=function(){var e=this;return new c(function(){var t;var r;return new o(function(){t=e.toArray();r=t.length},function(){return r>0?this.yieldReturn(t[--r]):false},n.Blank)})};c.prototype.shuffle=function(){var e=this;return new c(function(){var t;return new o(function(){t=e.toArray()},function(){if(t.length>0){var e=Math.floor(Math.random()*t.length);return this.yieldReturn(t.splice(e,1)[0])}return false},n.Blank)})};c.prototype.weightedSample=function(e){e=u.createLambda(e);var t=this;return new c(function(){var r;var u=0;return new o(function(){r=t.choose(function(t){var n=e(t);if(n<=0)return null;u+=n;return{value:t,bound:u}}).toArray()},function(){if(r.length>0){var e=Math.floor(Math.random()*u)+1;var t=-1;var n=r.length;while(n-t>1){var i=Math.floor((t+n)/2);if(r[i].bound>=e){n=i}else{t=i}}return this.yieldReturn(r[n].value)}return this.yieldBreak()},n.Blank)})};c.prototype.groupBy=function(e,t,n,r){var i=this;e=u.createLambda(e);t=u.createLambda(t);if(n!=null)n=u.createLambda(n);return new c(function(){var a;return new o(function(){a=i.toLookup(e,t,r).toEnumerable().getEnumerator()},function(){while(a.moveNext()){return n==null?this.yieldReturn(a.current()):this.yieldReturn(n(a.current().key(),a.current()))}return false},function(){u.dispose(a)})})};c.prototype.partitionBy=function(e,t,n,r){var i=this;e=u.createLambda(e);t=u.createLambda(t);r=r||ss.EqualityComparer.def;var a;if(n==null){a=false;n=function(e,t){return new d(e,t)}}else{a=true;n=u.createLambda(n)}return new c(function(){var f;var s;var l=[];return new o(function(){f=i.getEnumerator();if(f.moveNext()){s=e(f.current());l.push(t(f.current()))}},function(){var u;while((u=f.moveNext())==true){if(r.areEqual(s,e(f.current()))){l.push(t(f.current()))}else break}if(l.length>0){var i=a?n(s,c.from(l)):n(s,l);if(u){s=e(f.current());l=[t(f.current())]}else l=[];return this.yieldReturn(i)}return false},function(){u.dispose(f)})})};c.prototype.buffer=function(e){var t=this;return new c(function(){var n;return new o(function(){n=t.getEnumerator()},function(){var t=[];var r=0;while(n.moveNext()){t.push(n.current());if(++r>=e)return this.yieldReturn(t)}if(t.length>0)return this.yieldReturn(t);return false},function(){u.dispose(n)})})};c.prototype.aggregate=function(e,t,n){n=u.createLambda(n);return n(this.scan(e,t,n).last())};c.prototype.average=function(e){e=u.createLambda(e);var t=0;var n=0;this.forEach(function(r){t+=e(r);++n});return t/n};c.prototype.count=function(e){e=e==null?n.True:u.createLambda(e);var t=0;this.forEach(function(n,r){if(e(n,r))++t});return t};c.prototype.max=function(e){if(e==null)e=n.Identity;return this.select(e).aggregate(function(e,t){return e>t?e:t})};c.prototype.min=function(e){if(e==null)e=n.Identity;return this.select(e).aggregate(function(e,t){return e<t?e:t})};c.prototype.maxBy=function(e){e=u.createLambda(e);return this.aggregate(function(t,n){return e(t)>e(n)?t:n})};c.prototype.minBy=function(e){e=u.createLambda(e);return this.aggregate(function(t,n){return e(t)<e(n)?t:n})};c.prototype.sum=function(e){if(e==null)e=n.Identity;return this.select(e).aggregate(0,function(e,t){return e+t})};c.prototype.elementAt=function(e){var t;var n=false;this.forEach(function(r,u){if(u==e){t=r;n=true;return false}});if(!n)throw new Error("index is less than 0 or greater than or equal to the number of elements in source.");return t};c.prototype.elementAtOrDefault=function(e,n){if(n===t)n=null;var r;var u=false;this.forEach(function(t,n){if(n==e){r=t;u=true;return false}});return!u?n:r};c.prototype.first=function(e){if(e!=null)return this.where(e).first();var t;var n=false;this.forEach(function(e){t=e;n=true;return false});if(!n)throw new Error("first:No element satisfies the condition.");return t};c.prototype.firstOrDefault=function(e,n){if(n===t)n=null;if(e!=null)return this.where(e).firstOrDefault(null,n);var r;var u=false;this.forEach(function(e){r=e;u=true;return false});return!u?n:r};c.prototype.last=function(e){if(e!=null)return this.where(e).last();var t;var n=false;this.forEach(function(e){n=true;t=e});if(!n)throw new Error("last:No element satisfies the condition.");return t};c.prototype.lastOrDefault=function(e,n){if(n===t)n=null;if(e!=null)return this.where(e).lastOrDefault(null,n);var r;var u=false;this.forEach(function(e){u=true;r=e});return!u?n:r};c.prototype.single=function(e){if(e!=null)return this.where(e).single();var t;var n=false;this.forEach(function(e){if(!n){n=true;t=e}else throw new Error("single:sequence contains more than one element.")});if(!n)throw new Error("single:No element satisfies the condition.");return t};c.prototype.singleOrDefault=function(e,n){if(n===t)n=null;if(e!=null)return this.where(e).singleOrDefault(null,n);var r;var u=false;this.forEach(function(e){if(!u){u=true;r=e}else throw new Error("single:sequence contains more than one element.")});return!u?n:r};c.prototype.skip=function(e){var t=this;return new c(function(){var n;var r=0;return new o(function(){n=t.getEnumerator();while(r++<e&&n.moveNext()){}},function(){return n.moveNext()?this.yieldReturn(n.current()):false},function(){u.dispose(n)})})};c.prototype.skipWhile=function(e){e=u.createLambda(e);var t=this;return new c(function(){var n;var r=0;var i=false;return new o(function(){n=t.getEnumerator()},function(){while(!i){if(n.moveNext()){if(!e(n.current(),r++)){i=true;return this.yieldReturn(n.current())}continue}else return false}return n.moveNext()?this.yieldReturn(n.current()):false},function(){u.dispose(n)})})};c.prototype.take=function(e){var t=this;return new c(function(){var n;var r=0;return new o(function(){n=t.getEnumerator()},function(){return r++<e&&n.moveNext()?this.yieldReturn(n.current()):false},function(){u.dispose(n)})})};c.prototype.takeWhile=function(e){e=u.createLambda(e);var t=this;return new c(function(){var n;var r=0;return new o(function(){n=t.getEnumerator()},function(){return n.moveNext()&&e(n.current(),r++)?this.yieldReturn(n.current()):false},function(){u.dispose(n)})})};c.prototype.takeExceptLast=function(e){if(e==null)e=1;var t=this;return new c(function(){if(e<=0)return t.getEnumerator();var n;var r=[];return new o(function(){n=t.getEnumerator()},function(){while(n.moveNext()){if(r.length==e){r.push(n.current());return this.yieldReturn(r.shift())}r.push(n.current())}return false},function(){u.dispose(n)})})};c.prototype.takeFromLast=function(e){if(e<=0||e==null)return c.empty();var t=this;return new c(function(){var n;var r;var i=[];return new o(function(){n=t.getEnumerator()},function(){while(n.moveNext()){if(i.length==e)i.shift();i.push(n.current())}if(r==null){r=c.from(i).getEnumerator()}return r.moveNext()?this.yieldReturn(r.current()):false},function(){u.dispose(r)})})};c.prototype.indexOf=function(e,t){var n=null;if(typeof e===r.Function){this.forEach(function(t,r){if(e(t,r)){n=r;return false}})}else{t=t||ss.EqualityComparer.def;this.forEach(function(r,u){if(t.areEqual(r,e)){n=u;return false}})}return n!==null?n:-1};c.prototype.lastIndexOf=function(e,t){var n=-1;if(typeof e===r.Function){this.forEach(function(t,r){if(e(t,r))n=r})}else{t=t||ss.EqualityComparer.def;this.forEach(function(r,u){if(t.areEqual(r,e))n=u})}return n};c.prototype.asEnumerable=function(){return c.from(this)};c.prototype.toArray=function(){var e=[];this.forEach(function(t){e.push(t)});return e};c.prototype.toLookup=function(e,t,n){e=u.createLambda(e);t=u.createLambda(t);var r=new(ss.makeGenericType(ss.Dictionary$2,[Object,Object]))(null,n);var i=[];this.forEach(function(n){var u=e(n);var o=t(n);var a={$:null};if(r.tryGetValue(u,a)){a.$.push(o)}else{i.push(u);r.add(u,[o])}});return new m(r,i)};c.prototype.toObject=function(e,t){e=u.createLambda(e);t=u.createLambda(t);var n={};this.forEach(function(r){n[e(r)]=t(r)});return n};c.prototype.toDictionary=function(e,t,n,r,i){e=u.createLambda(e);t=u.createLambda(t);var o=new(ss.makeGenericType(ss.Dictionary$2,[n,r]))(null,i);this.forEach(function(n){o.add(e(n),t(n))});return o};c.prototype.toJSONString=function(e,t){if(typeof JSON===r.Undefined||JSON.stringify==null){throw new Error("toJSONString can't find JSON.stringify. This works native JSON support Browser or include json2.js")}return JSON.stringify(this.toArray(),e,t)};c.prototype.toJoinedString=function(e,t){if(e==null)e="";if(t==null)t=n.Identity;return this.select(t).toArray().join(e)};c.prototype.doAction=function(e){var t=this;e=u.createLambda(e);return new c(function(){var n;var r=0;return new o(function(){n=t.getEnumerator()},function(){if(n.moveNext()){e(n.current(),r++);return this.yieldReturn(n.current())}return false},function(){u.dispose(n)})})};c.prototype.forEach=function(e){e=u.createLambda(e);var t=0;var n=this.getEnumerator();try{while(n.moveNext()){if(e(n.current(),t++)===false)break}}finally{u.dispose(n)}};c.prototype.write=function(e,t){if(e==null)e="";t=u.createLambda(t);var n=true;this.forEach(function(r){if(n)n=false;else document.write(e);document.write(t(r))})};c.prototype.writeLine=function(e){e=u.createLambda(e);this.forEach(function(t){document.writeln(e(t)+"<br />")})};c.prototype.force=function(){var e=this.getEnumerator();try{while(e.moveNext()){}}finally{u.dispose(e)}};c.prototype.letBind=function(e){e=u.createLambda(e);var t=this;return new c(function(){var n;return new o(function(){n=c.from(e(t)).getEnumerator()},function(){return n.moveNext()?this.yieldReturn(n.current()):false},function(){u.dispose(n)})})};c.prototype.share=function(){var e=this;var t;var r=false;return new p(function(){return new o(function(){if(t==null){t=e.getEnumerator()}},function(){if(r)throw new Error("enumerator is disposed");return t.moveNext()?this.yieldReturn(t.current()):false},n.Blank)},function(){r=true;u.dispose(t)})};c.prototype.memoize=function(){var e=this;var t;var r;var i=false;return new p(function(){var u=-1;return new o(function(){if(r==null){r=e.getEnumerator();t=[]}},function(){if(i)throw new Error("enumerator is disposed");u++;if(t.length<=u){return r.moveNext()?this.yieldReturn(t[u]=r.current()):false}return this.yieldReturn(t[u])},n.Blank)},function(){i=true;u.dispose(r);t=null})};c.prototype.catchError=function(e){e=u.createLambda(e);var t=this;return new c(function(){var n;return new o(function(){n=t.getEnumerator()},function(){try{return n.moveNext()?this.yieldReturn(n.current()):false}catch(t){e(t);return false}},function(){u.dispose(n)})})};c.prototype.finallyAction=function(e){e=u.createLambda(e);var t=this;return new c(function(){var n;return new o(function(){n=t.getEnumerator()},function(){return n.moveNext()?this.yieldReturn(n.current()):false},function(){try{u.dispose(n)}finally{e()}})})};c.prototype.log=function(e){e=u.createLambda(e);return this.doAction(function(t){if(typeof console!==r.Undefined){console.log(e(t))}})};c.prototype.trace=function(e,t){if(e==null)e="Trace";t=u.createLambda(t);return this.doAction(function(n){if(typeof console!==r.Undefined){console.log(e,t(n))}})};var s=function(e,t,n,r,i){this.source=e;this.keySelector=u.createLambda(t);this.comparer=n||ss.Comparer.def;this.descending=r;this.parent=i};s.prototype=new c;s.prototype.createOrderedEnumerable=function(e,t,n){return new s(this.source,e,t,n,this)};s.prototype.thenBy=function(e,t){return this.createOrderedEnumerable(e,t,false)};s.prototype.thenByDescending=function(e,t){return this.createOrderedEnumerable(e,t,true)};s.prototype.getEnumerator=function(){var e=this;var t;var r;var u=0;return new o(function(){t=[];r=[];e.source.forEach(function(e,n){t.push(e);r.push(n)});var n=l.create(e,null);n.GenerateKeys(t);r.sort(function(e,t){return n.compare(e,t)})},function(){return u<r.length?this.yieldReturn(t[r[u++]]):false},n.Blank)};var l=function(e,t,n,r){this.keySelector=e;this.comparer=t;this.descending=n;this.child=r;this.keys=null};l.create=function(e,t){var n=new l(e.keySelector,e.comparer,e.descending,t);if(e.parent!=null)return l.create(e.parent,n);return n};l.prototype.GenerateKeys=function(e){var t=e.length;var n=this.keySelector;var r=new Array(t);for(var u=0;u<t;u++)r[u]=n(e[u]);this.keys=r;if(this.child!=null)this.child.GenerateKeys(e)};l.prototype.compare=function(e,t){var n=this.comparer.compare(this.keys[e],this.keys[t]);if(n==0){if(this.child!=null)return this.child.compare(e,t);return u.compare(e,t)}return this.descending?-n:n};var p=function(e,t){this.dispose=t;c.call(this,e)};p.prototype=new c;var h=function(e){this.getSource=function(){return e}};h.prototype=new c;h.prototype.any=function(e){return e==null?this.getSource().length>0:c.prototype.any.apply(this,arguments)};h.prototype.count=function(e){return e==null?this.getSource().length:c.prototype.count.apply(this,arguments)};h.prototype.elementAt=function(e){var t=this.getSource();return 0<=e&&e<t.length?t[e]:c.prototype.elementAt.apply(this,arguments)};h.prototype.elementAtOrDefault=function(e,n){if(n===t)n=null;var r=this.getSource();return 0<=e&&e<r.length?r[e]:n};h.prototype.first=function(e){var t=this.getSource();return e==null&&t.length>0?t[0]:c.prototype.first.apply(this,arguments)};h.prototype.firstOrDefault=function(e,n){if(n===t)n=null;if(e!=null){return c.prototype.firstOrDefault.apply(this,arguments)}var r=this.getSource();return r.length>0?r[0]:n};h.prototype.last=function(e){var t=this.getSource();return e==null&&t.length>0?t[t.length-1]:c.prototype.last.apply(this,arguments)};h.prototype.lastOrDefault=function(e,n){if(n===t)n=null;if(e!=null){return c.prototype.lastOrDefault.apply(this,arguments)}var r=this.getSource();return r.length>0?r[r.length-1]:n};h.prototype.skip=function(e){var t=this.getSource();return new c(function(){var r;return new o(function(){r=e<0?0:e},function(){return r<t.length?this.yieldReturn(t[r++]):false},n.Blank)})};h.prototype.takeExceptLast=function(e){if(e==null)e=1;return this.take(this.getSource().length-e)};h.prototype.takeFromLast=function(e){return this.skip(this.getSource().length-e)};h.prototype.reverse=function(){var e=this.getSource();return new c(function(){var t;return new o(function(){t=e.length},function(){return t>0?this.yieldReturn(e[--t]):false},n.Blank)})};h.prototype.sequenceEqual=function(e,t){if((e instanceof h||e instanceof Array)&&t==null&&c.from(e).count()!=this.count()){return false}return c.prototype.sequenceEqual.apply(this,arguments)};h.prototype.toJoinedString=function(e,t){var n=this.getSource();
if(t!=null||!(n instanceof Array)){return c.prototype.toJoinedString.apply(this,arguments)}if(e==null)e="";return n.join(e)};h.prototype.getEnumerator=function(){return new ss.ArrayEnumerator(this.getSource())};var y=function(e,t){this.prevSource=e;this.prevPredicate=t};y.prototype=new c;y.prototype.where=function(e){e=u.createLambda(e);if(e.length<=1){var t=this.prevPredicate;var n=function(n){return t(n)&&e(n)};return new y(this.prevSource,n)}else{return c.prototype.where.call(this,e)}};y.prototype.select=function(e){e=u.createLambda(e);return e.length<=1?new v(this.prevSource,this.prevPredicate,e):c.prototype.select.call(this,e)};y.prototype.getEnumerator=function(){var e=this.prevPredicate;var t=this.prevSource;var n;return new o(function(){n=t.getEnumerator()},function(){while(n.moveNext()){if(e(n.current())){return this.yieldReturn(n.current())}}return false},function(){u.dispose(n)})};var v=function(e,t,n){this.prevSource=e;this.prevPredicate=t;this.prevSelector=n};v.prototype=new c;v.prototype.where=function(e){e=u.createLambda(e);return e.length<=1?new y(this,e):c.prototype.where.call(this,e)};v.prototype.select=function(e){e=u.createLambda(e);if(e.length<=1){var t=this.prevSelector;var n=function(n){return e(t(n))};return new v(this.prevSource,this.prevPredicate,n)}else{return c.prototype.select.call(this,e)}};v.prototype.getEnumerator=function(){var e=this.prevPredicate;var t=this.prevSelector;var n=this.prevSource;var r;return new o(function(){r=n.getEnumerator()},function(){while(r.moveNext()){if(e==null||e(r.current())){return this.yieldReturn(t(r.current()))}}return false},function(){u.dispose(r)})};var m=function(e,t){this.count=function(){return e.get_count()};this.get=function(t){var n={$:null};var r=e.tryGetValue(t,n);return c.from(r?n.$:[])};this.contains=function(t){return e.containsKey(t)};this.toEnumerable=function(){return c.from(t).select(function(t){return new d(t,e.get_item(t))})};this.getEnumerator=function(){return this.toEnumerable().getEnumerator()}};ss.initClass(m,a,{},null,[ss.IEnumerable]);var d=function(e,t){this.key=function(){return e};h.call(this,t)};d.prototype=new h;if(typeof define===r.Function&&define.amd){define("linqjs",[],function(){return c});e.Enumerable=c}else if(typeof module!==r.Undefined&&module.exports){module.exports=c;global.Enumerable=c}else{e.Enumerable=c}})(this);