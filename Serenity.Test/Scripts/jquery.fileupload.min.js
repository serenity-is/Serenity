(function(e){"use strict";if(typeof define==="function"&&define.amd){define(["jquery","jquery.ui.widget"],e)}else{e(window.jQuery)}})(function(e){"use strict";e.support.fileInput=!(new RegExp("(Android (1\\.[0156]|2\\.[01]))"+"|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)"+"|(w(eb)?OSBrowser)|(webOS)"+"|(Kindle/(1\\.0|2\\.[05]|3\\.0))").test(window.navigator.userAgent)||e('<input type="file">').prop("disabled"));e.support.xhrFileUpload=!!(window.ProgressEvent&&window.FileReader);e.support.xhrFormDataFileUpload=!!window.FormData;e.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice);e.widget("blueimp.fileupload",{options:{dropZone:e(document),pasteZone:e(document),fileInput:undefined,replaceFileInput:true,paramName:undefined,singleFileUploads:true,limitMultiFileUploads:undefined,limitMultiFileUploadSize:undefined,limitMultiFileUploadSizeOverhead:512,sequentialUploads:false,limitConcurrentUploads:undefined,forceIframeTransport:false,redirect:undefined,redirectParamName:undefined,postMessage:undefined,multipart:true,maxChunkSize:undefined,uploadedBytes:undefined,recalculateProgress:true,progressInterval:100,bitrateInterval:500,autoUpload:true,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(t,i){t=this.messages[t]||t.toString();if(i){e.each(i,function(e,i){t=t.replace("{"+e+"}",i)})}return t},formData:function(e){return e.serializeArray()},add:function(t,i){if(t.isDefaultPrevented()){return false}if(i.autoUpload||i.autoUpload!==false&&e(this).fileupload("option","autoUpload")){i.process().done(function(){i.submit()})}},processData:false,contentType:false,cache:false},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:e.support.blobSlice&&function(){var e=this.slice||this.webkitSlice||this.mozSlice;return e.apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime();this.loaded=0;this.bitrate=0;this.getBitrate=function(e,t,i){var r=e-this.timestamp;if(!this.bitrate||!i||r>i){this.bitrate=(t-this.loaded)*(1e3/r)*8;this.loaded=t;this.timestamp=e}return this.bitrate}},_isXHRUpload:function(t){return!t.forceIframeTransport&&(!t.multipart&&e.support.xhrFileUpload||e.support.xhrFormDataFileUpload)},_getFormData:function(t){var i;if(e.type(t.formData)==="function"){return t.formData(t.form)}if(e.isArray(t.formData)){return t.formData}if(e.type(t.formData)==="object"){i=[];e.each(t.formData,function(e,t){i.push({name:e,value:t})});return i}return[]},_getTotal:function(t){var i=0;e.each(t,function(e,t){i+=t.size||1});return i},_initProgressObject:function(t){var i={loaded:0,total:0,bitrate:0};if(t._progress){e.extend(t._progress,i)}else{t._progress=i}},_initResponseObject:function(e){var t;if(e._response){for(t in e._response){if(e._response.hasOwnProperty(t)){delete e._response[t]}}}else{e._response={}}},_onProgress:function(t,i){if(t.lengthComputable){var r=Date.now?Date.now():(new Date).getTime(),n;if(i._time&&i.progressInterval&&r-i._time<i.progressInterval&&t.loaded!==t.total){return}i._time=r;n=Math.floor(t.loaded/t.total*(i.chunkSize||i._progress.total))+(i.uploadedBytes||0);this._progress.loaded+=n-i._progress.loaded;this._progress.bitrate=this._bitrateTimer.getBitrate(r,this._progress.loaded,i.bitrateInterval);i._progress.loaded=i.loaded=n;i._progress.bitrate=i.bitrate=i._bitrateTimer.getBitrate(r,n,i.bitrateInterval);this._trigger("progress",e.Event("progress",{delegatedEvent:t}),i);this._trigger("progressall",e.Event("progressall",{delegatedEvent:t}),this._progress)}},_initProgressListener:function(t){var i=this,r=t.xhr?t.xhr():e.ajaxSettings.xhr();if(r.upload){e(r.upload).bind("progress",function(e){var r=e.originalEvent;e.lengthComputable=r.lengthComputable;e.loaded=r.loaded;e.total=r.total;i._onProgress(e,t)});t.xhr=function(){return r}}},_isInstanceOf:function(e,t){return Object.prototype.toString.call(t)==="[object "+e+"]"},_initXHRData:function(t){var i=this,r,n=t.files[0],s=t.multipart||!e.support.xhrFileUpload,o=e.type(t.paramName)==="array"?t.paramName[0]:t.paramName;t.headers=e.extend({},t.headers);if(t.contentRange){t.headers["Content-Range"]=t.contentRange}if(!s||t.blob||!this._isInstanceOf("File",n)){t.headers["Content-Disposition"]='attachment; filename="'+encodeURI(n.name)+'"'}if(!s){t.contentType=n.type||"application/octet-stream";t.data=t.blob||n}else if(e.support.xhrFormDataFileUpload){if(t.postMessage){r=this._getFormData(t);if(t.blob){r.push({name:o,value:t.blob})}else{e.each(t.files,function(i,n){r.push({name:e.type(t.paramName)==="array"&&t.paramName[i]||o,value:n})})}}else{if(i._isInstanceOf("FormData",t.formData)){r=t.formData}else{r=new FormData;e.each(this._getFormData(t),function(e,t){r.append(t.name,t.value)})}if(t.blob){r.append(o,t.blob,n.name)}else{e.each(t.files,function(n,s){if(i._isInstanceOf("File",s)||i._isInstanceOf("Blob",s)){r.append(e.type(t.paramName)==="array"&&t.paramName[n]||o,s,s.uploadName||s.name)}})}}t.data=r}t.blob=null},_initIframeSettings:function(t){var i=e("<a></a>").prop("href",t.url).prop("host");t.dataType="iframe "+(t.dataType||"");t.formData=this._getFormData(t);if(t.redirect&&i&&i!==location.host){t.formData.push({name:t.redirectParamName||"redirect",value:t.redirect})}},_initDataSettings:function(e){if(this._isXHRUpload(e)){if(!this._chunkedUpload(e,true)){if(!e.data){this._initXHRData(e)}this._initProgressListener(e)}if(e.postMessage){e.dataType="postmessage "+(e.dataType||"")}}else{this._initIframeSettings(e)}},_getParamName:function(t){var i=e(t.fileInput),r=t.paramName;if(!r){r=[];i.each(function(){var t=e(this),i=t.prop("name")||"files[]",n=(t.prop("files")||[1]).length;while(n){r.push(i);n-=1}});if(!r.length){r=[i.prop("name")||"files[]"]}}else if(!e.isArray(r)){r=[r]}return r},_initFormSettings:function(t){if(!t.form||!t.form.length){t.form=e(t.fileInput.prop("form"));if(!t.form.length){t.form=e(this.options.fileInput.prop("form"))}}t.paramName=this._getParamName(t);if(!t.url){t.url=t.form.prop("action")||location.href}t.type=(t.type||e.type(t.form.prop("method"))==="string"&&t.form.prop("method")||"").toUpperCase();if(t.type!=="POST"&&t.type!=="PUT"&&t.type!=="PATCH"){t.type="POST"}if(!t.formAcceptCharset){t.formAcceptCharset=t.form.attr("accept-charset")}},_getAJAXSettings:function(t){var i=e.extend({},this.options,t);this._initFormSettings(i);this._initDataSettings(i);return i},_getDeferredState:function(e){if(e.state){return e.state()}if(e.isResolved()){return"resolved"}if(e.isRejected()){return"rejected"}return"pending"},_enhancePromise:function(e){e.success=e.done;e.error=e.fail;e.complete=e.always;return e},_getXHRPromise:function(t,i,r){var n=e.Deferred(),s=n.promise();i=i||this.options.context||s;if(t===true){n.resolveWith(i,r)}else if(t===false){n.rejectWith(i,r)}s.abort=n.promise;return this._enhancePromise(s)},_addConvenienceMethods:function(t,i){var r=this,n=function(t){return e.Deferred().resolveWith(r,t).promise()};i.process=function(t,s){if(t||s){i._processQueue=this._processQueue=(this._processQueue||n([this])).pipe(function(){if(i.errorThrown){return e.Deferred().rejectWith(r,[i]).promise()}return n(arguments)}).pipe(t,s)}return this._processQueue||n([this])};i.submit=function(){if(this.state()!=="pending"){i.jqXHR=this.jqXHR=r._trigger("submit",e.Event("submit",{delegatedEvent:t}),this)!==false&&r._onSend(t,this)}return this.jqXHR||r._getXHRPromise()};i.abort=function(){if(this.jqXHR){return this.jqXHR.abort()}this.errorThrown="abort";r._trigger("fail",null,this);return r._getXHRPromise(false)};i.state=function(){if(this.jqXHR){return r._getDeferredState(this.jqXHR)}if(this._processQueue){return r._getDeferredState(this._processQueue)}};i.processing=function(){return!this.jqXHR&&this._processQueue&&r._getDeferredState(this._processQueue)==="pending"};i.progress=function(){return this._progress};i.response=function(){return this._response}},_getUploadedBytes:function(e){var t=e.getResponseHeader("Range"),i=t&&t.split("-"),r=i&&i.length>1&&parseInt(i[1],10);return r&&r+1},_chunkedUpload:function(t,i){t.uploadedBytes=t.uploadedBytes||0;var r=this,n=t.files[0],s=n.size,o=t.uploadedBytes,a=t.maxChunkSize||s,l=this._blobSlice,p=e.Deferred(),f=p.promise(),u,d;if(!(this._isXHRUpload(t)&&l&&(o||a<s))||t.data){return false}if(i){return true}if(o>=s){n.error=t.i18n("uploadedBytes");return this._getXHRPromise(false,t.context,[null,"error",n.error])}d=function(){var i=e.extend({},t),f=i._progress.loaded;i.blob=l.call(n,o,o+a,n.type);i.chunkSize=i.blob.size;i.contentRange="bytes "+o+"-"+(o+i.chunkSize-1)+"/"+s;r._initXHRData(i);r._initProgressListener(i);u=(r._trigger("chunksend",null,i)!==false&&e.ajax(i)||r._getXHRPromise(false,i.context)).done(function(n,a,l){o=r._getUploadedBytes(l)||o+i.chunkSize;if(f+i.chunkSize-i._progress.loaded){r._onProgress(e.Event("progress",{lengthComputable:true,loaded:o-i.uploadedBytes,total:o-i.uploadedBytes}),i)}t.uploadedBytes=i.uploadedBytes=o;i.result=n;i.textStatus=a;i.jqXHR=l;r._trigger("chunkdone",null,i);r._trigger("chunkalways",null,i);if(o<s){d()}else{p.resolveWith(i.context,[n,a,l])}}).fail(function(e,t,n){i.jqXHR=e;i.textStatus=t;i.errorThrown=n;r._trigger("chunkfail",null,i);r._trigger("chunkalways",null,i);p.rejectWith(i.context,[e,t,n])})};this._enhancePromise(f);f.abort=function(){return u.abort()};d();return f},_beforeSend:function(e,t){if(this._active===0){this._trigger("start");this._bitrateTimer=new this._BitrateTimer;this._progress.loaded=this._progress.total=0;this._progress.bitrate=0}this._initResponseObject(t);this._initProgressObject(t);t._progress.loaded=t.loaded=t.uploadedBytes||0;t._progress.total=t.total=this._getTotal(t.files)||1;t._progress.bitrate=t.bitrate=0;this._active+=1;this._progress.loaded+=t.loaded;this._progress.total+=t.total},_onDone:function(t,i,r,n){var s=n._progress.total,o=n._response;if(n._progress.loaded<s){this._onProgress(e.Event("progress",{lengthComputable:true,loaded:s,total:s}),n)}o.result=n.result=t;o.textStatus=n.textStatus=i;o.jqXHR=n.jqXHR=r;this._trigger("done",null,n)},_onFail:function(e,t,i,r){var n=r._response;if(r.recalculateProgress){this._progress.loaded-=r._progress.loaded;this._progress.total-=r._progress.total}n.jqXHR=r.jqXHR=e;n.textStatus=r.textStatus=t;n.errorThrown=r.errorThrown=i;this._trigger("fail",null,r)},_onAlways:function(e,t,i,r){this._trigger("always",null,r)},_onSend:function(t,i){if(!i.submit){this._addConvenienceMethods(t,i)}var r=this,n,s,o,a,l=r._getAJAXSettings(i),p=function(){r._sending+=1;l._bitrateTimer=new r._BitrateTimer;n=n||((s||r._trigger("send",e.Event("send",{delegatedEvent:t}),l)===false)&&r._getXHRPromise(false,l.context,s)||r._chunkedUpload(l)||e.ajax(l)).done(function(e,t,i){r._onDone(e,t,i,l)}).fail(function(e,t,i){r._onFail(e,t,i,l)}).always(function(e,t,i){r._onAlways(e,t,i,l);r._sending-=1;r._active-=1;if(l.limitConcurrentUploads&&l.limitConcurrentUploads>r._sending){var n=r._slots.shift();while(n){if(r._getDeferredState(n)==="pending"){n.resolve();break}n=r._slots.shift()}}if(r._active===0){r._trigger("stop")}});return n};this._beforeSend(t,l);if(this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending){if(this.options.limitConcurrentUploads>1){o=e.Deferred();this._slots.push(o);a=o.pipe(p)}else{this._sequence=this._sequence.pipe(p,p);a=this._sequence}a.abort=function(){s=[undefined,"abort","abort"];if(!n){if(o){o.rejectWith(l.context,s)}return p()}return n.abort()};return this._enhancePromise(a)}return p()},_onAdd:function(t,i){var r=this,n=true,s=e.extend({},this.options,i),o=i.files,a=o.length,l=s.limitMultiFileUploads,p=s.limitMultiFileUploadSize,f=s.limitMultiFileUploadSizeOverhead,u=0,d=this._getParamName(s),h,c,g,_,m=0;if(p&&(!a||o[0].size===undefined)){p=undefined}if(!(s.singleFileUploads||l||p)||!this._isXHRUpload(s)){g=[o];h=[d]}else if(!(s.singleFileUploads||p)&&l){g=[];h=[];for(_=0;_<a;_+=l){g.push(o.slice(_,_+l));c=d.slice(_,_+l);if(!c.length){c=d}h.push(c)}}else if(!s.singleFileUploads&&p){g=[];h=[];for(_=0;_<a;_=_+1){u+=o[_].size+f;if(_+1===a||u+o[_+1].size+f>p||l&&_+1-m>=l){g.push(o.slice(m,_+1));c=d.slice(m,_+1);if(!c.length){c=d}h.push(c);m=_+1;u=0}}}else{h=d}i.originalFiles=o;e.each(g||o,function(s,o){var a=e.extend({},i);a.files=g?o:[o];a.paramName=h[s];r._initResponseObject(a);r._initProgressObject(a);r._addConvenienceMethods(t,a);n=r._trigger("add",e.Event("add",{delegatedEvent:t}),a);return n});return n},_replaceFileInput:function(t){var i=t.clone(true);e("<form></form>").append(i)[0].reset();t.after(i).detach();e.cleanData(t.unbind("remove"));this.options.fileInput=this.options.fileInput.map(function(e,r){if(r===t[0]){return i[0]}return r});if(t[0]===this.element[0]){this.element=i}},_handleFileTreeEntry:function(t,i){var r=this,n=e.Deferred(),s=function(e){if(e&&!e.entry){e.entry=t}n.resolve([e])},o;i=i||"";if(t.isFile){if(t._file){t._file.relativePath=i;n.resolve(t._file)}else{t.file(function(e){e.relativePath=i;n.resolve(e)},s)}}else if(t.isDirectory){o=t.createReader();o.readEntries(function(e){r._handleFileTreeEntries(e,i+t.name+"/").done(function(e){n.resolve(e)}).fail(s)},s)}else{n.resolve([])}return n.promise()},_handleFileTreeEntries:function(t,i){var r=this;return e.when.apply(e,e.map(t,function(e){return r._handleFileTreeEntry(e,i)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(t){t=t||{};var i=t.items;if(i&&i.length&&(i[0].webkitGetAsEntry||i[0].getAsEntry)){return this._handleFileTreeEntries(e.map(i,function(e){var t;if(e.webkitGetAsEntry){t=e.webkitGetAsEntry();if(t){t._file=e.getAsFile()}return t}return e.getAsEntry()}))}return e.Deferred().resolve(e.makeArray(t.files)).promise()},_getSingleFileInputFiles:function(t){t=e(t);var i=t.prop("webkitEntries")||t.prop("entries"),r,n;if(i&&i.length){return this._handleFileTreeEntries(i)}r=e.makeArray(t.prop("files"));if(!r.length){n=t.prop("value");if(!n){return e.Deferred().resolve([]).promise()}r=[{name:n.replace(/^.*\\/,"")}]}else if(r[0].name===undefined&&r[0].fileName){e.each(r,function(e,t){t.name=t.fileName;t.size=t.fileSize})}return e.Deferred().resolve(r).promise()},_getFileInputFiles:function(t){if(!(t instanceof e)||t.length===1){return this._getSingleFileInputFiles(t)}return e.when.apply(e,e.map(t,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_onChange:function(t){var i=this,r={fileInput:e(t.target),form:e(t.target.form)};this._getFileInputFiles(r.fileInput).always(function(n){r.files=n;if(i.options.replaceFileInput){i._replaceFileInput(r.fileInput)}if(i._trigger("change",e.Event("change",{delegatedEvent:t}),r)!==false){i._onAdd(t,r)}})},_onPaste:function(t){var i=t.originalEvent&&t.originalEvent.clipboardData&&t.originalEvent.clipboardData.items,r={files:[]};if(i&&i.length){e.each(i,function(e,t){var i=t.getAsFile&&t.getAsFile();if(i){r.files.push(i)}});if(this._trigger("paste",e.Event("paste",{delegatedEvent:t}),r)!==false){this._onAdd(t,r)}}},_onDrop:function(t){t.dataTransfer=t.originalEvent&&t.originalEvent.dataTransfer;var i=this,r=t.dataTransfer,n={};if(r&&r.files&&r.files.length){t.preventDefault();this._getDroppedFiles(r).always(function(r){n.files=r;if(i._trigger("drop",e.Event("drop",{delegatedEvent:t}),n)!==false){i._onAdd(t,n)}})}},_onDragOver:function(t){t.dataTransfer=t.originalEvent&&t.originalEvent.dataTransfer;var i=t.dataTransfer;if(i&&e.inArray("Files",i.types)!==-1&&this._trigger("dragover",e.Event("dragover",{delegatedEvent:t}))!==false){t.preventDefault();i.dropEffect="copy"}},_initEventHandlers:function(){if(this._isXHRUpload(this.options)){this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop});this._on(this.options.pasteZone,{paste:this._onPaste})}if(e.support.fileInput){this._on(this.options.fileInput,{change:this._onChange})}},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragover drop");this._off(this.options.pasteZone,"paste");this._off(this.options.fileInput,"change")},_setOption:function(t,i){var r=e.inArray(t,this._specialOptions)!==-1;if(r){this._destroyEventHandlers()}this._super(t,i);if(r){this._initSpecialOptions();this._initEventHandlers()}},_initSpecialOptions:function(){var t=this.options;if(t.fileInput===undefined){t.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]')}else if(!(t.fileInput instanceof e)){t.fileInput=e(t.fileInput)}if(!(t.dropZone instanceof e)){t.dropZone=e(t.dropZone)}if(!(t.pasteZone instanceof e)){t.pasteZone=e(t.pasteZone)}},_getRegExp:function(e){var t=e.split("/"),i=t.pop();t.shift();return new RegExp(t.join("/"),i)},_isRegExpOption:function(t,i){return t!=="url"&&e.type(i)==="string"&&/^\/.*\/[igm]{0,3}$/.test(i)},_initDataAttributes:function(){var t=this,i=this.options;e.each(e(this.element[0].cloneNode(false)).data(),function(e,r){if(t._isRegExpOption(e,r)){r=t._getRegExp(r)}i[e]=r})},_create:function(){this._initDataAttributes();this._initSpecialOptions();this._slots=[];this._sequence=this._getXHRPromise(true);this._sending=this._active=0;this._initProgressObject(this);this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(t){var i=this;if(!t||this.options.disabled){return}if(t.fileInput&&!t.files){this._getFileInputFiles(t.fileInput).always(function(e){t.files=e;i._onAdd(null,t)})}else{t.files=e.makeArray(t.files);this._onAdd(null,t)}},send:function(t){if(t&&!this.options.disabled){if(t.fileInput&&!t.files){var i=this,r=e.Deferred(),n=r.promise(),s,o;n.abort=function(){o=true;if(s){return s.abort()}r.reject(null,"abort","abort");return n};this._getFileInputFiles(t.fileInput).always(function(e){if(o){return}if(!e.length){r.reject();return}t.files=e;s=i._onSend(null,t).then(function(e,t,i){r.resolve(e,t,i)},function(e,t,i){r.reject(e,t,i)})});return this._enhancePromise(n)}t.files=e.makeArray(t.files);if(t.files.length){return this._onSend(null,t)}}return this._getXHRPromise(false,t&&t.context)}})});