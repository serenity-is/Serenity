<Project>
  <Import Project="..\src\RestoreNpmPackages.targets" />
  <PropertyGroup>
    <StaticWebAssetBasePath Condition="$('StaticWebAssetBasePath') == ''">/$(AssemblyName)</StaticWebAssetBasePath>
    <ESMAssetBasePath Condition="$('ESMAssetBasePath') == ''">$(StaticWebAssetBasePath)/esm</ESMAssetBasePath>
  </PropertyGroup>
  <ItemGroup>
    <TypeScriptCompile Remove="node_modules\**;obj\**;out\**;dist\**"></TypeScriptCompile>
    <ProjectCapability Include="TypeScriptNuGet" />
    <Content Update="$(MSBuildProjectDirectory)\coverage\**\*;$(MSBuildProjectDirectory)\out\**\*;$(MSBuildProjectDirectory)\package*.json;$(MSBuildProjectDirectory)\sergen*.json;$(MSBuildProjectDirectory)\ts*.json;$(MSBuildProjectDirectory)\src\**\*;$(MSBuildProjectDirectory)\test\**\*" CopyToOutputDirectory="Never" CopyToPublishDirectory="Never" Pack="false" />
    <None Update="$(MSBuildProjectDirectory)\coverage\**\*;$(MSBuildProjectDirectory)\out\**\*;$(MSBuildProjectDirectory)\jest*.js;$(MSBuildProjectDirectory)\vitest*.*;$(MSBuildProjectDirectory)\tsbuild*.js;$(MSBuildProjectDirectory)\test\**\*" CopyToOutputDirectory="Never" CopyToPublishDirectory="Never" Pack="false" />
    <None Include="$(MSBuildProjectDirectory)\dist\**" CopyToOutputDirectory="Never" CopyToPublishDirectory="Never" Pack="true" PackagePath="dist\" />
  </ItemGroup>
  <Target Name="CompileProjectTSConfig" BeforeTargets="ResolveProjectStaticWebAssets" DependsOnTargets="NpmInstall" Condition="'$(RunTSBuild)' == 'true'">
    <ItemGroup>
      <_ContentBeforeTSBuild Include="wwwroot\**\*" />
    </ItemGroup>
    <Exec Command="pnpm build" />
    <ItemGroup>
      <_ContentAfterTSBuild Include="wwwroot\**\*" Exclude="@(_ContentBeforeTSBuild)" />
      <Content Include="@(_ContentAfterTSBuild)" Exclude="@(Content)" CopyToOutputDirectory="Never" CopyToPublishDirectory="PreserveNewest" ExcludeFromSingleFile="true" />
      <_ContentBeforeTSBuild Remove="wwwroot\**\*" />
      <Content Remove="@(_ContentBeforeTSBuild)" />
    </ItemGroup>
  </Target>  
</Project>