<Project>
  <Import Project="..\src\RestoreNpmPackages.targets" />
  <PropertyGroup>
    <StaticWebAssetBasePath Condition="$('StaticWebAssetBasePath') == ''">/$(AssemblyName)</StaticWebAssetBasePath>
    <ESMAssetBasePath Condition="$('ESMAssetBasePath') == ''">$(StaticWebAssetBasePath)/esm</ESMAssetBasePath>
  </PropertyGroup>
  <ItemGroup>
    <TypeScriptCompile Remove="node_modules\**;obj\**;out\**;dist\**"></TypeScriptCompile>
    <ProjectCapability Include="TypeScriptNuGet" />
    <Content Update="$(MSBuildProjectDirectory)\coverage\**\*;$(MSBuildProjectDirectory)\out\**\*;$(MSBuildProjectDirectory)\package*.json;$(MSBuildProjectDirectory)\sergen*.json;$(MSBuildProjectDirectory)\ts*.json;$(MSBuildProjectDirectory)\src\**\*;$(MSBuildProjectDirectory)\test\**\*" CopyToOutputDirectory="Never" CopyToPublishDirectory="Never" Pack="false" />
    <None Update="$(MSBuildProjectDirectory)\coverage\**\*;$(MSBuildProjectDirectory)\out\**\*;$(MSBuildProjectDirectory)\jest*.js;$(MSBuildProjectDirectory)\vitest*.*;$(MSBuildProjectDirectory)\tsbuild*.js;$(MSBuildProjectDirectory)\test\**\*" CopyToOutputDirectory="Never" CopyToPublishDirectory="Never" Pack="false" />
    <None Include="$(MSBuildProjectDirectory)\dist\**" CopyToOutputDirectory="Never" CopyToPublishDirectory="Never" Pack="true" PackagePath="dist\" />
  </ItemGroup>
  <Target Name="CreateNodeModules" AfterTargets="NpmInstall" Condition="'$(CreateNodeModulesDirectory)' == 'true'">
    <MakeDir Directories="$(MSBuildProjectDirectory)\node_modules" Condition="!Exists('$(MSBuildProjectDirectory)\node_modules')" />
    <Touch AlwaysCreate="true" Files="$(MSBuildProjectDirectory)\node_modules\.keep" Condition="!Exists('$(MSBuildProjectDirectory)\node_modules\.keep')" />
  </Target>
  <Target Name="RunTSBuild" BeforeTargets="ResolveProjectStaticWebAssets" DependsOnTargets="NpmInstall" Condition="'$(RunTSBuild)' == 'true'">
    <Exec Command="pnpm build" />
  </Target>  
</Project>