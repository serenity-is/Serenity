var Serenity;(function(e){var t;(function(e){var t;var r;(function(e){e[e["Server"]=1]="Server";e[e["SS"]=2]="SS";e[e["TS"]=3]="TS"})(r=e.ExternalTypeOrigin||(e.ExternalTypeOrigin={}));function n(e,t){if(!e||!e.length)return false;for(var r=0,n=e;r<n.length;r++){var i=n[r];if(t(i))return true}return false}function i(e,t){if(!e||!e.length)return null;for(var r=0,n=e;r<n.length;r++){var i=n[r];if(t(i))return i}return null}function a(e){var t=[];if(!e)return t;while(e=e.parent){t.push(e)}return t.reverse()}function s(e){var t="";for(var r=0,n=a(e);r<n.length;r++){var i=n[r];if(i.kind==ts.SyntaxKind.ModuleDeclaration){if(t.length>0)t+=".";t+=i.name.getText()}}return t}function o(e,t){var r=s(t);if(r.length)return r+"."+e;return e}function u(e){if(!e)return e;var t={};for(var r in e){if(e.hasOwnProperty(r))t[r]=e[r]}return t}function l(e){if(!e.heritageClauses)return null;for(var t=0,r=e.heritageClauses;t<r.length;t++){var n=r[t];if(n.token==ts.SyntaxKind.ExtendsKeyword&&n.types!=null){for(var i=0,a=n.types;i<a.length;i++){var s=a[i];return x(s)}}}}function f(e){var t=[];if(!e.heritageClauses)return t;for(var r=0,n=e.heritageClauses;r<n.length;r++){var i=n[r];if(i.token==ts.SyntaxKind.ImplementsKeyword&&i.types!=null){for(var a=0,s=i.types;a<s.length;a++){var o=s[a];t.push(x(o))}}}return t}function c(e){var t=[];if(!e.heritageClauses)return t;for(var r=0,n=e.heritageClauses;r<n.length;r++){var i=n[r];if(i.token==ts.SyntaxKind.ExtendsKeyword&&i.types!=null){for(var a=0,s=i.types;a<s.length;a++){var o=s[a];t.push(x(o))}}}return t}function d(e){return n(a(e),function(e){return e.kind==ts.SyntaxKind.ModuleDeclaration&&n(e.modifiers,function(e){return e.kind==ts.SyntaxKind.DeclareKeyword})||e.kind==ts.SyntaxKind.SourceFile&&e.isDeclarationFile})}function p(e){return n(e.modifiers,function(e){return e.kind==ts.SyntaxKind.ExportKeyword})}function y(e){return n(e.modifiers,function(e){return e.kind==ts.SyntaxKind.DeclareKeyword})}function v(e){return!n(e.modifiers,function(e){return e.kind==ts.SyntaxKind.PrivateKeyword||e.kind==ts.SyntaxKind.ProtectedKeyword})}function m(e){return false}function g(e){return false}function x(e){if(!e)return"";try{var r=t.getTypeAtLocation(e);return t.getFullyQualifiedName(r.getSymbol())}catch(n){return e.getText()}}function h(e){if(e.expression==null)return false;var t=null;if(e.expression.kind==ts.SyntaxKind.CallExpression){var r=e.expression;if(r.expression!=null&&r.expression.kind==ts.SyntaxKind.PropertyAccessExpression){t=r.expression}}else if(e.expression.kind==ts.SyntaxKind.PropertyAccessExpression){t=e.expression}if(!t)return;var n=x(t);return n=="Serenity.Decorators.option"}function S(e){var t={Type:"",Arguments:[]};if(e.expression==null)return null;var r=null;if(e.expression.kind==ts.SyntaxKind.CallExpression){var n=e.expression;if(n.expression!=null&&n.expression.kind==ts.SyntaxKind.PropertyAccessExpression){r=n.expression;t.Type=x(r)}for(var i=0,a=n.arguments;i<a.length;i++){var s=a[i];switch(s.kind){case ts.SyntaxKind.StringLiteral:t.Arguments.push({Value:s.text});break;case ts.SyntaxKind.NumericLiteral:t.Arguments.push({Value:parseFloat(s.text)});break;default:t.Arguments.push({Value:null});break}}}else if(e.expression.kind==ts.SyntaxKind.PropertyAccessExpression){r=e.expression;t.Type=x(r)}return t}function K(e){var t=[];for(var r=0,n=e.members;r<n.length;r++){var i=n[r];if(i.kind!=ts.SyntaxKind.PropertySignature&&i.kind!=ts.SyntaxKind.MethodSignature)continue;var a=i.name.getText();if(t[a])continue;var s={Name:a,Type:"",Attributes:i.decorators==null?[]:i.decorators.map(S)};if(i.kind==ts.SyntaxKind.PropertySignature){var o=i;if(o.type)s.Type=x(o.type)}else if(i.kind==ts.SyntaxKind.MethodSignature){var u=s;u.Arguments=[];var l=i;if(l.type){s.Type=x(l.type)}for(var f=0,c=l.parameters;f<c.length;f++){var d=c[f];u.Arguments.push({Name:d.name.getText(),Type:x(d.type)})}}t[a]=s;t.push(s)}return t}function T(e){var t=[];for(var r=0,i=e.members;r<i.length;r++){var a=i[r];if(a.kind!=ts.SyntaxKind.MethodDeclaration&&a.kind!=ts.SyntaxKind.PropertyDeclaration&&a.kind!=ts.SyntaxKind.Constructor)continue;var s=a.name?a.name.getText():"$ctor";if(t[s])continue;var o={Name:s,IsStatic:n(a.modifiers,function(e){return e.getText()=="static"}),Type:"",Attributes:a.decorators==null?[]:a.decorators.map(S)};if(a.kind==ts.SyntaxKind.PropertyDeclaration){var u=a;if(u.type)o.Type=x(u.type)}else if(a.kind==ts.SyntaxKind.MethodDeclaration){var l=o;l.Arguments=[];var f=a;if(f.type){o.Type=x(f.type)}for(var c=0,d=f.parameters;c<d.length;c++){var p=d[c];l.Arguments.push({Name:p.name.getText(),Type:x(p.type)})}}else if(a.kind==ts.SyntaxKind.Constructor){var l=o;l.Arguments=[];l.IsConstructor=true;var f=a;for(var y=0,v=f.parameters;y<v.length;y++){var p=v[y];l.Arguments.push({Name:p.name.getText(),Type:x(p.type)})}}t[s]=o;t.push(o)}return t}function k(e){var t=[];for(var r=0,n=e.body.getChildren();r<n.length;r++){var i=n[r];if(i.kind!=ts.SyntaxKind.MethodDeclaration&&i.kind!=ts.SyntaxKind.PropertyDeclaration)continue;var a=i.name?i.name.getText():"";if(!a||t[a])continue;var s={Name:a,IsStatic:true,Type:"",Attributes:i.decorators==null?[]:i.decorators.map(S)};if(i.kind==ts.SyntaxKind.PropertyDeclaration){var o=i;if(o.type)s.Type=x(o.type)}else if(i.kind==ts.SyntaxKind.MethodDeclaration){var u=s;u.Arguments=[];var l=i;if(l.type){s.Type=x(l.type)}for(var f=0,c=l.parameters;f<c.length;f++){var d=c[f];u.Arguments.push({Name:d.name.getText(),Type:x(d.type)})}}t[a]=s;t.push(s)}return t}function A(e){function t(e){e.$imports=e.parent?e.parent.$imports:{};switch(e.kind){case ts.SyntaxKind.ImportEqualsDeclaration:var r=e;e.$imports[r.name.getText()]=r.moduleReference.getText();break;case ts.SyntaxKind.ClassDeclaration:case ts.SyntaxKind.ModuleDeclaration:case ts.SyntaxKind.InterfaceDeclaration:e.$imports=u(e.$imports);break}ts.forEachChild(e,function(e){return t(e)})}t(e)}function N(e){if(e==null||e.length==0)return[];var t=[];for(var r=0,n=e;r<n.length;r++){var i=n[r];t.push({Name:i.getText()})}return t}function b(e){var t={AssemblyName:"",BaseType:l(e),GenericParameters:N(e.typeParameters),IsAbstract:n(e.modifiers,function(e){return e.getText()=="abstract"}),IsSealed:false,IsSerializable:false,Origin:3,Properties:[],Namespace:s(e),Name:e.name.getText(),IsInterface:false,IsDeclaration:d(e)};var r=T(e);t.Fields=r.filter(function(e){return e.Arguments==null});t.Methods=r.filter(function(e){return e.Arguments!=null});t.Interfaces=f(e);t.Attributes=e.decorators==null?[]:e.decorators.map(function(e){return S(e)});return t}function w(e){var t={AssemblyName:"",GenericParameters:N(e.typeParameters),Origin:3,Properties:[],Namespace:s(e),Name:e.name.getText(),IsInterface:true,IsDeclaration:d(e)};var r=K(e);t.Fields=r.filter(function(e){return e.Arguments==null});t.Methods=r.filter(function(e){return e.Arguments!=null});t.Interfaces=c(e);t.Attributes=e.decorators==null?[]:e.decorators.map(function(e){return S(e)});return t}function D(e){var t={AssemblyName:"",GenericParameters:[],Origin:3,Properties:[],Namespace:s(e),Name:e.name.getText(),IsInterface:true,IsDeclaration:d(e)};var r=k(e);t.Fields=r.filter(function(e){return e.Arguments==null});t.Methods=r.filter(function(e){return e.Arguments!=null});t.Interfaces=[];t.Attributes=[];return t}function C(e){var t=[];function r(n){if(!n)return;switch(n.kind){case ts.SyntaxKind.ClassDeclaration:var i=n;if(e.isDeclarationFile||p(n)){var a=o(i.name.getText(),i);var s=b(i);t[a]=s;t.push(s)}return;case ts.SyntaxKind.InterfaceDeclaration:var u=n;if(e.isDeclarationFile||p(n)){var l=o(u.name.getText(),u);var s=w(u);t[l]=s;t.push(s)}return;case ts.SyntaxKind.ModuleDeclaration:var f=n;if(e.isDeclarationFile||p(f)||!d(f)&&!y(f)){var c=o(f.name.getText(),f);var s=D(f);t[c]=s;t.push(s)}break}ts.forEachChild(n,function(e){return r(e)})}r(e);return t}function P(e){var t=1;return JSON.stringify(e,function(e,r){if(e=="kind")return ts.SyntaxKind[r];if(Object.prototype.toString.apply(r)=="[object Object]"){if(!r.$id&&r.kind){r.$id=(t++).toString();var n={$id:r.$id};for(var i in r){if(i!="$id"&&Object.hasOwnProperty.call(r,i)){n[i]=r[i]}}return n}else if(r.$id&&r.kind){return{$ref:r.$id}}}return r},"    ")}e.stringifyNode=P;function F(e){var t=ts.createSourceFile("dummy.ts",e,ts.ScriptTarget.ES5,true);A(t);return t}function I(e){return P(F(e))}e.parseSourceToJson=I;var E=function(){function e(){var e=this;this.files={};this.filesLower={};this.options={target:ts.ScriptTarget.ES5,moduleKind:ts.ModuleKind.None};this.fileExists=function(t){return!!(e.files[t]||e.filesLower[(t||"").toLowerCase()])};this.getCurrentDirectory=function(){return"/"};this.getDirectories=function(e){return[]};this.getDefaultLibFileName=function(e){return"/lib.d.ts"};this.getCanonicalFileName=function(e){return e.toLowerCase()};this.useCaseSensitiveFileNames=function(){return false};this.getNewLine=function(){return"\r\n"};this.readFile=function(t){var r=e.files[t];if(r===undefined)return e.filesLower[(t||"").toLowerCase()];return r}}e.prototype.writeFile=function(e,t,r,n){};e.prototype.getSourceFile=function(e,t,r){var n=this.files[e];if(n===undefined)n=this.filesLower[(e||"").toLowerCase()];var i=n!==undefined?ts.createSourceFile(e,n,t,true):undefined;if(i!=null&&e.substr(-5).toLowerCase()==".d.ts")i.isDeclarationFile=true;return i};e.prototype.resolveModuleNames=function(e,t){var r=this;return e.map(function(e){var n=ts.resolveModuleName(e,t,r.options,{fileExists:r.fileExists,readFile:r.readFile});if(n.resolvedModule){return n.resolvedModule}return undefined})};return e}();var M=new E;function L(e,t){M.files[e]=t;M.filesLower[(e||"").toLowerCase()]=t}e.addSourceFile=L;function $(){try{var e=Object.getOwnPropertyNames(M.files);var r=ts.createProgram(e,M.options,M);t=r.getTypeChecker();var n=[];for(var i in M.files){if(i=="/lib.d.ts")continue;var a=C(r.getSourceFile(i));for(var s=0,o=a;s<o.length;s++){var u=o[s];u.AssemblyName=i;var l=u.Namespace?u.Namespace+"."+u.Name:u.Name;if(n[l])continue;n[l]=u;n.push(u)}}return n}catch(f){throw new Error(f.toString()+f.stack)}}e.parseTypes=$})(t=e.CodeGeneration||(e.CodeGeneration={}))})(Serenity||(Serenity={}));