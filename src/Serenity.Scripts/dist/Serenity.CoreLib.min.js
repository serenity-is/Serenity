var __decorate=this&&this.__decorate||function(e,t,i,r){var n=arguments.length,a=n<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,i):r,o;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")a=Reflect.decorate(e,t,i,r);else for(var l=e.length-1;l>=0;l--)if(o=e[l])a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a;return n>3&&a&&Object.defineProperty(t,i,a),a};var __skipExtends={__metadata:true,__typeName:true,__componentFactory:true};var __extends=function(e,t){for(var i in t)if(t.hasOwnProperty(i)&&__skipExtends[i]!==true)e[i]=t[i];function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};var __assign=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++){t=arguments[i];for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n))e[n]=t[n]}return e};var __rest=function(e,t){var i={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0)i[r]=e[r];if(e!=null&&typeof Object.getOwnPropertySymbols==="function")for(var n=0,r=Object.getOwnPropertySymbols(e);n<r.length;n++)if(t.indexOf(r[n])<0)i[r[n]]=e[r[n]];return i};var __spreadArrays=function(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;for(var r=Array(e),n=0,t=0;t<i;t++)for(var a=arguments[t],o=0,l=a.length;o<l;o++,n++)r[n]=a[o];return r};if(typeof Promise==="undefined"){if(typeof RSVP!=="undefined")Promise=RSVP;else if(typeof $!=="undefined"){Promise=$.Deferred;Promise.resolve=function(e){return $.Deferred().resolveWith(e)}}}var Serenity;(function(e){var t=function(){function e(){}return e}();e.ISlickFormatter=t})(Serenity||(Serenity={}));var globalObj=typeof global!=="undefined"?global:typeof window!=="undefined"?window:typeof self!=="undefined"?self:this;var Q;(function(e){e.types={};function t(e,t){var i=t.split(".");for(var r=0;r<i.length;r++){e=e[i[r]];if(e==null)return null}return e}e.getNested=t;e.getType=function(i,r){var n;if(r==null){n=e.types[i];if(n!=null||globalObj==null)return n;r=globalObj}n=t(r,i);if(typeof n!=="function")return null;return n};e.getTypeFullName=function(e){return e.__typeName||e.name||(e.toString().match(/^\s*function\s*([^\s(]+)/)||[])[1]||"Object"};e.getTypeName=function(t){var i=e.getTypeFullName(t);var r=i.indexOf("[");var n=i.lastIndexOf(".",r>=0?r:i.length);return n>0?i.substr(n+1):i};e.getInstanceType=function(e){if(e==null)throw new r("Cannot get type of null");try{return e.constructor}catch(t){return Object}};e.isAssignableFrom=function(e,t){return e===t||typeof e.isAssignableFrom==="function"&&e.isAssignableFrom(t)||t.prototype instanceof e};e.isInstanceOfType=function(t,i){if(t==null)return false;if(typeof i.isInstanceOfType==="function")return i.isInstanceOfType(t);return e.isAssignableFrom(i,e.getInstanceType(t))};e.safeCast=function(t,i){return e.isInstanceOfType(t,i)?t:null};e.cast=function(t,i){if(t==null)return t;else if(e.isInstanceOfType(t,i))return t;throw new o("Cannot cast object to type "+e.getTypeFullName(i))};e.getBaseType=function(e){if(e===Object||e.__interface){return null}else if(Object.getPrototypeOf){return Object.getPrototypeOf(e.prototype).constructor}else{var t=e.prototype;if(Object.prototype.hasOwnProperty.call(t,"constructor")){try{var i=t.constructor;delete t.constructor;return t.constructor}finally{t.constructor=i}}return t.constructor}};e.getAttributes=function(t,i,r){var n=[];if(r){var a=e.getBaseType(t);if(a){var o=e.getAttributes(a,i,true);for(var l=0;l<o.length;l++){var s=e.getInstanceType(o[l]);n.push(o[l])}}}if(t.__metadata&&t.__metadata.attr){for(var l=0;l<t.__metadata.attr.length;l++){var o=t.__metadata.attr[l];if(i==null||e.isInstanceOfType(o,i)){var s=e.getInstanceType(o);for(var u=n.length-1;u>=0;u--){if(e.isInstanceOfType(n[u],s))n.splice(u,1)}n.push(o)}}}return n};e.getMembers=function(t,i){var r=[];var n=e.getBaseType(t);if(n)r=e.getMembers(n,i&~1);if(t.__metadata&&t.__metadata.members){for(var a=0,o=t.__metadata.members;a<o.length;a++){var l=o[a];if(i&l.type)r.push(l)}}return r};e.getTypes=function(t){var i=[];if(!t){for(var r in e.types){if(e.types.hasOwnProperty(r))i.push(e.types[r])}}else{var n=function(e,t){for(var r in e){if(e.hasOwnProperty(r))n(e[r],r)}if(typeof e==="function"&&t.charAt(0).toUpperCase()===t.charAt(0)&&t.charAt(0).toLowerCase()!==t.charAt(0))i.push(e)};n(t,"")}return i};var i=function(e){__extends(t,e);function t(t){var i=e.call(this,t)||this;i.name="Exception";return i}return t}(Error);e.Exception=i;var r=function(e){__extends(t,e);function t(t){var i=e.call(this,t||"Object is null.")||this;i.name="NullReferenceException";return i}return t}(i);e.NullReferenceException=r;var n=function(e){__extends(t,e);function t(t,i){var r=e.call(this,(i||"Value cannot be null.")+"\nParameter name: "+t)||this;r.name="ArgumentNullException";return r}return t}(i);e.ArgumentNullException=n;var a=function(e){__extends(t,e);function t(t,i){var r=e.call(this,(i!==null&&i!==void 0?i:"Value is out of range.")+(t?"\nParameter name: "+t:""))||this;r.name="ArgumentNullException";return r}return t}(i);e.ArgumentOutOfRangeException=a;var o=function(e){__extends(t,e);function t(t){var i=e.call(this,t)||this;i.name="InvalidCastException";return i}return t}(i);e.InvalidCastException=o;e.clearKeys=function(e){for(var t in e){if(e.hasOwnProperty(t))delete e[t]}};e.delegateCombine=function(e,t){if(!e){if(!t._targets){return t}return t}if(!t){if(!e._targets){return e}return e}var i=e._targets?e._targets:[null,e];var r=t._targets?t._targets:[null,t];return u(i.concat(r))};var l;(function(e){e.toString=function(e,t){var i=e.prototype;if(t===0||!e.__metadata||!e.__metadata.enumFlags){for(var r in i){if(i[r]===t){return r}}return t==null?"":t.toString()}else{var n=[];for(var r in i){if(i[r]&t){n.push(r)}else n.push(t==null?"":t.toString())}return n.join(" | ")}};e.getValues=function(e){var t=[];var i=e.prototype;for(var r in i){if(i.hasOwnProperty(r))t.push(i[r])}return t}})(l=e.Enum||(e.Enum={}));function s(e,t,i){for(var r=0;r<e.length;r+=2){if(e[r]===t&&e[r+1]===i){return true}}return false}var u=function(e){var t=function(){if(e.length==2){return e[1].apply(e[0],arguments)}else{var t=e.slice();for(var i=0;i<t.length;i+=2){if(s(e,t[i],t[i+1])){t[i+1].apply(t[i],arguments)}}return null}};t._targets=e;return t};e.delegateRemove=function(e,t){if(!e||e===t){return null}if(!t){return e}var i=e._targets;var r=null;var n;if(t._targets){r=t._targets[0];n=t._targets[1]}else{n=t}for(var a=0;a<i.length;a+=2){if(i[a]===r&&i[a+1]===n){if(i.length==2){return null}var o=i.slice();o.splice(a,2);return u(o)}}return e};e.isEnum=function(e){return!!e.__enum};function c(e,t){for(var i=0;i<t.length-1;i+=2){(function(t,i){Object.defineProperty(e.prototype,t,{get:function(){return this.w(t,i)},enumerable:true,configurable:true})})(t[i],t[i+1])}}e.initFormType=c;function d(e,t,i,r){i=i||"get_"+t;r=r||"set_"+t;Object.defineProperty(e.prototype,t,{get:function(){return this[i]()},set:function(e){return this[r](e)},configurable:true,enumerable:true})}e.prop=d;function f(t,i,r){if(!t)return;for(var n=0,a=Object.keys(t);n<a.length;n++){var o=a[n];if(o.charAt(0)<"A"||o.charAt(0)>"Z")continue;if(o.indexOf("$")>=0)continue;if(o=="prototype")continue;if(!t.hasOwnProperty(o))continue;var l=t[o];if($.isArray(l)||t instanceof Date)continue;var s=typeof l;if(s=="string"||s=="number")continue;if($.isFunction(l)||l.__enum&&l.__register){if(l.hasOwnProperty("__typeName")&&!l.__register)continue;if(!l.__interfaces&&l.prototype.format&&o.substr(-9)=="Formatter"){l.__class=true;l.__interfaces=[Serenity.ISlickFormatter]}if(!l.__class){var u=e.getBaseType(l);if(u&&u.__class)l.__class=true}if(l.__class||l.__enum||l.__interface){l.__typeName=i+o;e.types[i+o]=l}delete l.__register}if(r>0)f(l,i+o+".",r-1)}}e.initializeTypes=f})(Q||(Q={}));var Q;(function(e){function t(e,t){return e!=null?e:t}e.coalesce=t;function i(e){return e!=null}e.isValue=i;function r(e,t){for(var i=0,r=e;i<r.length;i++){var n=r[i];if(t(n))return true}return false}e.any=r;function n(e,t){var i=0;for(var r=0,n=e;r<n.length;r++){var a=n[r];if(t(a))i++}return i}e.count=n;function a(e,t){for(var i=0,r=e;i<r.length;i++){var n=r[i];if(t(n))return n}throw new Error("first:No element satisfies the condition.!")}e.first=a;function o(e,t){for(var i=0;i<e.length;i++)if(t(e[i]))return i;return-1}e.indexOf=o;function l(e,t,i){if(e.insert)e.insert(t,i);else if(Object.prototype.toString.call(e)==="[object Array]")e.splice(t,0,i);else throw new Error("Object does not support insert!")}e.insert=l;function s(e){return Object.prototype.toString.call(e)==="[object Array]"}e.isArray=s;function u(e,t){var i;var r=false;for(var n=0,a=e;n<a.length;n++){var o=a[n];if(t(o)){if(r)throw new Error("single:sequence contains more than one element.");r=true;i=o}}if(!r)throw new Error("single:No element satisfies the condition.");return i}e.single=u;function c(e,t){var i={};for(var r=0,n=e;r<n.length;r++){var a=n[r];var o=t(a)||"";var l=i[o];if(!l){l=i[o]=[]}l.push(a)}return i}e.toGrouping=c;function d(t,i){var r={byKey:Object.create(null),inOrder:[]};for(var n=0;n<t.length;n++){var a=t[n];var o=e.coalesce(i(a),"");var l=r.byKey[o];if(l===undefined){l={order:r.inOrder.length,key:o,items:[a],start:n};r.byKey[o]=l;r.inOrder.push(l)}else{l.items.push(a)}}return r}e.groupBy=d;function f(e,t){for(var i=0,r=e;i<r.length;i++){var n=r[i];if(t(n))return n}}e.tryFirst=f;function p(e,t){if(t==null||!t.length)return true;if(t.length>e.length)return false;return e.substr(e.length-t.length)==t}e.endsWith=p;function h(e){return e==null||e.length===0}e.isEmptyOrNull=h;function g(e){return _(e)==null}e.isTrimmedEmpty=g;function v(e,t,i){if(i===void 0){i=" "}if(e["padStart"])return e["padStart"](t,i);e=e.toString();while(e.length<t)e=i+e;return e}e.padLeft=v;function y(e,t){if(t==null||!t.length)return true;if(t.length>e.length)return false;return e.substr(0,t.length)==t}e.startsWith=y;function m(t){return e.replaceAll(e.replaceAll(C(t),"\r\n"," "),"\n"," ").trim()}e.toSingleLine=m;e.today=function(){var e=new Date;return new Date(e.getFullYear(),e.getMonth(),e.getDate())};e.trimEnd=function(e){return e.replace(/\s*$/,"")};e.trimStart=function(e){return e.replace(/^\s*/,"")};function b(e){if(e==null)return"";return e.replace(new RegExp("^\\s+|\\s+$","g"),"")}e.trim=b;function C(e){if(e==null||e.length===0)return"";return b(e)}e.trimToEmpty=C;function _(e){e=b(e);if(e.length===0)return null;return e}e.trimToNull=_;function S(e,t,i){e=e||"";return e.split(t).join(i)}e.replaceAll=S;function x(e,t){var i=e.toString();while(i.length<t)i="0"+i;return i}e.zeroPad=x;function w(e,t,i){var r,n,a,o,l;if(null==t)t=100;function s(){var u=Date.now()-o;if(u<t&&u>=0){r=setTimeout(s,t-u)}else{r=null;if(!i){l=e.apply(a,n);a=n=null}}}var u=function(){a=this;n=arguments;o=Date.now();var u=i&&!r;if(!r)r=setTimeout(s,t);if(u){l=e.apply(a,n);a=n=null}return l};u.clear=function(){if(r){clearTimeout(r);r=null}};u.flush=function(){if(r){l=e.apply(a,n);a=n=null;clearTimeout(r);r=null}};return u}e.debounce=w;function Q(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];return e}e.extend=Q;function T(t,i,r){if(i!=null||r!=null){return e.extend(e.extend(e.deepClone(t||{}),e.deepClone(i||{})),e.deepClone(r||{}))}if(!t)return t;var n;var a=Array.isArray(t)?[]:{};for(var o in t){n=t[o];a[o]=typeof n==="object"?T(n):n}return a}e.deepClone=T})(Q||(Q={}));var Q;(function(e){e.Invariant={decimalSeparator:".",groupSeparator:",",decimalDigits:2,negativeSign:"-",positiveSign:"+",percentSymbol:"%",currencySymbol:"$",dateSeparator:"/",dateOrder:"mdy",dateFormat:"MM/dd/yyyy",dateTimeFormat:"MM/dd/yyyy HH:mm:ss",amDesignator:"AM",pmDesignator:"PM",timeSeparator:":",firstDayOfWeek:0,dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],minimizedDayNames:["Su","Mo","Tu","We","Th","Fr","Sa"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December",""],shortMonthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec",""],stringCompare:function(e,t){return e<t?-1:e>t?1:0}};function t(e){var t={};for(var i=0;i<e.length;i++){t[e.charAt(i)]=i+1}return function(e,i){e=e||"";i=i||"";if(e==i)return 0;for(var r=0,n=Math.min(e.length,i.length);r<n;r++){var a=e.charAt(r),o=i.charAt(r);if(a===o)continue;var l=t[a],s=t[o];if(l!=null&&s!=null)return l<s?-1:1;var u=a.localeCompare(o);if(u==0)continue;return u}return e.localeCompare(i)}}e.compareStringFactory=t;e.Culture={decimalSeparator:".",groupSeparator:",",dateSeparator:"/",dateOrder:"dmy",dateFormat:"dd/MM/yyyy",dateTimeFormat:"dd/MM/yyyy HH:mm:ss",stringCompare:t("AaBbCcÇçFfGgĞğHhIıİiJjKkLlMmNnOoÖöPpRrSsŞşTtUuÜüVvYyZz")};(function(){var t;for(t in e.Invariant)if(e.Culture[t]===undefined&&e.Invariant.hasOwnProperty(t))e.Culture[t]=e.Invariant[t];if(typeof $!="undefined"&&(t=e.trimToNull($("script#ScriptCulture").html()))!=null){var i=$.parseJSON(t);if(i.DecimalSeparator!=null)e.Culture.decimalSeparator=i.DecimalSeparator;if(i.GroupSeparator!=null&&i.GroupSeparator!=e.Culture.decimalSeparator)e.Culture.groupSeparator=i.GroupSeparator;else if(e.Culture.groupSeparator==e.Culture.decimalSeparator)e.Culture.groupSeparator=e.Culture.decimalSeparator=="."?",":".";delete i.groupSeparator;delete i.decimal;for(t in i){if(e.Culture[t]===undefined&&i.hasOwnProperty(t))e.Culture[t.charAt(0).toLowerCase()+t.substr(1)]=i[t]}}})();function i(e){if(!e)return e;return e.replace(/i/g,"İ").replace(/ı/g,"I").toUpperCase()}e.turkishLocaleToUpper=i;e.turkishLocaleCompare=e.Culture.stringCompare;function r(t,i,r,n){var a=null;var o=t.indexOf(i);if(o>0){a=t.substr(o);t=t.substr(0,o)}var l=e.startsWith(t,n);if(l){t=t.substr(1)}var s=3;if(t.length<s){return(l?n:"")+(a?t+a:t)}var u=t.length;var c="";var d=false;while(!d){var f=s;var p=u-f;if(p<0){s+=p;f+=p;p=0;d=true}if(!f)break;var h=t.substr(p,f);if(c.length)c=h+r+c;else c=h;u-=f}if(l)c="-"+c;return a?c+a:c}var n=/\{\{|\}\}|\{[^\}\{]+\}/g;function a(t,i,r,a){return t.replace(n,function(t){if(t==="{{"||t==="}}")return t.charAt(0);var n=parseInt(t.substr(1),10);var o=r[n+a];if(o==null){return""}var l=e.getInstanceType(o);if(l==Number||l==Date){var u=null;var c=t.indexOf(":");if(c>0){u=t.substring(c+1,t.length-1)}return s(o,u,i)}else{return o.toString()}})}function o(t){var i=[];for(var r=1;r<arguments.length;r++){i[r-1]=arguments[r]}return a(t,e.Culture,arguments,1)}e.format=o;function l(e,t){var i=[];for(var r=2;r<arguments.length;r++){i[r-2]=arguments[r]}return a(e,t,arguments,2)}e.localeFormat=l;function s(t,i,r){if(typeof t==="number")return e.formatNumber(t,i,r);else if(Object.prototype.toString.call(t)==="[object Date]")return e.formatDate(t,i,r);else return t.format(i)}e.round=function(e,t,i){var r=Math.pow(10,t||0);e*=r;var n=e>0|-(e<0);if(e%1===.5*n){var a=Math.floor(e);return(a+(i?n>0:a%2*n))/r}return Math.round(e)/r};e.trunc=function(e){return e!=null?e>0?Math.floor(e):Math.ceil(e):null};function u(t,i,n,a){var o,s,u,c,d,p;if(t==null)return"";var h=typeof n!=="string"?n!==null&&n!==void 0?n:e.Culture:{decimalSeparator:n,groupSeparator:a!==null&&a!==void 0?a:n==","?".":","};if(isNaN(t)){return(o=h.nanSymbol)!==null&&o!==void 0?o:e.Culture.nanSymbol}if(i==null||i.length==0||i=="i"){return t.toString()}var g=(s=h.decimalSeparator)!==null&&s!==void 0?s:e.Culture.decimalSeparator;a=(u=a!==null&&a!==void 0?a:h.groupSeparator)!==null&&u!==void 0?u:e.Culture.groupSeparator;var v=(c=h.negativeSign)!==null&&c!==void 0?c:e.Culture.negativeSign;var y="";var m=-1;if(i.length>1){m=parseInt(i.substr(1),10)}var b=i.charAt(0);switch(b){case"d":case"D":y=parseInt(Math.abs(t)).toString();if(m!=-1)y=e.padLeft(y,m,"0");if(t<0)y=v+y;break;case"x":case"X":y=parseInt(Math.abs(t)).toString(16);if(b=="X")y=y.toUpperCase();if(m!=-1)y=e.padLeft(y,m,"0");break;case"e":case"E":if(m==-1)y=t.toExponential();else y=t.toExponential(m);if(b=="E")y=y.toUpperCase();break;case"f":case"F":case"n":case"N":if(m==-1){m=(d=h.decimalDigits)!==null&&d!==void 0?d:e.Culture.decimalDigits}y=t.toFixed(m).toString();if(m&&g!="."){var C=y.indexOf(".");y=y.substr(0,C)+g+y.substr(C+1)}if(b=="n"||b=="N"){y=r(y,g,a,v)}break;case"c":case"C":case"p":case"P":if(m==-1){m=(p=h.decimalDigits)!==null&&p!==void 0?p:e.Culture.decimalDigits}if(b==="p"||b=="P")t*=100;y=Math.abs(t).toFixed(m).toString();if(m&&g!="."){var C=y.indexOf(".");y=y.substr(0,C)+g+y.substr(C+1)}y=r(y,g,a,v);y=l("0",h,y);break;default:var _="";var S="";var x="";var w=false;var Q=false;for(var T=0;T<i.length;T++){var k=i.charAt(T);if(k=="'"){Q=!Q;continue}else if(!Q){if(k=="\\"){var k=i.charAt(T+1)||"";T++}else if(k=="#"||k==","||k=="."||k=="0"){w=true;S+=k;continue}}w?x+=k:_+=k}i=S;var I="";if(i.indexOf(".")>-1){var E=g;var D=i.substring(i.lastIndexOf(".")+1);t=f(t,D.length);var F=t%1;var O=new String(F.toFixed(D.length));O=O.substring(O.lastIndexOf(".")+1);for(var P=0;P<D.length;P++){if(D.charAt(P)=="#"&&O.charAt(P)!="0"){E+=O.charAt(P);continue}else if(D.charAt(P)=="#"&&O.charAt(P)=="0"){var N=O.substring(P);if(N.match("[1-9]")){E+=O.charAt(P);continue}else break}else if(D.charAt(P)=="0")E+=O.charAt(P);else E+=D.charAt(P)}I+=E}else t=Math.round(t);var A=Math.floor(t);if(t<0)A=Math.ceil(t);var $="";if(i.indexOf(".")==-1)$=i;else $=i.substring(0,i.indexOf("."));var B="";if(!(A==0&&$.substr($.length-1)=="#")){var R=new String(Math.abs(A));var V=9999;if($.lastIndexOf(",")!=-1)V=$.length-$.lastIndexOf(",")-1;var L=0;for(var M=R.length-1;M>-1;M--){B=R.charAt(M)+B;L++;if(L==V&&M!=0){B=a+B;L=0}}if($.length>B.length){var G=$.indexOf("0");if(G!=-1){var q=$.length-G;var H=$.length-B.length-1;while(B.length<q){var z=$.charAt(H);if(z==",")z=a;B=z+B;H--}}}}if(!B&&$.indexOf("0",$.length-1)!==-1)B="0";I=B+I;if(t<0)I=v+I;if(I.lastIndexOf(g)==I.length-1){I=I.substring(0,I.length-1)}return _+I+x}return y}e.formatNumber=u;function c(t){t=e.trim(t.toString());var i=e.Culture.groupSeparator;if(t&&t.length&&t.indexOf(i)>0){t=t.replace(new RegExp("(\\b\\d{1,3})\\"+i+"(?=\\d{3}(\\D|$))","g"),"$1")}if(!/^[-\+]?\d+$/.test(t))return NaN;return parseInt(t,10)}e.parseInteger=c;function d(t){if(t==null)return null;t=e.trim(t.toString());if(t.length==0)return null;var i=e.Culture.groupSeparator;if(t&&t.length&&t.indexOf(i)>0){t=t.replace(new RegExp("(\\b\\d{1,3})\\"+i+"(?=\\d{3}(\\D|$))","g"),"$1")}if(!new RegExp("^\\s*([-\\+])?(\\d*)\\"+e.Culture.decimalSeparator+"?(\\d*)\\s*$").test(t))return NaN;return parseFloat(t.toString().replace(e.Culture.decimalSeparator,"."))}e.parseDecimal=d;function f(e,t){var i=Math.pow(10,t||0);var r=(Math.round(e*i)/i).toString();if(t>0){var n=r.indexOf(".");if(n==-1){r+=".";n=0}else{n=r.length-(n+1)}while(n<t){r+="0";n++}}return parseFloat(r)}function p(e){if(e==null)return null;if(typeof e=="number")return e;e=$.trim(e);if(e==null||!e.length)return null;if(e.length>=15||!/^-?\d+$/.test(e))return e;var t=parseInt(e,10);if(isNaN(t))return e;return t}e.toId=p;var h=/'.*?[^\\]'|dddd|ddd|dd|d|MMMM|MMM|MM|M|yyyy|yy|y|hh|h|HH|H|mm|m|ss|s|tt|t|fff|ff|f|zzz|zz|z|\//g;function g(t,i,r){var n,a,o,l,s,u,c,d,f,p,g,v,y;if(!t)return"";var m;if(typeof t=="string"){var b=e.parseDate(t,r==null?null:r.dateOrder);if(!b)return t;m=b}else m=t;if(i=="i")return m.toString();if(i=="id")return m.toDateString();if(i=="it")return m.toTimeString();if(r==null)r=e.Culture;if(i==null||i=="d")i=(n=r.dateFormat)!==null&&n!==void 0?n:e.Culture.dateFormat;else if(i.length==1){switch(i){case"g":i=((a=r.dateTimeFormat)!==null&&a!==void 0?a:e.Culture.dateTimeFormat).replace(":ss","");break;case"G":i=(o=r.dateTimeFormat)!==null&&o!==void 0?o:e.Culture.dateTimeFormat;break;case"s":i="yyyy-MM-ddTHH:mm:ss";break;case"d":i=(l=r.dateFormat)!==null&&l!==void 0?l:e.Culture.dateFormat;case"t":i=r.dateTimeFormat&&r.dateFormat?r.dateTimeFormat.replace(r.dateFormat+" ",""):"HH:mm";break;case"u":case"U":i=i=="u"?"yyyy-MM-ddTHH:mm:ss.fffZ":(s=r.dateTimeFormat)!==null&&s!==void 0?s:e.Culture.dateTimeFormat;m=new Date(m.getUTCFullYear(),m.getUTCMonth(),m.getUTCDate(),m.getUTCHours(),m.getUTCMinutes(),m.getUTCSeconds(),m.getUTCMilliseconds());break}}if(i.charAt(0)=="%"){i=i.substr(1)}var C=h;var _=[];C.lastIndex=0;while(true){var S=C.lastIndex;var x=C.exec(i);_.push(i.slice(S,x?x.index:i.length));if(!x){break}var w=x[0];var Q=w;switch(w){case"/":Q=(u=r.dateSeparator)!==null&&u!==void 0?u:e.Culture.dateSeparator;break;case"dddd":Q=((c=r.dayNames)!==null&&c!==void 0?c:e.Culture.dayNames)[m.getDay()];break;case"ddd":Q=((d=r.shortDayNames)!==null&&d!==void 0?d:e.Culture.shortDayNames)[m.getDay()];break;case"dd":Q=e.padLeft(m.getDate().toString(),2,"0");break;case"d":Q=m.getDate();break;case"MMMM":Q=((f=r.monthNames)!==null&&f!==void 0?f:e.Culture.monthNames)[m.getMonth()];break;case"MMM":Q=((p=r.shortMonthNames)!==null&&p!==void 0?p:e.Culture.shortMonthNames)[m.getMonth()];break;case"MM":Q=e.padLeft(m.getMonth()+1,2,"0");break;case"M":Q=m.getMonth()+1;break;case"yyyy":Q=e.padLeft(m.getFullYear(),4,"0");break;case"yy":Q=e.padLeft(m.getFullYear()%100,2,"0");break;case"y":Q=m.getFullYear()%100;break;case"h":case"hh":Q=m.getHours()%12;if(!Q){Q="12"}else if(w=="hh"){Q=e.padLeft(Q,2,"0")}break;case"HH":Q=e.padLeft(m.getHours(),2,"0");break;case"H":Q=m.getHours();break;case"mm":Q=e.padLeft(m.getMinutes(),2,"0");break;case"m":Q=m.getMinutes();break;case"ss":Q=e.padLeft(m.getSeconds().toString(),2,"0");break;case"s":Q=m.getSeconds();break;case"t":case"tt":Q=m.getHours()<12?(g=r.amDesignator)!==null&&g!==void 0?g:e.Culture.amDesignator:(v=r.pmDesignator)!==null&&v!==void 0?v:e.Culture.pmDesignator;if(w=="t"){Q=Q.charAt(0)}break;case"fff":Q=e.padLeft(m.getMilliseconds(),3,"0");break;case"ff":Q=e.padLeft(m.getMilliseconds(),3).substr(0,2);break;case"f":Q=e.padLeft(m.getMilliseconds(),3).charAt(0);break;case"z":case"Z":Q=m.getTimezoneOffset()/60;Q=(Q>=0?"-":"+")+Math.floor(Math.abs(Q));break;case"zz":case"zzz":Q=m.getTimezoneOffset()/60;Q=(Q>=0?"-":"+")+Math.floor(e.padLeft(Math.abs(Q),2,"0"));if(w=="zzz"){Q+=((y=r.timeSeparator)!==null&&y!==void 0?y:e.Culture.timeSeparator)+Math.abs(e.padLeft(m.getTimezoneOffset()%60,2,"0"))}break;default:if(Q.charAt(0)=="'"){Q=Q.substr(1,Q.length-2).replace(/\\'/g,"'")}break}_.push(Q)}return _.join("")}e.formatDate=g;function v(t){if(t===0)return"0";else if(!t)return"";var i=Math.floor(t/24/60);var r="";if(i>0){r+=i.toString()}var n=e.zeroPad(Math.floor(t%(24*60)/60),2)+":"+e.zeroPad(t%60,2);if(n!="00:00"){if(i>0)r+=".";r+=n}return r}e.formatDayHourAndMin=v;function y(e){if(e==null)return"";var t=function(e){return(e<10?"0":"")+e};var i=e.getUTCFullYear()+"-"+t(e.getUTCMonth()+1)+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes());var r=Number(e.getUTCSeconds()+"."+(e.getUTCMilliseconds()<100?"0":"")+t(e.getUTCMilliseconds()));i+=":"+t(r)+"Z";return i}e.formatISODateTimeUTC=y;var m=/(\d{4,})(?:-(\d{1,2})(?:-(\d{1,2})(?:[T ](\d{1,2}):(\d{1,2})(?::(\d{1,2})(?:\.(\d+))?)?(?:(Z)|([+-])(\d{1,2})(?::(\d{1,2}))?)?)?)?)?/;function b(e){if(!e||!e.length)return null;e=e+"";if(typeof e!="string"||e.length===0)return null;var t=e.match(m);if(typeof t=="undefined"||t===null)return null;return new Date(e+(e.length==10?"T00:00:00":""))}e.parseISODateTime=b;function C(t){var i=e.trim(t);if(i.length<4||i.length>5)return NaN;var r,n;if(i.charAt(1)==":"){r=c(i.substr(0,1));n=c(i.substr(2,2))}else{if(i.charAt(2)!=":")return NaN;r=c(i.substr(0,2));n=c(i.substr(3,2))}if(isNaN(r)||isNaN(n)||r<0||r>23||n<0||n>59)return NaN;return r*60+n}e.parseHourAndMin=C;function _(t){var i;var r=e.trim(t);if(!r)return NaN;var n=r.split(".");if(n.length==0||n.length>2)return NaN;if(n.length==1){i=c(n[0]);if(!isNaN(i))return i*24*60;return C(n[0])}else{i=c(n[0]);var a=C(n[1]);if(isNaN(i)||isNaN(a))return NaN;return i*24*60+a}}e.parseDayHourAndMin=_;function S(t,i){if(!t||!t.length)return null;if(t.length>=10&&t.charAt(4)==="-"&&t.charAt(7)==="-"&&(t.length===10||t.length>10&&t.charAt(10)==="T")){var r=e.parseISODateTime(t);if(r==null)return false;return r}t=e.trim(t);if(t.indexOf(" ")>0&&t.indexOf(":")>t.indexOf(" ")+1){var n=e.parseDate(t.substr(0,t.indexOf(" ")));if(!n)return false;return e.parseISODateTime(e.formatDate(n,"yyyy-MM-dd")+"T"+e.trim(t.substr(t.indexOf(" "+1))))}var a;var o;var l,s,u;o=x(t);if(!o)return false;if(o.length==3){i=i||e.Culture.dateOrder;switch(i){case"dmy":l=parseInt(o[0],10);s=parseInt(o[1],10)-1;u=parseInt(o[2],10);break;case"ymd":l=parseInt(o[2],10);s=parseInt(o[1],10)-1;u=parseInt(o[0],10);break;case"mdy":default:l=parseInt(o[1],10);s=parseInt(o[0],10)-1;u=parseInt(o[2],10);break}if(isNaN(l)||isNaN(s)||isNaN(u)||l<1||l>31||s<0||s>11||u>9999||u<0)return false;if(u<100){var c=(new Date).getFullYear();var d=c%100+10;u+=c-c%100+(u<=d?0:-100)}try{a=new Date(u,s,l);if(isNaN(a.getFullYear()))return false}catch(f){return false}}else if(o.length==1){try{a=new Date(o[0]);if(isNaN(a.getFullYear()))return false}catch(f){return false}}return a}e.parseDate=S;function x(t){t=e.trim(t);if(!t.length)return;if(t.indexOf("/")>=0)return t.split("/");else if(t.indexOf(".")>=0)return t.split(".");else if(t.indexOf("-")>=0)return t.split("-");else if(t.indexOf("\\")>=0)return t.split("\\");else return[t]}e.splitDateString=x})(Q||(Q={}));var Q;(function(e){function t(e){var t=l.$table[e];if(t==null){t=e||""}return t}e.text=t;function i(e){return function(i){return t("Db."+e+"."+i)}}e.dbText=i;function r(t){return function(i,r){if(i!=null&&!e.startsWith(i,"`")){var n=e.tryGetText(i);if(n!=null){return n}}if(i!=null&&e.startsWith(i,"`")){i=i.substr(1)}if(!e.isEmptyOrNull(t)){var a=typeof r=="function"?r(t):t+r;var o=e.tryGetText(a);if(o!=null){return o}}return i}}e.prefixedText=r;function n(e){return l.$table[e]}e.tryGetText=n;function a(e){return function(i){return t("Db."+e+"."+i)}}e.dbTryText=a;function o(t,i,r){if(typeof window!="undefined"&&window["Proxy"]){return new window["Proxy"](t,{get:function(n,a){var l=r[a];if(l==null)return;if(typeof l=="number")return e.text(i+a);else{var s=t[a];if(s!=null)return s;t[a]=s=o({},i+a+".",l);return s}},ownKeys:function(e){return Object.keys(r)}})}else{for(var n=0,a=Object.keys(r);n<a.length;n++){var l=a[n];if(typeof r[l]=="number")Object.defineProperty(t,l,{get:function(){return e.text(i+l)}});else t[l]=o({},i+l+".",r[l])}return t}}e.proxyTexts=o;var l=function(){function e(e){this.key=e}e.add=function(t,i){if(!t){return}i=i||"";for(var r=0,n=Object.keys(t);r<n.length;r++){var a=n[r];var o=i+a;var l=t[a];if(typeof l==="object"){e.add(l,o+".")}else{e.$table[o]=l}}};e.prototype.get=function(){var t=e.$table[this.key];if(t==null){t=this.key||""}return t};e.prototype.toString=function(){var t=e.$table[this.key];if(t==null){t=this.key||""}return t};e.$table={};e.empty=new e("");e.initializeTextClass=function(t,i){var r=Object.keys(t).slice();for(var n=0;n<r.length;n++){var a=r[n];var o=t[a];if(o instanceof e){var l=o;var s=i+a;e.$table[s]=l.key;t[a]=new e(s)}}};e.getDefault=function(t,i){var r=e.$table[t];if(r==null){r=i;if(r==null){r=t||""}}return r};return e}();e.LT=l})(Q||(Q={}));var Q;(function(e){var t=function(){function t(e,t){this.items=[];this.itemById={};e=e||{};this.textFormatter=e.textFormatter;this.idField=e.idField;this.parentIdField=e.parentIdField;this.textField=e.textField;this.textFormatter=e.textFormatter;if(t!=null)this.update(t)}t.prototype.update=function(t){this.items=[];this.itemById={};if(t){for(var i=0,r=t;i<r.length;i++){var n=r[i];this.items.push(n)}}var a=this.idField;if(!e.isEmptyOrNull(a)){for(var o=0,l=this.items;o<l.length;o++){var s=l[o];var u=s[a];if(u!=null){this.itemById[u]=s}}}};t.prototype.get_idField=function(){return this.idField};t.prototype.get_parentIdField=function(){return this.parentIdField};t.prototype.get_textField=function(){return this.textField};t.prototype.get_textFormatter=function(){return this.textFormatter};t.prototype.get_itemById=function(){return this.itemById};t.prototype.get_items=function(){return this.items};return t}();e.Lookup=t})(Q||(Q={}));var Q;(function(e){var t=0;function i(e){if(t>0){t++;return}if($.blockUI){$.blockUI&&$.blockUI(e)}else{$('<div class="blockUI blockOverlay" style="z-index: 2000; border: none; margin: 0px; padding: 0px; width: 100%; height: 100%; top: 0px; left: 0px; opacity: 0; cursor: wait; position: fixed;"></div>').appendTo(document.body)}t++}function r(t){t=e.extend({baseZ:2e3,message:"",overlayCSS:{opacity:"0.0",zIndex:2e3,cursor:"wait"},fadeOut:0},t);if(t.useTimeout){window.setTimeout(function(){i(t)},0)}else{i(t)}}e.blockUI=r;function n(){if(t>1){t--;return}t--;if($.unblockUI)$.unblockUI({fadeOut:0});else $(document.body).children(".blockUI.blockOverlay").remove()}e.blockUndo=n})(Q||(Q={}));var Q;(function(e){function t(e,t,i){$("<option/>").val(t).text(i).appendTo(e)}e.addOption=t;function i(i){t(i,"",e.text("Controls.SelectEditor.EmptyItemText"))}e.addEmptyOption=i;function r(e){e.html("")}e.clearOptions=r;function n(t,i){var r=t.attr("id");if(e.isEmptyOrNull(r)){return $("#"+i)}var n=$("#"+r+i);if(n.length>0){return n}n=$("#"+r+"_"+i);if(n.length>0){return n}while(true){var a=r.lastIndexOf("_");if(a<=0){return $("#"+i)}r=r.substr(0,a);n=$("#"+r+"_"+i);if(n.length>0){return n}}}e.findElementWithRelativeId=n;function a(e){switch(e){case"&":return"&amp;";case">":return"&gt;";case"<":return"&lt;";case"'":return"&apos;";case'"':return"&quot;"}return e}var o=/[><&'"]/g;function l(e){var t=e==null?"":e.toString();if(o.test(t)){return t.replace(o,a)}return t}e.attrEncode=l;function s(e){switch(e){case"&":return"&amp;";case">":return"&gt;";case"<":return"&lt;"}return e}function u(e){var t=e==null?"":e.toString();if(new RegExp("[><&]","g").test(t)){return t.replace(new RegExp("[><&]","g"),s)}return t}e.htmlEncode=u;function c(t,i){if(!t||t.indexOf("{{")<0){return t}if(!$.templates||!$.views){throw new e.Exception("Please make sure that jsrender.js is included in the page!")}i=i||{};var r=$.templates(t);$.views.converters({text:e.text},r);return r.render(i)}e.jsRender=c;function d(e){if(typeof console!=="undefined"&&console.log)console.log(e)}e.log=d;function f(){return $("<div/>").appendTo(document.body)}e.newBodyDiv=f;function p(e){return $("<i/>").append(e.eq(0).clone()).html()}e.outerHtml=p})(Q||(Q={}));var Q;(function(e){if(typeof $!=="undefined"&&$.fn&&$.fn.button&&$.ui&&$.ui.button&&$.fn.button.noConflict){$.fn.btn=$.fn.button.noConflict()}function t(t){if(!t)return null;if(e.startsWith(t,"fa-"))return"fa "+t;if(e.startsWith(t,"glyphicon-"))return"glyphicon "+t;return t}function i(t,i,r){var n=e.extend({modal:true,width:"40%",maxWidth:450,minWidth:180,resizable:false,open:function(){if(t.onOpen)t.onOpen.call(this)},close:function(){$(this).dialog("destroy");if(t.onClose)t.onClose.call(this,t.result)}},t);n.dialogClass="s-MessageDialog"+(r?" "+r:"");if(t.buttons){n.buttons=t.buttons.map(function(e){var i=u(e);i.click=function(i){t.result=e.result;$(this).dialog("close");e.click&&e.click.call(this,i)};return i})}return $("<div>"+i+"</div>").dialog(n)}var r;function n(){if(r!=null)return r;return r=!!($.fn.modal&&$.fn.modal.Constructor&&$.fn.modal.Constructor.VERSION&&($.fn.modal.Constructor.VERSION+"").charAt(0)=="3")}e.isBS3=n;var a={AlertTitle:"Alert",InformationTitle:"Information",WarningTitle:"Warning",ConfirmationTitle:"Confirm",OkButton:"OK",YesButton:"Yes",NoButton:"No",CancelButton:"Cancel",CloseButton:"Close"};function o(t){var i;return(i=e.tryGetText("Dialogs."+t))!==null&&i!==void 0?i:a[t]}function l(e,t,i){var r='<button type="button" class="close" data-dismiss="modal" aria-label="'+o("CloseButton")+'">'+'<span aria-hidden="true">&times;</span></button>';return'<div class="modal '+i+'" tabindex="-1" role="dialog">\n    <div class="modal-dialog" role="document">\n        <div class="modal-content">\n            <div class="modal-header">\n                '+(n()?r:"")+'<h5 class="modal-title">'+e+"</h5>"+(n()?"":r)+'\n            </div>\n            <div class="modal-body">'+t+'</div>\n            <div class="modal-footer"></div>\n        </div>\n    </div>\n</div>'}e.bsModalMarkup=l;
function s(i){var r=i.htmlEncode==null||i.htmlEncode?e.htmlEncode(i.text):i.text;var n=t(i.icon);if(n!=null)r='<i class="'+n+"><i>"+(r?" "+r:"");return'<button class="btn '+(i.cssClass?i.cssClass:"")+'"'+(i.hint?' title="'+e.attrEncode(i.hint)+'"':"")+">"+r+"</button>"}e.dialogButtonToBS=s;function u(i){var r=i.htmlEncode==null||i.htmlEncode?e.htmlEncode(i.text):i.text;var n=t(i.icon);if(n!=null)r='<i class="'+n+"><i> ";return{text:r,attr:!i.cssClass?undefined:{"class":i.cssClass},click:i.click}}e.dialogButtonToUI=u;function c(e,t,i){var r=l(e.title,t,"s-MessageModal"+(i?" "+i:""));var n=$(r).eq(0).appendTo(document.body);if(e.onOpen)n.one("shown.bs.modal",e.onOpen);if(e.onClose)n.one("hidden.bs.modal",function(t){return e.onClose(e.result)});var a=n.find(".modal-footer");function o(t){var i=this;return $(s(t)).appendTo(a).click(function(r){e.result=t.result;n.modal("hide");t.click&&t.click.call(i,r)})}if(e.buttons)for(var u=0,c=e.buttons;u<c.length;u++){var d=c[u];o(d)}n.modal({backdrop:false,show:true})}var d;function f(){if(d==null){d=typeof $==="undefined"||(!$.ui||!$.ui.dialog)&&(!$.fn||!$.fn.modal)}return d}function p(t){return!!(!$.ui||!$.ui.dialog||e.Config.bootstrapMessages||t&&t.bootstrap)}function h(t,i){var r=i==null||i.htmlEncode==null||i.htmlEncode;if(r)t=e.htmlEncode(t);var n=i==null||i.preWrap==null&&r||i.preWrap;return'<div class="message"'+(n?' style="white-space: pre-wrap">':">")+t+"</div>"}function g(t,r){var n,a;if(f()){window.alert(t);return}var l=p(r);r=e.extend({htmlEncode:true,okButton:o("OkButton"),title:o("AlertTitle")},r);if(r.buttons==null){r.buttons=[];if(r.okButton==null||r.okButton){r.buttons.push({text:typeof r.okButton=="boolean"?o("OkButton"):r.okButton,cssClass:l?"btn-default":undefined,result:"ok"})}}t=h(t,r);if(l)c(r,t,(n=r.modalClass)!==null&&n!==void 0?n:"s-AlertModal");else i(r,t,(a=r.dialogClass)!==null&&a!==void 0?a:"s-AlertDialog")}e.alert=g;function v(t,r,n){var a,l;if(f()){if(window.confirm(t))r&&r();return}var s=p(n);n=e.extend({htmlEncode:true,yesButton:o("YesButton"),noButton:o("NoButton"),title:o("ConfirmationTitle")},n);if(n.buttons==null){n.buttons=[];if(n.yesButton==null||n.yesButton){n.buttons.push({text:typeof n.yesButton=="boolean"?o("YesButton"):n.yesButton,cssClass:s?"btn-primary":undefined,result:"yes",click:r})}if(n.noButton==null||n.noButton){n.buttons.push({text:typeof n.noButton=="boolean"?o("NoButton"):n.noButton,cssClass:s?"btn-default":undefined,result:"no",click:n.onNo})}if(n.cancelButton){n.buttons.push({text:typeof n.cancelButton=="boolean"?o("CancelButton"):n.cancelButton,cssClass:s?"btn-default":undefined,result:"cancel",click:n.onCancel})}}t=h(t,n);if(s)c(n,t,(a=n.modalClass)!==null&&a!==void 0?a:"s-ConfirmModal");else i(n,t,(l=n.dialogClass)!==null&&l!==void 0?l:"s-ConfirmDialog")}e.confirm=v;function y(t){if(f()){window.alert(t.html);return}if(p(t)){c({title:o("AlertTitle"),modalClass:"modal-lg",onOpen:function(){i=$(this).find("iframe").css({border:"none",width:"100%",height:"100%"})[0].contentDocument;i.open();i.write(n.html);i.close()}},'<div style="overflow: hidden"><iframe></iframe></div>',"s-IFrameModal");return}var i;var r=$('<div style="overflow: hidden"><iframe></iframe></div>');var n=e.extend({autoOpen:true,modal:true,width:"60%",height:"400",title:o("AlertTitle"),open:function(){i=r.find("iframe").css({border:"none",width:"100%",height:"100%"})[0].contentDocument;i.open();i.write(n.html);i.close()},close:function(){i.open();i.write("");i.close();r.dialog("destroy").html("")}},t);r.dialog(n)}e.iframeDialog=y;function m(t,i,r){if(f()){window.alert(t);i&&i();return}v(t,i,e.extend({title:o("InformationTitle"),dialogClass:"s-InformationDialog",modalClass:"s-InformationModal",yesButton:o("OkButton"),noButton:false},r))}e.information=m;function b(t,i){g(t,e.extend({title:o("WarningTitle"),dialogClass:"s-WarningDialog",modalClass:"s-WarningModal"},i))}e.warning=b})(Q||(Q={}));var Q;(function(e){e.defaultNotifyOptions={timeOut:3e3,showDuration:250,hideDuration:500,extendedTimeOut:500,positionClass:"toast-top-full-width"};function t(t){t=e.extend(e.extend({},e.defaultNotifyOptions),t);o(true);return t}function i(e,i,r){toastr.warning(e,i,t(r))}e.notifyWarning=i;function r(e,i,r){toastr.success(e,i,t(r))}e.notifySuccess=r;function n(e,i,r){toastr.info(e,i,t(r))}e.notifyInfo=n;function a(e,i,r){toastr.error(e,i,t(r))}e.notifyError=a;function o(e){if(typeof toastr==="undefined"){return}var t=$(window.document.body).children(".ui-dialog:visible, .modal.in, .modal.show").last();var i=toastr.getContainer(null,e);if(i.length===0){return}if(t.length>0){var r=t.position();i.addClass("positioned-toast toast-top-full-width");i.css({position:"absolute",top:r.top+28+"px",left:r.left+6+"px",width:t.width()-12+"px"})}else{i.addClass("toast-top-full-width");if(i.hasClass("positioned-toast")){i.removeClass("positioned-toast");i.css({position:"",top:"",left:"",width:""})}}}e.positionToastContainer=o})(Q||(Q={}));var Q;(function(e){var t;(function(t){function i(t){var i;if(t==null){i="??ERROR??"}else{i=t.Message;if(i==null){i=t.Code}}e.alert(i)}t.showServiceError=i;function r(t,i,r,n,a){try{var o=(window.location.host||"").toLowerCase();if(o.indexOf("localhost")<0&&o.indexOf("127.0.0.1")<0)return;if(!window["toastr"])return;var l=JSON.stringify(a||{});t="<p></p><p>Message: "+e.htmlEncode(t)+"</p><p>File: "+e.htmlEncode(i)+", Line: "+r+", Column: "+n+(l!="{}"?"</p><p>Error: ":"")+"</p>";window.setTimeout(function(){try{e.notifyError(t,"SCRIPT ERROR! See browser console (F12) for details.",{escapeHtml:false,timeOut:15e3})}catch(i){}})}catch(s){}}t.runtimeErrorHandler=r})(t=e.ErrorHandling||(e.ErrorHandling={}))})(Q||(Q={}));var Q;(function(e){var t;(function(e){e.applicationPath="/";if(typeof document!=="undefined"){var t=document.querySelector("link#ApplicationPath");if(t!=null){e.applicationPath=t.getAttribute("href")}}e.emailAllowOnlyAscii=true;e.responsiveDialogs=false;e.bootstrapMessages=false;e.rootNamespaces=["Serenity"];e.notLoggedInHandler=null})(t=e.Config||(e.Config={}))})(Q||(Q={}));var Q;(function(e){function t(e){if($.cookie)return $.cookie(e);e+="=";for(var t=document.cookie.split(/;\s*/),i=t.length-1;i>=0;i--)if(!t[i].indexOf(e))return t[i].replace(e,"")}e.getCookie=t;typeof $!="undefined"&&$.ajaxSetup&&$.ajaxSetup({beforeSend:function(t){var i=e.getCookie("CSRF-TOKEN");if(i)t.setRequestHeader("X-CSRF-TOKEN",i)}});function i(t){var i=function(i){if(e.Config.notLoggedInHandler!=null&&i&&i.Error&&i.Error.Code=="NotLoggedIn"&&e.Config.notLoggedInHandler(t,i)){return}if(t.onError!=null){t.onError(i);return}e.ErrorHandling.showServiceError(i.Error)};var r=t.service;if(r&&r.length&&r.charAt(0)!="~"&&r.charAt(0)!="/"&&r.indexOf("://")<0)r=s("~/services/")+r;t=e.extend({dataType:"json",contentType:"application/json",type:"POST",cache:false,blockUI:true,url:r,data:$.toJSON(t.request),success:function(i,r,n){try{if(!i.Error&&t.onSuccess){t.onSuccess(i)}}finally{if(t.blockUI){e.blockUndo()}t.onCleanup&&t.onCleanup()}},error:function(r,n,a){try{if(r.status===403){var o=null;try{o=r.getResponseHeader("Location")}catch(l){o=null}if(o){window.top.location.href=o;return}}if((r.getResponseHeader("content-type")||"").toLowerCase().indexOf("application/json")>=0){var s=$.parseJSON(r.responseText);if(s&&s.Error){i(s);return}}var u=r.responseText;if(!u){if(!r.status){if(r.statusText!="abort")e.alert("An unknown AJAX connection error occurred! Check browser console for details.")}else if(r.status==500)e.alert("HTTP 500: Connection refused! Check browser console for details.");else e.alert("HTTP "+r.status+" error! Check browser console for details.")}else e.iframeDialog({html:u})}finally{if(t.blockUI){e.blockUndo()}t.onCleanup&&t.onCleanup()}}},t);if(t.blockUI){e.blockUI(null)}return $.ajax(t)}e.serviceCall=i;function r(t,r,n,a){return i(e.extend({service:t,request:r,onSuccess:n},a))}e.serviceRequest=r;function n(e,t,i){if(e.EqualityFilter==null){e.EqualityFilter={}}e.EqualityFilter[t]=i}e.setEquality=n;function a(e){var t;if(e===undefined)t=location.search.substring(1,location.search.length);else t=e||"";var i={};var r=t.split("&");for(var n=0;n<r.length;n++){var a=r[n].split("=");var o=decodeURIComponent(a[0]);i[o]=a.length>=2?decodeURIComponent(a[1]):o}return i}e.parseQueryString=a;function o(t){var i=$("<form/>").attr("method","POST").attr("action",t.url?s(t.url):s("~/services/"+t.service)).appendTo(document.body);if(t.target)i.attr("target",t.target);var r=$("<div/>").appendTo(i);$("<input/>").attr("type","hidden").attr("name","request").val($["toJSON"](t.request)).appendTo(r);var n=e.getCookie("CSRF-TOKEN");if(n){$("<input/>").attr("type","hidden").attr("name","__RequestVerificationToken").appendTo(r).val(n)}$("<input/>").attr("type","submit").appendTo(r);i.submit();window.setTimeout(function(){i.remove()},0)}e.postToService=o;function l(t){var i=$("<form/>").attr("method","POST").attr("action",s(t.url)).appendTo(document.body);if(t.target)i.attr("target",t.target);var r=$("<div/>").appendTo(i);if(t.params!=null){for(var n in t.params){$("<input/>").attr("type","hidden").attr("name",n).val(t.params[n]).appendTo(r)}}var a=e.getCookie("CSRF-TOKEN");if(a){$("<input/>").attr("type","hidden").attr("name","__RequestVerificationToken").appendTo(r).val(a)}$("<input/>").attr("type","submit").appendTo(r);i.submit();window.setTimeout(function(){i.remove()},0)}e.postToUrl=l;function s(t){if(t&&t.substr(0,2)==="~/"){return e.Config.applicationPath+t.substr(2)}return t}e.resolveUrl=s})(Q||(Q={}));var Q;(function(e){var t;(function(t){var i={};var r={};function n(e,t,i){$(document.body).bind("scriptdatachange."+t,function(t,r){if(r==e){i()}})}t.bindToChange=n;function a(e){$(document.body).triggerHandler("scriptdatachange",[e])}t.triggerChange=a;function o(e){$(document.body).unbind("scriptdatachange."+e)}t.unbindFromChange=o;function l(t,r){return{async:r,cache:true,type:"GET",url:e.resolveUrl("~/DynJS.axd/")+t+".js?"+i[t],data:null,dataType:"text",converters:{"text script":function(e){return e}},success:function(e,t,i){$.globalEval(e)},error:function(i,r,n){var a=e.startsWith(t,"Lookup.");if(i.status==403&&a){e.notifyError('<p>Access denied while trying to load the lookup: "<b>'+t.substr(7)+'</b>". Please check if current user has required permissions for this lookup.</p> '+"<p><em>Lookups use the ReadPermission of their row by default. You may override that for the lookup "+'like [LookupScript("Some.Lookup", Permission = "?")] to grant all '+'authenticated users to read it (or use "*" for public).</em></p>'+"<p><em>Note that this might be a security risk if the lookup contains sensitive data, "+'so it could be better to set a separate permission for lookups, like "MyModule:Lookups".</em></p>',null,{timeOut:1e4,escapeHtml:false});return}e.notifyError("An error occurred while trying to load "+(a?' the lookup: "'+t.substr(7):' dynamic script: "'+t)+'"!. Please check the error message displayed in the dialog below for more info.');var o=i.responseText;if(!o){if(!i.status)e.alert("An unknown connection error occurred! Check browser console for details.");else if(i.status==500)e.alert("HTTP 500: Connection refused! Check browser console for details.");else e.alert("HTTP "+i.status+" error! Check browser console for details.")}else e.iframeDialog({html:o})}}}function s(t){return Promise.resolve().then(function(){e.blockUI(null);return Promise.resolve($.ajax(l(t,true)).always(function(){e.blockUndo()}))},null)}function u(t){if(i[t]==null){throw new Error(e.format("Script data {0} is not found in registered script list!",t))}$.ajax(l(t,false))}function c(t){return Promise.resolve().then(function(){if(i[t]==null){throw new Error(e.format("Script data {0} is not found in registered script list!",t))}return s(t)},null)}function d(t){var i=r[t];if(i==null){u(t)}i=r[t];if(i==null)throw new Error(e.format("Can't load script data: {0}!",t));return i}t.ensure=d;function f(t){return Promise.resolve().then(function(){var i=r[t];if(i!=null){return Promise.resolve(i)}return c(t).then(function(){i=r[t];if(i==null){throw new Error(e.format("Can't load script data: {0}!",t))}return i},null)},null)}t.ensureAsync=f;function p(t){if(i[t]==null){throw new Error(e.format("Script data {0} is not found in registered script list!",t))}i[t]=(new Date).getTime().toString();u(t);var n=r[t];return n}t.reload=p;function h(t){return Promise.resolve().then(function(){if(i[t]==null){throw new Error(e.format("Script data {0} is not found in registered script list!",t))}i[t]=(new Date).getTime().toString();return c(t).then(function(){return r[t]},null)},null)}t.reloadAsync=h;function g(e){return r[e]!=null||i[e]!=null}t.canLoad=g;function v(e){i={};var t=(new Date).getTime();for(var r in e){i[r]=e[r]||t}}t.setRegisteredScripts=v;function y(e,t){r[e]=t;a(e)}t.set=y})(t=e.ScriptData||(e.ScriptData={}));function i(e){return t.ensure("RemoteData."+e)}e.getRemoteData=i;function r(e){return t.ensureAsync("RemoteData."+e)}e.getRemoteDataAsync=r;function n(i){var r="Lookup."+i;if(!t.canLoad(r)){var n='No lookup with key "'+i+'" is registered. Please make sure you have a'+' [LookupScript("'+i+'")] attribute in server side code on top of a row / custom lookup and '+" its key is exactly the same.";e.notifyError(n);throw new Error(n)}return t.ensure("Lookup."+i)}e.getLookup=n;function a(e){return t.ensureAsync("Lookup."+e)}e.getLookupAsync=a;function o(e){t.reload("Lookup."+e)}e.reloadLookup=o;function l(e){return t.reloadAsync("Lookup."+e)}e.reloadLookupAsync=l;function s(e){return t.ensure("Columns."+e)}e.getColumns=s;function u(e){return t.ensureAsync("Columns."+e)}e.getColumnsAsync=u;function c(e){return t.ensure("Form."+e)}e.getForm=c;function d(e){return t.ensureAsync("Form."+e)}e.getFormAsync=d;function f(e){return t.ensure("Template."+e)}e.getTemplate=f;function p(e){return t.ensureAsync("Template."+e)}e.getTemplateAsync=p;function h(e){return t.canLoad(e)}e.canLoadScriptData=h})(Q||(Q={}));var Q;(function(e){if(typeof $!=="undefined"&&$.validator&&$.validator.methods&&$.validator.addMethod){$.validator.addMethod("customValidate",function(e,t){var i=this.optional(t);if(t==null||!!i){return i}var r=$._data(t,"events");if(!r){return true}var n=r.customValidate;if(n==null||n.length===0){return true}var a=$(t);for(var o=0;!!(o<n.length);o++){if($.isFunction(n[o].handler)){var l=n[o].handler(a);if(l!=null){a.data("customValidationMessage",l);return false}}}return true},function(e,t){return $(t).data("customValidationMessage")});$.validator.addMethod("dateQ",function(t,i){var r=this.optional(i);if(r)return r;var n=e.parseDate(t);if(!n)return false;var a=new Date(n);a.setHours(0,0,0,0);return a.getTime()===n.getTime()});$.validator.addMethod("dateTimeQ",function(t,i){var r=this.optional(i);if(r)return r;var n=e.parseDate(t);return!!n});$.validator.addMethod("hourAndMin",function(t,i){return this.optional(i)||!isNaN(e.parseHourAndMin(t))});$.validator.addMethod("dayHourAndMin",function(t,i){return this.optional(i)||!isNaN(e.parseDayHourAndMin(t))});$.validator.addMethod("decimalQ",function(t,i){return this.optional(i)||!isNaN(e.parseDecimal(t))});$.validator.addMethod("integerQ",function(t,i){return this.optional(i)||!isNaN(e.parseInteger(t))});var t=$.validator.methods["email"];var i=null;$.validator.addMethod("email",function(r,n){if(e.Config.emailAllowOnlyAscii)return t.call(this,r,n);if(i==null)i=new RegExp("^((([a-z]|\\d|[!#\\$%&'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|"+"[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+(\\.([a-z]|\\d|"+"[!#\\$%&'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+)*)|"+"((\\x22)((((\\x20|\\x09)*(\\x0d\\x0a))?(\\x20|\\x09)+)?(([\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x7f]|"+"\\x21|[\\x23-\\x5b]|[\\x5d-\\x7e]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(\\\\([\\x01-\\x09\\x0b\\x0c\\x0d-\\x7f]|"+"[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]))))*(((\\x20|\\x09)*(\\x0d\\x0a))?(\\x20|\\x09)+)?(\\x22)))@((([a-z]|\\d|"+"[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])"+"([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.)"+"+(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|"+"[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))$","i");return i.test(r)});function r(t,i){var r=e.tryGetText("Validation."+i);if(r)$.validator.messages[t]=r;else if(!$.validator.messages[t])$.validator.messages[t]=i+"?"}r("required","Required");r("email","Email");r("minlength","MinLength");r("maxlength","MaxLength");r("digits","Digits");r("range","Range");r("xss","Xss");r("dateQ","DateInvalid");r("decimalQ","Decimal");r("integerQ","Integer");r("url","Url")}function n(t,i){if(e.isBS3())t.attr("data-original-title",i||"").tooltip("fixTitle");else t.attr("title",i||"").tooltip("_fixTitle");return t}function a(){return{errorClass:"error",ignore:":hidden, .no-validate",ignoreTitle:true,normalizer:function(e){return $.trim(e)},highlight:function(e,t,i){if(e.type==="radio"){this.findByName(e.name).addClass(t).removeClass(i)}else{var r=$(e);r.addClass(t).removeClass(i);if(r.hasClass("select2-offscreen")&&e.id){$("#s2id_"+e.id).addClass(t).removeClass(i)}}},unhighlight:function(e,t,i){if(e.type==="radio"){this.findByName(e.name).removeClass(t).addClass(i)}else{var r=$(e);r.removeClass(t).addClass(i);if(r.hasClass("select2-offscreen")&&e.id){$("#s2id_"+e.id).removeClass(t).addClass(i)}}},showErrors:function(e,t){var i=this;$.each(this.validElements(),function(e,t){var r=$(t);r.removeClass(i.settings.errorClass).addClass(i.settings.validClass);if(r.hasClass("select2-offscreen")&&r.id){r=$("#s2id_"+t.id).removeClass(i.settings.errorClass).addClass(i.settings.validClass);if(!r.length)r=$(t)}n(r,"").tooltip("hide")});$.each(t,function(e,t){var r=$(t.element).addClass(i.settings.errorClass);if(r.hasClass("select2-offscreen")&&t.element.id){r=$("#s2id_"+t.element.id).addClass(i.settings.errorClass);if(!r.length)r=$(t.element)}n(r,t.message);if(e==0)r.tooltip("show")})}}}e.baseValidateOptions=a;function o(t,i){return t.validate(e.extend(e.baseValidateOptions(),i))}e.validateForm=o;function l(t,i,r){if(!t.length)return t;if(r==null)throw new e.Exception("rule is null!");t.addClass("customValidate").bind("customValidate."+i,r);return t}e.addValidationRule=l;function s(e,t){e.unbind("customValidate."+t);return e}e.removeValidationRule=s})(Q||(Q={}));var Q;(function(e){var t;(function(t){function i(e){if(e==null)return false;if(e=="*")return true;if(e==""||e=="?")return t.isLoggedIn;var i=t.userDefinition;if(i&&i.IsAdmin)return true;if(i&&i.Permissions){var r=i.Permissions;if(r[e])return true;var n=e.split("|");for(var a=0,o=n;a<o.length;a++){var l=o[a];if(!l)continue;var s=l.split("&");if(!s.length)continue;var u=false;for(var c=0,d=s;c<d.length;c++){var f=d[c];if(!r[f]){u=true;break}}if(!u)return true}}return false}t.hasPermission=i;function r(t){if(!i(t)){e.notifyError(e.text("Authorization.AccessDenied"));throw new Error(e.text("Authorization.AccessDenied"))}}t.validatePermission=r})(t=e.Authorization||(e.Authorization={}));Object.defineProperty(e.Authorization,"userDefinition",{get:function(){return e.getRemoteData("UserData")}});Object.defineProperty(e.Authorization,"isLoggedIn",{get:function(){var e=t.userDefinition;return e&&!!e.Username}});Object.defineProperty(e.Authorization,"username",{get:function(){var e=t.userDefinition;if(e)return e.Username;return null}})})(Q||(Q={}));var Q;(function(e){var t;(function(e){var t;var i=0;var r=0;var n={};function a(){if(t==null&&r>0){t=window.setTimeout(l,100)}}function o(){if(t!=null){window.clearTimeout(t);t=null}}function l(){for(var e in n){var t=n[e];try{var i=t.element();if(!i)continue;var r=i.offsetWidth;var l=i.offsetHeight;try{if(t.width&&t.storedWidth!==r||t.height&&t.storedHeight!==l||!t.width&&!t.height&&(!r!==!t.storedWidth||!l!==!t.storedHeight)){if(r>0&&l>0){try{t.handler()}finally{r=i.offsetWidth;l=i.offsetHeight}}}}finally{t.storedWidth=r;t.storedHeight=l}}catch(s){console.log(s)}}o();a()}function s(e){var t=n[e];if(!t)return;var i=t.element();if(!i)return;t.storedWidth=i.offsetWidth;t.storedHeight=i.offsetHeight}e.store=s;function u(e){var t=n[e];if(!t)return;s(e);if(t.storedWidth>=0&&t.storedHeight>=0){t.handler()}s(e)}e.trigger=u;function c(e,t,o,l){if(t==null)throw"Layout handler can't be null!";n[++i]={element:e,handler:t,width:o!==false,height:l!==false};r++;s(i);a();return i}e.onSizeChange=c;function d(e,t){return c(e,t,true,false)}e.onWidthChange=d;function f(e,t){return c(e,t,false,true)}e.onHeightChange=f;function p(e,t){return c(e,t,false,false)}e.onShown=p;function h(e){var t=n[e];if(!t)return 0;delete n[e];r--;if(r<=0)o();return 0}e.off=h})(t=e.LayoutTimer||(e.LayoutTimer={}))})(Q||(Q={}));var Serenity;(function(e){function t(e){return[e]}e.Criteria=t;(function(e){var t=e;function i(e){return e==null||e.length===0||e.length===1&&typeof e[0]=="string"&&e[0].length===0}e.isEmpty=i;function r(e,i,r){if(t.isEmpty(e))return r;if(t.isEmpty(r))return e;return[e,i,r]}e.join=r;function n(e){return t.isEmpty(e)?e:["()",e]}e.paren=n;function a(e,t){var i=[];for(var n=2;n<arguments.length;n++){i[n-2]=arguments[n]}var a=r(e,"and",t);if(i){for(var o=0,l=i;o<l.length;o++){var s=l[o];a=r(a,"and",s)}}return a}e.and=a;function o(e,t){var i=[];for(var n=2;n<arguments.length;n++){i[n-2]=arguments[n]}var a=r(e,"or",t);if(i){for(var o=0,l=i;o<l.length;o++){var s=l[o];a=r(a,"or",s)}}return a}e.or=o})(t=e.Criteria||(e.Criteria={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(e){e[e["Disabled"]=-1]="Disabled";e[e["None"]=0]="None";e[e["Sum"]=1]="Sum";e[e["Avg"]=2]="Avg";e[e["Min"]=3]="Min";e[e["Max"]=4]="Max"})(t=e.SummaryType||(e.SummaryType={}))})(Serenity||(Serenity={}));typeof module!=="undefined"&&(module.exports={Q:Q,Serenity:Serenity,__extends:__extends});var Serenity;(function(e){var t;(function(e){function t(e){return e.filter(function(t,i){return e.indexOf(t)===i})}function i(e,i){if(!e||!i)return(e||i||[]).slice();return t(e.concat(i))}function r(e,t,r){if(t!=null){e.__typeName=t;Q.types[t]=e}else if(!e.__typeName)e.__register=true;else Q.types[e.__typeName]=e;if(r)e.__interfaces=i(e.__interfaces,r)}function n(e,t){return function(i){if(typeof e=="string")r(i,e,t);else r(i,null,e);i.__class=true}}e.registerClass=n;function a(e,t){return function(i){if(typeof e=="string")r(i,e,t);else r(i,null,e);i.__interface=true;i.isAssignableFrom=function(e){return e.__interfaces!=null&&e.__interfaces.indexOf(this)>=0}}}e.registerInterface=a;function o(e,t){return n(e,t)}e.registerEditor=o;function l(e,t){e.__metadata=e.__metadata||{};e.__metadata.attr=e.__metadata.attr||[];e.__metadata.attr.push(t)}e.addAttribute=l})(t=e.Decorators||(e.Decorators={}));e.Decorators.registerInterface("Serenity.ISlickFormatter")(e.ISlickFormatter);var i=function(){function t(e){this.value=e}t=__decorate([e.Decorators.registerClass("Serenity.EnumKeyAttribute")],t);return t}();e.EnumKeyAttribute=i;(function(e){function t(t){return function(r){e.addAttribute(r,new i(t))}}e.enumKey=t;function r(t,r,n){if(!t.__enum){Object.defineProperty(t,"__enum",{get:function(){return true}});t.prototype=t.prototype||{};for(var a=0,o=Object.keys(t);a<o.length;a++){var l=o[a];if(isNaN(Q.parseInteger(l))&&t[l]!=null&&!isNaN(Q.parseInteger(t[l])))t.prototype[l]=t[l]}if(n!=null){t.__typeName=n;Q.types[n]=t}else if(!t.__typeName)t.__register=true;if(r)e.addAttribute(t,new i(r))}}e.registerEnum=r;function n(e,t,i){r(e,Q.coalesce(i,t),t)}e.registerEnumType=n})(t=e.Decorators||(e.Decorators={}));e.Decorators.registerEnum(e.SummaryType,"Serenity.SummaryType")})(Serenity||(Serenity={}));var System;(function(e){var t;(function(e){var t=function(){function e(e){this.displayName=e}e=__decorate([Serenity.Decorators.registerClass("System.DisplayNameAttribute")],e);return e}();e.DisplayNameAttribute=t})(t=e.ComponentModel||(e.ComponentModel={}))})(System||(System={}));(function(e){function t(t){return e.Decorators.registerClass("Serenity."+t+"Attribute")}var i=function(){function e(e){this.category=e}e=__decorate([t("Category")],e);return e}();e.CategoryAttribute=i;var r=function(){function e(e){this.value=e}e=__decorate([t("ColumnsKey")],e);return e}();e.ColumnsKeyAttribute=r;var n=function(){function e(e){this.cssClass=e}e=__decorate([t("CssClass")],e);return e}();e.CssClassAttribute=n;var a=function(){function e(e){this.value=e}e=__decorate([t("DefaultValue")],e);return e}();e.DefaultValueAttribute=a;var o=function(){function e(e){this.value=e}e=__decorate([t("DialogType")],e);return e}();e.DialogTypeAttribute=o;var l=function(){function e(){}e=__decorate([t("Editor")],e);return e}();e.EditorAttribute=l;var s=function(){function e(e,t){this.key=e;this.value=t}e=__decorate([t("EditorOption")],e);return e}();e.EditorOptionAttribute=s;var u=function(){function t(e){this.editorType=e}t.prototype.setParams=function(e){};t=__decorate([e.Decorators.registerClass("Serenity.EditorTypeAttributeBase")],t);return t}();e.EditorTypeAttributeBase=u;var c=function(e){__extends(i,e);function i(t){return e.call(this,t)||this}i=__decorate([t("EditorType")],i);return i}(u);e.EditorTypeAttribute=c;var d=function(){function e(e){this.value=e}e=__decorate([t("Element")],e);return e}();e.ElementAttribute=d;var f=function(){function e(e){this.value=e}e=__decorate([t("EntityType")],e);return e}();e.EntityTypeAttribute=f;var p=function(){function e(e){if(e===void 0){e=true}this.value=e}e=__decorate([t("Filterable")],e);return e}();e.FilterableAttribute=p;var h=function(){function e(e){this.value=e}e=__decorate([t("FormKey")],e);return e}();e.FormKeyAttribute=h;var g=function(){function e(e){this.origin=e}e=__decorate([t("GeneratedCode")],e);return e}();e.GeneratedCodeAttribute=g;var v=function(){function e(){}e=__decorate([t("Hidden")],e);return e}();e.HiddenAttribute=v;var y=function(){function e(e){this.hint=e}e=__decorate([t("Hint")],e);return e}();e.HintAttribute=y;var m=function(){function e(e){this.value=e}e=__decorate([t("IdProperty")],e);return e}();e.IdPropertyAttribute=m;var b=function(){function e(e){if(e===void 0){e=true}this.value=e}e=__decorate([t("Insertable")],e);return e}();e.InsertableAttribute=b;var C=function(){function e(e){this.value=e}e=__decorate([t("IsActiveProperty")],e);return e}();e.IsActivePropertyAttribute=C;var _=function(){function e(e){this.value=e}e=__decorate([t("ItemName")],e);return e}();e.ItemNameAttribute=_;var S=function(){function e(e){this.value=e}e=__decorate([t("LocalTextPrefix")],e);return e}();e.LocalTextPrefixAttribute=S;var x=function(){function e(e){if(e===void 0){e=true}this.value=e}e=__decorate([t("Maximizable")],e);return e}();e.MaximizableAttribute=x;var w=function(){function e(e){this.maxLength=e}e=__decorate([t("MaxLength")],e);return e}();e.MaxLengthAttribute=w;var T=function(){function e(e){this.value=e}e=__decorate([t("NameProperty")],e);return e}();e.NamePropertyAttribute=T;var k=function(){function e(){}e=__decorate([t("OneWay")],e);return e}();e.OneWayAttribute=k;var I=function(){function e(){}e=__decorate([t("Option")],e);return e}();e.OptionAttribute=I;var E=function(){function e(e){this.value=e}e=__decorate([t("OptionsType")],e);return e}();e.OptionsTypeAttribute=E;var D=function(){function e(e){if(e===void 0){e=true}this.value=e}e=__decorate([t("Panel")],e);return e}();e.PanelAttribute=D;var F=function(){function e(e){this.value=e}e=__decorate([t("Placeholder")],e);return e}();e.PlaceholderAttribute=F;var O=function(){function e(e){if(e===void 0){e=true}this.value=e}e=__decorate([t("ReadOnly")],e);return e}();e.ReadOnlyAttribute=O;var P=function(){function e(e){if(e===void 0){e=true}this.isRequired=e}e=__decorate([t("Required")],e);return e}();e.RequiredAttribute=P;var N=function(){function e(e){if(e===void 0){e=true}this.value=e}e=__decorate([t("Resizable")],e);return e}();e.ResizableAttribute=N;var A=function(){function e(e){if(e===void 0){e=true}this.value=e}e=__decorate([t("Responsive")],e);return e}();e.ResponsiveAttribute=A;var $=function(){function e(e){this.value=e}e=__decorate([t("Service")],e);return e}();e.ServiceAttribute=$;var B=function(){function e(e){if(e===void 0){e=true}this.value=e}e=__decorate([t("Updatable")],e);return e}();e.UpdatableAttribute=B;var R;(function(t){function i(){return function(t,i){var r=Q.startsWith(i,"get_")||Q.startsWith(i,"set_");var n=r?i.substr(4):i;var a=t.constructor;a.__metadata=a.__metadata||{};a.__metadata.members=a.__metadata.members||[];var o=undefined;for(var l=0,s=a.__metadata.members;l<s.length;l++){var u=s[l];if(u.name==n){o=u;break}}if(!o){o={attr:[new e.OptionAttribute],name:n};if(r){o.type=16;o.getter={name:"get_"+n};o.setter={name:"set_"+n}}else{o.type=4}a.__metadata.members.push(o)}else{o.attr=o.attr||[];o.attr.push(new I)}}}t.option=i;function r(i,r){if(i===void 0){i=[e.ISlickFormatter]}if(r===void 0){r=[e.ISlickFormatter]}return t.registerClass(i,r)}t.registerFormatter=r;function n(e){return function(i){t.addAttribute(i,new o(e))}}t.dialogType=n;function a(e){return function(i){var r=new l;if(e!==undefined)r.key=e;t.addAttribute(i,r)}}t.editor=a;function s(e){return function(i){t.addAttribute(i,new d(e))}}t.element=s;function u(e){if(e===void 0){e=true}return function(i){t.addAttribute(i,new p(e))}}t.filterable=u;function c(e){return function(i){t.addAttribute(i,new _(e))}}t.itemName=c;function f(e){if(e===void 0){e=true}return function(i){t.addAttribute(i,new x(e))}}t.maximizable=f;function h(e){return function(i){t.addAttribute(i,new E(e))}}t.optionsType=h;function g(e){if(e===void 0){e=true}return function(i){t.addAttribute(i,new D(e))}}t.panel=g;function v(e){if(e===void 0){e=true}return function(i){t.addAttribute(i,new N(e))}}t.resizable=v;function y(e){if(e===void 0){e=true}return function(i){t.addAttribute(i,new A(e))}}t.responsive=y;function m(e){return function(i){t.addAttribute(i,new $(e))}}t.service=m})(R=e.Decorators||(e.Decorators={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(){function e(e){this.idPrefix=e}e.prototype.byId=function(e){return $("#"+this.idPrefix+e)};e.prototype.w=function(e,t){return $("#"+this.idPrefix+e).getWidget(t)};return e}();e.PrefixedContext=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(){function t(){}t=__decorate([e.Decorators.registerInterface("Serenity.IDialog")],t);return t}();e.IDialog=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(){function t(){}t=__decorate([e.Decorators.registerInterface("Serenity.IEditDialog")],t);return t}();e.IEditDialog=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(){function t(){}t=__decorate([e.Decorators.registerInterface()],t);return t}();e.IBooleanValue=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(){function t(){}t=__decorate([e.Decorators.registerInterface()],t);return t}();e.IDoubleValue=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(){function t(){}t=__decorate([e.Decorators.registerInterface()],t);return t}();e.IStringValue=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(){function t(){}t=__decorate([e.Decorators.registerInterface()],t);return t}();e.IGetEditValue=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(){function t(){}t=__decorate([e.Decorators.registerInterface()],t);return t}();e.ISetEditValue=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(){function t(){}t=__decorate([e.Decorators.registerInterface("Serenity.IReadOnly")],t);return t}();e.IReadOnly=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(){function t(){}t=__decorate([e.Decorators.registerInterface("Serenity.IValidateRequired")],t);return t}();e.IValidateRequired=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t;
(function(e){function t(e,t){var i=e;var n=i["get_"+t];if(!!!(typeof n==="undefined")){return n.apply(e)}var a=r(t);n=i["get_"+a];if(!!!(typeof n==="undefined")){return n.apply(e)}return i[a]}e.getPropertyValue=t;function i(e,t,i){var n=e;var a=n["set_"+t];if(!!!(typeof a==="undefined")){a.apply(e,[i]);return}var o=r(t);a=n["set_"+o];if(!!!(typeof a==="undefined")){a.apply(e,[i]);return}n[o]=i}e.setPropertyValue=i;function r(e){if(Q.isEmptyOrNull(e)){return e}if(e==="ID"){return"id"}var t=false;var i=0;for(var r=0;r<e.length;r++){if(e.charCodeAt(r)>=65&&e.charCodeAt(r)<=90){i++}else{t=true;break}}if(!t&&e.length!==1||i===0){return e}else if(i>1){return e.substr(0,i-1).toLowerCase()+e.substr(i-1)}else if(e.length===1){return e.toLowerCase()}else{return e.substr(0,1).toLowerCase()+e.substr(1)}}e.makeCamelCase=r})(t=e.ReflectionUtils||(e.ReflectionUtils={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(t){function i(t){var i=Q.getType(t);if(i!=null&&Q.isAssignableFrom(e.IDialog,i)){return i}for(var r=0,n=Q.Config.rootNamespaces;r<n.length;r++){var a=n[r];i=Q.getType(a+"."+t);if(i!=null&&Q.isAssignableFrom(e.IDialog,i)){return i}}return null}var r={};function n(e){if(r[e]==null){var t=e;var n=i(t);if(n==null&&!Q.endsWith(e,"Dialog")){t=e+"Dialog";n=i(t)}if(n==null){return null}r[e]=n;return n}return r[e]}t.tryGet=n;function a(e){var t=n(e);if(t==null){var i=e+" dialog class is not found! Make sure there is a dialog class with this name, "+"it is under your project root namespace, and your namespace parts start with capital letters, "+"e.g. MyProject.Pascal.Cased namespace. If you got this error from an editor with InplaceAdd option "+"check that lookup key and dialog type name matches (case sensitive, excluding Dialog suffix). "+"You need to change lookup key or specify DialogType property in LookupEditor attribute if that's not the case.";Q.notifyError(i,"",null);throw new Q.Exception(i)}return t}t.get=a})(t=e.DialogTypeRegistry||(e.DialogTypeRegistry={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(t){var i;function r(e){var t;if(Q.isEmptyOrNull(e)){throw new Q.ArgumentNullException("key")}n();var r=i[e.toLowerCase()];if(r==null){var a=(t=Q.getType(e))!==null&&t!==void 0?t:Q.getType(e,globalObj);if(a!=null){i[e.toLowerCase()]=a;return a}throw new Q.Exception(Q.format("Can't find {0} editor type!",e))}return r}t.get=r;function n(){if(i!=null)return;i={};for(var t=0,r=Q.getTypes();t<r.length;t++){var n=r[t];var a=Q.getTypeFullName(n).toLowerCase();i[a]=n;var l=Q.getAttributes(n,e.EditorAttribute,false);if(l!=null&&l.length>0){var s=l[0].key;if(!Q.isEmptyOrNull(s)){i[s.toLowerCase()]=n}}for(var u=0,c=Q.Config.rootNamespaces;u<c.length;u++){var d=c[u];if(Q.startsWith(a,d.toLowerCase()+".")){var f=a.substr(d.length+1).toLowerCase();if(i[f]==null){i[f]=n}}}}o()}function a(){i=null}t.reset=a;function o(){var e="editor";var t=Object.keys(i);for(var r=0,n=t;r<n.length;r++){var a=n[r];l(a,i[a])}}function l(e,t){var r="editor";if(!Q.endsWith(e,r))return;var n=e.substr(0,e.length-r.length);if(Q.isEmptyOrNull(n))return;if(i[n]!=null)return;i[n]=i[e]}})(t=e.EditorTypeRegistry||(e.EditorTypeRegistry={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(t){var i;function r(t){if(i==null){i={};for(var r=0,n=Q.getTypes();r<n.length;r++){var a=n[r];if(Q.isEnum(a)){var o=Q.getTypeFullName(a);i[o]=a;var l=Q.getAttributes(a,e.EnumKeyAttribute,false);if(l!=null&&l.length>0){i[l[0].value]=a}for(var s=0,u=Q.Config.rootNamespaces;s<u.length;s++){var c=u[s];if(Q.startsWith(o,c+".")){i[o.substr(c.length+1)]=a}}}}}if(i[t]==null)return null;return i[t]}t.tryGet=r;function n(e){var i=t.tryGet(e);if(i==null){var r=Q.format("Can't find {0} enum type! If you have recently defined this enum type "+"in server side code, make sure your project builds successfully and transform T4 templates. "+"Also make sure that enum is under your project root namespace, and your namespace parts starts "+"with capital letters, e.g.MyProject.Pascal.Cased namespace",e);Q.notifyError(r,"",null);throw new Q.Exception(r)}return i}t.get=n})(t=e.EnumTypeRegistry||(e.EnumTypeRegistry={}))})(Serenity||(Serenity={}));var Serenity;(function(e){if(typeof React==="undefined"&&typeof window!=="undefined"){if(window["preact"]!=null){window["React"]=window["ReactDOM"]=window["preact"];React.Fragment=Q.coalesce(React.Fragment,"x-fragment")}else if(window["Nerv"]!=null){window["React"]=window["ReactDOM"]=window["Nerv"];React.Fragment=Q.coalesce(React.Fragment,"x-fragment")}else{window["React"]={Component:function(){},Fragment:"x-fragment",createElement:function(){return{_reactNotLoaded:true}}};window["ReactDOM"]={render:function(){throw Error("To use React, it should be included before Serenity.CoreLib.js")}}}}var t=function(t){__extends(i,t);function i(e,i){var n=t.call(this,i)||this;n.element=e;n.options=i||{};n.widgetName=r.getWidgetName(Q.getInstanceType(n));n.uniqueName=n.widgetName+(r.nextWidgetNumber++).toString();if(e.data(n.widgetName)){throw new Q.Exception(Q.format("The element already has widget '{0}'!",n.widgetName))}e.on("remove."+n.widgetName,function(e){if(e.bubbles||e.cancelable){return}n.destroy()}).data(n.widgetName,n);n.addCssClass();return n}r=i;i.prototype.destroy=function(){if(this.element){this.element.removeClass("s-"+Q.getTypeName(Q.getInstanceType(this)));this.element.off("."+this.widgetName).off("."+this.uniqueName).removeData(this.widgetName);this.element=null}};i.prototype.addCssClass=function(){this.element.addClass(this.getCssClass())};i.prototype.getCssClass=function(){var e=Q.getInstanceType(this);var t="s-"+Q.getTypeName(e);var i=Q.replaceAll(Q.getTypeFullName(e),".","-");for(var r=0,n=Q.Config.rootNamespaces;r<n.length;r++){var a=n[r];if(Q.startsWith(i,a+"-")){i=i.substr(a.length+1);break}}i="s-"+i;if(t===i){return t}return t+" "+i};i.getWidgetName=function(e){return Q.replaceAll(Q.getTypeFullName(e),".","_")};i.elementFor=function(t){var i=Q.getAttributes(t,e.ElementAttribute,true);var r=i.length>0?i[0].value:"<input/>";return $(r)};i.prototype.addValidationRule=function(e,t){return Q.addValidationRule(this.element,e,t)};i.prototype.getGridField=function(){return this.element.closest(".field")};i.prototype.change=function(e){this.element.on("change."+this.uniqueName,e)};i.prototype.changeSelect2=function(e){this.element.on("change."+this.uniqueName,function(t){if(!$(t.target).hasClass("select2-change-triggered"))e(t)})};i.create=function(t){var i;if(Q.isAssignableFrom(e.IDialog,t.type)){i=new t.type(t.options);if(t.container)i.element.appendTo(t.container);t.element&&t.element(i.element)}else{var n=r.elementFor(t.type);if(t.container)n.appendTo(t.container);t.element&&t.element(n);i=new t.type(n,t.options)}i.init(null);t.init&&t.init(i);return i};i.prototype.initialize=function(){};i.prototype.init=function(e){e&&e(this);return this};var r;i.nextWidgetNumber=0;i.__isWidgetType=true;i=r=__decorate([e.Decorators.registerClass()],i);return i}(React.Component);e.Widget=t;if(typeof $!=="undefined"&&$.fn){$.fn.tryGetWidget=function(i){var r=this;var n;if(Q.isAssignableFrom(e.Widget,i)){var a=t.getWidgetName(i);n=r.data(a);if(n!=null&&!Q.isAssignableFrom(i,Q.getInstanceType(n))){n=null}if(n!=null){return n}}var o=r.data();if(o==null){return null}for(var l=0,s=Object.keys(o);l<s.length;l++){var u=s[l];n=o[u];if(n!=null&&Q.isAssignableFrom(i,Q.getInstanceType(n))){return n}}return null};$.fn.getWidget=function(e){if(this==null){throw new Q.ArgumentNullException("element")}if(this.length===0){throw new Q.Exception(Q.format("Searching for widget of type '{0}' on a non-existent element! ({1})",Q.getTypeFullName(e),this.selector))}var t=this.tryGetWidget(e);if(t==null){var i=Q.format("Element has no widget of type '{0}'! If you have recently changed "+"editor type of a property in a form class, or changed data type in row (which also changes "+"editor type) your script side Form definition might be out of date. Make sure your project "+"builds successfully and transform T4 templates",Q.getTypeFullName(e));Q.notifyError(i,"",null);throw new Q.Exception(i)}return t}}})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(e,i){var r=t.call(this,e,i)||this;r.idPrefix=r.uniqueName+"_";var n=r.getTemplate().replace(new RegExp("~_","g"),r.idPrefix);var a=0;while(true){var o=n.indexOf('{{text:"',a);if(o<0)break;var a=n.indexOf('"}}',o);if(a<0)break;var l=n.substr(o+8,a-o-8);var s=Q.text(l);n=n.substr(0,o)+s+n.substr(a+3);a=o+s.length}r.element.html(n);return r}r=i;i.prototype.byId=function(e){return $("#"+this.idPrefix+e)};i.prototype.byID=function(e,t){return this.byId(e).getWidget(t)};i.noGeneric=function(e){var t=e.indexOf("$");if(t>=0){return e.substr(0,t)}return e};i.prototype.getDefaultTemplateName=function(){return r.noGeneric(Q.getTypeName(Q.getInstanceType(this)))};i.prototype.getTemplateName=function(){var t=Q.getInstanceType(this);var i=Q.getTypeFullName(t);var n=r.templateNames;var a=r.templateNames[i];if(a!=null){return a}while(t&&t!==e.Widget){var o=r.noGeneric(Q.getTypeFullName(t));for(var l=0,s=Q.Config.rootNamespaces;l<s.length;l++){var u=s[l];if(Q.startsWith(o,u+".")){o=o.substr(u.length+1);break}}if(Q.canLoadScriptData("Template."+o)){n[i]=o;return o}o=Q.replaceAll(o,".","_");if(Q.canLoadScriptData("Template."+o)||$("script#Template_"+o).length>0){n[i]=o;return o}o=r.noGeneric(Q.getTypeName(t));if(Q.canLoadScriptData("Template."+o)||$("script#Template_"+o).length>0){r.templateNames[i]=o;return o}t=Q.getBaseType(t)}n[i]=a=this.getDefaultTemplateName();return a};i.prototype.getFallbackTemplate=function(){return null};i.prototype.getTemplate=function(){var e=this.getTemplateName();var t=$("script#Template_"+e);if(t.length>0){return t.html()}var i;if(!Q.canLoadScriptData("Template."+e)&&this.getDefaultTemplateName()==e){i=this.getFallbackTemplate();if(i!=null)return i}i=Q.getTemplate(e);if(i==null){throw new Error(Q.format("Can't locate template for widget '{0}' with name '{1}'!",Q.getTypeName(Q.getInstanceType(this)),e))}return i};var r;i.templateNames={};i=r=__decorate([e.Decorators.registerClass()],i);return i}(e.Widget);e.TemplatedWidget=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(e){var t=0;function i(e,t){var i=e&&e[0];if(!i)return;if(i.offsetWidth>0&&i.offsetHeight>0){t();return}var r=Q.LayoutTimer.onShown(function(){return i},function(){Q.LayoutTimer.off(r);t()})}e.executeOnceWhenShown=i;function r(e,t,i){var r=e&&e[0];if(!r)return;if(i&&r.offsetWidth>0&&r.offsetHeight>0){t()}Q.LayoutTimer.onShown(function(){return r},function(){t()})}e.executeEverytimeWhenShown=r})(t=e.LazyLoadHelper||(e.LazyLoadHelper={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(e){function t(e,t,i,r){var n=t.widgetName;e.element.bind("ondatachange."+n,function(e,t){if(r){window.setTimeout(function(){i(e,t)},0)}else{i(e,t)}}).bind("remove."+n,function(){e.element.unbind("ondatachange."+n)});return e}e.bindToDataChange=t;function i(e){e.element.triggerHandler("ondatachange");return e}e.triggerDataChange=i;function r(e){e.triggerHandler("ondatachange");return e}e.triggerDataChanged=r;function n(e,i,r){return t(e,i,function(e,t){i.element.triggerHandler("ondatachange")},r)}e.bubbleDataChange=n;function a(e,t){e.element.one("dialogopen",function(i){e.element.dialog().dialog("option","position",o(t))});return e}e.cascade=a;function o(e){return{my:"left top",at:"left+20 top+20",of:e[0]}}e.cascadedDialogOffset=o})(t=e.SubDialogHelper||(e.SubDialogHelper={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(e){function t(e){e.container.addClass("fileinput-button");var t=$("<input/>").attr("type","file").attr("name",e.inputName+"[]").attr("data-url",Q.resolveUrl("~/File/TemporaryUpload")).attr("multiple","multiple").appendTo(e.container);if(e.allowMultiple){t.attr("multiple","multiple")}t.fileupload({dataType:"json",dropZone:e.zone,pasteZone:e.zone,done:function(t,i){var r=i.result;if(e.fileDone!=null){e.fileDone(r,i.files[0].name,i)}},start:function(){Q.blockUI(null);if(e.progress!=null){e.progress.show()}},stop:function(){Q.blockUndo();if(e.progress!=null){e.progress.hide()}},progress:function(t,i){if(e.progress!=null){var r=i.loaded/i.total*100;e.progress.children().css("width",r.toString()+"%")}}});return t}e.addUploadInput=t;function i(t,i){if(!t.IsImage&&!i.allowNonImage){Q.alert(Q.text("Controls.ImageUpload.NotAnImageFile"));return false}if(i.minSize>0&&t.Size<i.minSize){Q.alert(Q.format(Q.text("Controls.ImageUpload.UploadFileTooSmall"),e.fileSizeDisplay(i.minSize)));return false}if(i.maxSize>0&&t.Size>i.maxSize){Q.alert(Q.format(Q.text("Controls.ImageUpload.UploadFileTooBig"),e.fileSizeDisplay(i.maxSize)));return false}if(!t.IsImage){return true}if(i.minWidth>0&&t.Width<i.minWidth){Q.alert(Q.format(Q.text("Controls.ImageUpload.MinWidth"),i.minWidth));return false}if(i.maxWidth>0&&t.Width>i.maxWidth){Q.alert(Q.format(Q.text("Controls.ImageUpload.MaxWidth"),i.maxWidth));return false}if(i.minHeight>0&&t.Height<i.minHeight){Q.alert(Q.format(Q.text("Controls.ImageUpload.MinHeight"),i.minHeight));return false}if(i.maxHeight>0&&t.Height>i.maxHeight){Q.alert(Q.format(Q.text("Controls.ImageUpload.MaxHeight"),i.maxHeight));return false}return true}e.checkImageConstraints=i;function r(e,t){return e+" ("+n(t)+")"}e.fileNameSizeDisplay=r;function n(e){var t=Q.round(e*100/1024)*.01;var i="KB";if(t>=1024){t=Q.round(t*100/1024)*.01;i="MB"}var r=t.toString().split(String.fromCharCode(46));var n;if(r.length>1){n=r[0]+"."+r[1].substr(0,2)}else{n=r[0]}return n+" "+i}e.fileSizeDisplay=n;function a(e){if(Q.isEmptyOrNull(e)){return false}e=e.toLowerCase();return Q.endsWith(e,".jpg")||Q.endsWith(e,".jpeg")||Q.endsWith(e,".gif")||Q.endsWith(e,".png")}e.hasImageExtension=a;function o(e){e=Q.coalesce(e,"");var t=e.lastIndexOf(".");if(t>=0){e=e.substr(0,t)}return e+"_t.jpg"}e.thumbFileName=o;function l(e){e=Q.replaceAll(Q.coalesce(e,""),"\\","/");return Q.resolveUrl("~/upload/")+e}e.dbFileUrl=l;function s(e,t){e.colorbox({current:Q.text("Controls.ImageUpload.ColorboxCurrent"),previous:Q.text("Controls.ImageUpload.ColorboxPrior"),next:Q.text("Controls.ImageUpload.ColorboxNext"),close:Q.text("Controls.ImageUpload.ColorboxClose")})}e.colorBox=s;function u(e,t,i,r){t=t||[];e.html("");for(var n=0;n<t.length;n++){var u=t[n];var c=$("<li/>").addClass("file-item").data("index",n);var d=a(u.Filename);if(d){c.addClass("file-image")}else{c.addClass("file-binary")}var f="#"+n;var p=$("<a/>").addClass("thumb").appendTo(c);var h=Q.coalesce(u.OriginalName,"");var g=u.Filename;if(r!=null&&g!=null&&!Q.startsWith(g,"temporary/")){g=r+g}p.attr("href",l(g));p.attr("target","_blank");if(!Q.isEmptyOrNull(h)){p.attr("title",h)}if(d){p.css("backgroundImage","url('"+l(o(u.Filename))+"')");s(p,new Object)}if(i){$("<div/>").addClass("filename").text(h).attr("title",h).appendTo(c)}c.appendTo(e)}}e.populateFileSymbols=u})(t=e.UploadHelper||(e.UploadHelper={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(e,i){var r=t.call(this,e,i)||this;e.addClass("s-PopupMenuButton");e.click(function(e){e.preventDefault();e.stopPropagation();if(r.options.onPopup!=null){r.options.onPopup()}var t=r.options.menu;t.show().position({my:Q.coalesce(r.options.positionMy,"left top"),at:Q.coalesce(r.options.positionAt,"left bottom"),of:r.element});var i=r.uniqueName;$(document).one("click."+i,function(e){t.hide()})});r.options.menu.hide().appendTo(document.body).addClass("s-PopupMenu").menu();return r}i.prototype.destroy=function(){if(this.options.menu!=null){this.options.menu.remove();this.options.menu=null}t.prototype.destroy.call(this)};i=__decorate([e.Decorators.registerEditor("Serenity.PopupMenuButton")],i);return i}(e.Widget);e.PopupMenuButton=t;var i=function(t){__extends(i,t);function i(e,i){var r=t.call(this,e,i)||this;e.addClass("s-PopupToolButton");$("<b/>").appendTo(e.children(".button-outer").children("span"));return r}i=__decorate([e.Decorators.registerEditor("Serenity.PopupToolButton")],i);return i}(t);e.PopupToolButton=i;var r=function(t){__extends(i,t);function i(e,i){var r=t.call(this,e,i)||this;r.element.addClass("s-Toolbar clearfix").html('<div class="tool-buttons"><div class="buttons-outer">'+'<div class="buttons-inner"></div></div></div>');var n=$("div.buttons-inner",r.element);var a=r.options.buttons;for(var o=0;o<a.length;o++){r.createButton(n,a[o])}return r}i.prototype.destroy=function(){this.element.find("div.tool-button").unbind("click");if(this.mouseTrap){if(!!this.mouseTrap.destroy){this.mouseTrap.destroy()}else{this.mouseTrap.reset()}this.mouseTrap=null}t.prototype.destroy.call(this)};i.prototype.createButton=function(e,t){var i=Q.coalesce(t.cssClass,"");if(t.separator===true||t.separator==="left"||t.separator==="both"){$('<div class="separator"></div>').appendTo(e)}var r=$('<div class="tool-button"><div class="button-outer">'+'<span class="button-inner"></span></div></div>').appendTo(e);if(t.separator==="right"||t.separator==="both"){$('<div class="separator"></div>').appendTo(e)}if(i.length>0){r.addClass(i)}if(!Q.isEmptyOrNull(t.hint)){r.attr("title",t.hint)}r.click(function(e){if(r.hasClass("disabled")){return}t.onClick(e)});var n=t.title;if(t.htmlEncode!==false){n=Q.htmlEncode(t.title)}if(!Q.isEmptyOrNull(t.icon)){r.addClass("icon-tool-button");var a=t.icon;if(Q.startsWith(a,"fa-")){a="fa "+a}else if(Q.startsWith(a,"glyphicon-")){a="glyphicon "+a}n="<i class='"+a+"'></i> "+n}if(n==null||n.length===0){r.addClass("no-text")}else{r.find("span").html(n)}if(t.visible===false)r.hide();if(t.disabled!=null&&typeof t.disabled!=="function")r.toggleClass("disabled",!!t.disabled);if(typeof t.visible==="function"||typeof t.disabled=="function"){r.on("updateInterface",function(){if(typeof t.visible==="function")r.toggle(!!t.visible());if(typeof t.disabled==="function")r.toggleClass("disabled",!!t.disabled())})}if(!!(!Q.isEmptyOrNull(t.hotkey)&&window["Mousetrap"]!=null)){this.mouseTrap=this.mouseTrap||window["Mousetrap"](t.hotkeyContext||this.options.hotkeyContext||window.document.documentElement);this.mouseTrap.bind(t.hotkey,function(e,i){if(r.is(":visible")){r.triggerHandler("click")}return t.hotkeyAllowDefault})}};i.prototype.findButton=function(e){if(e!=null&&Q.startsWith(e,".")){e=e.substr(1)}return $("div.tool-button."+e,this.element)};i.prototype.updateInterface=function(){this.element.find(".tool-button").each(function(e,t){$(t).triggerHandler("updateInterface")})};i=__decorate([e.Decorators.registerClass("Serenity.Toolbar")],i);return i}(e.Widget);e.Toolbar=r})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(t){function i(e){var t=e.element.data("select2");if(t!=null){var i=e.element.select2("data");if(i==null)return"";return Q.coalesce(i.text,"")}var r=n(e);if(r==null){return""}if(typeof r==="string")return r;if(r instanceof Boolean)return!!r?Q.coalesce(Q.tryGetText("Controls.FilterPanel.OperatorNames.true"),"True"):Q.coalesce(Q.tryGetText("Controls.FilterPanel.OperatorNames.true"),"False");return r.toString()}t.getDisplayText=i;var r={name:"_"};function n(e){var t={};a(e,r,t);return t["_"]}t.getValue=n;function a(t,i,r){var n=Q.safeCast(t,e.IGetEditValue);if(n!=null){n.getEditValue(i,r);return}var a=Q.safeCast(t,e.IStringValue);if(a!=null){r[i.name]=a.get_value();return}var o=Q.safeCast(t,e.IBooleanValue);if(o!=null){r[i.name]=o.get_value();return}var l=Q.safeCast(t,e.IDoubleValue);if(l!=null){var s=l.get_value();r[i.name]=isNaN(s)?null:s;return}if(t.getEditValue!=null){t.getEditValue(i,r);return}if(t.element.is(":input")){r[i.name]=t.element.val();return}}t.saveValue=a;function o(e,t){var i={_:t};l(e,r,i)}t.setValue=o;function l(t,i,r){var n=Q.safeCast(t,e.ISetEditValue);if(n!=null){n.setEditValue(r,i);return}var a=Q.safeCast(t,e.IStringValue);if(a!=null){var o=r[i.name];if(o!=null){o=o.toString()}a.set_value(Q.cast(o,String));return}var l=Q.safeCast(t,e.IBooleanValue);if(l!=null){var s=r[i.name];if(typeof s==="number"){l.set_value(s>0)}else{l.set_value(!!s)}return}var u=Q.safeCast(t,e.IDoubleValue);if(u!=null){var c=r[i.name];if(!!(c==null||Q.isInstanceOfType(c,String)&&Q.isTrimmedEmpty(Q.cast(c,String)))){u.set_value(null)}else if(Q.isInstanceOfType(c,String)){u.set_value(Q.cast(Q.parseDecimal(Q.cast(c,String)),Number))}else if(Q.isInstanceOfType(c,Boolean)){u.set_value(!!c?1:0)}else{u.set_value(Q.cast(c,Number))}return}if(t.setEditValue!=null){t.setEditValue(r,i);return}if(t.element.is(":input")){var d=r[i.name];if(d==null){t.element.val("")}else{t.element.val(d)}return}}t.loadValue=l;function s(e,t){e.each(function(e,i){var r=$(i);var n=r.attr("type");if(r.is("select")||n==="radio"||n==="checkbox"){if(t){r.addClass("readonly").attr("disabled","disabled")}else{r.removeClass("readonly").removeAttr("disabled")}}else if(t){r.addClass("readonly").attr("readonly","readonly")}else{r.removeClass("readonly").removeAttr("readonly")}return true});return e}t.setReadonly=s;function u(t,i){var r=Q.safeCast(t,e.IReadOnly);if(r!=null){r.set_readOnly(i)}else if(t.element.is(":input")){s(t.element,i)}}t.setReadOnly=u;function c(t,i){var r=Q.safeCast(t,e.IValidateRequired);if(r!=null){r.set_required(i)}else if(t.element.is(":input")){t.element.toggleClass("required",!!i)}var n=t.element.closest(".field");var a=n.find("sup").get().length>0;if(i&&!a){$("<sup>*</sup>").attr("title",Q.text("Controls.PropertyGrid.RequiredHint")).prependTo(n.find(".caption")[0])}else if(!i&&a){$(n.find("sup")[0]).remove()}}t.setRequired=c;function d(t,i){if(!i){if(!t.hasClass("readonly-container"))return;t.removeClass("readonly-container").find(".editor.container-readonly").removeClass("container-readonly").each(function(t,i){var r=$(i).tryGetWidget(e.Widget);if(r!=null)e.EditorUtils.setReadOnly(r,false);else e.EditorUtils.setReadonly($(i),false)});return}t.addClass("readonly-container").find(".editor").not(".container-readonly").each(function(t,i){var r=$(i).tryGetWidget(e.Widget);if(r!=null){if(r["get_readOnly"]){if(r["get_readOnly"]())return}else if($(i).is("[readonly]")||$(i).is("[disabled]")||$(i).is(".readonly")||$(i).is(".disabled"))return;$(i).addClass("container-readonly");e.EditorUtils.setReadOnly(r,true)}else{if($(i).is("[readonly]")||$(i).is("[disabled]")||$(i).is(".readonly")||$(i).is(".disabled"))return;e.EditorUtils.setReadonly($(i).addClass("container-readonly"),true)}})}t.setContainerReadOnly=d})(t=e.EditorUtils||(e.EditorUtils={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(){function t(e,t,i){var r=this;this.parentType=e;this.widget=t;this.parentChange=i;this.bind();this.widget.element.bind("remove."+t.uniqueName+"cwh",function(e){r.unbind();r.widget=null;r.parentChange=null})}t.prototype.bind=function(){var e=this;if(Q.isEmptyOrNull(this._parentID)){return null}var t=Q.findElementWithRelativeId(this.widget.element,this._parentID).tryGetWidget(this.parentType);if(t!=null){t.element.bind("change."+this.widget.uniqueName,function(){e.parentChange(t)});return t}else{Q.notifyError("Can't find cascaded parent element with ID: "+this._parentID+"!","",null);return null}};t.prototype.unbind=function(){if(Q.isEmptyOrNull(this._parentID)){return null}var e=Q.findElementWithRelativeId(this.widget.element,this._parentID).tryGetWidget(this.parentType);if(e!=null){e.element.unbind("."+this.widget.uniqueName)}return e};t.prototype.get_parentID=function(){return this._parentID};t.prototype.set_parentID=function(e){if(this._parentID!==e){this.unbind();this._parentID=e;this.bind()}};t=__decorate([e.Decorators.registerClass("Serenity.CascadedWidgetLink")],t);return t}();e.CascadedWidgetLink=t})(Serenity||(Serenity={}));var Serenity;(function(e){function t(){if(typeof $=="undefined"||!$.ui||!$.ui.dialog||!$.ui.dialog.prototype)return false;$.ui.dialog.prototype._allowInteraction=function(e){if($(e.target).closest(".ui-dialog").length){return true}return!!$(e.target).closest(".ui-datepicker, .select2-drop, .cke, .cke_dialog, #support-modal").length};(function(e){$.ui.dialog.prototype._focusTabbable=function(){if($(document.body).hasClass("mobile-device")){this.uiDialog&&this.uiDialog.focus();return}e.call(this)}})($.ui.dialog.prototype._focusTabbable);(function(e){$.ui.dialog.prototype._createTitlebar=function(){e.call(this);this.uiDialogTitlebar.find(".ui-dialog-titlebar-close").html('<i class="fa fa-times" />')}})($.ui.dialog.prototype._createTitlebar)}!t()&&typeof $!=="undefined"&&$(t);if(typeof $!=="undefined"){$.cleanData=function(e){return function(t){var i,r,n,a;var o=t;for(n=0;(r=o[n])!=null;n++){try{i=$._data(r,"events");if(i&&i.remove){if(o===t)o=Array.prototype.slice.call(t);$(r).triggerHandler("remove");delete i.remove}}catch(a){}}e(t)}}($.cleanData)}})(Serenity||(Serenity={}));var Q;(function(e){var t;function i(e,i){t.call(this,e,i);this.errorsFor(e).each(function(t,i){if($(e).hasClass("error"))$(i).removeClass("checked");$(i).attr("title",$(i).text())})}function r(){var e=$.validator;e=e.prototype;t=e.showLabel;e.showLabel=i;e.oldfocusInvalid=e.focusInvalid;e.focusInvalid=function(){if(this.settings.abortHandler)this.settings.abortHandler(this);this.oldfocusInvalid.call(this)};e.oldstopRequest=e.focusInvalid;e.stopRequest=function(e,t){var i=this.formSubmitted;this.oldfocusInvalid.call(this,[e,t]);if(!t&&this.pendingRequest==0&&i&&this.settings.abortHandler){this.settings.abortHandler(this)}};e.resetAll=function(){this.submitted={};this.prepareForm();this.hideErrors();this.elements().removeClass(this.settings.errorClass)}}function n(e){e.settings.abortHandler=null;e.settings.submitHandler=function(){return false}}e.validatorAbortHandler=n;function a(t){var i=e.baseValidateOptions();delete i.showErrors;return e.extend(e.extend(i,{meta:"v",errorPlacement:function(e,t){var i=null;var r=t.attr("data-vx-id");if(r){i=$("#"+r);if(!i.length)i=null;else i=i[0]}if(i==null){i=t.parents("div.field");if(i.length){var n=$("div.vx",i[0]);if(n.length)i=n[0]}else i=t.parent()}e.appendTo(i)},submitHandler:function(){return false},invalidHandler:function(t,i){e.notifyError(e.text("Validation.InvalidFormMessage"));$(i.errorList.map(function(e){return e.element})).closest(".category.collapsed").children(".category-title").each(function(e,t){$(t).click();return true});if(i.errorList.length){var r=i.errorList[0].element;if(r){var n=$(r).closest(".tab-pane");if(!n.hasClass("active")&&n.parent().hasClass("tab-content")){var a=n.attr("id");if(a){$('a[href="#'+a+'"]').click()}}if($.fn.tooltip){var o=$(r);if(o.hasClass("select2-offscreen")&&r.id){o=$("#s2id_"+r.id)}$.fn.tooltip&&o.tooltip({title:i.errorList[0].message,trigger:"manual"}).tooltip("show");window.setTimeout(function(){o.tooltip("destroy")},1500)}}}},success:function(e){e.addClass("checked")}}),t)}e.validateOptions=a;if($.validator)r();else $(function(){$.validator&&r()})})(Q||(Q={}));var Serenity;(function(e){var t;(function(e){function t(e,t,i){var r=e.validate();var n=r.settings;if(n.abortHandler){return false}if(t!=null&&t()===false){return false}n["abortHandler"]=Q.validatorAbortHandler;n["submitHandler"]=function(){if(i!=null){i()}return false};e.trigger("submit");return true}e.asyncSubmit=t;function i(e,t,i){var r=e.validate();var n=r.settings;if(n.abortHandler!=null){return false}if(t!=null&&t()===false){return false}if(!r.form()){return false}if(i!=null){i()}return true}e.submit=i;function r(e){var t=e.closest("form");if(t.length===0){return null}return t.data("validator")}e.getValidator=r})(t=e.ValidationHelper||(e.ValidationHelper={}));var i;(function(e){e.addValidationRule=Q.addValidationRule;e.removeValidationRule=Q.removeValidationRule;function t(e,t){return e.element(t.element[0])}e.validateElement=t})(i=e.VX||(e.VX={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(e,i){var r=t.call(this,e,i)||this;r.initValidator();r.initTabs();r.initToolbar();return r}i.prototype.destroy=function(){if(this.tabs){this.tabs.tabs("destroy");this.tabs=null}if(this.toolbar){this.toolbar.destroy();this.toolbar=null}if(this.validator){this.byId("Form").remove();this.validator=null}t.prototype.destroy.call(this)};i.prototype.arrange=function(){this.element.find(".require-layout").filter(":visible").each(function(e,t){$(t).triggerHandler("layout")})};i.prototype.getToolbarButtons=function(){return[]};i.prototype.getValidatorOptions=function(){return{}};i.prototype.initTabs=function(){var e=this.byId("Tabs");if(e.length===0){return}this.tabs=e.tabs({})};i.prototype.initToolbar=function(){var t=this.byId("Toolbar");if(t.length===0){return}var i={buttons:this.getToolbarButtons()};this.toolbar=new e.Toolbar(t,i)};i.prototype.initValidator=function(){var e=this.byId("Form");if(e.length>0){var t=this.getValidatorOptions();this.validator=e.validate(Q.validateOptions(t))}};i.prototype.resetValidation=function(){if(this.validator){this.validator.resetAll()}};i.prototype.validateForm=function(){return this.validator==null||!!this.validator.form()};return i}(e.TemplatedWidget);e.TemplatedPanel=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(e){function t(e,t,i){if(!e)return;var r=n(e);if(!r)return;var a=r[t];if(a==null){return}if(i&&a===e.tabs("option","active")){e.tabs("option","active",0)}e.tabs(i?"disable":"enable",a)}e.setDisabled=t;function i(e,t,i){if(!e)return;var r=n(e);if(!r)return;var a=r[t];if(a==null){return}if(!i&&a===e.tabs("option","active")){e.tabs("option","active",0)}e.children("ul").children("li").eq(a).toggle(i)}e.toggle=i;function r(e){var t=e.children("ul").children("li").eq(e.tabs("option","active")).children("a").attr("href").toString();var i="_Tab";var r=t.lastIndexOf(i);if(r>=0){t=t.substr(r+i.length)}return t}e.activeTabKey=r;function n(e){var t=e.data("indexByKey");if(!t){t={};e.children("ul").children("li").children("a").each(function(e,i){var r=i.getAttribute("href").toString();var n="_Tab";var a=r.lastIndexOf(n);if(a>=0){r=r.substr(a+n.length)}t[r]=e});e.data("indexByKey",t)}return t}e.indexByKey=n;function a(e,t){var i=n(e);if(!i)return;var r=i[t];if(r==null){return}if(r!==e.tabs("option","active")){e.tabs("option","active",r)}}e.selectTab=a})(t=e.TabsExtensions||(e.TabsExtensions={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(t){function i(t,i){if(i==null){return}var r=Q.getInstanceType(t);if(r===Object){return}var n=r.__propByName;var a=r.__fieldByName;if(n==null){var o=Q.getMembers(r,16);var l=o.filter(function(t){return!!t.setter&&((t.attr||[]).filter(function(t){return Q.isInstanceOfType(t,e.OptionAttribute)}).length>0||(t.attr||[]).filter(function(e){return Q.isInstanceOfType(e,System.ComponentModel.DisplayNameAttribute)}).length>0)});n={};for(var s=0,u=l;s<u.length;s++){var c=u[s];n[e.ReflectionUtils.makeCamelCase(c.name)]=c}r.__propByName=n}if(a==null){var d=Q.getMembers(r,4);var f=d.filter(function(t){return(t.attr||[]).filter(function(t){return Q.isInstanceOfType(t,e.OptionAttribute)}).length>0||(t.attr||[]).filter(function(e){return Q.isInstanceOfType(e,System.ComponentModel.DisplayNameAttribute)}).length>0});a={};for(var p=0;p<f.length;p++){var h=f[p];a[e.ReflectionUtils.makeCamelCase(h.name)]=h}r.__fieldByName=a}var g=Object.keys(i);for(var v=0,y=g;v<y.length;v++){var m=y[v];var b=i[m];var C=e.ReflectionUtils.makeCamelCase(m);var _=n[C]||n[m];if(_!=null){var S=t[_.setter];S&&S.call(t,b)}else{var x=a[C]||a[m];x&&(t[x.name]=b)}}}t.set=i})(t=e.ReflectionOptionsSetter||(e.ReflectionOptionsSetter={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(e,i){var r=t.call(this,e,i)||this;r.categoryLinkClick=function(e){e.preventDefault();var t=$("a[name="+e.target.getAttribute("href").toString().substr(1)+"]");if(t.closest(".category").hasClass("collapsed"))t.closest(".category").children(".category-title").click();var i=function(){t.fadeTo(100,.5,function(){t.fadeTo(100,1,function(){})})};var r=t.closest(".category");if(r.closest(":scrollable(both)").length===0)i();
else{r.scrollintoview({duration:"fast",direction:"y",complete:i})}};if(i.mode==null)i.mode=1;e.addClass("s-PropertyGrid");r.editors=[];var n=r.options.items||[];r.items=[];var a=Q.any(n,function(e){return!Q.isEmptyOrNull(e.tab)});if(a){var o=n.filter(function(e){return Q.isEmptyOrNull(e.tab)});if(o.length>0){r.createItems(r.element,o);$("<div class='pad'></div>").appendTo(r.element)}var l=n.filter(function(e){return!Q.isEmptyOrNull(e.tab)});var s=$("<ul class='nav nav-tabs property-tabs' role='tablist'></ul>").appendTo(r.element);var u=$("<div class='tab-content property-panes'></div>").appendTo(r.element);var c=0;var d=0;while(d<l.length){var f={$:Q.trimToEmpty(l[d].tab)};var p=[];var h=d;do{p.push(l[h])}while(++h<l.length&&Q.trimToEmpty(l[h].tab)===f.$);d=h;var g=$("<li><a data-toggle='tab' role='tab'></a></li>").appendTo(s);if(c===0){g.addClass("active")}var v=r.uniqueName+"_Tab"+c;g.children("a").attr("href","#"+v).text(r.determineText(f.$,function(e){return e+"Tabs."+this.tab.$}.bind({tab:f})));var y=$("<div class='tab-pane fade' role='tabpanel'>").appendTo(u);if(c===0){y.addClass("in active")}y.attr("id",v);r.createItems(y,p);c++}}else{r.createItems(r.element,n)}r.updateInterface();return r}r=i;i.prototype.destroy=function(){if(this.editors!=null){for(var t=0;t<this.editors.length;t++){this.editors[t].destroy()}this.editors=null}this.element.find("a.category-link").unbind("click",this.categoryLinkClick).remove();e.Widget.prototype.destroy.call(this)};i.prototype.createItems=function(e,t){var i={};var r=e;var n=this.options.useCategories!==false&&Q.any(t,function(e){return!Q.isEmptyOrNull(e.category)});if(n){var a=$("<div/>").addClass("category-links");i=this.createCategoryLinks(a,t);if(Object.keys(i).length>1){a.appendTo(e)}else{a.find("a.category-link").unbind("click",this.categoryLinkClick).remove()}}r=$("<div/>").addClass("categories").appendTo(e);var o;if(n){o=r}else{o=$("<div/>").addClass("category").appendTo(r)}var l=null;for(var s=0;s<t.length;s++){var u=t[s];var c=u.category;if(c==null){c=Q.coalesce(this.options.defaultCategory,"")}if(n&&l!==c){var d=this.createCategoryDiv(r,i,c,u.collapsible!==true?null:Q.coalesce(u.collapsed,false));if(l==null){d.addClass("first-category")}l=c;o=d}var f=this.createField(o,u);this.items.push(u);this.editors.push(f)}};i.prototype.createCategoryDiv=function(e,t,i,r){var n=$("<div/>").addClass("category").appendTo(e);var a=$("<div/>").addClass("category-title").append($("<a/>").addClass("category-anchor").text(this.determineText(i,function(e){return e+"Categories."+i})).attr("name",this.options.idPrefix+"Category"+t[i].toString())).appendTo(n);if(r!=null){n.addClass(r===true?"collapsible collapsed":"collapsible");var o=$("<i/>").addClass(r===true?"fa fa-plus":"fa fa-minus").appendTo(a);a.click(function(e){n.toggleClass("collapsed");o.toggleClass("fa-plus").toggleClass("fa-minus")})}return n};i.prototype.determineText=function(e,t){if(e!=null&&!Q.startsWith(e,"`")){var i=Q.tryGetText(e);if(i!=null){return i}}if(e!=null&&Q.startsWith(e,"`")){e=e.substr(1)}if(!Q.isEmptyOrNull(this.options.localTextPrefix)){var r=Q.tryGetText(t(this.options.localTextPrefix));if(r!=null){return r}}return e};i.prototype.createField=function(t,i){var n=$("<div/>").addClass("field").addClass(i.name).data("PropertyItem",i).appendTo(t);if(!Q.isEmptyOrNull(i.cssClass)){n.addClass(i.cssClass)}if(!Q.isEmptyOrNull(i.formCssClass)){n.addClass(i.formCssClass);if(i.formCssClass.indexOf("line-break-")>=0){var a=i.formCssClass.split(String.fromCharCode(32));if(a.indexOf("line-break-xs")>=0){$("<div class='line-break' style='width: 100%' />").insertBefore(n)}else if(a.indexOf("line-break-sm")>=0){$("<div class='line-break hidden-xs' style='width: 100%' />").insertBefore(n)}else if(a.indexOf("line-break-md")>=0){$("<div class='line-break hidden-sm' style='width: 100%' />").insertBefore(n)}else if(a.indexOf("line-break-lg")>=0){$("<div class='line-break hidden-md' style='width: 100%' />").insertBefore(n)}}}var o=this.options.idPrefix+i.name;var l=this.determineText(i.title,function(e){return e+i.name});var s=this.determineText(i.hint,function(e){return e+i.name+"_Hint"});var u=this.determineText(i.placeholder,function(e){return e+i.name+"_Placeholder"});if(s==null){s=Q.coalesce(l,"")}var c=$("<label/>").addClass("caption").attr("for",o).attr("title",s).html(Q.coalesce(l,"")).appendTo(n);if(!Q.isEmptyOrNull(i.labelWidth)){if(i.labelWidth==="0"){c.hide()}else{c.css("width",i.labelWidth)}}if(i.required===true){$("<sup>*</sup>").attr("title",Q.text("Controls.PropertyGrid.RequiredHint")).prependTo(c)}var d=e.EditorTypeRegistry.get(Q.coalesce(i.editorType,"String"));var f=Q.getAttributes(d,e.ElementAttribute,true);var p=f.length>0?f[0].value:"<input/>";var h=e.Widget.elementFor(d).addClass("editor").attr("id",o).appendTo(n);if(h.is(":input")){h.attr("name",Q.coalesce(i.name,""))}if(!Q.isEmptyOrNull(u)){h.attr("placeholder",u)}var g=i.editorParams;var v=null;var y=Q.getAttributes(d,e.OptionsTypeAttribute,true);if(y!=null&&y.length>0){v=y[0].optionsType}var m;if(v!=null){g=Q.extend(new v,i.editorParams);m=new d(h,g)}else{g=Q.extend(new Object,i.editorParams);m=new d(h,g)}m.initialize();if(Q.getTypeName(m)=="BooleanEditor"&&(i.editorParams==null||!!!i.editorParams["labelFor"])){c.removeAttr("for")}if(Q.getTypeName(m)=="RadioButtonEditor"&&(i.editorParams==null||!!!i.editorParams["labelFor"])){c.removeAttr("for")}if(i.maxLength!=null){r.setMaxLength(m,i.maxLength)}if(i.editorParams!=null){e.ReflectionOptionsSetter.set(m,i.editorParams)}$("<div/>").addClass("vx").appendTo(n);$("<div/>").addClass("clear").appendTo(n);return m};i.prototype.getCategoryOrder=function(e){var t=0;var i={};var r=Q.trimToNull(this.options.categoryOrder);if(r!=null){var n=r.split(";");for(var a=0,o=n;a<o.length;a++){var l=o[a];var s=Q.trimToNull(l);if(s==null){continue}if(i[s]!=null){continue}i[s]=t++}}for(var u=0,c=e;u<c.length;u++){var d=c[u];var f=d.category;if(f==null){f=Q.coalesce(this.options.defaultCategory,"")}if(i[f]==null){i[f]=t++}}return i};i.prototype.createCategoryLinks=function(e,t){var i=0;var r={};var n={};for(var a=0,o=t;a<o.length;a++){var l=o[a];var s=l.name;var u=l.category;if(u==null){u=Q.coalesce(this.options.defaultCategory,"")}n[s]=u;r[l.name]=i++}var c=this;var d=this.getCategoryOrder(t);t.sort(function(e,t){var i=0;var a=n[e.name];var o=n[t.name];if(a!=o){var l=d[a];var s=d[o];if(l!=null&&s!=null){i=l-s}else if(l!=null){i=-1}else if(s!=null){i=1}}if(i===0){i=Q.Culture.stringCompare(a,o)}if(i===0){i=r[e.name]<r[t.name]?-1:r[e.name]>r[t.name]?1:0}return i});var f={};for(var p=0;p<t.length;p++){var h=t[p];var g={$:n[h.name]};if(f[g.$]==null){var v=Object.keys(f).length+1;f[g.$]=v;if(v>1){$("<span/>").addClass("separator").text("|").prependTo(e)}$("<a/>").addClass("category-link").text(this.determineText(g.$,function(e){return e+"Categories."+this.category.$}.bind({category:g}))).attr("tabindex","-1").attr("href","#"+this.options.idPrefix+"Category"+v.toString()).click(this.categoryLinkClick).prependTo(e)}}$("<div/>").addClass("clear").appendTo(e);return f};i.prototype.get_editors=function(){return this.editors};i.prototype.get_items=function(){return this.items};i.prototype.get_idPrefix=function(){return this.options.idPrefix};i.prototype.get_mode=function(){return this.options.mode};i.prototype.set_mode=function(e){if(this.options.mode!==e){this.options.mode=e;this.updateInterface()}};i.loadEditorValue=function(e,t,i){};i.saveEditorValue=function(t,i,r){e.EditorUtils.saveValue(t,i,r)};i.setReadOnly=function(t,i){e.EditorUtils.setReadOnly(t,i)};i.setReadonly=function(t,i){return e.EditorUtils.setReadonly(t,i)};i.setRequired=function(t,i){e.EditorUtils.setRequired(t,i)};i.setMaxLength=function(e,t){if(e.element.is(":input")){if(t>0){e.element.attr("maxlength",t)}else{e.element.removeAttr("maxlength")}}};i.prototype.load=function(t){for(var i=0;i<this.editors.length;i++){var r=this.items[i];var n=this.editors[i];if(!!(this.get_mode()===1&&r.defaultValue!=null)&&typeof t[r.name]==="undefined"){t[r.name]=r.defaultValue}e.EditorUtils.loadValue(n,r,t)}};i.prototype.save=function(t){if(t==null)t=Object.create(null);for(var i=0;i<this.editors.length;i++){var r=this.items[i];if(r.oneWay!==true&&this.canModifyItem(r)){var n=this.editors[i];e.EditorUtils.saveValue(n,r,t)}}return t};Object.defineProperty(i.prototype,"value",{get:function(){return this.save()},set:function(e){if(e==null)e=Object.create(null);this.load(e)},enumerable:true,configurable:true});i.prototype.canModifyItem=function(e){if(this.get_mode()===1){if(e.insertable===false){return false}if(e.insertPermission==null){return true}return Q.Authorization.hasPermission(e.insertPermission)}else if(this.get_mode()===2){if(e.updatable===false){return false}if(e.updatePermission==null){return true}return Q.Authorization.hasPermission(e.updatePermission)}return true};i.prototype.updateInterface=function(){for(var t=0;t<this.editors.length;t++){var i=this.items[t];var r=this.editors[t];var n=i.readOnly===true||!this.canModifyItem(i);e.EditorUtils.setReadOnly(r,n);e.EditorUtils.setRequired(r,!n&&!!i.required&&i.editorType!=="Boolean");if(i.visible===false||i.readPermission!=null||i.insertPermission!=null||i.updatePermission!=null||i.hideOnInsert===true||i.hideOnUpdate===true){var a=i.readPermission!=null&&!Q.Authorization.hasPermission(i.readPermission)||i.visible===false||this.get_mode()===1&&i.hideOnInsert===true||this.get_mode()===2&&i.hideOnUpdate===true;r.getGridField().toggle(!a)}}};i.prototype.enumerateItems=function(e){for(var t=0;t<this.editors.length;t++){var i=this.items[t];var r=this.editors[t];e(i,r)}};var r;i=r=__decorate([e.Decorators.registerClass("PropertyGrid")],i);return i}(e.Widget);e.PropertyGrid=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(e,i){var r=t.call(this,e,i)||this;r.initPropertyGrid();r.loadInitialEntity();return r}i.prototype.destroy=function(){if(this.propertyGrid){this.propertyGrid.destroy();this.propertyGrid=null}if(this.validator){this.byId("Form").remove();this.validator=null}t.prototype.destroy.call(this)};i.prototype.initPropertyGrid=function(){var t=this.byId("PropertyGrid");if(t.length<=0){return}var i=this.getPropertyGridOptions();this.propertyGrid=new e.PropertyGrid(t,i).init(null);if(this.element.closest(".ui-Panel").hasClass("s-Flexify")){this.propertyGrid.element.children(".categories").flexHeightOnly(1)}};i.prototype.loadInitialEntity=function(){if(this.propertyGrid){this.propertyGrid.load(new Object)}};i.prototype.getFormKey=function(){var t=Q.getAttributes(Q.getInstanceType(this),e.FormKeyAttribute,true);if(t.length>=1){return t[0].value}var i=Q.getTypeFullName(Q.getInstanceType(this));var r=i.indexOf(".");if(r>=0){i=i.substring(r+1)}if(Q.endsWith(i,"Panel")){i=i.substr(0,i.length-6)}else if(Q.endsWith(i,"Panel")){i=i.substr(0,i.length-5)}return i};i.prototype.getPropertyGridOptions=function(){return{idPrefix:this.idPrefix,items:this.getPropertyItems(),mode:1,useCategories:false,localTextPrefix:"Forms."+this.getFormKey()+"."}};i.prototype.getPropertyItems=function(){var e=this.getFormKey();return Q.getForm(e)};i.prototype.getSaveEntity=function(){var e=new Object;if(this.propertyGrid){this.propertyGrid.save(e)}return e};i.prototype.get_entity=function(){return this._entity};i.prototype.get_entityId=function(){return this._entityId};i.prototype.set_entity=function(e){this._entity=Q.coalesce(e,new Object)};i.prototype.set_entityId=function(e){this._entityId=e};i.prototype.validateBeforeSave=function(){return this.validator.form()};i=__decorate([e.Decorators.registerClass("Serenity.PropertyPanel")],i);return i}(e.TemplatedPanel);e.PropertyPanel=t})(Serenity||(Serenity={}));var Serenity;(function(e){function t(){if(typeof Vue==="undefined")return false;Vue.component("editor",{props:{type:{type:String,required:true},id:{type:String,required:false},name:{type:String,required:false},placeholder:{type:String,required:false},value:{required:false},options:{required:false},maxLength:{required:false}},render:function(t){var i=e.EditorTypeRegistry.get(this.type);var r=Q.getAttributes(i,e.ElementAttribute,true);var n=r.length>0?r[0].value:"<input/>";var a={};var o=$(n)[0];var l=o.attributes;for(var s=0;s<l.length;s++){var u=l.item(s);a[u.name]=u.value}if(this.id!=null)a.id=this.id;if(this.name!=null)a.name=this.name;if(this.placeholder!=null)a.placeholder=this.placeholder;var c=this.options;var d=null;var f=this;var p=t(o.tagName,{domProps:a});this.$editorType=i;return p},watch:{value:function(t){e.EditorUtils.setValue(this.$widget,t)}},mounted:function(){var t=this;this.$widget=new this.$editorType($(this.$el),this.options);this.$widget.initialize();if(this.maxLength){e.PropertyGrid.$setMaxLength(this.$widget,this.maxLength)}if(this.options)e.ReflectionOptionsSetter.set(this.$widget,this.options);if(this.value!=null)e.EditorUtils.setValue(this.$widget,this.value);if($(this.$el).data("select2"))this.$widget.changeSelect2(function(){t.$emit("input",e.EditorUtils.getValue(t.$widget))});else this.$widget.change(function(){t.$emit("input",e.EditorUtils.getValue(t.$widget))})},destroyed:function(){if(this.$widget){this.$widget.destroy();this.$widget=null}}});return true}!t()&&typeof $!=="undefined"&&$(t)})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(e){return t.call(this,e)||this}Object.defineProperty(i.prototype,"value",{get:function(){return this.element.val()},set:function(e){this.element.val(e)},enumerable:true,configurable:true});i.prototype.get_value=function(){return this.value};i.prototype.set_value=function(e){this.value=e};i=__decorate([e.Decorators.registerEditor("Serenity.StringEditor",[e.IStringValue]),e.Decorators.element('<input type="text"/>')],i);return i}(e.Widget);e.StringEditor=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(e){var i=t.call(this,e)||this;e.attr("type","password");return i}i=__decorate([e.Decorators.registerEditor("Serenity.PasswordEditor")],i);return i}(e.StringEditor);e.PasswordEditor=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(e,i){var r=t.call(this,e,i)||this;if(r.options.cols!==0){e.attr("cols",Q.coalesce(r.options.cols,80))}if(r.options.rows!==0){e.attr("rows",Q.coalesce(r.options.rows,6))}return r}Object.defineProperty(i.prototype,"value",{get:function(){return this.element.val()},set:function(e){this.element.val(e)},enumerable:true,configurable:true});i.prototype.get_value=function(){return this.value};i.prototype.set_value=function(e){this.value=e};i=__decorate([e.Decorators.registerEditor("Sereniy.TextAreaEditor",[e.IStringValue]),e.Decorators.element("<textarea />")],i);return i}(e.Widget);e.TextAreaEditor=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(){return t!==null&&t.apply(this,arguments)||this}Object.defineProperty(i.prototype,"value",{get:function(){return this.element.is(":checked")},set:function(e){this.element.prop("checked",!!e)},enumerable:true,configurable:true});i.prototype.get_value=function(){return this.value};i.prototype.set_value=function(e){this.value=e};i=__decorate([e.Decorators.registerEditor("Serenity.BooleanEditor",[e.IBooleanValue]),e.Decorators.element('<input type="checkbox"/>')],i);return i}(e.Widget);e.BooleanEditor=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(i,r){var n=t.call(this,i,r)||this;i.addClass("decimalQ");var a=Q.extend(e.DecimalEditor.defaultAutoNumericOptions(),{vMin:Q.coalesce(n.options.minValue,n.options.allowNegatives?n.options.maxValue!=null?"-"+n.options.maxValue:"-999999999999.99":"0.00"),vMax:Q.coalesce(n.options.maxValue,"999999999999.99")});if(n.options.decimals!=null){a.mDec=n.options.decimals}if(n.options.padDecimals!=null){a.aPad=n.options.padDecimals}if($.fn.autoNumeric)i.autoNumeric(a);return n}i.prototype.get_value=function(){if($.fn.autoNumeric){var e=this.element.autoNumeric("get");if(!!(e==null||e===""))return null;return parseFloat(e)}var e=this.element.val();return Q.parseDecimal(e)};Object.defineProperty(i.prototype,"value",{get:function(){return this.get_value()},set:function(e){this.set_value(e)},enumerable:true,configurable:true});i.prototype.set_value=function(e){if(e==null||e===""){this.element.val("")}else if($.fn.autoNumeric){this.element.autoNumeric("set",e)}else this.element.val(Q.formatNumber(e))};i.prototype.get_isValid=function(){return!isNaN(this.get_value())};i.defaultAutoNumericOptions=function(){return{aDec:Q.Culture.decimalSeparator,altDec:Q.Culture.decimalSeparator==="."?",":".",aSep:Q.Culture.decimalSeparator==="."?",":".",aPad:true}};i=__decorate([e.Decorators.registerEditor("Serenity.DecimalEditor",[e.IDoubleValue]),e.Decorators.element('<input type="text"/>')],i);return i}(e.Widget);e.DecimalEditor=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(i,r){var n=t.call(this,i,r)||this;i.addClass("integerQ");var a=Q.extend(e.DecimalEditor.defaultAutoNumericOptions(),{vMin:Q.coalesce(n.options.minValue,n.options.allowNegatives?n.options.maxValue!=null?"-"+n.options.maxValue:"-2147483647":"0"),vMax:Q.coalesce(n.options.maxValue,2147483647),aSep:null});if($.fn.autoNumeric)i.autoNumeric(a);return n}i.prototype.get_value=function(){if($.fn.autoNumeric){var e=this.element.autoNumeric("get");if(!!Q.isTrimmedEmpty(e))return null;else return parseInt(e,10)}else{var e=Q.trimToNull(this.element.val());if(e==null)return null;return Q.parseInteger(e)}};Object.defineProperty(i.prototype,"value",{get:function(){return this.get_value()},set:function(e){this.set_value(e)},enumerable:true,configurable:true});i.prototype.set_value=function(e){if(e==null||e==="")this.element.val("");else if($.fn.autoNumeric)this.element.autoNumeric("set",e);else this.element.val(Q.formatNumber(e))};i.prototype.get_isValid=function(){return!isNaN(this.get_value())};i=__decorate([e.Decorators.registerEditor("Serenity.IntegerEditor",[e.IDoubleValue]),e.Decorators.element('<input type="text"/>')],i);return i}(e.Widget);e.IntegerEditor=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=e.Decorators.option;e.datePickerIconSvg='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 17 17"><g></g><path d="M14 2v-1h-3v1h-5v-1h-3v1h-3v15h17v-15h-3zM12 2h1v2h-1v-2zM4 2h1v2h-1v-2zM16 16h-15v-8.921h15v8.921zM1 6.079v-3.079h2v2h3v-2h5v2h3v-2h2v3.079h-15z" fill="#000000"></path></svg>';var i=function(i){__extends(r,i);function r(t){var r=i.call(this,t)||this;if(typeof flatpickr!=="undefined"&&(n.useFlatpickr||!$.fn.datepicker)){flatpickr(t[0],n.flatPickrOptions(t))}else if($.fn.datepicker){t.datepicker({showOn:"button",beforeShow:function(e,i){return!t.hasClass("readonly")},yearRange:Q.coalesce(r.yearRange,"-100:+50")})}else{t.attr("type","date")}t.on("keyup."+r.uniqueName,function(t){if(t.which===32&&!r.get_readOnly()){if(r.get_valueAsDate()!=Q.today()){r.set_valueAsDate(Q.today());r.element.trigger("change")}}else{e.DateEditor.dateInputKeyup(t)}});t.on("change."+r.uniqueName,e.DateEditor.dateInputChange);Q.addValidationRule(t,r.uniqueName,function(e){var t=r.get_value();if(Q.isEmptyOrNull(t)){return null}if(!Q.isEmptyOrNull(r.get_minValue())&&Q.Invariant.stringCompare(t,r.get_minValue())<0){return Q.format(Q.text("Validation.MinDate"),Q.formatDate(r.get_minValue(),null))}if(!Q.isEmptyOrNull(r.get_maxValue())&&Q.Invariant.stringCompare(t,r.get_maxValue())>=0){return Q.format(Q.text("Validation.MaxDate"),Q.formatDate(r.get_maxValue(),null))}return null});r.set_sqlMinMax(true);return r}n=r;r.flatPickrOptions=function(e){return{clickOpens:true,allowInput:true,dateFormat:Q.Culture.dateOrder.split("").join(Q.Culture.dateSeparator).replace("y","Y"),onChange:function(){e.triggerHandler("change")}}};r.prototype.get_value=function(){var e=this.element.val().trim();if(e!=null&&e.length===0){return null}return Q.formatDate(e,"yyyy-MM-dd")};Object.defineProperty(r.prototype,"value",{get:function(){return this.get_value()},set:function(e){this.set_value(e)},enumerable:true,configurable:true});r.prototype.set_value=function(e){if(e==null){this.element.val("")}else if(e.toLowerCase()==="today"||e.toLowerCase()==="now"){this.element.val(Q.formatDate(Q.today(),null))}else{this.element.val(Q.formatDate(e,null))}};r.prototype.get_valueAsDate=function(){if(Q.isEmptyOrNull(this.get_value())){return null}return Q.parseISODateTime(this.get_value())};Object.defineProperty(r.prototype,"valueAsDate",{get:function(){return this.get_valueAsDate()},set:function(e){this.set_valueAsDate(e)},enumerable:true,configurable:true});r.prototype.set_valueAsDate=function(e){if(e==null){this.set_value(null)}this.set_value(Q.formatDate(e,"yyyy-MM-dd"))};r.prototype.get_readOnly=function(){return this.element.hasClass("readonly")};r.prototype.set_readOnly=function(e){if(e!==this.get_readOnly()){if(e){this.element.addClass("readonly").attr("readonly","readonly");this.element.nextAll(".ui-datepicker-trigger").css("opacity","0.1")}else{this.element.removeClass("readonly").removeAttr("readonly");this.element.nextAll(".ui-datepicker-trigger").css("opacity","1")}}};r.prototype.get_minValue=function(){return this.minValue};r.prototype.set_minValue=function(e){this.minValue=e};r.prototype.get_maxValue=function(){return this.maxValue};r.prototype.set_maxValue=function(e){this.maxValue=e};r.prototype.get_minDate=function(){return Q.parseISODateTime(this.get_minValue())};r.prototype.set_minDate=function(e){this.set_minValue(Q.formatDate(e,"yyyy-MM-dd"))};r.prototype.get_maxDate=function(){return Q.parseISODateTime(this.get_maxValue())};r.prototype.set_maxDate=function(e){this.set_maxValue(Q.formatDate(e,"yyyy-MM-dd"))};r.prototype.get_sqlMinMax=function(){return this.get_minValue()==="1753-01-01"&&this.get_maxValue()==="9999-12-31"};r.prototype.set_sqlMinMax=function(e){if(e){this.set_minValue("1753-01-01");this.set_maxValue("9999-12-31")}else{this.set_minValue(null);this.set_maxValue(null)}};r.flatPickrTrigger=function(t){return $('<i class="ui-datepicker-trigger" href="javascript:;">'+e.datePickerIconSvg+"</i>").insertAfter(t).click(function(){if(!t.hasClass("readonly"))t[0]._flatpickr.open()})};r.dateInputKeyup=function(e){if(Q.Culture.dateOrder!=="dmy"){return}var t=$(e.target);if(!t.is(":input")||t.attr("type")=="date"){return}if(t.is("[readonly]")||t.is(":disabled")){return}var i=Q.coalesce(t.val(),"");if(!!(i.length===0||t[0].selectionEnd!==i.length)){return}if(i.indexOf(Q.Culture.dateSeparator+Q.Culture.dateSeparator)!==-1){t.val(Q.replaceAll(i,Q.Culture.dateSeparator+Q.Culture.dateSeparator,Q.Culture.dateSeparator));return}function r(e){return e>=48&&e<=57}if(e.which===47||e.which===111){if(i.length>=2&&i.charAt(i.length-1)===Q.Culture.dateSeparator&&i.charAt(i.length-2)===Q.Culture.dateSeparator){t.val(i.substr(0,i.length-1));return}if(i.charAt(i.length-1)!==Q.Culture.dateSeparator){return}switch(i.length){case 2:{if(r(i.charCodeAt(0))){i="0"+i;break}else{return}}case 4:{if(r(i.charCodeAt(0))&&r(i.charCodeAt(2))&&i.charAt(1)==Q.Culture.dateSeparator){i="0"+i.charAt(0)+Q.Culture.dateSeparator+"0"+i.charAt(2)+Q.Culture.dateSeparator;break}else{return}}case 5:{if(r(i.charCodeAt(0))&&r(i.charCodeAt(2))&&r(i.charCodeAt(3))&&i.charAt(1)===Q.Culture.dateSeparator){i="0"+i;break}else if(r(i.charCodeAt(0))&&r(i.charCodeAt(1))&&r(i.charCodeAt(3))&&i.charAt(2)===Q.Culture.dateSeparator){i=i.charAt(0)+i.charAt(1)+Q.Culture.dateSeparator+"0"+i.charAt(3)+Q.Culture.dateSeparator;break}else{break}}default:{return}}t.val(i)}if(i.length<6&&(e.which>=48&&e.which<=57||e.which>=96&&e.which<=105)&&r(i.charCodeAt(i.length-1))){switch(i.length){case 1:{if(i.charCodeAt(0)<=51){return}i="0"+i;break}case 2:{if(!r(i.charCodeAt(0))){return}break}case 3:{if(!r(i.charCodeAt(0))||i.charAt(1)!==Q.Culture.dateSeparator||i.charCodeAt(2)<=49){return}i="0"+i.charAt(0)+Q.Culture.dateSeparator+"0"+i.charAt(2);break}case 4:{if(i.charAt(1)==Q.Culture.dateSeparator){if(!r(i.charCodeAt(0))||!r(i.charCodeAt(2))){return}i="0"+i;break}else if(i.charAt(2)==Q.Culture.dateSeparator){if(!r(i.charCodeAt(0))||!r(i.charCodeAt(1))||i.charCodeAt(3)<=49){return}i=i.charAt(0)+i.charAt(1)+Q.Culture.dateSeparator+"0"+i.charAt(3);break}else{return}}case 5:{if(i.charAt(2)!==Q.Culture.dateSeparator||!r(i.charCodeAt(0))||!r(i.charCodeAt(1))||!r(i.charCodeAt(3))){return}break}default:{return}}t.val(i+Q.Culture.dateSeparator)}};var n;r.dateInputChange=function(e){if(Q.Culture.dateOrder!=="dmy"){return}var t=$(e.target);if(!t.is(":input")||t.attr("type")=="date"){return}var i=Q.coalesce(t.val(),"");var r={};if(i.length>=6&&/^[0-9]*$/g.test(i)){t.val(i.substr(0,2)+Q.Culture.dateSeparator+i.substr(2,2)+Q.Culture.dateSeparator+i.substr(4))}i=Q.coalesce(t.val(),"");if(!!(i.length>=5&&Q.parseDate(i)!==false)){var n=Q.parseDate(i);t.val(Q.formatDate(n,null))}};__decorate([t()],r.prototype,"yearRange",void 0);__decorate([t()],r.prototype,"get_minValue",null);__decorate([t()],r.prototype,"get_maxValue",null);__decorate([t()],r.prototype,"get_maxDate",null);__decorate([t()],r.prototype,"get_sqlMinMax",null);r=n=__decorate([e.Decorators.registerEditor("Serenity.DateEditor",[e.IStringValue,e.IReadOnly]),e.Decorators.element('<input type="text"/>')],r);return r}(e.Widget);e.DateEditor=i;function r(){if(!$.datepicker||!$.datepicker.regional||!$.datepicker.regional.en)return false;var t=Q.Culture.dateOrder;var i=Q.Culture.dateSeparator;var r=($("html").attr("lang")||"en").toLowerCase();if(!$.datepicker.regional[r]){r=r.split("-")[0];if(!$.datepicker.regional[r]){r="en"}}$.datepicker.setDefaults($.datepicker.regional["en"]);$.datepicker.setDefaults($.datepicker.regional[r]);$.datepicker.setDefaults({dateFormat:t=="mdy"?"mm"+i+"dd"+i+"yy":t=="ymd"?"yy"+i+"mm"+i+"dd":"dd"+i+"mm"+i+"yy",buttonImage:"data:image/svg+xml,"+encodeURIComponent(e.datePickerIconSvg),buttonImageOnly:true,showOn:"both",showButtonPanel:true,changeMonth:true,changeYear:true});return true}typeof $!=="undefined"&&!r()&&$(r)})(Serenity||(Serenity={}));var Serenity;(function(e){var t=e.Decorators.option;var i=function(i){__extends(r,i);function r(t,r){var a=i.call(this,t,r)||this;t.addClass("s-DateTimeEditor");if(a.options.inputOnly){t.addClass("dateTimeQ")}else if(typeof flatpickr!=="undefined"&&(e.DateEditor.useFlatpickr||!$.fn.datepicker||a.options.seconds)){t.addClass("dateTimeQ");flatpickr(t[0],a.getFlatpickrOptions())}else if($.fn.datepicker){t.addClass("dateQ");t.datepicker({showOn:"button",beforeShow:function(){return!t.hasClass("readonly")},yearRange:Q.coalesce(a.options.yearRange,"-100:+50")});t.bind("change."+a.uniqueName,function(t){a.lastSetValue=null;e.DateEditor.dateInputChange(t)});a.time=$("<select/>").addClass("editor s-DateTimeEditor time");var o=t.next(".ui-datepicker-trigger");if(o.length>0){a.time.insertAfter(o)}else{o=t.prev(".ui-datepicker-trigger");if(o.length>0){a.time.insertBefore(o)}else{a.time.insertAfter(t)}}a.time.on("change",function(e){this.lastSetValue=null;t.triggerHandler("change")});var l=n.getTimeOptions(Q.coalesce(a.options.startHour,0),0,Q.coalesce(a.options.endHour,23),59,Q.coalesce(a.options.intervalMinutes,5));for(var s=0,u=l;s<u.length;s++){var c=u[s];Q.addOption(a.time,c,c)}Q.addValidationRule(t,a.uniqueName,function(e){var t=a.get_value();if(Q.isEmptyOrNull(t)){return null}if(!Q.isEmptyOrNull(a.get_minValue())&&Q.Invariant.stringCompare(t,a.get_minValue())<0){return Q.format(Q.text("Validation.MinDate"),Q.formatDate(a.get_minValue(),null))}if(!Q.isEmptyOrNull(a.get_maxValue())&&Q.Invariant.stringCompare(t,a.get_maxValue())>=0){return Q.format(Q.text("Validation.MaxDate"),Q.formatDate(a.get_maxValue(),null))}return null})}else t.attr("type","datetime").addClass("dateTimeQ");t.bind("keyup."+a.uniqueName,function(t){if(a.get_readOnly())return;if(a.time){if(t.which===32){if(a.get_valueAsDate()!==new Date){a.set_valueAsDate(new Date);a.element.trigger("change")}}else{var i=a.element.val();e.DateEditor.dateInputKeyup(t);if(i!=a.element.val())a.lastSetValue=null}}});a.set_sqlMinMax(true);if(!a.options.inputOnly){$("<i class='inplace-button inplace-now'><b></b></div>").attr("title",a.getInplaceNowText()).insertAfter(a.time).click(function(e){if(a.element.hasClass("readonly")){return}a.lastSetValue=null;a.set_valueAsDate(new Date);t.triggerHandler("change")})}return a}n=r;r.prototype.getFlatpickrOptions=function(){var e=this;var t;return{clickOpens:true,allowInput:true,enableTime:true,time_24hr:true,enableSeconds:!!this.options.seconds,minuteIncrement:(t=this.options.intervalMinutes)!==null&&t!==void 0?t:5,dateFormat:Q.Culture.dateOrder.split("").join(Q.Culture.dateSeparator).replace("y","Y")+" H:i"+(this.options.seconds?":S":""),onChange:function(){e.lastSetValue=null;e.element&&e.element.triggerHandler("change")}}};r.prototype.get_value=function(){var e=this.element.val().trim();if(e!=null&&e.length===0){return null}var t;if(this.time){var i=Q.formatDate(e,"yyyy-MM-dd");var r=this.time.val();t=i+"T"+r+":00.000"}else t=Q.formatDate(Q.parseDate(this.element.val()),"yyyy-MM-ddTHH:mm:ss.fff");if(this.options.useUtc)t=Q.formatISODateTimeUTC(Q.parseISODateTime(t));if(this.lastSetValue!=null&&this.lastSetValueGet==t)return this.lastSetValue;return t};Object.defineProperty(r.prototype,"value",{get:function(){return this.get_value()},set:function(e){this.set_value(e)},enumerable:true,configurable:true});r.prototype.set_value=function(t){if(Q.isEmptyOrNull(t)){this.element.val("");this.time&&this.time.val("00:00")}else if(t.toLowerCase()==="today"){if(this.time){this.element.val(Q.formatDate(Q.today(),null));this.time.val("00:00")}else{this.element.val(this.getDisplayFormat())}}else{var i=t.toLowerCase()==="now"?new Date:Q.parseISODateTime(t);if(this.time){i=e.DateTimeEditor.roundToMinutes(i,Q.coalesce(this.options.intervalMinutes,5));this.element.val(Q.formatDate(i,null));this.time.val(Q.formatDate(i,"HH:mm"))}else this.element.val(Q.formatDate(i,this.getDisplayFormat()))}this.lastSetValue=null;if(!Q.isEmptyOrNull(t)&&t.toLowerCase()!="today"&&t.toLowerCase()!="now"){this.lastSetValueGet=this.get_value();this.lastSetValue=t}};r.prototype.getInplaceNowText=function(){return Q.coalesce(Q.tryGetText("Controls.DateTimeEditor.SetToNow"),"set to now")};r.prototype.getDisplayFormat=function(){return this.options.seconds?Q.Culture.dateTimeFormat:Q.Culture.dateTimeFormat.replace(":ss","")};r.prototype.get_valueAsDate=function(){if(Q.isEmptyOrNull(this.get_value())){return null}return Q.parseISODateTime(this.get_value())};Object.defineProperty(r.prototype,"valueAsDate",{get:function(){return this.get_valueAsDate()},set:function(e){this.set_valueAsDate(e)},enumerable:true,configurable:true});r.prototype.set_valueAsDate=function(e){if(e==null){this.set_value(null)}this.set_value(Q.formatDate(e,"yyyy-MM-ddTHH:mm"+(this.options.seconds?":ss":"")))};r.prototype.get_minValue=function(){return this.minValue};r.prototype.set_minValue=function(e){this.minValue=e};r.prototype.get_maxValue=function(){return this.maxValue};r.prototype.set_maxValue=function(e){this.maxValue=e};r.prototype.get_minDate=function(){return Q.parseISODateTime(this.get_minValue())};r.prototype.set_minDate=function(e){this.set_minValue(Q.formatDate(e,"yyyy-MM-ddTHH:mm:ss"))};r.prototype.get_maxDate=function(){return Q.parseISODateTime(this.get_maxValue())};r.prototype.set_maxDate=function(e){this.set_maxValue(Q.formatDate(e,"yyyy-MM-ddTHH:mm:ss"))};r.prototype.get_sqlMinMax=function(){return this.get_minValue()==="1753-01-01"&&this.get_maxValue()==="9999-12-31"};r.prototype.set_sqlMinMax=function(e){if(e){this.set_minValue("1753-01-01");this.set_maxValue("9999-12-31")}else{this.set_minValue(null);this.set_maxValue(null)}};r.prototype.get_readOnly=function(){return this.element.hasClass("readonly")};r.prototype.set_readOnly=function(t){if(t!==this.get_readOnly()){if(t){this.element.addClass("readonly").attr("readonly","readonly");
this.element.nextAll(".ui-datepicker-trigger").css("opacity","0.1");this.element.nextAll(".inplace-now").css("opacity","0.1")}else{this.element.removeClass("readonly").removeAttr("readonly");this.element.nextAll(".ui-datepicker-trigger").css("opacity","1");this.element.nextAll(".inplace-now").css("opacity","1")}this.time&&e.EditorUtils.setReadonly(this.time,t)}};r.roundToMinutes=function(e,t){e=new Date(e.getTime());var i=Q.trunc(Q.round(e.getMinutes()/t)*t);e.setMinutes(i);e.setSeconds(0);e.setMilliseconds(0);return e};var n;r.getTimeOptions=function(e,t,i,r,n){var a=[];if(i>=23){i=23}if(r>=60){r=59}var o=e;var l=t;while(true){if(o>i||o===i&&l>r){break}var s=(o>=10?"":"0")+o+":"+(l>=10?"":"0")+l;a.push(s);l+=n;if(l>=60){l-=60;o++}}return a};__decorate([t()],r.prototype,"get_minValue",null);__decorate([t()],r.prototype,"get_maxValue",null);__decorate([t()],r.prototype,"get_maxDate",null);__decorate([t()],r.prototype,"get_sqlMinMax",null);r=n=__decorate([e.Decorators.registerEditor("Serenity.DateTimeEditor",[e.IStringValue,e.IReadOnly]),e.Decorators.element('<input type="text"/>')],r);return r}(e.Widget);e.DateTimeEditor=i})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(e,i){var r=t.call(this,e,i)||this;e.addClass("editor s-TimeEditor hour");if(!r.options.noEmptyOption){Q.addOption(e,"","--")}for(var n=r.options.startHour||0;n<=(r.options.endHour||23);n++){Q.addOption(e,n.toString(),n<10?"0"+n:n.toString())}r.minutes=$("<select/>").addClass("editor s-TimeEditor minute").insertAfter(e);r.minutes.change(function(){return r.element.trigger("change")});for(var a=0;a<=59;a+=r.options.intervalMinutes||5){Q.addOption(r.minutes,a.toString(),a<10?"0"+a:a.toString())}return r}Object.defineProperty(i.prototype,"value",{get:function(){var e=Q.toId(this.element.val());var t=Q.toId(this.minutes.val());if(e==null||t==null){return null}return e*60+t},set:function(e){if(!e){if(this.options.noEmptyOption){this.element.val(this.options.startHour);this.minutes.val("0")}else{this.element.val("");this.minutes.val("0")}}else{this.element.val(Math.floor(e/60).toString());this.minutes.val(e%60)}},enumerable:true,configurable:true});i.prototype.get_value=function(){return this.value};i.prototype.set_value=function(e){this.value=e};i.prototype.get_readOnly=function(){return this.element.hasClass("readonly")};i.prototype.set_readOnly=function(t){if(t!==this.get_readOnly()){if(t){this.element.addClass("readonly").attr("readonly","readonly")}else{this.element.removeClass("readonly").removeAttr("readonly")}e.EditorUtils.setReadonly(this.minutes,t)}};i=__decorate([e.Decorators.registerEditor("Serenity.TimeEditor",[e.IDoubleValue,e.IReadOnly]),e.Decorators.element("<select />")],i);return i}(e.Widget);e.TimeEditor=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(e){var i=t.call(this,e)||this;e.attr("type","email").addClass("email");return i}i=__decorate([e.Decorators.registerEditor("Serenity.EmailAddressEditor")],i);return i}(e.StringEditor);e.EmailAddressEditor=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(e,i){var n=t.call(this,e,i)||this;r.registerValidationMethods();e.addClass("emailuser");var a=$("<span/>").text("@").addClass("emailat").insertAfter(e);var o=$('<input type="text"/>').addClass("emaildomain").insertAfter(a);o.bind("blur."+n.uniqueName,function(){var t=o.closest("form").data("validator");if(t!=null){t.element(e[0])}});if(!Q.isEmptyOrNull(n.options.domain)){o.val(n.options.domain)}if(n.options.readOnlyDomain){o.attr("readonly","readonly").addClass("disabled").attr("tabindex","-1")}e.bind("keypress."+n.uniqueName,function(e){if(e.which===64){e.preventDefault();if(!n.options.readOnlyDomain){o.focus();o.select()}}});o.bind("keypress."+n.uniqueName,function(e){if(e.which===64){e.preventDefault()}});if(!n.options.readOnlyDomain){e.change(function(t){return n.set_value(e.val())})}return n}r=i;i.registerValidationMethods=function(){var e;if(!$.validator||!$.validator.methods||$.validator.methods["emailuser"]!=null)return;$.validator.addMethod("emailuser",function(e,t){var i=$(t).nextAll(".emaildomain");if(i.length>0&&i.attr("readonly")==null){if(this.optional(t)&&this.optional(i[0])){return true}return $.validator.methods.email.call(this,e+"@"+i.val(),t)}else{return $.validator.methods.email.call(this,e+"@dummy.com",t)}},(e=Q.tryGetText("Validation.Email"))!==null&&e!==void 0?e:$.validator.messages.email)};i.prototype.get_value=function(){var e=this.element.nextAll(".emaildomain");var t=this.element.val();var i=e.val();if(Q.isEmptyOrNull(t)){if(this.options.readOnlyDomain||Q.isEmptyOrNull(i)){return""}return"@"+i}return t+"@"+i};Object.defineProperty(i.prototype,"value",{get:function(){return this.get_value()},set:function(e){this.set_value(e)},enumerable:true,configurable:true});i.prototype.set_value=function(e){var t=this.element.nextAll(".emaildomain");e=Q.trimToNull(e);if(e==null){if(!this.options.readOnlyDomain)t.val("");this.element.val("")}else{var i=e.split("@");if(i.length>1){if(!this.options.readOnlyDomain){t.val(i[1]);this.element.val(i[0])}else if(!Q.isEmptyOrNull(this.options.domain)){if(i[1]!==this.options.domain)this.element.val(e);else this.element.val(i[0])}else this.element.val(i[0])}else this.element.val(i[0])}};i.prototype.get_readOnly=function(){var e=this.element.nextAll(".emaildomain");return!(this.element.attr("readonly")==null&&(!this.options.readOnlyDomain||e.attr("readonly")==null))};i.prototype.set_readOnly=function(e){var t=this.element.nextAll(".emaildomain");if(e){this.element.attr("readonly","readonly").addClass("readonly");if(!this.options.readOnlyDomain){t.attr("readonly","readonly").addClass("readonly")}}else{this.element.removeAttr("readonly").removeClass("readonly");if(!this.options.readOnlyDomain){t.removeAttr("readonly").removeClass("readonly")}}};var r;i=r=__decorate([e.Decorators.registerEditor("Serenity.EmailEditor",[e.IStringValue,e.IReadOnly]),e.Decorators.element('<input type="text"/>')],i);return i}(e.Widget);e.EmailEditor=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(e){var i=t.call(this,e)||this;e.addClass("url").attr("title","URL should be entered in format: 'http://www.site.com/page'.");e.on("blur."+i.uniqueName,function(t){var i=e.closest("form").data("validator");if(i==null)return;if(!e.hasClass("error"))return;var r=Q.trimToNull(e.val());if(!r)return;r="http://"+r;if($.validator.methods["url"].call(i,r,e[0])==true){e.val(r);i.element(e)}});return i}i=__decorate([e.Decorators.registerEditor("Serenity.URLEditor",[e.IStringValue])],i);return i}(e.StringEditor);e.URLEditor=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(i,r){var n=t.call(this,i,r)||this;if(Q.isEmptyOrNull(n.options.enumKey)&&n.options.enumType==null&&Q.isEmptyOrNull(n.options.lookupKey)){return n}if(!Q.isEmptyOrNull(n.options.lookupKey)){var a=Q.getLookup(n.options.lookupKey);for(var o=0,l=a.items;o<l.length;o++){var s=l[o];var u=s[a.textField];var c=u==null?"":u.toString();var d=s[a.idField];var f=d==null?"":d.toString();n.addRadio(f,c)}}else{var p=n.options.enumType||e.EnumTypeRegistry.get(n.options.enumKey);var h=n.options.enumKey;if(h==null&&p!=null){var g=Q.getAttributes(p,e.EnumKeyAttribute,false);if(g.length>0){h=g[0].value}}var v=Q.Enum.getValues(p);for(var y=0,m=v;y<m.length;y++){var b=m[y];var C=Q.Enum.toString(p,b);n.addRadio(b.toString(),Q.coalesce(Q.tryGetText("Enums."+h+"."+C),C))}}return n}i.prototype.addRadio=function(e,t){var i=$("<label/>").text(t);$('<input type="radio"/>').attr("name",this.uniqueName).attr("id",this.uniqueName+"_"+e).attr("value",e).prependTo(i);i.appendTo(this.element)};i.prototype.get_value=function(){return this.element.find("input:checked").first().val()};Object.defineProperty(i.prototype,"value",{get:function(){return this.get_value()},set:function(e){this.set_value(e)},enumerable:true,configurable:true});i.prototype.set_value=function(e){if(e!==this.get_value()){var t=this.element.find("input");var i=t.filter(":checked");if(i.length>0){i[0].checked=false}if(!Q.isEmptyOrNull(e)){i=t.filter("[value="+e+"]");if(i.length>0){i[0].checked=true}}}};i.prototype.get_readOnly=function(){return this.element.attr("disabled")!=null};i.prototype.set_readOnly=function(e){if(this.get_readOnly()!==e){if(e){this.element.attr("disabled","disabled").find("input").attr("disabled","disabled")}else{this.element.removeAttr("disabled").find("input").removeAttr("disabled")}}};i=__decorate([e.Decorators.registerEditor("Serenity.RadioButtonEditor",[e.IStringValue,e.IReadOnly]),e.Decorators.element("<div/>")],i);return i}(e.Widget);e.RadioButtonEditor=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(e,i){var r=t.call(this,e,i)||this;r._items=[];r._itemById={};var n=r.emptyItemText();if(n!=null){e.attr("placeholder",n)}var a=r.getSelect2Options();e.select2(a);e.attr("type","text");e.on("change."+r.uniqueName,function(t){if(!$(t.target).hasClass("select2-change-triggered")&&e.closest("form").data("validator")){e.valid()}});r.setCascadeFrom(r.options.cascadeFrom);if(r.useInplaceAdd())r.addInplaceCreate(Q.text("Controls.SelectEditor.InplaceAdd"),null);return r}r=i;i.prototype.destroy=function(){if(this.element!=null){this.element.select2("destroy")}t.prototype.destroy.call(this)};i.prototype.hasAsyncSource=function(){return false};i.prototype.asyncSearch=function(e,t){t({items:[],more:false});return null};i.prototype.getTypeDelay=function(){return Q.coalesce(this.options["typeDelay"],500)};i.prototype.emptyItemText=function(){return Q.coalesce(this.element.attr("placeholder"),Q.text("Controls.SelectEditor.EmptyItemText"))};i.prototype.getPageSize=function(){var e;return(e=this.options["pageSize"])!==null&&e!==void 0?e:100};i.prototype.getIdField=function(){return this.options["idField"]};i.prototype.itemId=function(e){var t=e[this.getIdField()];if(t==null)return"";return t.toString()};i.prototype.getTextField=function(){var e;return(e=this.options["textField"])!==null&&e!==void 0?e:this.getIdField()};i.prototype.itemText=function(e){var t=e[this.getTextField()];if(t==null)return"";return t.toString()};i.prototype.itemDisabled=function(e){return false};i.prototype.mapItem=function(e){return{id:this.itemId(e),text:this.itemText(e),disabled:this.itemDisabled(e),source:e}};i.prototype.mapItems=function(e){return e.map(this.mapItem.bind(this))};i.prototype.allowClear=function(){return this.options.allowClear!=null?!!this.options.allowClear:this.emptyItemText()!=null};i.prototype.isMultiple=function(){return!!this.options.multiple};i.prototype.getSelect2Options=function(){var e=this;var t=this.emptyItemText();var i={multiple:this.isMultiple(),placeHolder:!Q.isEmptyOrNull(t)?t:null,allowClear:this.allowClear(),createSearchChoicePosition:"bottom"};if(this.hasAsyncSource()){var n=0;var a=null;i.query=function(t){var i=e.getPageSize();var r={searchTerm:Q.trimToNull(t.term),skip:(t.page-1)*i,take:i,checkMore:true};a&&a.abort&&a.abort();a=null;if(n!=null)clearTimeout(n);var o=$(e.element).data("select2");o&&o.search&&o.search.removeClass("select2-active");n=setTimeout(function(){a&&a.abort&&a.abort();o&&o.search.addClass("select2-active");a=e.asyncSearch(r,function(i){a=null;t.callback({results:e.mapItems(i.items),more:i.more})});(a&&(a.catch||a.fail)).call(a,function(){a=null;o&&o.search&&o.search.removeClass("select2-active")})},!t.term?0:e.getTypeDelay())};var o=null;i.initSelection=function(t,i){var r=t.val();if(r==null||r==""){i(null);return}var n=e.isMultiple();var a=n?r.split(","):[r];var l={idList:a};o&&o.abort&&o.abort();o=e.asyncSearch(l,function(t){o=null;if(n){var l=(t.items||[]).map(function(t){return e.mapItem(t)});e._itemById=e._itemById||{};for(var s=0,u=l;s<u.length;s++){var c=u[s];e._itemById[c.id]=c}if(e.isAutoComplete&&l.length!=a.length){for(var d=0,f=a;d<f.length;d++){var p=f[d];if(!Q.any(l,function(e){return e.id==p})){l.push({id:p,text:p})}}}i(l)}else if(!t.items||!t.items.length){if(e.isAutoComplete){i({id:r,text:r})}else i(null)}else{var c=e.mapItem(t.items[0]);e._itemById=e._itemById||{};e._itemById[c.id]=c;i(c)}});(o&&(o.catch||o.fail)).call(o,function(){o=null})}}else{i.data=this._items;i.query=function(t){var i=r.filterByText(e._items,function(e){return e.text},t.term);var n=e.getPageSize();t.callback({results:i.slice((t.page-1)*n,t.page*n),more:i.length>=t.page*n})};i.initSelection=function(t,i){var r=t.val();var n=e.isAutoComplete();if(e.isMultiple()){var a=[];for(var o=0,l=r.split(",");o<l.length;o++){var s=l[o];var u=e._itemById[s];if(u==null&&n){u={id:s,text:s};e.addItem(u)}if(u!=null){a.push(u)}}i(a);return}var c=e._itemById[r];if(c==null&&n){c={id:r,text:r};e.addItem(c)}i(c)}}if(this.options.minimumResultsForSearch!=null)i.minimumResultsForSearch=this.options.minimumResultsForSearch;if(this.isAutoComplete()||this.useInplaceAdd())i.createSearchChoice=this.getCreateSearchChoice(null);return i};i.prototype.get_delimited=function(){return!!this.options.delimited};Object.defineProperty(i.prototype,"items",{get:function(){if(this.hasAsyncSource())throw new Error("Can't read items property of an async select editor!");return this._items||[]},set:function(e){if(this.hasAsyncSource())throw new Error("Can't set items of an async select editor!");this._items=e||[];this._itemById={};for(var t=0,i=this._items;t<i.length;t++){var r=i[t];this._itemById[r.id]=r}},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"itemById",{get:function(){if(this.hasAsyncSource())throw new Error("Can't read items property of an async select editor!");return this._itemById},set:function(e){if(this.hasAsyncSource())throw new Error("Can't set itemById of an async select editor!");this._itemById=e||{}},enumerable:true,configurable:true});i.prototype.clearItems=function(){if(this.hasAsyncSource())throw new Error("Can't clear items of an async select editor!");this._items.length=0;this._itemById={}};i.prototype.addItem=function(e){if(this.hasAsyncSource())throw new Error("Can't add item to an async select editor!");this._items.push(e);this._itemById[e.id]=e};i.prototype.addOption=function(e,t,i,r){this.addItem({id:e,text:t,source:i,disabled:r})};i.prototype.addInplaceCreate=function(e,t){var i=this;var r=this;e=Q.coalesce(e,Q.text("Controls.SelectEditor.InplaceAdd"));t=Q.coalesce(t,Q.text("Controls.SelectEditor.InplaceEdit"));var n=$("<a><b/></a>").addClass("inplace-button inplace-create").attr("title",e).insertAfter(this.element).click(function(e){r.inplaceCreateClick(e)});this.get_select2Container().add(this.element).addClass("has-inplace-button");this.element.change(function(){var r=i.isMultiple()||Q.isEmptyOrNull(i.get_value());n.attr("title",r?e:t).toggleClass("edit",!r)});this.element.change(function(e){if($(e.target).hasClass("select2-change-triggered"))return;if(i.isMultiple()){var t=i.get_values();if(t.length>0&&t[t.length-1]==(-2147483648).toString()){i.set_values(t.slice(0,t.length-1));i.inplaceCreateClick(e)}}else if(i.get_value()==(-2147483648).toString()){i.set_value(null);i.inplaceCreateClick(e)}});if(this.isMultiple()){this.get_select2Container().on("dblclick."+this.uniqueName,".select2-search-choice",function(e){var t=$(e.target);if(!t.hasClass("select2-search-choice")){t=t.closest(".select2-search-choice")}var r=t.index();var n=i.get_values();if(r<0||r>=i.get_values().length){return}e["editItem"]=n[r];i.inplaceCreateClick(e)})}};i.prototype.useInplaceAdd=function(){return!this.isAutoComplete()&&this.options.inplaceAdd&&(this.options.inplaceAddPermission==null||Q.Authorization.hasPermission(this.options.inplaceAddPermission))};i.prototype.isAutoComplete=function(){return!!this.options.autoComplete};i.prototype.getCreateSearchChoice=function(e){var t=this;return function(i){t.lastCreateTerm=i;i=Q.coalesce(Select2.util.stripDiacritics(i),"").toLowerCase();if(Q.isTrimmedEmpty(i)){return null}var r=false;if(Q.any(t._items||[],function(t){var r=e?e(t.source):t.text;return Select2.util.stripDiacritics(Q.coalesce(r,"")).toLowerCase()==i}))return null;if(!Q.any(t._items||[],function(e){return Q.coalesce(Select2.util.stripDiacritics(e.text),"").toLowerCase().indexOf(i)!==-1})){if(t.isAutoComplete()){return{id:t.lastCreateTerm,text:t.lastCreateTerm}}return{id:(-2147483648).toString(),text:Q.text("Controls.SelectEditor.NoResultsClickToDefine")}}if(t.isAutoComplete()){return{id:t.lastCreateTerm,text:t.lastCreateTerm}}return{id:(-2147483648).toString(),text:Q.text("Controls.SelectEditor.ClickToDefine")}}};i.prototype.setEditValue=function(e,t){var i=e[t.name];if(Q.isArray(i)){this.set_values(i)}else{this.set_value(i==null?null:i.toString())}};i.prototype.getEditValue=function(e,t){if(!this.isMultiple()||this.get_delimited()){t[e.name]=this.get_value()}else{t[e.name]=this.get_values()}};i.prototype.get_select2Container=function(){return this.element.prevAll(".select2-container")};i.prototype.get_items=function(){return this.items};i.prototype.get_itemByKey=function(){return this.itemById};i.filterByText=function(e,t,i){if(i==null||i.length==0)return e;i=Select2.util.stripDiacritics(i).toUpperCase();var r=[];function n(e){var n=t(e);if(n==null||!n.length)return false;n=Select2.util.stripDiacritics(n).toUpperCase();if(Q.startsWith(n,i))return true;if(n.indexOf(i)>=0)r.push(e);return false}return e.filter(n).concat(r)};i.prototype.get_value=function(){var e;if(this.element.data("select2")){e=this.element.select2("val");if(e!=null&&Q.isArray(e)){return e.join(",")}}else e=this.element.val();return e};Object.defineProperty(i.prototype,"value",{get:function(){return this.get_value()},set:function(e){this.set_value(e)},enumerable:true,configurable:true});i.prototype.set_value=function(e){if(e!=this.get_value()){var t=e;if(!Q.isEmptyOrNull(e)&&this.isMultiple()){t=e.split(String.fromCharCode(44)).map(function(e){return Q.trimToNull(e)}).filter(function(e){return e!=null})}var i=this.element;i.select2("val",t);i.data("select2-change-triggered",true);try{i.triggerHandler("change")}finally{i.data("select2-change-triggered",false)}this.updateInplaceReadOnly()}};Object.defineProperty(i.prototype,"selectedItem",{get:function(){var e=this.get_value();if(e&&this._itemById){var t=this._itemById[e];if(t)return t.source}return null},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"selectedItems",{get:function(){var e=this.values;var t=[];for(var i=0,r=e;i<r.length;i++){var n=r[i];if(n&&this._itemById){var a=this._itemById[n];if(a&&a.source)t.push(a.source);else t.push(null)}}return t},enumerable:true,configurable:true});i.prototype.get_values=function(){var e=this.element.select2("val");if(e==null){return[]}if(Q.isArray(e)){return e}var t=e;if(Q.isEmptyOrNull(t)){return[]}return[t]};Object.defineProperty(i.prototype,"values",{get:function(){return this.get_values()},set:function(e){this.set_values(e)},enumerable:true,configurable:true});i.prototype.set_values=function(e){if(e==null||e.length===0){this.set_value(null);return}this.set_value(e.join(","))};i.prototype.get_text=function(){return Q.coalesce(this.element.select2("data"),{}).text};Object.defineProperty(i.prototype,"text",{get:function(){return this.get_text()},enumerable:true,configurable:true});i.prototype.get_readOnly=function(){return!Q.isEmptyOrNull(this.element.attr("readonly"))};Object.defineProperty(i.prototype,"readOnly",{get:function(){return this.get_readOnly()},set:function(e){this.set_readOnly(e)},enumerable:true,configurable:true});i.prototype.updateInplaceReadOnly=function(){var e=this.get_readOnly()&&(this.isMultiple()||!this.value);this.element.nextAll(".inplace-create").attr("disabled",e?"disabled":"").css("opacity",e?"0.1":"").css("cursor",e?"default":"")};i.prototype.set_readOnly=function(e){if(e!==this.get_readOnly()){this.element.attr("readonly",e?"readonly":null);this.updateInplaceReadOnly()}};i.prototype.getCascadeFromValue=function(t){return e.EditorUtils.getValue(t)};i.prototype.setCascadeFrom=function(t){var i=this;if(Q.isEmptyOrNull(t)){if(this.cascadeLink!=null){this.cascadeLink.set_parentID(null);this.cascadeLink=null}this.options.cascadeFrom=null;return}this.cascadeLink=new e.CascadedWidgetLink(e.Widget,this,function(e){i.set_cascadeValue(i.getCascadeFromValue(e))});this.cascadeLink.set_parentID(t);this.options.cascadeFrom=t};i.prototype.get_cascadeFrom=function(){return this.options.cascadeFrom};Object.defineProperty(i.prototype,"cascadeFrom",{get:function(){return this.get_cascadeFrom()},set:function(e){this.set_cascadeFrom(e)},enumerable:true,configurable:true});i.prototype.set_cascadeFrom=function(e){if(e!==this.options.cascadeFrom){this.setCascadeFrom(e);this.updateItems()}};i.prototype.get_cascadeField=function(){return Q.coalesce(this.options.cascadeField,this.options.cascadeFrom)};Object.defineProperty(i.prototype,"cascadeField",{get:function(){return this.get_cascadeField()},set:function(e){this.set_cascadeField(e)},enumerable:true,configurable:true});i.prototype.set_cascadeField=function(e){this.options.cascadeField=e};i.prototype.get_cascadeValue=function(){return this.options.cascadeValue};Object.defineProperty(i.prototype,"cascadeValue",{get:function(){return this.get_cascadeValue()},set:function(e){this.set_cascadeValue(e)},enumerable:true,configurable:true});i.prototype.set_cascadeValue=function(e){if(this.options.cascadeValue!==e){this.options.cascadeValue=e;this.set_value(null);this.updateItems()}};i.prototype.get_filterField=function(){return this.options.filterField};Object.defineProperty(i.prototype,"filterField",{get:function(){return this.get_filterField()},set:function(e){this.set_filterField(e)},enumerable:true,configurable:true});i.prototype.set_filterField=function(e){this.options.filterField=e};i.prototype.get_filterValue=function(){return this.options.filterValue};Object.defineProperty(i.prototype,"filterValue",{get:function(){return this.get_filterValue()},set:function(e){this.set_filterValue(e)},enumerable:true,configurable:true});i.prototype.set_filterValue=function(e){if(this.options.filterValue!==e){this.options.filterValue=e;this.set_value(null);this.updateItems()}};i.prototype.cascadeItems=function(t){var i=this.get_cascadeValue();if(i==null||i===""){if(!Q.isEmptyOrNull(this.get_cascadeField())){return[]}return t}var r=i.toString();var n=this.get_cascadeField();return t.filter(function(t){var i=Q.coalesce(t[n],e.ReflectionUtils.getPropertyValue(t,n));return!!(i!=null&&i.toString()===r)})};i.prototype.filterItems=function(t){var i=this.get_filterValue();if(i==null||i===""){return t}var r=i.toString();var n=this.get_filterField();return t.filter(function(t){var i=Q.coalesce(t[n],e.ReflectionUtils.getPropertyValue(t,n));return!!(i!=null&&i.toString()===r)})};i.prototype.updateItems=function(){};i.prototype.getDialogTypeKey=function(){if(this.options.dialogType!=null){return this.options.dialogType}return null};i.prototype.createEditDialog=function(t){var i=this.getDialogTypeKey();var r=e.DialogTypeRegistry.get(i);e.Widget.create({type:r,init:function(e){return t(e)}})};i.prototype.initNewEntity=function(e){if(!Q.isEmptyOrNull(this.get_cascadeField())){e[this.get_cascadeField()]=this.get_cascadeValue()}if(!Q.isEmptyOrNull(this.get_filterField())){e[this.get_filterField()]=this.get_filterValue()}if(this.onInitNewEntity!=null){this.onInitNewEntity(e)}};i.prototype.setEditDialogReadOnly=function(e){e.element&&e.element.find(".tool-button.delete-button").addClass("disabled").unbind("click")};i.prototype.editDialogDataChange=function(){};i.prototype.setTermOnNewEntity=function(e,t){};i.prototype.inplaceCreateClick=function(t){var i=this;if(this.get_readOnly()&&(this.isMultiple()&&!t["editItem"]||!this.value))return;this.createEditDialog(function(r){if(i.get_readOnly())i.setEditDialogReadOnly(r);e.SubDialogHelper.bindToDataChange(r,i,function(e,t){i.editDialogDataChange();i.updateItems();i.lastCreateTerm=null;if((t.type==="create"||t.type==="update")&&t.entityId!=null){var r=t.entityId.toString();if(i.isMultiple()){var n=i.get_values().slice();if(n.indexOf(r)<0){n.push(r)}i.set_values(null);i.set_values(n.slice())}else{i.set_value(null);i.set_value(r)}}else if(i.isMultiple()&&t.type==="delete"&&t.entityId!=null){var a=t.entityId.toString();var o=i.get_values().slice();var l=o.indexOf(a);if(l>=0)o.splice(l,1);i.set_values(o.slice())}else if(!i.isMultiple()){i.set_value(null)}},true);var n=t["editItem"];if(n!=null){r.load(n,function(){r.dialogOpen(i.openDialogAsPanel)},null)}else if(i.isMultiple()||Q.isEmptyOrNull(i.get_value())){var a={};i.setTermOnNewEntity(a,Q.trimToEmpty(i.lastCreateTerm));i.initNewEntity(a);r.load(a,function(){r.dialogOpen(i.openDialogAsPanel)},null)}else{r.load(i.get_value(),function(){r.dialogOpen(i.openDialogAsPanel)},null)}})};var r;i=r=__decorate([e.Decorators.registerClass("Serenity.Select2Editor",[e.ISetEditValue,e.IGetEditValue,e.IStringValue,e.IReadOnly]),e.Decorators.element('<input type="hidden"/>')],i);return i}(e.Widget);e.Select2Editor=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(e,i){var r=t.call(this,e,i)||this;r.updateItems();return r}i.prototype.getItems=function(){return this.options.items||[]};i.prototype.emptyItemText=function(){if(!Q.isEmptyOrNull(this.options.emptyOptionText)){return this.options.emptyOptionText}return t.prototype.emptyItemText.call(this)};i.prototype.updateItems=function(){var e=this.getItems();this.clearItems();if(e.length>0){var t=typeof e[0]==="string";for(var i=0,r=e;i<r.length;i++){var n=r[i];var a=t?n:n[0];var o=t?n:Q.coalesce(n[1],n[0]);this.addOption(a,o,n,false)}}};i=__decorate([e.Decorators.registerClass("Serenity.SelectEditor")],i);return i}(e.Select2Editor);e.SelectEditor=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(e,i){var r=t.call(this,e,i)||this;r.updateItems();return r}i.prototype.getItems=function(){var e=this.options;if(e.items!=null&&e.items.length>=1){return e.items}var t=[];var i=(new Date).getFullYear();var r=(new Date).getFullYear();e.minYear=Q.coalesce(e.minYear,"-10").toString();if(Q.startsWith(e.minYear,"-")){i-=parseInt(e.minYear.substr(1),10)}else if(Q.startsWith(e.minYear,"+")){i+=parseInt(e.minYear.substr(1),10)}else{i=parseInt(e.minYear,10)}e.maxYear=Q.coalesce(e.maxYear,"+10").toString();if(Q.startsWith(e.maxYear,"-")){r-=parseInt(e.maxYear.substr(1),10)}else if(Q.startsWith(e.maxYear,"+")){r+=parseInt(e.maxYear.substr(1),10)}else{r=parseInt(e.maxYear,10)}if(e.descending){for(var n=r;n>=i;n--){t.push(n.toString())}}else{for(var a=i;a<=r;a++){t.push(a.toString())}}return t};i=__decorate([e.Decorators.registerEditor("Serenity.DateYearEditor")],i);return i}(e.SelectEditor);e.DateYearEditor=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(e,i){var r=t.call(this,e,i)||this;r.updateItems();return r}i.prototype.updateItems=function(){this.clearItems();var t=this.options.enumType||e.EnumTypeRegistry.get(this.options.enumKey);var i=this.options.enumKey;if(i==null&&t!=null){var r=Q.getAttributes(t,e.EnumKeyAttribute,false);if(r.length>0){i=r[0].value}}var n=Q.Enum.getValues(t);for(var a=0,o=n;a<o.length;a++){var l=o[a];var s=Q.Enum.toString(t,l);this.addOption(parseInt(l,10).toString(),Q.coalesce(Q.tryGetText("Enums."+i+"."+s),s),null,false)}};i.prototype.allowClear=function(){return Q.coalesce(this.options.allowClear,true)};i=__decorate([e.Decorators.registerEditor("Serenity.EnumEditor")],i);return i}(e.Select2Editor);e.EnumEditor=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(e,i){var r=t.call(this,e,i)||this;if(!r.hasAsyncSource()){r.updateItems();var n=r;Q.ScriptData.bindToChange("Lookup."+r.getLookupKey(),r.uniqueName,function(){n.updateItems()})}return r}i.prototype.hasAsyncSource=function(){return!!this.options.async};i.prototype.destroy=function(){if(!this.hasAsyncSource())Q.ScriptData.unbindFromChange(this.uniqueName);t.prototype.destroy.call(this)};i.prototype.getLookupKey=function(){if(this.options.lookupKey!=null){return this.options.lookupKey}var e=Q.getTypeFullName(Q.getInstanceType(this));var t=e.indexOf(".");if(t>=0){e=e.substring(t+1)}if(Q.endsWith(e,"Editor")){e=e.substr(0,e.length-6)}return e};i.prototype.getLookupAsync=function(){return Q.getLookupAsync(this.getLookupKey())};i.prototype.getLookup=function(){return Q.getLookup(this.getLookupKey())};i.prototype.getItems=function(e){return this.filterItems(this.cascadeItems(e.items))};i.prototype.getIdField=function(){return this.lookup!=null?this.lookup.idField:t.prototype.getIdField.call(this)};i.prototype.getItemText=function(e,i){if(i==null)return t.prototype.itemText.call(this,e);var r=i.textFormatter?i.textFormatter(e):e[i.textField];return r==null?"":r.toString()};i.prototype.mapItem=function(e){return{id:this.itemId(e),text:this.getItemText(e,this.lookup),disabled:this.getItemDisabled(e,this.lookup),source:e}};i.prototype.getItemDisabled=function(e,i){return t.prototype.itemDisabled.call(this,e)};i.prototype.updateItems=function(){this.clearItems();this.lookup=this.getLookup();var e=this.getItems(this.lookup);for(var t=0,i=e;t<i.length;t++){var r=i[t];this.addItem(this.mapItem(r))}};i.prototype.asyncSearch=function(t,i){var r=this;return this.getLookupAsync().then(function(n){r.lookup=n;var a=r.getItems(r.lookup);if(t.idList!=null){a=a.filter(function(e){return t.idList.indexOf(r.itemId(e))>=0})}function o(e){return this.getItemText(e,this.lookup)}a=e.Select2Editor.filterByText(a,o.bind(r),t.searchTerm);i({items:a.slice(t.skip,t.take),more:a.length>=t.take})})};i.prototype.getDialogTypeKey=function(){var e=t.prototype.getDialogTypeKey.call(this);if(e)return e;return this.getLookupKey()};i.prototype.setCreateTermOnNewEntity=function(e,t){e[this.getLookup().textField]=t};i.prototype.editDialogDataChange=function(){Q.reloadLookup(this.getLookupKey())};i=__decorate([e.Decorators.registerEditor("Serenity.LookupEditorBase")],i);return i}(e.Select2Editor);e.LookupEditorBase=t;var i=function(t){__extends(i,t);function i(e,i){return t.call(this,e,i)||this}i=__decorate([e.Decorators.registerEditor("Serenity.LookupEditor")],i);return i}(t);e.LookupEditor=i})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(e,i){return t.call(this,e,i)||this}i.prototype.getDialogTypeKey=function(){var e=t.prototype.getDialogTypeKey.call(this);if(e)return e;var i=this.getService();if(Q.startsWith(i,"~/Services/"))i=i.substr("~/Services/".length);if(i.split("/").length==3)i=i.substr(0,i.lastIndexOf("/"));return i.replace("/",".")};i.prototype.getService=function(){return this.options.service};i.prototype.getServiceUrl=function(){var e=this.getService();if(e==null)throw new Error("ServiceLookupEditor requires 'service' option to be configured!");if(!Q.startsWith(e,"~")&&!Q.startsWith(e,"/")&&e.indexOf("://")<0)e="~/Services/"+e;if(Q.startsWith(e,"~"))e=Q.resolveUrl(e);return e};i.prototype.getIncludeColumns=function(){var e=this.options.includeColumns||[];var t=this.getIdField();if(t&&e.indexOf(t)<0)e.push(t);var i=this.getTextField();if(i&&e.indexOf(i)<0)e.push(i);return e};i.prototype.getSort=function(){return this.options.sort||(this.getTextField()?[this.getTextField()]:null)};i.prototype.getCascadeCriteria=function(){var e=this.get_cascadeValue();if(e==null||e===""){if(!Q.isEmptyOrNull(this.get_cascadeField())){return["1","=","0"]}return null}var t=this.get_cascadeField();return[[t],"=",e]};i.prototype.getFilterCriteria=function(){var e=this.get_filterValue();if(e==null||e===""){return null}var t=this.get_filterField();return[[t],"=",e]};i.prototype.getIdListCriteria=function(e){if(e==null)return null;if(e.length==0)return["0","=","1"];var t=this.getIdField();if(t==null)throw new Error("ServiceLookupEditor requires 'idField' option to be configured!");return[[t],"in",[e]]};
i.prototype.getCriteria=function(t){return e.Criteria.and(e.Criteria.and(this.getIdListCriteria(t.idList),this.options.criteria),e.Criteria.and(this.getCascadeCriteria(),this.getFilterCriteria()))};i.prototype.getListRequest=function(e){var t={};if(e.searchTerm)t.ContainsText=e.searchTerm;t.Sort=this.getSort();t.ColumnSelection=this.options.columnSelection||1;t.IncludeColumns=this.getIncludeColumns();t.ExcludeColumns=this.options.excludeColumns;t.ContainsField=this.options.containsField;t.EqualityFilter=this.options.equalityFilter;t.Criteria=this.getCriteria(e);t.Skip=e.skip||0;t.Take=e.take?e.checkMore?e.take+1:e.take:0;t.IncludeDeleted=this.options.includeDeleted;t.ExcludeTotalCount=true;return t};i.prototype.getServiceCallOptions=function(e,t){return{blockUI:false,url:this.getServiceUrl(),request:this.getListRequest(e),onSuccess:function(i){var r=i.Entities||[];if(r&&e.take&&e.checkMore&&i.Entities.length>r.length)r=r.slice(0,e.take);t({items:r.slice(0,e.take),more:e.checkMore&&e.take&&r.length>e.take})}}};i.prototype.hasAsyncSource=function(){return true};i.prototype.asyncSearch=function(e,t){var i=this.getServiceCallOptions(e,t);return Q.serviceCall(i)};i=__decorate([e.Decorators.registerEditor("Serenity.ServiceLookupEditorBase")],i);return i}(e.Select2Editor);e.ServiceLookupEditorBase=t;var i=function(t){__extends(i,t);function i(e,i){return t.call(this,e,i)||this}i=__decorate([e.Decorators.registerEditor("Serenity.ServiceLookupEditor")],i);return i}(t);e.ServiceLookupEditor=i})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(i,n){var a=t.call(this,i,n)||this;a._instanceReady=false;r.includeCKEditor();var o=i.attr("id");if(Q.isTrimmedEmpty(o)){i.attr("id",a.uniqueName);o=a.uniqueName}if(a.options.cols!=null)i.attr("cols",a.options.cols);if(a.options.rows!=null)i.attr("rows",a.options.rows);a.addValidationRule(a.uniqueName,function(e){if(e.hasClass("required")){var t=Q.trimToNull(a.get_value());if(t==null)return Q.text("Validation.Required")}return null});e.LazyLoadHelper.executeOnceWhenShown(a.element,function(){var e=a.getConfig();window["CKEDITOR"]&&window["CKEDITOR"].replace(o,e)});return a}r=i;i.prototype.instanceReady=function(e){this._instanceReady=true;$(e.editor.container.$).addClass(this.element.attr("class"));this.element.addClass("select2-offscreen").css("display","block");e.editor.setData(this.element.val());e.editor.setReadOnly(this.get_readOnly())};i.prototype.getLanguage=function(){if(!window["CKEDITOR"])return"en";var e=window["CKEDITOR"];var t=Q.coalesce(Q.trimToNull($("html").attr("lang")),"en");if(!!e.lang.languages[t]){return t}if(t.indexOf(String.fromCharCode(45))>=0){t=t.split(String.fromCharCode(45))[0]}if(!!e.lang.languages[t]){return t}return"en"};i.prototype.getConfig=function(){var e=this;return{customConfig:"",language:this.getLanguage(),bodyClass:"s-HtmlContentBody",on:{instanceReady:function(t){return e.instanceReady(t)},change:function(t){t.editor.updateElement();e.element.triggerHandler("change")}},toolbarGroups:[{name:"clipboard",groups:["clipboard","undo"]},{name:"editing",groups:["find","selection","spellchecker"]},{name:"insert",groups:["links","insert","blocks","bidi","list","indent"]},{name:"forms",groups:["forms","mode","document","doctools","others","about","tools"]},{name:"colors"},{name:"basicstyles",groups:["basicstyles","cleanup"]},{name:"align"},{name:"styles"}],removeButtons:"SpecialChar,Anchor,Subscript,Styles",format_tags:"p;h1;h2;h3;pre",removeDialogTabs:"image:advanced;link:advanced",removePlugins:"uploadimage,image2",contentsCss:Q.resolveUrl("~/Content/site/site.htmlcontent.css"),entities:false,entities_latin:false,entities_greek:false,autoUpdateElement:true,height:this.options.rows==null||this.options.rows===0?null:this.options.rows*20+"px"}};i.prototype.getEditorInstance=function(){var e=this.element.attr("id");return window["CKEDITOR"].instances[e]};i.prototype.destroy=function(){var e=this.getEditorInstance();e&&e.destroy(true);t.prototype.destroy.call(this)};i.prototype.get_value=function(){var e=this.getEditorInstance();if(this._instanceReady&&e){return e.getData()}else{return this.element.val()}};Object.defineProperty(i.prototype,"value",{get:function(){return this.get_value()},set:function(e){this.set_value(e)},enumerable:true,configurable:true});i.prototype.set_value=function(e){var t=this.getEditorInstance();this.element.val(e);if(this._instanceReady&&t)t.setData(e)};i.prototype.get_readOnly=function(){return!Q.isEmptyOrNull(this.element.attr("disabled"))};i.prototype.set_readOnly=function(e){if(this.get_readOnly()!==e){if(e){this.element.attr("disabled","disabled")}else{this.element.removeAttr("disabled")}var t=this.getEditorInstance();if(this._instanceReady&&t)t.setReadOnly(e)}};i.includeCKEditor=function(){if(window["CKEDITOR"]){return}var e=$("#CKEditorScript");if(e.length>0){return}$("<script/>").attr("type","text/javascript").attr("id","CKEditorScript").attr("src",Q.resolveUrl("~/Scripts/CKEditor/ckeditor.js?v="+r.CKEditorVer)).appendTo(window.document.head)};var r;i.CKEditorVer="4.7.1";i=r=__decorate([e.Decorators.registerEditor("Serenity.HtmlContentEditor",[e.IStringValue,e.IReadOnly]),e.Decorators.element("<textarea/>")],i);return i}(e.Widget);e.HtmlContentEditor=t;var i=function(t){__extends(i,t);function i(e,i){return t.call(this,e,i)||this}i.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this);e.removeButtons+=",Cut,Copy,Paste,BulletedList,NumberedList,"+"Indent,Outdent,SpecialChar,Subscript,Superscript,Styles,PasteText,"+"PasteFromWord,Strike,Link,Unlink,CreatePlaceholder,Image,Table,"+"HorizontalRule,Source,Maximize,Format,Font,FontSize,Anchor,Blockquote,"+"CreatePlaceholder,BGColor,JustifyLeft,JustifyCenter,"+"JustifyRight,JustifyBlock,Superscript,RemoveFormat";e.removePlugins="elementspath,uploadimage,image2";return e};i=__decorate([e.Decorators.registerEditor("Serenity.HtmlNoteContentEditor")],i);return i}(t);e.HtmlNoteContentEditor=i;var r=function(t){__extends(i,t);function i(e,i){return t.call(this,e,i)||this}i.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this);e.removeButtons+=",Cut,Copy,Paste,BulletedList,NumberedList,"+"Indent,Outdent,SpecialChar,Subscript,Superscript,Styles,"+"PasteText,PasteFromWord,Strike,Link,Unlink,CreatePlaceholder,"+"Image,Table,HorizontalRule,Source,Maximize,Format,Font,FontSize,"+"Anchor,Blockquote,CreatePlaceholder,BGColor,JustifyLeft,JustifyCenter,"+"JustifyRight,JustifyBlock,Superscript,RemoveFormat";e.removePlugins="elementspath,uploadimage,image2";return e};i=__decorate([e.Decorators.registerEditor("Serenity.HtmlReportContentEditor")],i);return i}(t);e.HtmlReportContentEditor=r})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(e,i){var r=t.call(this,e,i)||this;e.mask(r.options.mask||"",{placeholder:Q.coalesce(r.options.placeholder,"_")});return r}Object.defineProperty(i.prototype,"value",{get:function(){this.element.triggerHandler("blur.mask");return this.element.val()},set:function(e){this.element.val(e)},enumerable:true,configurable:true});i.prototype.get_value=function(){return this.value};i.prototype.set_value=function(e){this.value=e};i=__decorate([e.Decorators.registerEditor("Serenity.MaskedEditor",[e.IStringValue]),e.Decorators.element('<input type="text"/>')],i);return i}(e.Widget);e.MaskedEditor=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(e,i){var r=t.call(this,e,i)||this;r.element.addClass("g-recaptcha").attr("data-sitekey",r.options.siteKey);if(!!(window["grecaptcha"]==null&&$("script#RecaptchaInclude").length===0)){var n="https://www.google.com/recaptcha/api.js";var a=r.options.language;if(a==null){a=Q.coalesce($("html").attr("lang"),"")}n+="?hl="+a;$("<script/>").attr("id","RecaptchaInclude").attr("src",n).appendTo(document.body)}var o=$("<input />").insertBefore(r.element).attr("id",r.uniqueName+"_validate").val("x");var l={};l["visibility"]="hidden";l["width"]="0px";l["height"]="0px";l["padding"]="0px";var s=o.css(l);var u=r;Q.addValidationRule(s,r.uniqueName,function(e){if(Q.isEmptyOrNull(r.get_value())){return Q.text("Validation.Required")}return null});return r}i.prototype.get_value=function(){return this.element.find(".g-recaptcha-response").val()};i.prototype.set_value=function(e){};i=__decorate([e.Decorators.registerEditor("Serenity.Recaptcha",[e.IStringValue]),e.Decorators.element("<div/>")],i);return i}(e.Widget);e.Recaptcha=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(i,r){var n=t.call(this,i,r)||this;if(!r||r.allowNonImage==null)n.options.allowNonImage=true;i.addClass("s-FileUploadEditor");if(Q.isEmptyOrNull(n.options.originalNameProperty))i.addClass("hide-original-name");n.toolbar=new e.Toolbar($("<div/>").appendTo(n.element),{buttons:n.getToolButtons()});var a=$("<div><div></div></div>").addClass("upload-progress").prependTo(n.toolbar.element);var o=n.getUploadInputOptions();n.uploadInput=e.UploadHelper.addUploadInput(o);n.fileSymbols=$("<ul/>").appendTo(n.element);n.updateInterface();return n}i.prototype.getUploadInputOptions=function(){var t=this;return{container:this.toolbar.findButton("add-file-button"),zone:this.element,inputName:this.uniqueName,progress:this.progress,fileDone:function(i,r,n){if(!e.UploadHelper.checkImageConstraints(i,t.options)){return}var a={OriginalName:r,Filename:i.TemporaryFile};t.entity=a;t.populate();t.updateInterface()}}};i.prototype.addFileButtonText=function(){return Q.text("Controls.ImageUpload.AddFileButton")};i.prototype.getToolButtons=function(){var e=this;return[{title:this.addFileButtonText(),cssClass:"add-file-button",onClick:function(){}},{title:"",hint:Q.text("Controls.ImageUpload.DeleteButtonHint"),cssClass:"delete-button",onClick:function(){e.entity=null;e.populate();e.updateInterface()}}]};i.prototype.populate=function(){var t=this.options.displayFileName||!Q.isTrimmedEmpty(this.options.originalNameProperty);if(this.entity==null){e.UploadHelper.populateFileSymbols(this.fileSymbols,null,t,this.options.urlPrefix)}else{e.UploadHelper.populateFileSymbols(this.fileSymbols,[this.entity],t,this.options.urlPrefix)}};i.prototype.updateInterface=function(){var e=this.toolbar.findButton("add-file-button");var t=this.toolbar.findButton("delete-button");e.toggleClass("disabled",this.get_readOnly());t.toggleClass("disabled",this.get_readOnly()||this.entity==null)};i.prototype.get_readOnly=function(){return this.uploadInput.attr("disabled")!=null};i.prototype.set_readOnly=function(e){if(this.get_readOnly()!==e){if(e){this.uploadInput.attr("disabled","disabled").fileupload("disable")}else{this.uploadInput.removeAttr("disabled").fileupload("enable")}this.updateInterface()}};i.prototype.get_value=function(){if(this.entity==null){return null}var e=Q.extend({},this.entity);return e};Object.defineProperty(i.prototype,"value",{get:function(){return this.get_value()},set:function(e){this.set_value(e)},enumerable:true,configurable:true});i.prototype.set_value=function(e){if(e!=null){if(e.Filename==null){this.entity=null}else{this.entity=Q.extend({},e)}}else{this.entity=null}this.populate();this.updateInterface()};i.prototype.getEditValue=function(e,t){t[e.name]=this.entity==null?null:Q.trimToNull(this.entity.Filename)};i.prototype.setEditValue=function(e,t){var i={};i.Filename=e[t.name];if(Q.isEmptyOrNull(this.options.originalNameProperty)){if(this.options.displayFileName){var r=Q.coalesce(i.Filename,"");var n=Q.replaceAll(r,"\\","/").lastIndexOf("/");if(n>=0){i.OriginalName=r.substr(n+1)}else{i.OriginalName=r}}}else{i.OriginalName=e[this.options.originalNameProperty]}this.set_value(i)};i=__decorate([e.Decorators.registerEditor("Serenity.FileUploadEditor",[e.IReadOnly]),e.Decorators.element("<div/>")],i);return i}(e.Widget);e.FileUploadEditor=t;var i=function(t){__extends(i,t);function i(e,i){var r=t.call(this,e,i)||this;if(i&&i.allowNonImage==null)r.options.allowNonImage=false;e.addClass("s-ImageUploadEditor");return r}i=__decorate([e.Decorators.registerEditor("Serenity.ImageUploadEditor")],i);return i}(t);e.ImageUploadEditor=i;var r=function(t){__extends(i,t);function i(i,r){var n=t.call(this,i,r)||this;n.entities=[];i.addClass("s-MultipleFileUploadEditor");var a=n;n.toolbar=new e.Toolbar($("<div/>").appendTo(n.element),{buttons:n.getToolButtons()});var o=$("<div><div></div></div>").addClass("upload-progress").prependTo(n.toolbar.element);var l=n.toolbar.findButton("add-file-button");n.uploadInput=e.UploadHelper.addUploadInput({container:l,zone:n.element,inputName:n.uniqueName,progress:o,fileDone:function(t,i,r){if(!e.UploadHelper.checkImageConstraints(t,n.options)){return}var o={OriginalName:i,Filename:t.TemporaryFile};a.entities.push(o);a.populate();a.updateInterface()}});n.fileSymbols=$("<ul/>").appendTo(n.element);n.updateInterface();return n}i.prototype.addFileButtonText=function(){return Q.text("Controls.ImageUpload.AddFileButton")};i.prototype.getToolButtons=function(){return[{title:this.addFileButtonText(),cssClass:"add-file-button",onClick:function(){}}]};i.prototype.populate=function(){var t=this;e.UploadHelper.populateFileSymbols(this.fileSymbols,this.entities,true,this.options.urlPrefix);this.fileSymbols.children().each(function(e,i){var r=e;$("<a class='delete'></a>").appendTo($(i).children(".filename")).click(function(e){e.preventDefault();t.entities.splice(r,1);t.populate()})})};i.prototype.updateInterface=function(){var e=this.toolbar.findButton("add-file-button");e.toggleClass("disabled",this.get_readOnly());this.fileSymbols.find("a.delete").toggle(!this.get_readOnly())};i.prototype.get_readOnly=function(){return this.uploadInput.attr("disabled")!=null};i.prototype.set_readOnly=function(e){if(this.get_readOnly()!==e){if(e){this.uploadInput.attr("disabled","disabled").fileupload("disable")}else{this.uploadInput.removeAttr("disabled").fileupload("enable")}this.updateInterface()}};i.prototype.get_value=function(){return this.entities.map(function(e){return Q.extend({},e)})};Object.defineProperty(i.prototype,"value",{get:function(){return this.get_value()},set:function(e){this.set_value(e)},enumerable:true,configurable:true});i.prototype.set_value=function(e){this.entities=(e||[]).map(function(e){return Q.extend({},e)});this.populate();this.updateInterface()};i.prototype.getEditValue=function(e,t){if(this.jsonEncodeValue){t[e.name]=$.toJSON(this.get_value())}else{t[e.name]=this.get_value()}};i.prototype.setEditValue=function(e,t){var i=e[t.name];if(Q.isInstanceOfType(i,String)){var r=Q.coalesce(Q.trimToNull(i),"[]");if(Q.startsWith(r,"[")&&Q.endsWith(r,"]")){this.set_value($.parseJSON(r))}else{this.set_value([{Filename:r,OriginalName:"UnknownFile"}])}}else{this.set_value(i)}};__decorate([e.Decorators.option()],i.prototype,"jsonEncodeValue",void 0);i=__decorate([e.Decorators.registerEditor("Serenity.MultipleFileUploadEditor",[e.IReadOnly]),e.Decorators.element("<div/>")],i);return i}(e.Widget);e.MultipleFileUploadEditor=r;var n=function(t){__extends(i,t);function i(e,i){var r=t.call(this,e,i)||this;e.addClass("s-MultipleImageUploadEditor");return r}i=__decorate([e.Decorators.registerEditor("Serenity.MultipleImageUploadEditor")],i);return i}(r);e.MultipleImageUploadEditor=n})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(e,i){var r=t.call(this,e,i)||this;e.addClass("quick-filters-bar").addClass("clear");var n=r.options.filters;for(var a=0;a<n.length;a++){var o=n[a];r.add(o)}r.options.idPrefix=Q.coalesce(r.options.idPrefix,r.uniqueName+"_");return r}r=i;i.prototype.addSeparator=function(){this.element.append($("<hr/>"))};i.prototype.add=function(t){var i=this;if(t==null){throw new Q.ArgumentNullException("opt")}if(t.separator){this.addSeparator()}var r=$("<div class='quick-filter-item'><span class='quick-filter-label'></span></div>").appendTo(this.element).data("qffield",t.field).children();var n=t.title;if(n==null){n=this.options.getTitle?this.options.getTitle(t):null;if(n==null){n=t.field}}var a=r.text(n).parent();if(t.displayText!=null){a.data("qfdisplaytext",t.displayText)}if(t.saveState!=null){a.data("qfsavestate",t.saveState)}if(t.loadState!=null){a.data("qfloadstate",t.loadState)}if(!Q.isEmptyOrNull(t.cssClass)){a.addClass(t.cssClass)}var o=e.Widget.create({type:t.type,element:function(e){if(!Q.isEmptyOrNull(t.field)){e.attr("id",i.options.idPrefix+t.field)}e.attr("placeholder"," ");e.appendTo(a);if(t.element!=null){t.element(e)}},options:t.options,init:t.init});var l=function(i){if(a.hasClass("ignore")){return}i.EqualityFilter=i.EqualityFilter||{};var r=e.EditorUtils.getValue(o);var n=r!=null&&!Q.isEmptyOrNull(r.toString());if(t.handler!=null){var l={field:t.field,request:i,equalityFilter:i.EqualityFilter,value:r,active:n,widget:o,handled:true};t.handler(l);a.toggleClass("quick-filter-active",l.active);if(!l.handled){i.EqualityFilter[t.field]=r}}else{i.EqualityFilter[t.field]=r;a.toggleClass("quick-filter-active",n)}};o.changeSelect2(function(e){window.setTimeout(function(){return i.onChange&&i.onChange(e)},0)});this.add_submitHandlers(l);o.element.bind("remove."+this.uniqueName,function(e){i.remove_submitHandlers(l)});return o};i.prototype.addDateRange=function(e,t){return this.add(r.dateRange(e,t))};i.dateRange=function(t,i){var r=null;return{field:t,type:e.DateEditor,title:i,element:function(t){r=e.Widget.create({type:e.DateEditor,element:function(e){e.insertAfter(t)},options:null,init:null});r.element.change(function(e){t.triggerHandler("change")});$("<span/>").addClass("range-separator").text("-").insertAfter(t)},handler:function(t){var i=!Q.isTrimmedEmpty(t.widget.value);var n=!Q.isTrimmedEmpty(r.value);if(i&&!Q.parseDate(t.widget.element.val())){i=false;Q.notifyWarning(Q.text("Validation.DateInvalid"),"",null);t.widget.element.val("")}if(n&&!Q.parseDate(r.element.val())){n=false;Q.notifyWarning(Q.text("Validation.DateInvalid"),"",null);r.element.val("")}t.active=i||n;if(i){t.request.Criteria=e.Criteria.join(t.request.Criteria,"and",[[t.field],">=",t.widget.value])}if(n){var a=new Date(r.valueAsDate.valueOf());a.setDate(a.getDate()+1);t.request.Criteria=e.Criteria.join(t.request.Criteria,"and",[[t.field],"<",Q.formatDate(a,"yyyy-MM-dd")])}},displayText:function(t,i){var n=e.EditorUtils.getDisplayText(t);var a=e.EditorUtils.getDisplayText(r);if(Q.isEmptyOrNull(n)&&Q.isEmptyOrNull(a)){return null}var o=i+" >= "+n;var l=i+" <= "+a;if(!Q.isEmptyOrNull(n)&&!Q.isEmptyOrNull(a)){return o+" "+Q.coalesce(Q.tryGetText("Controls.FilterPanel.And"),"and")+" "+l}else if(!Q.isEmptyOrNull(n)){return o}else{return l}},saveState:function(t){return[e.EditorUtils.getValue(t),e.EditorUtils.getValue(r)]},loadState:function(t,i){if(i==null||!Q.isArray(i)||i.length!==2){i=[null,null]}e.EditorUtils.setValue(t,i[0]);e.EditorUtils.setValue(r,i[1])}}};i.prototype.addDateTimeRange=function(e,t){return this.add(r.dateTimeRange(e,t))};i.dateTimeRange=function(t,i){var r=null;return{field:t,type:e.DateTimeEditor,title:i,element:function(t){r=e.Widget.create({type:e.DateTimeEditor,element:function(e){e.insertAfter(t)},options:null,init:null});r.element.change(function(e){t.triggerHandler("change")});$("<span/>").addClass("range-separator").text("-").insertAfter(t)},init:function(e){e.element.parent().find(".time").change(function(t){e.element.triggerHandler("change")})},handler:function(t){var i=!Q.isTrimmedEmpty(t.widget.value);var n=!Q.isTrimmedEmpty(r.value);if(i&&!Q.parseDate(t.widget.element.val())){i=false;Q.notifyWarning(Q.text("Validation.DateInvalid"),"",null);t.widget.element.val("")}if(n&&!Q.parseDate(r.element.val())){n=false;Q.notifyWarning(Q.text("Validation.DateInvalid"),"",null);r.element.val("")}t.active=i||n;if(i){t.request.Criteria=e.Criteria.join(t.request.Criteria,"and",[[t.field],">=",t.widget.value])}if(n){t.request.Criteria=e.Criteria.join(t.request.Criteria,"and",[[t.field],"<=",r.value])}},displayText:function(t,i){var n=e.EditorUtils.getDisplayText(t);var a=e.EditorUtils.getDisplayText(r);if(Q.isEmptyOrNull(n)&&Q.isEmptyOrNull(a)){return null}var o=i+" >= "+n;var l=i+" <= "+a;if(!Q.isEmptyOrNull(n)&&!Q.isEmptyOrNull(a)){return o+" "+Q.coalesce(Q.tryGetText("Controls.FilterPanel.And"),"and")+" "+l}else if(!Q.isEmptyOrNull(n)){return o}else{return l}},saveState:function(t){return[e.EditorUtils.getValue(t),e.EditorUtils.getValue(r)]},loadState:function(t,i){if(i==null||!Q.isArray(i)||i.length!==2){i=[null,null]}e.EditorUtils.setValue(t,i[0]);e.EditorUtils.setValue(r,i[1])}}};i.prototype.addBoolean=function(e,t,i,n){return this.add(r.boolean(e,t,i,n))};i.boolean=function(t,i,r,n){var a={};var o=[];var l=r;if(l==null){l=Q.text("Controls.FilterPanel.OperatorNames.true")}o.push(["1",l]);var s=n;if(s==null){s=Q.text("Controls.FilterPanel.OperatorNames.false")}o.push(["0",s]);a.items=o;return{field:t,type:e.SelectEditor,title:i,options:a,handler:function(e){e.equalityFilter[e.field]=e.value==null||Q.isEmptyOrNull(e.value.toString())?null:!!Q.toId(e.value)}}};i.prototype.destroy=function(){this.submitHandlers=null;t.prototype.destroy.call(this)};i.prototype.onSubmit=function(e){this.submitHandlers&&this.submitHandlers(e)};i.prototype.add_submitHandlers=function(e){this.submitHandlers=Q.delegateCombine(this.submitHandlers,e)};i.prototype.remove_submitHandlers=function(e){this.submitHandlers=Q.delegateRemove(this.submitHandlers,e)};i.prototype.clear_submitHandlers=function(){};i.prototype.find=function(e,t){return $("#"+this.options.idPrefix+t).getWidget(e)};i.prototype.tryFind=function(e,t){var i=$("#"+this.options.idPrefix+t);if(!i.length)return null;return i.tryGetWidget(e)};var r;i=r=__decorate([e.Decorators.registerClass("Serenity.QuickFilterBar"),e.Decorators.element("<div/>")],i);return i}(e.Widget);e.QuickFilterBar=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(i,r){var n=t.call(this,i,r)||this;i.attr("title",Q.text("Controls.QuickSearch.Hint")).attr("placeholder",Q.text("Controls.QuickSearch.Placeholder"));n.lastValue=Q.trim(Q.coalesce(i.val(),""));var a=n;n.element.bind("keyup."+n.uniqueName,function(){a.checkIfValueChanged()});n.element.bind("change."+n.uniqueName,function(){a.checkIfValueChanged()});$("<span><i></i></span>").addClass("quick-search-icon").insertBefore(i);if(Q.isValue(n.options.fields)&&n.options.fields.length>0){var o=$("<a/>").addClass("quick-search-field").attr("title",Q.text("Controls.QuickSearch.FieldSelection")).insertBefore(i);var l=$("<ul></ul>").css("width","120px");for(var s=0,u=n.options.fields;s<u.length;s++){var c=u[s];var d={$:c};$("<li><a/></li>").appendTo(l).children().attr("href","#").text(Q.coalesce(c.title,"")).click(function(e){e.preventDefault();this.$this.fieldChanged=a.field!==this.field.$;a.field=this.field.$;this.$this.updateInputPlaceHolder();this.$this.checkIfValueChanged()}.bind({field:d,$this:n}))}new e.PopupMenuButton(o,{positionMy:"right top",positionAt:"right bottom",menu:l});n.field=n.options.fields[0];n.updateInputPlaceHolder()}n.element.bind("execute-search."+n.uniqueName,function(e){if(!!n.timer){window.clearTimeout(n.timer)}n.searchNow(Q.trim(Q.coalesce(n.element.val(),"")))});return n}i.prototype.checkIfValueChanged=function(){if(this.element.hasClass("ignore-change")){return}var e=this.get_value();if(e==this.lastValue&&(!this.fieldChanged||Q.isEmptyOrNull(e))){this.fieldChanged=false;return}this.fieldChanged=false;if(!!this.timer){window.clearTimeout(this.timer)}var t=this;this.timer=window.setTimeout(function(){t.searchNow(e)},Q.coalesce(this.options.typeDelay,500));this.lastValue=e};i.prototype.get_value=function(){return Q.trim(Q.coalesce(this.element.val(),""))};i.prototype.get_field=function(){return this.field};i.prototype.set_field=function(e){if(this.field!==e){this.fieldChanged=true;this.field=e;this.updateInputPlaceHolder();this.checkIfValueChanged()}};i.prototype.updateInputPlaceHolder=function(){var e=this.element.prevAll(".quick-search-field");if(this.field){e.text(this.field.title)}else{e.text("")}};i.prototype.restoreState=function(e,t){this.fieldChanged=false;this.field=t;var e=Q.trim(Q.coalesce(e,""));this.element.val(e);this.lastValue=e;if(!!this.timer){window.clearTimeout(this.timer);this.timer=null}this.updateInputPlaceHolder()};i.prototype.searchNow=function(e){var t=this;this.element.parent().toggleClass(Q.coalesce(this.options.filteredParentClass,"s-QuickSearchFiltered"),!!(e.length>0));this.element.parent().addClass(Q.coalesce(this.options.loadingParentClass,"s-QuickSearchLoading")).addClass(Q.coalesce(this.options.loadingParentClass,"s-QuickSearchLoading"));var i=function(e){t.element.removeClass(Q.coalesce(t.options.loadingParentClass,"s-QuickSearchLoading")).parent().removeClass(Q.coalesce(t.options.loadingParentClass,"s-QuickSearchLoading"));if(!e){t.element.closest(".s-QuickSearchBar").find(".quick-search-icon i").effect("shake",{distance:2})}};if(this.options.onSearch!=null){this.options.onSearch(this.field!=null&&!Q.isEmptyOrNull(this.field.name)?this.field.name:null,e,i)}else{i(true)}};return i}(e.Widget);e.QuickSearchInput=t})(Serenity||(Serenity={}));var Q;(function(e){var t;(function(t){var i;var r=0;var n=0;var a;var o=0;var l=0;t.enabled=true;function s(e,t){return e==t||e==t+"#"||t==e+"#"}function u(e,n,a){if(!t.enabled||r>0)return;e=e||"";e=e.replace(/^#/,"");e=!e?"":"#"+e;var o=window.location.href.replace(/#$/,"").replace(/#.*$/,"")+e;if(o!=window.location.href){if(n&&i!=null&&s(i,o)){if(a)y();var l=window.location.href;i=null;window.history.back();return}if(a)y();i=window.location.href;window.location.hash=e}}t.navigate=u;function c(e,t){u(e,t,true)}t.replace=c;function d(e,i){if(!t.enabled)return;var r=window.location.hash||"";if(r.charAt(0)=="#")r=r.substr(1,r.length-1);var n=r.split("/+/");if(n.length>1){if(e&&e.length){n[n.length-1]=e;e=n.join("/+/")}else{n.splice(n.length-1,1);e=n.join("/+/")}}c(e,i)}t.replaceLast=d;function f(){return $(".ui-dialog-content:visible, .ui-dialog.panel-hidden>.ui-dialog-content, .s-Panel").toArray().sort(function(e,t){return($(e).data("qrouterorder")||0)-($(t).data("qrouterorder")||0)})}function p(t,i,r){var n=[];var a=t.hasClass(".ui-dialog-content")||t.hasClass(".s-Panel");var o=a?t:t.closest(".ui-dialog-content, .s-Panel");var l=r();var s;if(o.length){var u=f();var p=u.indexOf(o[0]);for(var h=0;h<=p;h++){var g=$(u[h]).data("qroute");if(g&&g.length)n.push(g)}if(!a){s=o.attr("id");if(s){s+="_";var v=t.attr("id");if(v&&e.startsWith(v,s))l=v.substr(s.length)+"@"+l}}}else{var v=t.attr("id");if(v&&(!t.hasClass("route-handler")||$(".route-handler").first().attr("id")!=v))l=v+"@"+l}n.push(l);i.data("qroute",l);c(n.join("/+/"));i.bind("dialogclose.qrouter panelclose.qrouter",function(e){i.data("qroute",null);i.unbind(".qrouter");var t=i.data("qprhash");var r=$(e.target).closest(".s-MessageDialog").length>0||e&&e.originalEvent&&(e.originalEvent.type=="keydown"&&e.originalEvent.keyCode==27||$(e.originalEvent.target).hasClass("ui-dialog-titlebar-close")||$(e.originalEvent.target).hasClass("panel-titlebar-close"));if(t!=null)c(t,r);else d("",r)})}function h(e,i,r){if(!t.enabled)return;i.on("dialogopen.qrouter panelopen.qrouter",function(t){p(e,i,r)})}t.dialog=h;function g(i){if(!t.enabled)return;r++;try{i=e.coalesce(e.coalesce(i,window.location.hash),"");if(i.charAt(0)=="#")i=i.substr(1,i.length-1);var n=f();var a=i.split("/+/");var o=n.map(function(e){return $(e).data("qroute")});var l=0;while(l<n.length&&l<a.length&&o[l]==a[l]){l++}for(var s=l;s<n.length;s++){var u=$(n[s]);if(u.hasClass("ui-dialog-content"))u.dialog("close");else if(u.hasClass("s-Panel"))Serenity.TemplatedDialog.closePanel(u)}for(var s=l;s<a.length;s++){var c=a[s];var d=c.split("@");var p;if(d.length==2){var h=s>0?$(n[s-1]):$([]);if(h.length){var g=h.attr("id");if(g){p=$("#"+g+"_"+d[0]);if(p.length){c=d[1]}}}if(!p||!p.length){p=$("#"+d[0]);if(p.length){c=d[1]}}}if(!p||!p.length){p=s>0?$(n[s-1]):$(".route-handler").first()}p.triggerHandler("handleroute",{handled:false,route:c,parts:a,index:s})}}finally{r--}}t.resolve=g;function v(e,t){if(o>0){if((new Date).getTime()-l>1e3){o=0}else{o--;return}}g()}function y(){o++;l=(new Date).getTime()}window.addEventListener("hashchange",v,false);var m=1;$(document).on("dialogopen panelopen",".ui-dialog-content, .s-Panel",function(e,i){if(!t.enabled)return;var r=$(e.target);r.data("qrouterorder",m++);if(r.data("qroute"))return;r.data("qprhash",window.location.hash);var a=$(f).not(r).last();if(!a.length)a=$("html");p(a,r,function(){return"!"+(++n).toString(36)})})})(t=e.Router||(e.Router={}))})(Q||(Q={}));var Q;(function(e){function t(e){e.css("height","100%");o(e)}e.autoFullHeight=t;function i(t){$("body").addClass("full-height-page");t.addClass("responsive-height");var i=function(){var e=t.parent().hasClass("page-content")||t.parent().is("section.content");if(e){t.css("height","1px").css("overflow","hidden")}n(t);if(e){t.css("overflow","")}t.triggerHandler("layout")};if($("body").hasClass("has-layout-event")){$("body").bind("layout",i)}else if(window.Metronic){window.Metronic.addResizeHandler(i)}else{$(window).resize(i)}i();t.one("remove",function(){$(window).off("layout",i);$("body").off("layout",i)});e["Router"]&&e["Router"].resolve&&e["Router"].resolve()}e.initFullHeightGridPage=i;function r(e){var t=0;e.parent().children().not(e).each(function(e,i){var r=$(i);if(r.is(":visible")){t+=r.outerHeight(true)}});t=e.parent().height()-t;if(e.css("box-sizing")!=="border-box"){t=t-(e.outerHeight(true)-e.height())}return t}e.layoutFillHeightValue=r;function n(e){var t=r(e);var i=Math.round(t)+"px";if(e.css("height")!=i){e.css("height",i)}}e.layoutFillHeight=n;function a(){var e=navigator.userAgent.indexOf("Mobi")>=0||window.matchMedia&&window.matchMedia("(max-width: 767px)").matches;var t=$(document.body);if(t.hasClass("mobile-device")){if(!e){t.removeClass("mobile-device")}}else if(e){t.addClass("mobile-device")}}e.setMobileDeviceMode=a;a();$(function(){if(globalObj&&e.Config.rootNamespaces){for(var t=0,i=e.Config.rootNamespaces;t<i.length;t++){var r=i[t];var n=e.getNested(globalObj,r);if(n!=null)e.initializeTypes(n,r+".",3)}}globalObj&&$(globalObj).bind("resize",function(){a()})});function o(e){Serenity.LazyLoadHelper.executeEverytimeWhenShown(e,function(){e.triggerHandler("layout")},true)}e.triggerLayoutOnShow=o;function l(e){if(!e.hasClass("ui-dialog"))e=e.closest(".ui-dialog");e.position({at:"center center",of:window});var t=e.position();if(t.left<0)e.css("left","0px");if(t.top<0)e.css("top","0px")}e.centerDialog=l})(Q||(Q={}));var Serenity;(function(e){var t;(function(e){function t(e,t,i,r,n){var a=e.dialog();a.dialog("option","resizable",true);if(r!=null){a.dialog("option","minWidth",r)}if(t!=null){a.dialog("option","width",t)}if(n!=null){a.dialog("option","minHeight",n)}if(i!=null){a.dialog("option","height",i)}return e}e.dialogResizable=t;function i(e){e.dialogExtend({closable:true,maximizable:true,dblclick:"maximize",icons:{maximize:"ui-icon-maximize-window"}});return e}e.dialogMaximizable=i})(t=e.DialogExtensions||(e.DialogExtensions={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(e){var i=t.call(this,Q.newBodyDiv().addClass("s-TemplatedDialog hidden"),e)||this;i.element.attr("id",i.uniqueName);i.initValidator();i.initTabs();i.initToolbar();return i}r=i;Object.defineProperty(i.prototype,"isMarkedAsPanel",{get:function(){var t=Q.getAttributes(Q.getInstanceType(this),e.PanelAttribute,true);return t.length>0&&t[t.length-1].value!==false},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"isResponsive",{get:function(){return Q.Config.responsiveDialogs||Q.getAttributes(Q.getInstanceType(this),e.ResponsiveAttribute,true).length>0},enumerable:true,configurable:true});i.getCssSize=function(e,t){var i=e.css(t);if(i==null){return null}if(!Q.endsWith(i,"px")){return null}i=i.substr(0,i.length-2);var r=Q.parseInteger(i);if(r==null||isNaN(r)||r==0)return null;return r};i.applyCssSizes=function(e,t){var i;
var n=$("<div/>").hide().addClass(t).appendTo(document.body);try{var a=$("<div/>").addClass("size").appendTo(n);i=r.getCssSize(a,"minWidth");if(i!=null)e.minWidth=i;i=r.getCssSize(a,"width");if(i!=null)e.width=i;i=r.getCssSize(a,"height");if(i!=null)e.height=i;i=r.getCssSize(a,"minHeight");if(i!=null)e.minHeight=i}finally{n.remove()}};i.prototype.destroy=function(){this.tabs&&this.tabs.tabs("destroy");this.tabs=null;this.toolbar&&this.toolbar.destroy();this.toolbar=null;this.validator&&this.byId("Form").remove();this.validator=null;if(this.element!=null&&this.element.hasClass("ui-dialog-content")){this.element.dialog("destroy");this.element.removeClass("ui-dialog-content")}else if(this.element!=null&&this.element.hasClass("modal-body")){var e=this.element.closest(".modal").data("bs.modal",null);this.element&&this.element.removeClass("modal-body");window.setTimeout(function(){return e.remove()},0)}$(window).unbind("."+this.uniqueName);t.prototype.destroy.call(this)};i.prototype.initDialog=function(){var t=this;if(this.element.hasClass("ui-dialog-content"))return;this.element.removeClass("hidden");this.element.dialog(this.getDialogOptions());this.element.closest(".ui-dialog").on("resize",function(e){return t.arrange()});var i=Q.getInstanceType(this);if(this.isResponsive){e.DialogExtensions.dialogResizable(this.element);$(window).bind("resize."+this.uniqueName,function(e){if(t.element&&t.element.is(":visible")){t.handleResponsive()}});this.element.closest(".ui-dialog").addClass("flex-layout")}else if(e["FlexifyAttribute"]&&e.DialogExtensions["dialogFlexify"]&&Q.getAttributes(i,e["FlexifyAttribute"],true).length>0){e.DialogExtensions["dialogFlexify"](this.element);e.DialogExtensions.dialogResizable(this.element)}if(Q.getAttributes(i,e.MaximizableAttribute,true).length>0){e.DialogExtensions.dialogMaximizable(this.element)}var r=this;this.element.bind("dialogopen."+this.uniqueName,function(){$(document.body).addClass("modal-dialog-open");if(t.isResponsive){t.handleResponsive()}r.onDialogOpen()});this.element.bind("dialogclose."+this.uniqueName,function(){$(document.body).toggleClass("modal-dialog-open",$(".ui-dialog:visible").length>0);r.onDialogClose()})};i.prototype.getModalOptions=function(){return{backdrop:false,keyboard:false,size:"lg",modalClass:this.getCssClass()}};i.prototype.initModal=function(){var e=this;if(this.element.hasClass("modal-body"))return;var t=Q.coalesce(this.element.data("dialogtitle"),this.getDialogTitle())||"";var i=this.getModalOptions();i["show"]=false;var r="s-Modal";if(i.modalClass)r+=" "+i.modalClass;var n=Q.bsModalMarkup(t,"",r);var a=$(n).eq(0).appendTo(document.body).addClass("flex-layout");a.one("shown.bs.modal."+this.uniqueName,function(){e.element.triggerHandler("shown.bs.modal");e.onDialogOpen()});a.one("hidden.bs.modal."+this.uniqueName,function(){$(document.body).toggleClass("modal-open",$(".modal.show").length+$(".modal.in").length>0);e.onDialogClose()});if(i.size)a.find(".modal-dialog").addClass("modal-"+i.size);var o=a.find(".modal-footer");var l=this.getDialogButtons();if(l!=null){for(var s=0,u=l;s<u.length;s++){var c=u[s];$(Q.dialogButtonToBS(c)).appendTo(o).click(c.click)}}else o.hide();a.modal(i);a.find(".modal-body").replaceWith(this.element.removeClass("hidden").addClass("modal-body"));$(window).on("resize."+this.uniqueName,this.arrange.bind(this))};i.prototype.initToolbar=function(){var t=this.byId("Toolbar");if(t.length===0){return}var i=this.element.closest(".ui-dialog");if(i.length===0){i=this.element.closest(".modal");if(i.length==0)i=this.element}var r={buttons:this.getToolbarButtons(),hotkeyContext:i[0]};this.toolbar=new e.Toolbar(t,r)};i.prototype.getToolbarButtons=function(){return[]};i.prototype.getValidatorOptions=function(){return{}};i.prototype.initValidator=function(){var e=this.byId("Form");if(e.length>0){var t=this.getValidatorOptions();this.validator=e.validate(Q.validateOptions(t))}};i.prototype.resetValidation=function(){this.validator&&this.validator.resetAll()};i.prototype.validateForm=function(){return this.validator==null||!!this.validator.form()};i.prototype.dialogOpen=function(e){var t=this;e=Q.coalesce(e,this.isMarkedAsPanel);if(e){if(!this.element.hasClass("s-Panel")){this.element.on("panelopen."+this.uniqueName,function(){t.onDialogOpen()});this.element.on("panelclose."+this.uniqueName,function(){t.onDialogClose()})}r.openPanel(this.element,this.uniqueName);this.setupPanelTitle()}else if(this.useBSModal()){this.initModal();this.element.closest(".modal").modal("show")}else{this.initDialog();this.element.dialog("open")}};i.prototype.useBSModal=function(){return!!(!$.ui||!$.ui.dialog||r.bootstrapModal)};i.openPanel=function(e,t){var i=$(".panels-container");if(!i.length)i=$("section.content");e.data("paneluniquename",t);if(i.length){i=i.last();i.children().not(e).not(".panel-hidden").addClass("panel-hidden panel-hidden-"+t);if(e[0].parentElement!==i[0])e.appendTo(i)}$(".ui-dialog:visible, .ui-widget-overlay:visible, .modal.show, .modal.in").not(e).addClass("panel-hidden panel-hidden-"+t);e.removeClass("hidden").removeClass("panel-hidden").addClass("s-Panel").trigger("panelopen")};i.closePanel=function(e,t){if(!e.hasClass("s-Panel")||e.hasClass("hidden"))return;var i=$.Event(t);i.type="panelbeforeclose";i.target=e[0];e.trigger(i);if(i.isDefaultPrevented())return;e.addClass("hidden");var r=e.data("paneluniquename")||(new Date).getTime();var n="panel-hidden-"+r;$("."+n).removeClass(n).removeClass("panel-hidden");$(window).triggerHandler("resize");$(".require-layout:visible").triggerHandler("layout");var t=$.Event(t);t.type="panelclose";t.target=e[0];e.trigger(t)};i.prototype.onDialogOpen=function(){if(!$(document.body).hasClass("mobile-device"))$(":input",this.element).not("button").eq(0).focus();this.arrange();this.tabs&&this.tabs.tabs("option","active",0)};i.prototype.arrange=function(){this.element.find(".require-layout").filter(":visible").each(function(e,t){$(t).triggerHandler("layout")})};i.prototype.onDialogClose=function(){var e=this;$(document).trigger("click");if($.qtip){$(document.body).children(".qtip").each(function(e,t){$(t).qtip("hide")})}window.setTimeout(function(){var t=e.element;e.destroy();t.remove();Q.positionToastContainer(false)},0)};i.prototype.addCssClass=function(){if(this.isMarkedAsPanel){t.prototype.addCssClass.call(this);if(this.isResponsive)this.element.addClass("flex-layout")}};i.prototype.getDialogButtons=function(){return undefined};i.prototype.getDialogOptions=function(){var t={};var i="s-Dialog "+this.getCssClass();t.dialogClass=i;var n=this.getDialogButtons();if(n!=null)t.buttons=n.map(Q.dialogButtonToUI);t.width=920;r.applyCssSizes(t,i);t.autoOpen=false;var a=Q.getInstanceType(this);t.resizable=Q.getAttributes(a,e.ResizableAttribute,true).length>0;t.modal=true;t.position={my:"center",at:"center",of:$(window.window)};t.title=Q.coalesce(this.element.data("dialogtitle"),this.getDialogTitle())||"";return t};i.prototype.getDialogTitle=function(){return""};i.prototype.dialogClose=function(){if(this.element.hasClass("ui-dialog-content"))this.element.dialog().dialog("close");else if(this.element.hasClass("modal-body"))this.element.closest(".modal").modal("hide");else if(this.element.hasClass("s-Panel")&&!this.element.hasClass("hidden")){r.closePanel(this.element)}};Object.defineProperty(i.prototype,"dialogTitle",{get:function(){if(this.element.hasClass("ui-dialog-content"))return this.element.dialog("option","title");else if(this.element.hasClass("modal-body"))return this.element.closest(".modal").find(".modal-header").children("h5").text();return this.element.data("dialogtitle")},set:function(e){var t=this.dialogTitle;this.element.data("dialogtitle",e);if(this.element.hasClass("ui-dialog-content"))this.element.dialog("option","title",e);else if(this.element.hasClass("modal-body")){this.element.closest(".modal").find(".modal-header").children("h5").text(e!==null&&e!==void 0?e:"")}else if(this.element.hasClass("s-Panel")){if(t!=this.dialogTitle){this.setupPanelTitle();this.arrange()}}},enumerable:true,configurable:true});i.prototype.setupPanelTitle=function(){var e=this;var t=Q.coalesce(this.dialogTitle,this.getDialogTitle());var i=this.element.children(".panel-titlebar");if(Q.isEmptyOrNull(t)){i.remove()}else{if(!this.element.children(".panel-titlebar").length){i=$("<div class='panel-titlebar'><div class='panel-titlebar-text'></div></div>").prependTo(this.element)}i.children(".panel-titlebar-text").text(t);if(this.element.hasClass("s-Panel")){if(!i.children(".panel-titlebar-close").length){$('<button class="panel-titlebar-close">&nbsp;</button>').prependTo(i).click(function(t){r.closePanel(e.element,t)})}}}};i.prototype.set_dialogTitle=function(e){this.dialogTitle=e};i.prototype.initTabs=function(){var e=this;var t=this.byId("Tabs");if(t.length===0){return}this.tabs=t.tabs({});this.tabs.bind("tabsactivate",function(){return e.arrange()})};i.prototype.handleResponsive=function(){var e=this.element.dialog();var t=this.element.closest(".ui-dialog");if($(document.body).hasClass("mobile-device")){var i=this.element.data("responsiveData");if(!i){i={};i.draggable=e.dialog("option","draggable");i.resizable=e.dialog("option","resizable");i.position=e.css("position");var r=t.position();i.left=r.left;i.top=r.top;i.width=t.width();i.height=t.height();i.contentHeight=this.element.height();this.element.data("responsiveData",i);e.dialog("option","draggable",false);e.dialog("option","resizable",false)}t.addClass("mobile-layout");t.css({left:"0px",top:"0px",width:$(window).width()+"px",height:$(window).height()+"px",position:"fixed"});$(document.body).scrollTop(0);Q.layoutFillHeight(this.element)}else{var n=this.element.data("responsiveData");if(n){e.dialog("option","draggable",n.draggable);e.dialog("option","resizable",n.resizable);this.element.closest(".ui-dialog").css({left:"0px",top:"0px",width:n.width+"px",height:n.height+"px",position:n.position});this.element.height(n.contentHeight);t.removeClass("mobile-layout");this.element.removeData("responsiveData")}}};var r;i=r=__decorate([e.Decorators.registerClass([e.IDialog])],i);return i}(e.TemplatedWidget);e.TemplatedDialog=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(e){var i=t.call(this,e)||this;i.initPropertyGrid();i.loadInitialEntity();return i}i.prototype.destroy=function(){if(this.propertyGrid){this.propertyGrid.destroy();this.propertyGrid=null}if(this.validator){this.byId("Form").remove();this.validator=null}t.prototype.destroy.call(this)};i.prototype.getDialogOptions=function(){var e=t.prototype.getDialogOptions.call(this);e.width=400;return e};i.prototype.getDialogButtons=function(){var e=this;return[{text:Q.text("Dialogs.OkButton"),click:function(){return e.okClick()}},{text:Q.text("Dialogs.CancelButton"),click:function(){return e.cancelClick()}}]};i.prototype.okClick=function(){if(!this.validateBeforeSave()){return}this.okClickValidated()};i.prototype.okClickValidated=function(){this.dialogClose()};i.prototype.cancelClick=function(){this.dialogClose()};i.prototype.initPropertyGrid=function(){var t=this.byId("PropertyGrid");if(t.length<=0){return}var i=this.getPropertyGridOptions();this.propertyGrid=new e.PropertyGrid(t,i).init(null);if(this.element.closest(".ui-dialog").hasClass("s-Flexify")){this.propertyGrid.element.children(".categories").flexHeightOnly(1)}};i.prototype.getFormKey=function(){var t=Q.getAttributes(Q.getInstanceType(this),e.FormKeyAttribute,true);if(t.length>=1){return t[0].value}else{var i=Q.getTypeFullName(Q.getInstanceType(this));var r=i.indexOf(".");if(r>=0){i=i.substring(r+1)}if(Q.endsWith(i,"Dialog")){i=i.substr(0,i.length-6)}else if(Q.endsWith(i,"Panel")){i=i.substr(0,i.length-5)}return i}};i.prototype.getPropertyGridOptions=function(){return{idPrefix:this.idPrefix,items:this.getPropertyItems(),mode:1,useCategories:false,localTextPrefix:"Forms."+this.getFormKey()+"."}};i.prototype.getPropertyItems=function(){var e=this.getFormKey();return Q.getForm(e)};i.prototype.getSaveEntity=function(){var e=new Object;if(this.propertyGrid){this.propertyGrid.save(e)}return e};i.prototype.loadInitialEntity=function(){this.propertyGrid&&this.propertyGrid.load(new Object)};i.prototype.get_entity=function(){return this._entity};i.prototype.set_entity=function(e){this._entity=Q.coalesce(e,new Object)};i.prototype.get_entityId=function(){return this._entityId};i.prototype.set_entityId=function(e){this._entityId=e};i.prototype.validateBeforeSave=function(){return this.validator.form()};i.prototype.updateTitle=function(){};i=__decorate([e.Decorators.registerClass("Serenity.PropertyDialog")],i);return i}(e.TemplatedDialog);e.PropertyDialog=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(e){var i=t.call(this,e)||this;i.initPropertyGrid();i.initLocalizationGrid();return i}i.prototype.destroy=function(){if(this.propertyGrid){this.propertyGrid.destroy();this.propertyGrid=null}if(this.localizationGrid){this.localizationGrid.destroy();this.localizationGrid=null}this.undeleteButton=null;this.applyChangesButton=null;this.deleteButton=null;this.saveAndCloseButton=null;this.editButton=null;this.cloneButton=null;this.toolbar=null;t.prototype.destroy.call(this)};i.prototype.get_entity=function(){return this.entity};i.prototype.set_entity=function(e){this.entity=e||new Object};i.prototype.get_entityId=function(){return this.entityId};i.prototype.set_entityId=function(e){this.entityId=e};i.prototype.getEntityNameFieldValue=function(){return Q.coalesce(this.get_entity()[this.getNameProperty()],"").toString()};i.prototype.getEntityTitle=function(){if(!this.isEditMode()){return Q.format(Q.text("Controls.EntityDialog.NewRecordTitle"),this.getEntitySingular())}else{var e=this.isViewMode()||this.readOnly||!this.hasSavePermission()?Q.text("Controls.EntityDialog.ViewRecordTitle"):Q.text("Controls.EntityDialog.EditRecordTitle");var t=Q.coalesce(this.getEntityNameFieldValue(),"");return Q.format(e,this.getEntitySingular(),Q.isEmptyOrNull(t)?"":" ("+t+")")}};i.prototype.updateTitle=function(){this.dialogTitle=this.getEntityTitle()};i.prototype.isCloneMode=function(){return false};i.prototype.isEditMode=function(){return this.get_entityId()!=null&&!this.isCloneMode()};i.prototype.isDeleted=function(){if(this.get_entityId()==null){return false}var e=this.getIsDeletedProperty();if(e){return!!this.get_entity()[e]}var t=this.get_entity()[this.getIsActiveProperty()];if(t==null){return false}return t<0};i.prototype.isNew=function(){return this.get_entityId()==null};i.prototype.isNewOrDeleted=function(){return this.isNew()||this.isDeleted()};i.prototype.getDeleteOptions=function(e){return{}};i.prototype.deleteHandler=function(e,t){Q.serviceCall(e)};i.prototype.doDelete=function(e){var t=this;var i=this;var r={EntityId:this.get_entityId()};var n={service:this.getService()+"/Delete",request:r,onSuccess:function(n){i.onDeleteSuccess(n);if(e!=null){e(n)}i.element.triggerHandler("ondatachange",[{entityId:r.EntityId,entity:t.entity,type:"delete"}])}};var a=this.getDeleteOptions(e);var o=Q.extend(n,a);this.deleteHandler(o,e)};i.prototype.onDeleteSuccess=function(e){};i.prototype.attrs=function(e){return Q.getAttributes(Q.getInstanceType(this),e,true)};i.prototype.getEntityType=function(){if(this.entityType!=null)return this.entityType;var t=this.attrs(e.EntityTypeAttribute);if(t.length===1)return this.entityType=t[0].value;var i=Q.getTypeFullName(Q.getInstanceType(this));var r=i.indexOf(".");if(r>=0)i=i.substring(r+1);if(Q.endsWith(i,"Dialog")||Q.endsWith(i,"Control"))i=i.substr(0,i.length-6);else if(Q.endsWith(i,"Panel"))i=i.substr(0,i.length-5);return this.entityType=i};i.prototype.getFormKey=function(){if(this.formKey!=null)return this.formKey;var t=this.attrs(e.FormKeyAttribute);if(t.length>=1)return this.formKey=t[0].value;return this.formKey=this.getEntityType()};i.prototype.getLocalTextDbPrefix=function(){if(this.localTextDbPrefix!=null)return this.localTextDbPrefix;this.localTextDbPrefix=Q.coalesce(this.getLocalTextPrefix(),"");if(this.localTextDbPrefix.length>0&&!Q.endsWith(this.localTextDbPrefix,"."))this.localTextDbPrefix="Db."+this.localTextDbPrefix+".";return this.localTextDbPrefix};i.prototype.getLocalTextPrefix=function(){var t=this.attrs(e.LocalTextPrefixAttribute);if(t.length>=1)return t[0].value;return this.getEntityType()};i.prototype.getEntitySingular=function(){if(this.entitySingular!=null)return this.entitySingular;var t=this.attrs(e.ItemNameAttribute);if(t.length>=1){this.entitySingular=t[0].value;this.entitySingular=Q.LT.getDefault(this.entitySingular,this.entitySingular)}else{var i=Q.tryGetText(this.getLocalTextDbPrefix()+"EntitySingular");if(i==null)i=this.getEntityType();this.entitySingular=i}return this.entitySingular};i.prototype.getNameProperty=function(){if(this.nameProperty!=null)return this.nameProperty;var t=this.attrs(e.NamePropertyAttribute);if(t.length>=1)this.nameProperty=t[0].value;else this.nameProperty="Name";return this.nameProperty};i.prototype.getIdProperty=function(){if(this.idProperty!=null)return this.idProperty;var t=this.attrs(e.IdPropertyAttribute);if(t.length>=1)this.idProperty=t[0].value;else this.idProperty="ID";return this.idProperty};i.prototype.getIsActiveProperty=function(){if(this.isActiveProperty!=null)return this.isActiveProperty;var t=this.attrs(e.IsActivePropertyAttribute);if(t.length>=1)this.isActiveProperty=t[0].value;else this.isActiveProperty="IsActive";return this.isActiveProperty};i.prototype.getIsDeletedProperty=function(){return null};i.prototype.getService=function(){if(this.service!=null)return this.service;var t=this.attrs(e.ServiceAttribute);if(t.length>=1)this.service=t[0].value;else this.service=Q.replaceAll(this.getEntityType(),".","/");return this.service};i.prototype.load=function(e,t,i){var r=this;var n=function(){if(e==null){r.loadResponse({});t&&t();return}var i=typeof e;if(i==="string"||i==="number"){var n=e;r.loadById(n,function(e){if(t)window.setTimeout(t,0)},null);return}var a=e||new Object;r.loadResponse({Entity:a});t&&t()};if(i==null){n();return}try{n()}catch(a){var o=Q.Exception.wrap(a);i(o)}};i.prototype.loadNewAndOpenDialog=function(e){this.loadResponse({});this.dialogOpen(e)};i.prototype.loadEntityAndOpenDialog=function(e,t){this.loadResponse({Entity:e});this.dialogOpen(t)};i.prototype.loadResponse=function(e){e=e||{};this.onLoadingData(e);var t=e.Entity||new Object;this.beforeLoadEntity(t);this.loadEntity(t);this.set_entity(t);this.afterLoadEntity()};i.prototype.loadEntity=function(e){var t=this.getIdProperty();if(t!=null)this.set_entityId(e[t]);this.set_entity(e);if(this.propertyGrid!=null){this.propertyGrid.set_mode(this.isEditMode()?2:1);this.propertyGrid.load(e)}};i.prototype.beforeLoadEntity=function(e){this.localizationPendingValue=null;this.localizationLastValue=null};i.prototype.afterLoadEntity=function(){this.updateInterface();this.updateTitle()};i.prototype.loadByIdAndOpenDialog=function(e,t){var i=this;this.loadById(e,function(e){return window.setTimeout(function(){return i.dialogOpen(t)},0)},function(){if(!i.element.is(":visible")){i.element.remove()}})};i.prototype.onLoadingData=function(e){};i.prototype.getLoadByIdOptions=function(e,t){return{}};i.prototype.getLoadByIdRequest=function(e){var t={};t.EntityId=e;return t};i.prototype.reloadById=function(){this.loadById(this.get_entityId())};i.prototype.loadById=function(e,t,i){var r=this;var n={service:this.getService()+"/Retrieve",blockUI:true,request:this.getLoadByIdRequest(e),onSuccess:function(e){r.loadResponse(e);t&&t(e)},onCleanup:function(){if(r.validator!=null){Q.validatorAbortHandler(r.validator)}}};var a=this.getLoadByIdOptions(e,t);var o=Q.extend(n,a);this.loadByIdHandler(o,t,i)};i.prototype.loadByIdHandler=function(e,t,i){var r=Q.serviceCall(e);i&&r.fail(i)};i.prototype.initLocalizationGrid=function(){var e=this.byId("PropertyGrid");if(e.length<=0){return}var t=this.getPropertyGridOptions();this.initLocalizationGridCommon(t)};i.prototype.initLocalizationGridCommon=function(t){var i=this.byId("PropertyGrid");if(!Q.any(t.items,function(e){return e.localizable===true}))return;var r=$("<div/>").attr("id",this.idPrefix+"LocalizationGrid").hide().insertAfter(i);t.idPrefix=this.idPrefix+"Localization_";var n=[];for(var a=0,o=t.items;a<o.length;a++){var l=o[a];var s=null;if(l.localizable===true){var u=Q.extend({},l);u.oneWay=true;u.readOnly=true;u.required=false;u.defaultValue=null;n.push(u);if(s==null)s=this.getLangs();for(var c=0,d=s;c<d.length;c++){var f=d[c];u=Q.extend({},l);u.name=f[0]+"$"+u.name;u.title=f[1];u.cssClass=[u.cssClass,"translation"].join(" ");u.insertable=true;u.updatable=true;u.oneWay=false;u.required=false;u.localizable=false;u.defaultValue=null;n.push(u)}}}t.items=n;this.localizationGrid=new e.PropertyGrid(r,t).init(null);r.addClass("s-LocalizationGrid")};i.prototype.isLocalizationMode=function(){return this.localizationButton!=null&&this.localizationButton.hasClass("pressed")};i.prototype.isLocalizationModeAndChanged=function(){if(!this.isLocalizationMode()){return false}var e=this.getLocalizationGridValue();return $.toJSON(this.localizationLastValue)!=$.toJSON(e)};i.prototype.localizationButtonClick=function(){if(this.isLocalizationMode()&&!this.validateForm()){return}if(this.isLocalizationModeAndChanged()){var e=this.getLocalizationGridValue();this.localizationLastValue=e;this.localizationPendingValue=e}this.localizationButton.toggleClass("pressed");this.updateInterface();if(this.isLocalizationMode()){this.loadLocalization()}};i.prototype.getLanguages=function(){if(e.EntityDialog.defaultLanguageList!=null)return e.EntityDialog.defaultLanguageList()||[];return[]};i.prototype.getLangs=function(){var e=this.getLanguages();var t=Q.safeCast(e,Array);if(t==null||t.length===0||t[0]==null||!Q.isArray(t[0])){t=Array.prototype.slice.call(e.map(function(e){return[e.item1,e.item2]}))}return t};i.prototype.loadLocalization=function(){var e=this;if(this.localizationLastValue==null&&this.isNew()){this.localizationGrid.load({});this.setLocalizationGridCurrentValues();this.localizationLastValue=this.getLocalizationGridValue();return}if(this.localizationLastValue!=null){this.localizationGrid.load(this.localizationLastValue);this.setLocalizationGridCurrentValues();return}var t={service:this.getService()+"/Retrieve",blockUI:true,request:{EntityId:this.get_entityId(),ColumnSelection:"keyOnly",IncludeColumns:["Localizations"]},onSuccess:function(t){var i=Q.extend(new Object,e.get_entity());if(t.Localizations){for(var r=0,n=Object.keys(t.Localizations);r<n.length;r++){var a=n[r];var o=t.Localizations[a];for(var l=0,s=Object.keys(o);l<s.length;l++){var u=s[l];i[a+"$"+u]=o[u]}}}e.localizationGrid.load(i);e.setLocalizationGridCurrentValues();e.localizationPendingValue=null;e.localizationLastValue=e.getLocalizationGridValue()}};Q.serviceCall(t)};i.prototype.setLocalizationGridCurrentValues=function(){var e=this;var t={};this.localizationGrid.enumerateItems(function(i,r){if(i.name.indexOf("$")<0&&r.element.is(":input")){t[i.name]=e.byId(i.name).val();r.element.val(t[i.name])}});this.localizationGrid.enumerateItems(function(e,i){var r=e.name.indexOf("$");if(r>=0&&i.element.is(":input")){var n=t[e.name.substr(r+1)];if(n!=null&&n.length>0){i.element.attr("title",n).attr("placeholder",n)}}})};i.prototype.getLocalizationGridValue=function(){var e={};this.localizationGrid.save(e);for(var t=0,i=Object.keys(e);t<i.length;t++){var r=i[t];if(r.indexOf("$")<0){delete e[r]}}return e};i.prototype.getPendingLocalizations=function(){if(this.localizationPendingValue==null){return null}var e={};var t=this.getIdProperty();var i=this.getLangs();for(var r=0,n=i;r<n.length;r++){var a=n[r];var o=a[0];var l={};if(t!=null){l[t]=this.get_entityId()}var s=o+"$";for(var u=0,c=Object.keys(this.localizationPendingValue);u<c.length;u++){var d=c[u];if(Q.startsWith(d,s))l[d.substr(s.length)]=this.localizationPendingValue[d]}e[o]=l}return e};i.prototype.initPropertyGrid=function(){var t=this.byId("PropertyGrid");if(t.length<=0){return}var i=this.getPropertyGridOptions();this.propertyGrid=new e.PropertyGrid(t,i).init(null);if(this.element.closest(".ui-dialog").hasClass("s-Flexify")){this.propertyGrid.element.children(".categories").flexHeightOnly(1)}};i.prototype.getPropertyItems=function(){var e=this.getFormKey();return Q.getForm(e)};i.prototype.getPropertyGridOptions=function(){return{idPrefix:this.idPrefix,items:this.getPropertyItems(),mode:1,localTextPrefix:"Forms."+this.getFormKey()+".",useCategories:true}};i.prototype.validateBeforeSave=function(){return true};i.prototype.getSaveOptions=function(e){var t=this;var i={};i.service=this.getService()+"/"+(this.isEditMode()?"Update":"Create"),i.onSuccess=function(r){t.onSaveSuccess(r);e&&e(r);var n=t.isEditMode()?"update":"create";var a=i.request==null?null:i.request.Entity;var o=t.isEditMode()?t.get_entityId():r==null?null:r.EntityId;var l={type:n,entity:a,entityId:o};t.element.triggerHandler("ondatachange",[l])};i.onCleanup=function(){t.validator&&Q.validatorAbortHandler(t.validator)};i.request=this.getSaveRequest();return i};i.prototype.getSaveEntity=function(){var e=new Object;if(this.propertyGrid!=null){this.propertyGrid.save(e)}if(this.isEditMode()){var t=this.getIdProperty();if(t!=null&&e[t]==null){e[t]=this.get_entityId()}}return e};i.prototype.getSaveRequest=function(){var e=this.getSaveEntity();var t={};t.Entity=e;if(this.isEditMode()){var i=this.getIdProperty();if(i!=null){t.EntityId=this.get_entityId()}}if(this.localizationPendingValue!=null){t.Localizations=this.getPendingLocalizations()}return t};i.prototype.onSaveSuccess=function(e){};i.prototype.save_submitHandler=function(e){var t=this.getSaveOptions(e);this.saveHandler(t,e)};i.prototype.save=function(t){var i=this;return e.ValidationHelper.submit(this.byId("Form"),function(){return i.validateBeforeSave()},function(){return i.save_submitHandler(t)})};i.prototype.saveHandler=function(e,t){Q.serviceCall(e)};i.prototype.initToolbar=function(){t.prototype.initToolbar.call(this);if(!this.toolbar)return;this.saveAndCloseButton=this.toolbar.findButton("save-and-close-button");this.applyChangesButton=this.toolbar.findButton("apply-changes-button");this.deleteButton=this.toolbar.findButton("delete-button");this.undeleteButton=this.toolbar.findButton("undo-delete-button");this.editButton=this.toolbar.findButton("edit-button");this.cloneButton=this.toolbar.findButton("clone-button");this.localizationButton=this.toolbar.findButton("localization-button")};i.prototype.showSaveSuccessMessage=function(e){Q.notifySuccess(Q.text("Controls.EntityDialog.SaveSuccessMessage"),"",null)};i.prototype.getToolbarButtons=function(){var t=this;var i=[];i.push({title:Q.text("Controls.EntityDialog.SaveButton"),cssClass:"save-and-close-button",hotkey:"alt+s",onClick:function(){t.save(function(e){t.dialogClose()})},visible:function(){return!t.isDeleted()&&!t.isViewMode()},disabled:function(){return!t.hasSavePermission()||t.readOnly}});i.push({title:"",hint:Q.text("Controls.EntityDialog.ApplyChangesButton"),cssClass:"apply-changes-button",hotkey:"alt+a",onClick:function(){t.save(function(e){if(t.isEditMode()){var i=e.EntityId;if(i==null){i=t.get_entityId()}t.loadById(i)}else{t.loadById(e.EntityId)}t.showSaveSuccessMessage(e)})},visible:function(){return!t.isDeleted()&&!t.isViewMode()},disabled:function(){return!t.hasSavePermission()||t.readOnly}});i.push({title:Q.text("Controls.EntityDialog.DeleteButton"),cssClass:"delete-button",hotkey:"alt+x",onClick:function(){Q.confirm(Q.text("Controls.EntityDialog.DeleteConfirmation"),function(){t.doDelete(function(){return t.dialogClose()})})},visible:function(){return t.isEditMode()&&!t.isDeleted()&&!t.isViewMode()},disabled:function(){return!t.hasDeletePermission()||t.readOnly}});i.push({title:Q.text("Controls.EntityDialog.UndeleteButton"),cssClass:"undo-delete-button",onClick:function(){if(t.isDeleted()){Q.confirm(Q.text("Controls.EntityDialog.UndeleteConfirmation"),function(){t.undelete(function(){return t.loadById(t.get_entityId())})})}},visible:function(){return t.isEditMode()&&t.isDeleted()&&!t.isViewMode()},disabled:function(){return!t.hasDeletePermission()||t.readOnly}});if(this.useViewMode()){i.push({title:Q.text("Controls.EntityDialog.EditButton"),cssClass:"edit-button",icon:"fa-edit",onClick:function(){if(!t.isEditMode())return;t.editClicked=true;t.updateInterface();t.updateTitle()},visible:function(){return t.isViewMode()},disabled:function(){return!t.hasSavePermission()||t.readOnly}})}i.push({title:Q.text("Controls.EntityDialog.LocalizationButton"),cssClass:"localization-button",onClick:function(){return t.localizationButtonClick()}});i.push({title:Q.text("Controls.EntityDialog.CloneButton"),cssClass:"clone-button",onClick:function(){if(!t.isEditMode()){return}var i=t.getCloningEntity();e.Widget.create({type:Q.getInstanceType(t),init:function(r){return e.SubDialogHelper.bubbleDataChange(e.SubDialogHelper.cascade(r,t.element),t,true).loadEntityAndOpenDialog(i,null)}})},visible:function(){return false},disabled:function(){return!t.hasInsertPermission()||t.readOnly}});return i};i.prototype.getCloningEntity=function(){var e=new Object;e=Q.extend(e,this.get_entity());var t=this.getIdProperty();if(!Q.isEmptyOrNull(t)){delete e[t]}var i=this.getIsActiveProperty();if(!Q.isEmptyOrNull(i)){delete e[i]}var r=this.getIsDeletedProperty();if(!Q.isEmptyOrNull(r)){delete e[r]}return e};i.prototype.updateInterface=function(){e.EditorUtils.setContainerReadOnly(this.byId("Form"),false);var t=this.isDeleted();var i=this.isLocalizationMode();var r=this.hasSavePermission();var n=this.isViewMode();var t=this.isDeleted();var a=this.readOnly;this.toolbar.updateInterface();if(this.tabs!=null){e.TabsExtensions.setDisabled(this.tabs,"Log",this.isNewOrDeleted())}if(this.propertyGrid!=null){this.propertyGrid.element.toggle(!i)}if(this.localizationGrid!=null){this.localizationGrid.element.toggle(i)}if(this.localizationButton!=null){this.localizationButton.toggle(this.localizationGrid!=null);this.localizationButton.find(".button-inner").text(this.isLocalizationMode()?Q.text("Controls.EntityDialog.LocalizationBack"):Q.text("Controls.EntityDialog.LocalizationButton"))}if(i){if(this.toolbar!=null)this.toolbar.findButton("tool-button").not(".localization-hidden").addClass(".localization-hidden").hide();this.localizationButton&&this.localizationButton.show();return}this.toolbar.findButton("localization-hidden").removeClass("localization-hidden").show();this.saveAndCloseButton&&this.saveAndCloseButton.find(".button-inner").text(Q.text(this.isNew()?"Controls.EntityDialog.SaveButton":"Controls.EntityDialog.UpdateButton"));if(!r||n||a)e.EditorUtils.setContainerReadOnly(this.byId("Form"),true)};i.prototype.getUndeleteOptions=function(e){return{}};i.prototype.undeleteHandler=function(e,t){Q.serviceCall(e)};i.prototype.undelete=function(e){var t=this;var i={};i.service=this.getService()+"/Undelete";var r={};r.EntityId=this.get_entityId();i.request=r;i.onSuccess=function(i){e&&e(i);t.element.triggerHandler("ondatachange",[{entityId:t.get_entityId(),entity:t.entity,type:"undelete"}])};var n=this.getUndeleteOptions(e);var a=Q.extend(i,n);this.undeleteHandler(a,e)};Object.defineProperty(i.prototype,"readOnly",{get:function(){return this.get_readOnly()},set:function(e){this.set_readOnly(e)},enumerable:true,configurable:true});i.prototype.get_readOnly=function(){return!!this._readonly};i.prototype.set_readOnly=function(e){if(!!this._readonly!=!!e){this._readonly=!!e;this.updateInterface();this.updateTitle()}};i.prototype.getInsertPermission=function(){return null};i.prototype.getUpdatePermission=function(){return null};i.prototype.getDeletePermission=function(){return null};i.prototype.hasDeletePermission=function(){var e=this.getDeletePermission();return e==null||Q.Authorization.hasPermission(e)};i.prototype.hasInsertPermission=function(){var e=this.getInsertPermission();return e==null||Q.Authorization.hasPermission(e)};i.prototype.hasUpdatePermission=function(){var e=this.getUpdatePermission();
return e==null||Q.Authorization.hasPermission(e)};i.prototype.hasSavePermission=function(){return this.isNew()?this.hasInsertPermission():this.hasUpdatePermission()};i.prototype.isViewMode=function(){return this.useViewMode()&&this.isEditMode()&&!this.editClicked};i.prototype.useViewMode=function(){return false};i=__decorate([e.Decorators.registerClass("Serenity.EntityDialog",[e["IEditDialog"],e.IReadOnly])],i);return i}(e.TemplatedDialog);e.EntityDialog=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(e){e.isTrue="true";e.isFalse="false";e.contains="contains";e.startsWith="startswith";e.EQ="eq";e.NE="ne";e.GT="gt";e.GE="ge";e.LT="lt";e.LE="le";e.BW="bw";e.IN="in";e.isNull="isnull";e.isNotNull="isnotnull";e.toCriteriaOperator={eq:"=",ne:"!=",gt:">",ge:">=",lt:"<",le:"<="}})(t=e.FilterOperators||(e.FilterOperators={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(){function t(e){this.items=[];if(e==null){throw new Q.ArgumentNullException("source")}this.fields=e.slice();this.get_fields().sort(function(e,t){var i=Q.tryGetText(e.title);if(i==null){i=e.title;if(i==null)i=e.name}var r=Q.tryGetText(t.title);if(r==null){r=t.title;if(r==null)r=t.name}return Q.Culture.stringCompare(i,r)});this.fieldByName={};for(var t=0,i=e;t<i.length;t++){var r=i[t];this.get_fieldByName()[r.name]=r}}i=t;t.getCriteriaFor=function(t){if(t==null)return[""];var i=false;var r=[""];var n=false;var a=[""];for(var o=0;o<t.length;o++){var l=t[o];if(l.leftParen||i&&l.rightParen){if(!e.Criteria.isEmpty(r)){if(i)r=e.Criteria.paren(r);if(n)a=e.Criteria.join(a,"or",r);else a=e.Criteria.join(a,"and",r);r=[""]}i=false}if(l.leftParen){n=l.isOr;i=true}if(l.isOr)r=e.Criteria.join(r,"or",l.criteria);else r=e.Criteria.join(r,"and",l.criteria)}if(!e.Criteria.isEmpty(r)){if(n)a=e.Criteria.join(a,"or",e.Criteria.paren(r));else a=e.Criteria.join(a,"and",e.Criteria.paren(r))}return a};t.getDisplayTextFor=function(e){if(e==null)return"";var t=false;var i="";for(var r=0;r<e.length;r++){var n=e[r];if(t&&(n.rightParen||n.leftParen)){i+=")";t=false}if(i.length>0){i+=" "+Q.text("Controls.FilterPanel."+(n.isOr?"Or":"And"))+" "}if(n.leftParen){i+="(";t=true}i+=n.displayText}if(t){i+=")"}return i};t.prototype.get_fields=function(){return this.fields};t.prototype.get_fieldByName=function(){return this.fieldByName};t.prototype.get_items=function(){return this.items};t.prototype.raiseChanged=function(){this.displayText=null;this.changed&&this.changed(this,{})};t.prototype.add_changed=function(e){this.changed=Q.delegateCombine(this.changed,e)};t.prototype.remove_changed=function(e){this.changed=Q.delegateRemove(this.changed,e)};t.prototype.get_activeCriteria=function(){return i.getCriteriaFor(this.items)};t.prototype.get_displayText=function(){if(this.displayText==null)this.displayText=i.getDisplayTextFor(this.items);return this.displayText};var i;t=i=__decorate([e.Decorators.registerClass("FilterStore")],t);return t}();e.FilterStore=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(){function t(){}t=__decorate([e.Decorators.registerInterface("Serenity.IFiltering")],t);return t}();e.IFiltering=t;var i=function(){function t(){}t=__decorate([e.Decorators.registerInterface("Serenity.IQuickFiltering")],t);return t}();e.IQuickFiltering=i;var r=e.FilterOperators;var n=e.Decorators.option;var a=function(){function r(){}r.prototype.get_field=function(){return this.field};r.prototype.set_field=function(e){this.field=e};r.prototype.get_container=function(){return this.container};r.prototype.set_container=function(e){this.container=e};r.prototype.get_operator=function(){return this.operator};r.prototype.set_operator=function(e){this.operator=e};r.prototype.appendNullableOperators=function(t){if(!this.isNullable()){return t}t.push({key:e.FilterOperators.isNotNull});t.push({key:e.FilterOperators.isNull});return t};r.prototype.appendComparisonOperators=function(t){t.push({key:e.FilterOperators.EQ});t.push({key:e.FilterOperators.NE});t.push({key:e.FilterOperators.LT});t.push({key:e.FilterOperators.LE});t.push({key:e.FilterOperators.GT});t.push({key:e.FilterOperators.GE});return t};r.prototype.isNullable=function(){return this.get_field().required!==true};r.prototype.createEditor=function(){switch(this.get_operator().key){case"true":case"false":case"isnull":case"isnotnull":{return}case"contains":case"startswith":case"eq":case"ne":case"lt":case"le":case"gt":case"ge":{this.get_container().html('<input type="text"/>');return}}throw new Q.Exception(Q.format("Filtering '{0}' has no editor for '{1}' operator",Q.getTypeName(Q.getInstanceType(this)),this.get_operator().key))};r.prototype.operatorFormat=function(e){return Q.coalesce(e.format,Q.coalesce(Q.tryGetText("Controls.FilterPanel.OperatorFormats."+e.key),e.key))};r.prototype.getTitle=function(e){return Q.coalesce(Q.tryGetText(e.title),Q.coalesce(e.title,e.name))};r.prototype.displayText=function(e,t){if(!t||t.length===0){return Q.format(this.operatorFormat(e),this.getTitle(this.field))}else if(t.length===1){return Q.format(this.operatorFormat(e),this.getTitle(this.field),t[0])}else{return Q.format(this.operatorFormat(e),this.getTitle(this.field),t[0],t[1])}};r.prototype.getCriteriaField=function(){return this.field.name};r.prototype.getCriteria=function(){var t={};var i;switch(this.get_operator().key){case"true":{t.displayText=this.displayText(this.get_operator(),[]);t.criteria=[[this.getCriteriaField()],"=",true];return t}case"false":{t.displayText=this.displayText(this.get_operator(),[]);t.criteria=[[this.getCriteriaField()],"=",false];return t}case"isnull":{t.displayText=this.displayText(this.get_operator(),[]);t.criteria=["is null",[this.getCriteriaField()]];return t}case"isnotnull":{t.displayText=this.displayText(this.get_operator(),[]);t.criteria=["is not null",[this.getCriteriaField()]];return t}case"contains":{i=this.getEditorText();t.displayText=this.displayText(this.get_operator(),[i]);t.criteria=[[this.getCriteriaField()],"like","%"+i+"%"];return t}case"startswith":{i=this.getEditorText();t.displayText=this.displayText(this.get_operator(),[i]);t.criteria=[[this.getCriteriaField()],"like",i+"%"];return t}case"eq":case"ne":case"lt":case"le":case"gt":case"ge":{i=this.getEditorText();t.displayText=this.displayText(this.get_operator(),[i]);t.criteria=[[this.getCriteriaField()],e.FilterOperators.toCriteriaOperator[this.get_operator().key],this.getEditorValue()];return t}}throw new Q.Exception(Q.format("Filtering '{0}' has no handler for '{1}' operator",Q.getTypeName(Q.getInstanceType(this)),this.get_operator().key))};r.prototype.loadState=function(e){var t=this.get_container().find(":input").first();t.val(e)};r.prototype.saveState=function(){switch(this.get_operator().key){case"contains":case"startswith":case"eq":case"ne":case"lt":case"le":case"gt":case"ge":{var e=this.get_container().find(":input").first();return e.val()}}return null};r.prototype.argumentNull=function(){return new Q.ArgumentNullException("value",Q.text("Controls.FilterPanel.ValueRequired"))};r.prototype.validateEditorValue=function(e){if(e.length===0){throw this.argumentNull()}return e};r.prototype.getEditorValue=function(){var e=this.get_container().find(":input").not(".select2-focusser").first();if(e.length!==1){throw new Q.Exception(Q.format("Couldn't find input in filter container for {0}",Q.coalesce(this.field.title,this.field.name)))}var t;if(e.data("select2")!=null){t=e.select2("val")}else{t=e.val()}t=Q.coalesce(t,"").trim();return this.validateEditorValue(t)};r.prototype.getEditorText=function(){var e=this.get_container().find(":input").not(".select2-focusser").not(".select2-input").first();if(e.length===0){return this.get_container().text().trim()}var t;if(e.data("select2")!=null){t=Q.coalesce(e.select2("data"),{}).text}else{t=e.val()}return t};r.prototype.initQuickFilter=function(t){t.field=this.getCriteriaField();t.type=e.StringEditor;t.title=this.getTitle(this.field);t.options=Q.deepClone(this.get_field().quickFilterParams)};r=__decorate([e.Decorators.registerClass("Serenity.BaseFiltering",[t,i])],r);return r}();e.BaseFiltering=a;function o(t){return e.Decorators.registerClass("Serenity."+t+"Filtering")}var l=function(t){__extends(i,t);function i(e){var i=t.call(this)||this;i.editorType=e;return i}i.prototype.useEditor=function(){switch(this.get_operator().key){case"eq":case"ne":case"lt":case"le":case"gt":case"ge":return true}return false};i.prototype.createEditor=function(){if(this.useEditor()){this.editor=e.Widget.create({type:this.editorType,container:this.get_container(),options:this.getEditorOptions(),init:null});return}this.editor=null;t.prototype.createEditor.call(this)};i.prototype.useIdField=function(){return false};i.prototype.getCriteriaField=function(){if(this.useEditor()&&this.useIdField()&&!Q.isEmptyOrNull(this.get_field().filteringIdField)){return this.get_field().filteringIdField}return t.prototype.getCriteriaField.call(this)};i.prototype.getEditorOptions=function(){var e=Q.deepClone(this.get_field().editorParams||{});delete e["cascadeFrom"];return Q.extend(e,this.get_field().filteringParams)};i.prototype.loadState=function(i){if(this.useEditor()){if(i==null){return}e.EditorUtils.setValue(this.editor,i);return}t.prototype.loadState.call(this,i)};i.prototype.saveState=function(){if(this.useEditor()){return e.EditorUtils.getValue(this.editor)}return t.prototype.saveState.call(this)};i.prototype.getEditorValue=function(){if(this.useEditor()){var i=e.EditorUtils.getValue(this.editor);if(i==null||typeof i=="string"&&i.trim().length===0)throw this.argumentNull();return i}return t.prototype.getEditorValue.call(this)};i.prototype.initQuickFilter=function(e){t.prototype.initQuickFilter.call(this,e);e.type=this.editorType;e.options=Q.extend(Q.extend({},Q.deepClone(this.getEditorOptions())),Q.deepClone(this.get_field().quickFilterParams))};i=__decorate([o("BaseEditor")],i);return i}(a);e.BaseEditorFiltering=l;var s=function(t){__extends(i,t);function i(){return t.call(this,e.DateEditor)||this}i.prototype.getOperators=function(){return this.appendNullableOperators(this.appendComparisonOperators([]))};i=__decorate([o("Date")],i);return i}(l);e.DateFiltering=s;var u=function(t){__extends(i,t);function i(){return t!==null&&t.apply(this,arguments)||this}i.prototype.getOperators=function(){return this.appendNullableOperators([{key:e.FilterOperators.isTrue},{key:e.FilterOperators.isFalse}])};i=__decorate([o("Boolean")],i);return i}(a);e.BooleanFiltering=u;var c=function(t){__extends(i,t);function i(){return t.call(this,e.DateTimeEditor)||this}i.prototype.getOperators=function(){return this.appendNullableOperators(this.appendComparisonOperators([]))};i.prototype.getCriteria=function(){var i={};switch(this.get_operator().key){case"eq":case"ne":case"lt":case"le":case"gt":case"ge":{{var r=this.getEditorText();i.displayText=this.displayText(this.get_operator(),[r]);var n=Q.parseISODateTime(this.getEditorValue());n=new Date(n.getFullYear(),n.getMonth(),n.getDate());var a=new Date(n.getFullYear(),n.getMonth(),n.getDate()+1);var o=[this.getCriteriaField()];var l=Q.formatDate(n,"yyyy-MM-dd");var s=Q.formatDate(a,"yyyy-MM-dd");switch(this.get_operator().key){case"eq":{i.criteria=e.Criteria.join([o,">=",l],"and",[o,"<",s]);return i}case"ne":{i.criteria=e.Criteria.paren(e.Criteria.join([o,"<",l],"or",[o,">",s]));return i}case"lt":{i.criteria=[o,"<",l];return i}case"le":{i.criteria=[o,"<",s];return i}case"gt":{i.criteria=[o,">=",s];return i}case"ge":{i.criteria=[o,">=",l];return i}}}break}}return t.prototype.getCriteria.call(this)};i=__decorate([o("DateTime")],i);return i}(l);e.DateTimeFiltering=c;var d=function(t){__extends(i,t);function i(){return t.call(this,e.DecimalEditor)||this}i.prototype.getOperators=function(){return this.appendNullableOperators(this.appendComparisonOperators([]))};i=__decorate([o("Decimal")],i);return i}(l);e.DecimalFiltering=d;var f=function(t){__extends(i,t);function i(){return t.call(this,e.Widget)||this}i.prototype.getOperators=function(){var e=[];e.push({key:r.EQ});e.push({key:r.NE});if(this.useRelative){e.push({key:r.LT});e.push({key:r.LE});e.push({key:r.GT});e.push({key:r.GE})}if(this.useLike){e.push({key:r.contains});e.push({key:r.startsWith})}this.appendNullableOperators(e);return e};i.prototype.useEditor=function(){var e=this.get_operator().key;return e===r.EQ||e===r.NE||this.useRelative&&(e===r.LT||e===r.LE||e===r.GT||e===r.GE)};i.prototype.getEditorOptions=function(){var e=t.prototype.getEditorOptions.call(this);if(this.useEditor()&&this.editorType===Q.coalesce(this.get_field().editorType,"String")){e=Q.extend(e,this.get_field().editorParams)}return e};i.prototype.createEditor=function(){var i=this;if(this.useEditor()){var r=e.EditorTypeRegistry.get(this.editorType);this.editor=e.Widget.create({type:r,element:function(e){return e.appendTo(i.get_container())},options:this.getEditorOptions()});return}t.prototype.createEditor.call(this)};i.prototype.useIdField=function(){return this.useEditor()};i.prototype.initQuickFilter=function(i){t.prototype.initQuickFilter.call(this,i);i.type=e.EditorTypeRegistry.get(this.editorType)};__decorate([n()],i.prototype,"editorType",void 0);__decorate([n()],i.prototype,"useRelative",void 0);__decorate([n()],i.prototype,"useLike",void 0);i=__decorate([o("Editor")],i);return i}(l);e.EditorFiltering=f;var p=function(t){__extends(i,t);function i(){return t.call(this,e.EnumEditor)||this}i.prototype.getOperators=function(){var e=[{key:r.EQ},{key:r.NE}];return this.appendNullableOperators(e)};i=__decorate([o("Enum")],i);return i}(l);e.EnumFiltering=p;var h=function(t){__extends(i,t);function i(){return t.call(this,e.IntegerEditor)||this}i.prototype.getOperators=function(){return this.appendNullableOperators(this.appendComparisonOperators([]))};i=__decorate([o("Integer")],i);return i}(l);e.IntegerFiltering=h;var g=function(t){__extends(i,t);function i(){return t.call(this,e.LookupEditor)||this}i.prototype.getOperators=function(){var e=[{key:r.EQ},{key:r.NE},{key:r.contains},{key:r.startsWith}];return this.appendNullableOperators(e)};i.prototype.useEditor=function(){var e=this.get_operator().key;return e==r.EQ||e==r.NE};i.prototype.useIdField=function(){return this.useEditor()};i.prototype.getEditorText=function(){if(this.useEditor()){return this.editor.text}return t.prototype.getEditorText.call(this)};i=__decorate([o("Lookup")],i);return i}(l);e.LookupFiltering=g;var v=function(t){__extends(i,t);function i(){return t.call(this,e.ServiceLookupEditor)||this}i.prototype.getOperators=function(){var e=[{key:r.EQ},{key:r.NE},{key:r.contains},{key:r.startsWith}];return this.appendNullableOperators(e)};i.prototype.useEditor=function(){var e=this.get_operator().key;return e==r.EQ||e==r.NE};i.prototype.useIdField=function(){return this.useEditor()};i.prototype.getEditorText=function(){if(this.useEditor()){return this.editor.text}return t.prototype.getEditorText.call(this)};i=__decorate([o("ServiceLookup")],i);return i}(l);e.ServiceLookupFiltering=v;var y=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.getOperators=function(){var e=[{key:r.contains},{key:r.startsWith},{key:r.EQ},{key:r.NE}];return this.appendNullableOperators(e)};t.prototype.validateEditorValue=function(t){if(t.length===0){return t}return e.prototype.validateEditorValue.call(this,t)};t=__decorate([o("String")],t);return t}(a);e.StringFiltering=y;var m;(function(t){var i;function r(){if(i!=null)return;i={};for(var t=0,r=Q.getTypes();t<r.length;t++){var a=r[t];if(!Q.isAssignableFrom(e.IFiltering,a))continue;var o=Q.getTypeFullName(a).toLowerCase();i[o]=a;for(var l=0,s=Q.Config.rootNamespaces;l<s.length;l++){var u=s[l];if(Q.startsWith(o,u.toLowerCase()+".")){var c=o.substr(u.length+1).toLowerCase();if(i[c]==null){i[c]=a}}}}n()}function n(){var e="filtering";for(var t=0,r=Object.keys(i);t<r.length;t++){var n=r[t];if(!Q.endsWith(n,e))continue;var a=n.substr(0,n.length-e.length);if(Q.isEmptyOrNull(a))continue;if(i[a]!=null)continue;i[a]=i[n]}}function a(){i=null}function o(e){if(Q.isEmptyOrNull(e))throw new Q.ArgumentNullException("key");r();var t=i[e.toLowerCase()];if(t==null)throw new Q.Exception(Q.format("Can't find {0} filter handler type!",e));return t}t.get=o})(m=e.FilteringTypeRegistry||(e.FilteringTypeRegistry={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(i,r){var n=t.call(this,i,r)||this;n.store=new e.FilterStore([]);n.onFilterStoreChanged=function(){return n.filterStoreChanged()};n.store.add_changed(n.onFilterStoreChanged);return n}i.prototype.destroy=function(){if(this.store){this.store.remove_changed(this.onFilterStoreChanged);this.onFilterStoreChanged=null;this.store=null}t.prototype.destroy.call(this)};i.prototype.filterStoreChanged=function(){};i.prototype.get_store=function(){return this.store};i.prototype.set_store=function(t){if(this.store!==t){if(this.store!=null)this.store.remove_changed(this.onFilterStoreChanged);this.store=t||new e.FilterStore([]);this.store.add_changed(this.onFilterStoreChanged);this.filterStoreChanged()}};i=__decorate([e.Decorators.registerClass("Serenity.FilterWidgetBase")],i);return i}(e.TemplatedWidget);e.FilterWidgetBase=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(e,i){var r=t.call(this,e)||this;for(var n=0,a=i;n<a.length;n++){var o=a[n];r.addOption(o.name,Q.coalesce(Q.tryGetText(o.title),Q.coalesce(o.title,o.name)),o)}return r}i.prototype.emptyItemText=function(){if(Q.isEmptyOrNull(this.value)){return Q.text("Controls.FilterPanel.SelectField")}return null};i.prototype.getSelect2Options=function(){var e=t.prototype.getSelect2Options.call(this);e.allowClear=false;return e};i=__decorate([e.Decorators.registerClass("Serenity.FilterFieldSelect")],i);return i}(e.Select2Editor);var i=function(t){__extends(i,t);function i(e,i){var r=t.call(this,e)||this;for(var n=0,a=i;n<a.length;n++){var o=a[n];var l=Q.coalesce(o.title,Q.coalesce(Q.tryGetText("Controls.FilterPanel.OperatorNames."+o.key),o.key));r.addOption(o.key,l,o)}if(i.length&&i[0])r.value=i[0].key;return r}i.prototype.emptyItemText=function(){return null};i.prototype.getSelect2Options=function(){var e=t.prototype.getSelect2Options.call(this);e.allowClear=false;return e};i=__decorate([e.Decorators.registerClass("Serenity.FilterOperatorSelect")],i);return i}(e.Select2Editor);var r=function(r){__extends(n,r);function n(e){var t=r.call(this,e)||this;t.element.addClass("s-FilterPanel");t.rowsDiv=t.byId("Rows");t.initButtons();t.updateButtons();return t}n.prototype.get_showInitialLine=function(){return this.showInitialLine};n.prototype.set_showInitialLine=function(e){if(this.showInitialLine!==e){this.showInitialLine=e;if(this.showInitialLine&&this.rowsDiv.children().length===0){this.addEmptyRow(false)}}};n.prototype.filterStoreChanged=function(){r.prototype.filterStoreChanged.call(this);this.updateRowsFromStore()};n.prototype.updateRowsFromStore=function(){this.rowsDiv.empty();var e=this.get_store().get_items();for(var r=0,n=e;r<n.length;r++){var a=n[r];this.addEmptyRow(false);var o=this.rowsDiv.children().last();var l=o.children("div.l");l.children(".leftparen").toggleClass("active",!!a.leftParen);l.children(".rightparen").toggleClass("active",!!a.rightParen);l.children(".andor").toggleClass("or",!!a.isOr).text(Q.text(!!a.isOr?"Controls.FilterPanel.Or":"Controls.FilterPanel.And"));var s=o.children("div.f").find("input.field-select").getWidget(t);s.value=a.field;this.rowFieldChange(o);var u=o.children("div.o").find("input.op-select").getWidget(i);u.set_value(a.operator);this.rowOperatorChange(o);var c=this.getFilteringFor(o);if(c!=null){c.set_operator({key:a.operator});c.loadState(a.state)}}if(this.get_showInitialLine()&&this.rowsDiv.children().length===0){this.addEmptyRow(false)}this.updateParens()};n.prototype.get_showSearchButton=function(){return this.showSearchButton};n.prototype.set_showSearchButton=function(e){if(this.showSearchButton!==e){this.showSearchButton=e;this.updateButtons()}};n.prototype.get_updateStoreOnReset=function(){return this.updateStoreOnReset};n.prototype.set_updateStoreOnReset=function(e){if(this.updateStoreOnReset!==e){this.updateStoreOnReset=e}};n.prototype.getTemplate=function(){return"<div id='~_Rows' class='filter-lines'>"+"</div>"+"<div id='~_Buttons' class='buttons'>"+"<button id='~_AddButton' class='btn btn-primary add'></button>"+"<button id='~_SearchButton' class='btn btn-success search'></button>"+"<button id='~_ResetButton' class='btn btn-danger reset'></button>"+"</div>"+"<div style='clear: both'>"+"</div>"};n.prototype.initButtons=function(){var e=this;this.byId("AddButton").text(Q.text("Controls.FilterPanel.AddFilter")).click(function(t){return e.addButtonClick(t)});this.byId("SearchButton").text(Q.text("Controls.FilterPanel.SearchButton")).click(function(t){return e.searchButtonClick(t)});this.byId("ResetButton").text(Q.text("Controls.FilterPanel.ResetButton")).click(function(t){return e.resetButtonClick(t)})};n.prototype.searchButtonClick=function(e){e.preventDefault();this.search()};n.prototype.get_hasErrors=function(){return this.rowsDiv.children().children("div.v").children("span.error").length>0};n.prototype.search=function(){this.rowsDiv.children().children("div.v").children("span.error").remove();var e=[];var t=null;var r=null;for(var n=0;n<this.rowsDiv.children().length;n++){r=this.rowsDiv.children().eq(n);var a=this.getFilteringFor(r);if(a==null){continue}var o=this.getFieldFor(r);var l=r.children("div.o").find("input.op-select").getWidget(i).value;if(l==null||l.length===0){t=Q.text("Controls.FilterPanel.InvalidOperator");break}var s={};s.field=o.name;s.operator=l;s.isOr=r.children("div.l").children("a.andor").hasClass("or");s.leftParen=r.children("div.l").children("a.leftparen").hasClass("active");s.rightParen=r.children("div.l").children("a.rightparen").hasClass("active");a.set_operator({key:l});var u=a.getCriteria();s.criteria=u.criteria;s.state=a.saveState();s.displayText=u.displayText;e.push(s)}if(t!=null){$("<span/>").addClass("error").attr("title",t).appendTo(r.children("div.v"));r.children("div.v").find("input:first").focus();return}var c=this.get_store().get_items();c.length=0;c.push.apply(c,e);this.get_store().raiseChanged()};n.prototype.addButtonClick=function(e){this.addEmptyRow(true);e.preventDefault()};n.prototype.resetButtonClick=function(e){e.preventDefault();if(this.get_updateStoreOnReset()){if(this.get_store().get_items().length>0){this.get_store().get_items().length=0;this.get_store().raiseChanged()}}this.rowsDiv.empty();this.updateButtons();if(this.get_showInitialLine()){this.addEmptyRow(false)}};n.prototype.findEmptyRow=function(){var e=null;this.rowsDiv.children().each(function(t,i){var r=$(i).children("div.f").children("input.field-select").first();if(r.length===0){return true}var n=r.val();if(n==null||n.length===0){e=$(i);return false}return true});return e};n.prototype.addEmptyRow=function(e){var i=this;var r=this.findEmptyRow();if(r!=null){r.find("input.field-select").select2("focus");if(e){r.find("input.field-select").select2("open")}return r}var n=this.rowsDiv.children().last().children("a.andor").hasClass("or");var a=$("<div class='filter-line'>"+"<a class='delete'><span></span></a>"+"<div class='l'>"+"<a class='rightparen' href='#'>)</a>"+"<a class='andor' href='#'></a>"+"<a class='leftparen' href='#'>(</a>"+"</div>"+"<div class='f'>"+"<input type='hidden' class='field-select'>"+"</div>"+"<div class='o'></div>"+"<div class='v'></div>"+"<div style='clear: both'></div>"+"</div>").appendTo(this.rowsDiv);var o=a.children("div.l").hide();o.children("a.leftparen, a.rightparen").click(function(e){return i.leftRightParenClick(e)});var l=o.children("a.andor").attr("title",Q.text("Controls.FilterPanel.ChangeAndOr"));if(n){l.addClass("or").text(Q.text("Controls.FilterPanel.Or"))}else{l.text(Q.text("Controls.FilterPanel.And"))}l.click(function(e){return i.andOrClick(e)});a.children("a.delete").attr("title",Q.text("Controls.FilterPanel.RemoveField")).click(function(e){return i.deleteRowClick(e)});var s=new t(a.children("div.f").children("input"),this.get_store().get_fields()).changeSelect2(function(e){return i.onRowFieldChange(e)});this.updateParens();this.updateButtons();a.find("input.field-select").select2("focus");if(e){a.find("input.field-select").select2("open")}return a};n.prototype.onRowFieldChange=function(e){var t=$(e.target).closest("div.filter-line");this.rowFieldChange(t);var i=t.children("div.o").find("input.op-select");i.select2("focus")};n.prototype.rowFieldChange=function(e){e.removeData("Filtering");var i=e.children("div.f").find("input.field-select").getWidget(t);var r=i.get_value();var n=r==null||r==="";this.removeFiltering(e);this.populateOperatorList(e);this.rowOperatorChange(e);this.updateParens();this.updateButtons()};n.prototype.removeFiltering=function(e){e.data("Filtering",null);e.data("FilteringField",null)};n.prototype.populateOperatorList=function(e){var t=this;e.children("div.o").html("");var r=this.getFilteringFor(e);if(r==null)return;var n=e.children("div.o").html("<input/>").children().attr("type","hidden").addClass("op-select");var a=r.getOperators();var o=new i(n,a);o.changeSelect2(function(e){return t.onRowOperatorChange(e)})};n.prototype.getFieldFor=function(e){if(e.length===0){return null}var i=e.children("div.f").find("input.field-select").getWidget(t);if(Q.isEmptyOrNull(i.value)){return null}return this.get_store().get_fieldByName()[i.get_value()]};n.prototype.getFilteringFor=function(t){var i=this.getFieldFor(t);if(i==null)return null;var r=Q.cast(t.data("Filtering"),e.IFiltering);if(r!=null)return r;var n=e.FilteringTypeRegistry.get(Q.coalesce(i.filteringType,"String"));var a=t.children("div.v");r=new n;e.ReflectionOptionsSetter.set(r,i.filteringParams);r.set_container(a);r.set_field(i);t.data("Filtering",r);return r};n.prototype.onRowOperatorChange=function(e){var t=$(e.target).closest("div.filter-line");this.rowOperatorChange(t);var i=t.children("div.v").find(":input:visible").first();try{i.focus()}catch(r){}};n.prototype.rowOperatorChange=function(e){if(e.length===0){return}var t=e.children("div.v");t.html("");var r=this.getFilteringFor(e);if(r==null)return;var n=e.children("div.o").find("input.op-select").getWidget(i);if(Q.isEmptyOrNull(n.get_value()))return;var a=r.getOperators().filter(function(e){return e.key===n.value});var o=a.length>0?a[0]:null;if(o==null)return;r.set_operator(o);r.createEditor()};n.prototype.deleteRowClick=function(e){e.preventDefault();var t=$(e.target).closest("div.filter-line");t.remove();if(this.rowsDiv.children().length===0){this.search()}this.updateParens();this.updateButtons()};n.prototype.updateButtons=function(){this.byId("SearchButton").toggle(this.rowsDiv.children().length>=1&&this.showSearchButton);this.byId("ResetButton").toggle(this.rowsDiv.children().length>=1)};n.prototype.andOrClick=function(e){e.preventDefault();var t=$(e.target).toggleClass("or");t.text(Q.text("Controls.FilterPanel."+(t.hasClass("or")?"Or":"And")))};n.prototype.leftRightParenClick=function(e){e.preventDefault();$(e.target).toggleClass("active");this.updateParens()};n.prototype.updateParens=function(){var e=this.rowsDiv.children();if(e.length===0){return}e.removeClass("paren-start");e.removeClass("paren-end");e.children("div.l").css("display",e.length===1?"none":"block");e.first().children("div.l").children("a.rightparen, a.andor").css("visibility","hidden");for(var t=1;t<e.length;t++){var i=e.eq(t);i.children("div.l").css("display","block").children("a.lefparen, a.andor").css("visibility","visible")}var r=false;for(var n=0;n<e.length;n++){var a=e.eq(n);var o=a.children("div.l");var l=o.children("a.leftparen");var s=o.children("a.rightparen");if(s.hasClass("active")&&r){r=false;if(n>0){e.eq(n-1).addClass("paren-end")}}if(l.hasClass("active")){r=true;if(n>0){a.addClass("paren-start")}}}};return n}(e.FilterWidgetBase);e.FilterPanel=r})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(){var i=t.call(this)||this;i.filterPanel=new e.FilterPanel(i.byId("FilterPanel"));i.filterPanel.set_showInitialLine(true);i.filterPanel.set_showSearchButton(false);i.filterPanel.set_updateStoreOnReset(false);i.dialogTitle=Q.text("Controls.FilterPanel.DialogTitle");return i}i.prototype.get_filterPanel=function(){return this.filterPanel};i.prototype.getTemplate=function(){return'<div id="~_FilterPanel"/>'};i.prototype.getDialogButtons=function(){var e=this;return[{text:Q.text("Dialogs.OkButton"),click:function(){e.filterPanel.search();if(e.filterPanel.get_hasErrors()){Q.notifyError(Q.text("Controls.FilterPanel.FixErrorsMessage"),"",null);return}e.dialogClose()}},{text:Q.text("Dialogs.CancelButton"),click:function(){return e.dialogClose()}}]};i=__decorate([e.Decorators.registerClass("Serenity.FilterDialog")],i);return i}(e.TemplatedDialog);e.FilterDialog=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(i){var r=t.call(this,i)||this;r.element.find(".cap").text(Q.text("Controls.FilterPanel.EffectiveFilter"));r.element.find(".edit").text(Q.text("Controls.FilterPanel.EditFilter"));r.element.find(".reset").attr("title",Q.text("Controls.FilterPanel.ResetFilterHint"));var n=function(t){t.preventDefault();var i=new e.FilterDialog;i.get_filterPanel().set_store(r.get_store());i.dialogOpen(null)};r.element.find(".edit").click(n);r.element.find(".txt").click(n);r.element.find(".reset").click(function(e){e.preventDefault();r.get_store().get_items().length=0;r.get_store().raiseChanged()});return r}i.prototype.filterStoreChanged=function(){t.prototype.filterStoreChanged.call(this);var e=Q.trimToNull(this.get_store().get_displayText());this.element.find(".current").toggle(e!=null);this.element.find(".reset").toggle(e!=null);if(e==null)e=Q.text("Controls.FilterPanel.EffectiveEmpty");this.element.find(".txt").text("["+e+"]")};i.prototype.getTemplate=function(){return"<div><a class='reset'></a><a class='edit'></a>"+"<div class='current'><span class='cap'></span>"+"<a class='txt'></a></div></div>"};i=__decorate([e.Decorators.registerClass("Serenity.FilterDisplayBar")],i);return i}(e.FilterWidgetBase);e.FilterDisplayBar=t})(Serenity||(Serenity={}));var Slick;(function(e){var t;(function(e){function t(e){this.field_=e;this.init=function(){this.count_=0;this.nonNullCount_=0;this.sum_=0};this.accumulate=function(e){var t=e[this.field_];this.count_++;if(t!=null&&t!==""&&!isNaN(t)){this.nonNullCount_++;this.sum_+=parseFloat(t)}};this.storeResult=function(e){if(!e.avg){e.avg={}}if(this.nonNullCount_!=0){e.avg[this.field_]=this.sum_/this.nonNullCount_}}}e.Avg=t;function i(e,t){this.field_=e;this.weightedField_=t;this.init=function(){this.sum_=0;this.weightedSum_=0};this.accumulate=function(e){var t=e[this.field_];var i=e[this.weightedField_];if(this.isValid(t)&&this.isValid(i)){this.weightedSum_+=parseFloat(i);this.sum_+=parseFloat(t)*parseFloat(i)}};this.storeResult=function(e){if(!e.avg){e.avg={}}if(this.sum_&&this.weightedSum_){e.avg[this.field_]=this.sum_/this.weightedSum_}};this.isValid=function(e){return e!==null&&e!==""&&!isNaN(e)}}e.WeightedAvg=i;function r(e){this.field_=e;this.init=function(){this.min_=null};this.accumulate=function(e){var t=e[this.field_];if(t!=null&&t!==""&&!isNaN(t)){if(this.min_==null||t<this.min_){this.min_=t}}};this.storeResult=function(e){if(!e.min){e.min={}}e.min[this.field_]=this.min_}}e.Min=r;function n(e){this.field_=e;this.init=function(){this.max_=null};this.accumulate=function(e){var t=e[this.field_];if(t!=null&&t!==""&&!isNaN(t)){if(this.max_==null||t>this.max_){this.max_=t}}};this.storeResult=function(e){if(!e.max){e.max={}}e.max[this.field_]=this.max_}}e.Max=n;function a(e){this.field_=e;this.init=function(){this.sum_=null};this.accumulate=function(e){var t=e[this.field_];if(t!=null&&t!==""&&!isNaN(t)){this.sum_+=parseFloat(t)}};this.storeResult=function(e){if(!e.sum){e.sum={}}e.sum[this.field_]=this.sum_}}e.Sum=a})(t=e.Aggregators||(e.Aggregators={}))
})(Slick||(Slick={}));var Slick;(function(e){var t=function(){function t(t){var i;var r=this;var n={groupItemMetadataProvider:null,inlineFilters:false};var a;var o=[];var l=[];var s={};var u=null;var c=null;var d=null;var f=0;var p=true;var h;var g;var v={};var y={};var m;var b=[];var C;var _;var S=[];var x={getter:null,formatter:null,comparer:function(e,t){return e.value===t.value?0:e.value>t.value?1:-1},predefinedValues:[],aggregators:[],aggregateEmpty:false,aggregateCollapsed:false,aggregateChildGroups:false,collapsed:false,displayTotalsRow:true,lazyTotalsCalculation:false};var w={};var T=[];var k=[];var I=[];var E=":|:";var D=1;var F=0;var O=new e.Event;var P=new e.Event;var N=new e.Event;var A=new e.Event;var B=new e.Event;var R=new e.Event;var V=new e.Event;var L=new e.Event;var M=new e.Event;var G=false;var q=null;var H=0;var z=0;var W;var U;var j=null;var K=(i=t===null||t===void 0?void 0:t.localSort)!==null&&i!==void 0?i:false;var Y;function J(){f++}function X(){f--;if(f<=0)di()}function Z(e){v=e}function et(e){m=e}function tt(e){e=e||0;var t;for(var i=e,r=o.length;i<r;i++){t=o[i][a];if(t===undefined){var n="Each data element must implement a unique '"+a+"' property. Object at index '"+i+"' "+"has no identity value: ";n+=$.toJSON(o[i]);throw n}s[t]=i}}function it(){var e;for(var t=0,i=o.length;t<i;t++){e=o[t][a];if(e===undefined||s[e]!==t){var r="Each data element must implement a unique '"+a+"' property. Object at index '"+t+"' ";if(e==undefined)r+="has no identity value: ";else r+="has repeated identity value '"+e+"': ";r+=$.toJSON(o[t]);throw r}}}function rt(){return o}function nt(){return a}function at(e,t){if(t!=null&&typeof t=="string")a=t;o=b=e;if(K){o.sort(st())}s={};u=null;w.totals={};tt();it();if(f){ci(o)}else{di()}O.notify({dataView:r},null,r)}function ot(e){var t=false;if(e.rowsPerPage!=undefined&&Y.rowsPerPage!=e.rowsPerPage){Y.rowsPerPage=e.rowsPerPage;t=true}if(e.page!=undefined){var i;if(!Y.rowsPerPage)i=1;else if(j==null)i=e.page;else i=Math.min(e.page,Math.ceil(j/Y.rowsPerPage)+1);if(i<1)i=1;if(i!=D){Y.seekToPage=i;t=true}}if(t)gi()}function lt(){return{rowsPerPage:Y.rowsPerPage,page:D,totalCount:j,loading:G,error:q,dataView:r}}function st(){if(g!=null)return g;var e=[];var t=[];var i=Y.sortBy||[];for(var r=0,n=i;r<n.length;r++){var a=n[r];if(a==null)continue;if(a.length>5&&a.toLowerCase().substr(a.length-5).toLowerCase()==" desc"){t.push(false);e.push(a.substr(0,a.length-5))}else{t.push(true);e.push(a)}}return function(i,r){for(var n=0,a=e.length;n<a;n++){var o=e[n];var l=t[n]?1:-1;var s=i[o],u=r[o];var c=(s==u?0:s>u?1:-1)*l;if(c!=0){return c}}return 0}}function ut(e,t){p=t;h=null;if(t===false){o.reverse()}g=e;o.sort(st());if(t===false){o.reverse()}s={};tt();di()}function ct(){return K}function dt(e){if(K!=e){K=e;ut()}}function ft(e,t){p=t;h=e;g=null;var i=Object.prototype.toString;Object.prototype.toString=typeof e==="function"?e:function(){return this[e]};if(t===false){o.reverse()}o.sort();Object.prototype.toString=i;if(t===false){o.reverse()}s={};tt();di()}function pt(){if(h)ft(h,p);else ut(g,p)}function ht(){return b}function gt(){return c}function vt(e){c=e;if(t.inlineFilters){C=ri();_=ni()}di()}function yt(){return T}function mt(e){e=e||{};w.aggregators=e.aggregators||[];w.compiledAccumulators=[];w.totals={};var t=w.aggregators.length;while(t--){w.compiledAccumulators[t]=ii(w.aggregators[t])}Ct(T||[])}function bt(){w.totals=w.totals||{};if(!w.totals.initialized){w.aggregators=w.aggregators||[];w.compiledAccumulators=w.compiledAccumulators||[];var e,t=w.aggregators.length;while(t--){e=w.aggregators[t];e.init();w.compiledAccumulators[t].call(e,o);e.storeResult(w.totals)}w.totals.initialized=true}return w.totals}function Ct(i){if(!t.groupItemMetadataProvider){t.groupItemMetadataProvider=new e.Data.GroupItemMetadataProvider}k=[];I=[];i=i||[];T=i instanceof Array?i:[i];for(var r=0;r<T.length;r++){var n=T[r]=Q.extend(Q.extend({},x),Q.deepClone(T[r]));n.aggregators=n.aggregators||w.aggregators||[];n.getterIsAFn=typeof n.getter==="function";n.compiledAccumulators=[];var a=n.aggregators.length;while(a--){n.compiledAccumulators[a]=ii(n.aggregators[a])}I[r]={}}di()}function _t(e){return o[e]}function St(e){return s[e]}function xt(){if(!u){u={};for(var e=0,t=l.length;e<t;e++){u[l[e][a]]=e}}}function wt(e){xt();return u[e[a]]}function Qt(e){xt();return u[e]}function Tt(e){return o[s[e]]}function kt(e){var t=[];xt();for(var i=0,r=e.length;i<r;i++){var n=u[e[i][a]];if(n!=null){t[t.length]=n}}return t}function It(e){var t=[];xt();for(var i=0,r=e.length;i<r;i++){var n=u[e[i]];if(n!=null){t[t.length]=n}}return t}function Et(e){var t=[];for(var i=0,r=e.length;i<r;i++){if(e[i]<l.length){t[t.length]=l[e[i]][a]}}return t}function Dt(e,t){if(s[e]===undefined){throw new Error("Invalid id")}if(e!==t[a]){var i=t[a];if(i==null){throw new Error("Cannot update item to associate with a null id")}if(s[i]!==undefined){throw new Error("Cannot update item to associate with a non-unique id")}s[i]=s[e];delete s[e];if(d&&d[e]){delete d[e]}e=i}o[s[e]]=t;if(!d){d={}}d[e]=true;di()}function Ft(e,t){o.splice(e,0,t);tt(e);di()}function Ot(e){o.push(e);tt(o.length-1);di()}function Pt(e){var t=s[e];if(t===undefined){throw"Invalid id"}delete s[e];o.splice(t,1);tt(t);di()}function Nt(e){Ft($t(e),e)}function At(e,t){if(s[e]===undefined||e!==t[a]){throw new Error("Invalid or non-matching id "+s[e])}var i=st();var r=Tt(e);if(i(r,t)!==0){Pt(e);Nt(t)}else{Dt(e,t)}}function $t(e){var t=0,i=o.length;var r=st();while(t<i){var n=t+i>>>1;if(r(o[n],e)===-1){t=n+1}else{i=n}}return t}function Bt(){return l}function Rt(){return l.length}function Vt(e){var t=l[e];if(t&&t.__group&&t.totals&&!t.totals.initialized){var i=T[t.level];if(!i.displayTotalsRow){Jt(t.totals);t.title=i.formatter?i.formatter(t):t.value}}else if(t&&t.__groupTotals&&!t.initialized){Jt(t)}return t}function Lt(e){var i=l[e];if(i===undefined){return null}if(i.__group){return t.groupItemMetadataProvider.getGroupRowMetadata(i)}if(i.__groupTotals){return t.groupItemMetadataProvider.getTotalsRowMetadata(i)}return t.getItemMetadata&&t.getItemMetadata(i,e)||null}function Mt(e,t){if(e==null){for(var i=0;i<T.length;i++){I[i]={};T[i].collapsed=t;if(t===true){B.notify({level:i,groupingKey:null})}else{A.notify({level:i,groupingKey:null})}}}else{I[e]={};T[e].collapsed=t;if(t===true){B.notify({level:e,groupingKey:null})}else{A.notify({level:e,groupingKey:null})}}di()}function Gt(e){Mt(e,true)}function qt(e){Mt(e,false)}function Ht(e){var t=e[0];if(e.length===1&&t.indexOf(E)!==-1){return{level:t.split(E).length-1,groupingKey:t}}else{return{level:e.length-1,groupingKey:e.join(E)}}}function zt(e,t){var i=Ht(e);I[i.level][i.groupingKey]=T[i.level].collapsed^t;if(t)B.notify({level:i.level,groupingKey:i.groupingKey});else A.notify({level:i.level,groupingKey:i.groupingKey});di()}function Wt(e){var t=Array.prototype.slice.call(arguments);zt(t,true)}function Ut(e){var t=Array.prototype.slice.call(arguments);zt(t,false)}function jt(){return k}function Kt(t,i,r,n,a){var o=t[i];if(!o){o=new e.Group;o.value=i;o.level=r;o.groupingKey=(n?n.groupingKey+E:"")+i;a[a.length]=o;t[i]=o}return o}function Yt(e,t){var i;var r;var n=[];var a={};var o;var l=t?t.level+1:0;var s=T[l];for(var u=0,c=s.predefinedValues.length;u<c;u++){r=s.predefinedValues[u];i=Kt(a,r,l,t,n)}for(var u=0,c=e.length;u<c;u++){o=e[u];r=s.getterIsAFn?s.getter(o):o[s.getter];i=Kt(a,r,l,t,n);i.rows[i.count++]=o}if(l<T.length-1){for(var u=0;u<n.length;u++){i=n[u];i.groups=Yt(i.rows,i)}}if(n.length){Zt(n,l)}n.sort(T[l].comparer);return n}function Jt(e){var t=e.group;var i=T[t.level];var r=t.level==T.length;var n,a=i.aggregators.length;if(!r&&i.aggregateChildGroups){var o=t.groups.length;while(o--){if(!t.groups[o].totals.initialized){Jt(t.groups[o].totals)}}}while(a--){n=i.aggregators[a];n.init();if(!r&&i.aggregateChildGroups){i.compiledAccumulators[a].call(n,t.groups)}else{i.compiledAccumulators[a].call(n,t.rows)}n.storeResult(e)}e.initialized=true}function Xt(t){var i=T[t.level];var r=new e.GroupTotals;r.group=t;t.totals=r;if(!i.lazyTotalsCalculation){Jt(r)}}function Zt(e,t){t=t||0;var i=T[t];var r=i.collapsed;var n=I[t];var a=e.length,o;while(a--){o=e[a];if(o.collapsed&&!i.aggregateCollapsed){continue}if(o.groups){Zt(o.groups,t+1)}if(i.aggregators.length&&(i.aggregateEmpty||o.rows.length||o.groups&&o.groups.length)){Xt(o)}o.collapsed=r^n[o.groupingKey];o.title=i.formatter?i.formatter(o):o.value}}function ei(e,t){t=t||0;var i=T[t];var r=[],n,a=0,o;for(var l=0,s=e.length;l<s;l++){o=e[l];r[a++]=o;if(!o.collapsed){n=o.groups?ei(o.groups,t+1):o.rows;for(var u=0,c=n.length;u<c;u++){r[a++]=n[u]}}if(o.totals&&i.displayTotalsRow&&(!o.collapsed||i.aggregateCollapsed)){r[a++]=o.totals}}return r}function ti(e){var t=/^function[^(]*\(([^)]*)\)\s*{([\s\S]*)}$/;var i=e.toString().match(t);return{params:i[1].split(","),body:i[2]}}function ii(e){var t=ti(e.accumulate);var i=new Function("_items","for (var "+t.params[0]+", _i=0, _il=_items.length; _i<_il; _i++) {"+t.params[0]+" = _items[_i]; "+t.body+"}");i.displayName=i.name="compiledAccumulatorLoop";return i}function ri(){var e=ti(c);var t=e.body.replace(/return false\s*([;}]|$)/gi,"{ continue _coreloop; }$1").replace(/return true\s*([;}]|$)/gi,"{ _retval[_idx++] = $item$; continue _coreloop; }$1").replace(/return ([^;}]+?)\s*([;}]|$)/gi,"{ if ($1) { _retval[_idx++] = $item$; }; continue _coreloop; }$2");var i=["var _retval = [], _idx = 0; ","var $item$, $args$ = _args; ","_coreloop: ","for (var _i = 0, _il = _items.length; _i < _il; _i++) { ","$item$ = _items[_i]; ","$filter$; ","} ","return _retval; "].join("");i=i.replace(/\$filter\$/gi,t);i=i.replace(/\$item\$/gi,e.params[0]);i=i.replace(/\$args\$/gi,e.params[1]);var r=new Function("_items,_args",i);r.displayName=r.name="compiledFilter";return r}function ni(){var e=ti(c);var t=e.body.replace(/return false\s*([;}]|$)/gi,"{ continue _coreloop; }$1").replace(/return true\s*([;}]|$)/gi,"{ _cache[_i] = true;_retval[_idx++] = $item$; continue _coreloop; }$1").replace(/return ([^;}]+?)\s*([;}]|$)/gi,"{ if ((_cache[_i] = $1)) { _retval[_idx++] = $item$; }; continue _coreloop; }$2");var i=["var _retval = [], _idx = 0; ","var $item$, $args$ = _args; ","_coreloop: ","for (var _i = 0, _il = _items.length; _i < _il; _i++) { ","$item$ = _items[_i]; ","if (_cache[_i]) { ","_retval[_idx++] = $item$; ","continue _coreloop; ","} ","$filter$; ","} ","return _retval; "].join("");i=i.replace(/\$filter\$/gi,t);i=i.replace(/\$item\$/gi,e.params[0]);i=i.replace(/\$args\$/gi,e.params[1]);var r=new Function("_items,_args,_cache",i);var n="compiledFilterWithCaching";r.displayName=n;r.name=ai(r,n);return r}function ai(e,t){try{Object.defineProperty(e,"name",{writable:true,value:t})}catch(i){e.name=t}}function oi(e,t){var i=[],r=0;for(var n=0,a=e.length;n<a;n++){if(c(e[n],t)){i[r++]=e[n]}}return i}function li(e,t,i){var r=[],n=0,a;for(var o=0,l=e.length;o<l;o++){a=e[o];if(i[o]){r[n++]=a}else if(c(a,t)){r[n++]=a;i[o]=true}}return r}function si(e){if(c){var i=t.inlineFilters?C:oi;var r=t.inlineFilters?_:li;if(v.isFilterNarrowing){b=i(b,m)}else if(v.isFilterExpanding){b=r(e,m,S)}else if(!v.isFilterUnchanged){b=i(e,m)}}else{b=e.concat()}return{totalRows:b.length,rows:b}}function ui(e,t){var i,r,n,o=[];var l=0,s=t.length;if(v&&v.ignoreDiffsBefore){l=Math.max(0,Math.min(t.length,v.ignoreDiffsBefore))}if(v&&v.ignoreDiffsAfter){s=Math.min(t.length,Math.max(0,v.ignoreDiffsAfter))}for(var u=l,c=e.length;u<s;u++){if(u>=c){o[o.length]=u}else{i=t[u];r=e[u];if(T.length&&(n=i.__nonDataRow||r.__nonDataRow)&&i.__group!==r.__group||i.__group&&!i.equals(r)||n&&(i.__groupTotals||r.__groupTotals)||i[a]!=r[a]||d&&d[i[a]]){o[o.length]=u}}}return o}function ci(e){u=null;if(v.isFilterNarrowing!=y.isFilterNarrowing||v.isFilterExpanding!=y.isFilterExpanding){S=[]}var t=si(e);F=t.totalRows;var i=t.rows;w.totals={};k=[];if(T.length){k=Yt(i);if(k.length){i=ei(k)}}var r=ui(l,i);l=i;return r}function di(){if(f){return}var e=l.length;var t=F;var i=ci(o);d=null;y=v;v={};if(t!==F){R.notify(lt(),null,r)}if(e!==l.length){V.notify({previous:e,current:l.length,dataView:r},null,r)}if(i.length>0){L.notify({rows:i,dataView:r},null,r)}if(e!==l.length||i.length>0){M.notify({rowsDiff:i,previousRowCount:e,currentRowCount:l.length,rowCountChanged:e!==l.length,rowsChanged:i.length>0,dataView:r},null,r)}}function fi(t,i,r){var n=this;var a;var o=n.mapRowsToIds(t.getSelectedRows());var l=new e.Event;function s(i){if(o.join(",")==i.join(",")){return}o=i;l.notify({grid:t,ids:o,dataView:n},new e.EventData,n)}function u(){if(o.length>0){a=true;var e=n.mapIdsToRows(o);if(!i){s(n.mapRowsToIds(e))}t.setSelectedRows(e);a=false}}t.onSelectedRowsChanged.subscribe(function(e,i){if(a){return}var l=n.mapRowsToIds(t.getSelectedRows());if(!r||!t.getOptions().multiSelect){s(l)}else{var u=$.grep(o,function(e){return n.getRowById(e)===undefined});s(u.concat(l))}});this.onRowsChanged.subscribe(u);this.onRowCountChanged.subscribe(u);return l}function pi(e,t){var i;var r;n(e.getCellCssStyles(t));function n(e){i={};for(var t in e){var r=l[t][a];i[r]=e[t]}}function o(){if(i){r=true;xt();var n={};for(var a in i){var o=u[a];if(o!=undefined){n[o]=i[a]}}e.setCellCssStyles(t,n);r=false}}var s=function(i,a){if(r){return}if(t!=a.key){return}if(a.hash){n(a.hash)}else{e.onCellCssStylesChanged.unsubscribe(s);M.unsubscribe(o)}};e.onCellCssStylesChanged.subscribe(s);M.subscribe(o)}function hi(e){if(Y.onProcessData&&e)e=Y.onProcessData(e,Y)||e;q=null;G&&G.abort();G=false;if(!e){q=Y.errormsg;R.notify(lt());return false}e.TotalCount=e.TotalCount||0;e.Entities=e.Entities||[];if(!e.Skip||!Y.rowsPerPage&&!e.Take)e.Page=1;else e.Page=Math.ceil(e.Skip/(e.Take||Y.rowsPerPage))+1;D=e.Page;j=e.TotalCount;at(e.Entities);R.notify(lt())}function gi(){if(H>0){z++;return}z=0;G&&G.abort();if(Y.onSubmit){var e=Y.onSubmit(Y);if(e===false)return false}P.notify(this);if(!Y.url)return false;if(!Y.seekToPage)Y.seekToPage=1;var t={};var i=(Y.seekToPage-1)*Y.rowsPerPage;if(i)t.Skip=i;if(Y.rowsPerPage)t.Take=Y.rowsPerPage;if(Y.sortBy&&Y.sortBy.length){if(typeof Y.sortBy!=="string")t.Sort=Y.sortBy;else{t.Sort=[Y.sortBy]}}if(Y.params){t=Q.extend(t,Y.params)}var r=U;var n={cache:false,type:Y.method,contentType:W,url:Y.url,data:t,dataType:r,success:function(e){G=false;if(e.Error)Q.notifyError(e.Error.Message||e.Error.Code);else hi(e);N.notify(this)},error:function(e,t,i){G=false;if((e.getResponseHeader("content-type")||"").toLowerCase().indexOf("application/json")>=0){var r=$.parseJSON(e.responseText);if(r!=null&&r.Error!=null){Q.notifyError(r.Error.Message||r.Error.Code);R.notify(lt());N.notify(this);return}}q=e.errormsg;R.notify(lt());N.notify(this)},complete:function(){G=false}};if(Y.onAjaxCall){var a=Y.onAjaxCall(this,n);if(a===false){G=false;R.notify(lt());return false}}n.data=$.toJSON(n.data);R.notify(lt());G=$.ajax(n)}function vi(){if(H==0)z=0;H++}function yi(){if(H>0){H--;if(H==0&&z>0)gi()}}Y={beginUpdate:J,endUpdate:X,setPagingOptions:ot,getPagingInfo:lt,getIdPropertyName:nt,getRows:Bt,getItems:rt,setItems:at,getFilter:gt,getFilteredItems:ht,setFilter:vt,sort:ut,fastSort:ft,reSort:pt,getLocalSort:ct,setLocalSort:dt,setSummaryOptions:mt,getGrandTotals:bt,setGrouping:Ct,getGrouping:yt,collapseAllGroups:Gt,expandAllGroups:qt,collapseGroup:Wt,expandGroup:Ut,getGroups:jt,getIdxById:St,getRowByItem:wt,getRowById:Qt,getItemById:Tt,getItemByIdx:_t,mapItemsToRows:kt,mapRowsToIds:Et,mapIdsToRows:It,setRefreshHints:Z,setFilterArgs:et,refresh:di,updateItem:Dt,insertItem:Ft,addItem:Ot,deleteItem:Pt,sortedAddItem:Nt,sortedUpdateItem:At,syncGridSelection:fi,syncGridCellCssStyles:pi,getLength:Rt,getItem:Vt,getItemMetadata:Lt,onRowCountChanged:V,onRowsChanged:L,onRowsOrCountChanged:M,onPagingInfoChanged:R,onGroupExpanded:A,onGroupCollapsed:B,addData:hi,populate:gi,populateLock:vi,populateUnlock:yi,onDataChanged:O,onDataLoaded:N,onDataLoading:P};a=t.idField||"id";W=t.contentType||"application/json";U=t.dataType||"json";c=t.filter||null;Y.params=t.params||{};Y.onSubmit=t.onSubmit||null;Y.url=t.url||null;Y.rowsPerPage=t.rowsPerPage||0;Y.seekToPage=t.seekToPage||1;Y.onAjaxCall=t.onAjaxCall||null;Y.onProcessData=t.onProcessData||null;Y.method=t.method||"POST";Y.errormsg=Y.errormsg||Q.text("Controls.Pager.DefaultLoadError");Y.sortBy=typeof t.sortBy=="string"?[t.sortBy]:t.sortBy||[];Y.idField=a;if(t.url&&t.autoLoad){gi()}return Y}return t}();e.RemoteView=t})(Slick||(Slick={}));var Serenity;(function(e){var t=function(e){__extends(t,e);function t(t,i){var r=e.call(this,t,Q.extend({showRowsPerPage:true,rowsPerPageOptions:[20,100,500,2e3]},i))||this;i=r.options;var n=i.view;if(!n)throw"SlickPager requires view option to be set!";r.element.addClass("s-SlickPager slick-pg").html('<div class="slick-pg-in">'+'<div class="slick-pg-grp">'+'<div class="slick-pg-first slick-pg-btn"><span class="slick-pg-btn-span"></span></div>'+'<div class="slick-pg-prev slick-pg-btn"><span class="slick-pg-btn-span"></span></div>'+'</div><div class="slick-pg-sep"></div><div class="slick-pg-grp">'+'<span class="slick-pg-control">&nbsp;'+Q.text("Controls.Pager.Page")+'&nbsp;<input class="slick-pg-current" type="text" size="4" value="1" /> / '+'<span class="slick-pg-total"> 1 </span></span>'+'</div><div class="slick-pg-sep"></div><div class="slick-pg-grp">'+'<div class="slick-pg-next slick-pg-btn"><span class="slick-pg-btn-span"></span></div>'+'<div class="slick-pg-last slick-pg-btn"><span class="slick-pg-btn-span"></span></div>'+'</div><div class="slick-pg-sep"></div><div class="slick-pg-grp">'+'<div class="slick-pg-reload slick-pg-btn"><span class="slick-pg-btn-span"></span></div>'+'</div><div class="slick-pg-sep"></div>'+'<div class="slick-pg-grp"><span class="slick-pg-stat"></span></div></div>');var a=r;$(".slick-pg-reload",r.element).click(function(){n.populate()});$(".slick-pg-first",r.element).click(function(){a._changePage("first")});$(".slick-pg-prev",r.element).click(function(){a._changePage("prev")});$(".slick-pg-next",r.element).click(function(){a._changePage("next")});$(".slick-pg-last",r.element).click(function(){a._changePage("last")});$(".slick-pg-current",r.element).keydown(function(e){if(e.keyCode==13)a._changePage("input")});if(a.options.showRowsPerPage){var o,l="";for(var s=0;s<i.rowsPerPageOptions.length;s++){if(n.rowsPerPage==i.rowsPerPageOptions[s])l='selected="selected"';else l="";o+="<option value='"+i.rowsPerPageOptions[s]+"' "+l+" >"+i.rowsPerPageOptions[s]+"&nbsp;&nbsp;</option>"}$(".slick-pg-in",r.element).prepend('<div class="slick-pg-grp"><select class="slick-pg-size" name="rp">'+o+'</select></div><div class="slick-pg-sep"></div>');$("select.slick-pg-size",r.element).change(function(){if(i.onRowsPerPageChange)i.onRowsPerPageChange(+this.value);else{n["newp"]=1;n.setPagingOptions({page:1,rowsPerPage:+this.value})}})}n.onPagingInfoChanged.subscribe(function(){a._updatePager()});return r}t.prototype._changePage=function(e){var t=this.options.view;if(!t||t.loading)return true;var i=t.getPagingInfo();var r=!i.rowsPerPage||!i.totalCount?1:Math.ceil(i.totalCount/i.rowsPerPage);var n;switch(e){case"first":n=1;break;case"prev":if(i.page>1)n=parseInt(i.page)-1;break;case"next":if(i.page<r)n=parseInt(i.page)+1;break;case"last":n=r;break;case"input":var a=parseInt($("input.slick-pg-current",this.element).val());if(isNaN(a))a=1;else if(a<1)a=1;else if(a>r)a=r;$(".slick-pg-current",this.element).val(a);n=a;break}if(n==i.page)return false;if(this.options.onChangePage)this.options.onChangePage(n);else{t.setPagingOptions({page:n})}};t.prototype._updatePager=function(){var e=this.options.view;var t=e.getPagingInfo();var i=!t.rowsPerPage||!t.totalCount?1:Math.ceil(t.totalCount/t.rowsPerPage);$(".slick-pg-current",this.element).val(t.page);$(".slick-pg-total",this.element).html(i);var r=(t.page-1)*t.rowsPerPage+1;var n=r+t.rowsPerPage-1;if(t.totalCount<n)n=t.totalCount;var a;if(t.loading){a=Q.text("Controls.Pager.LoadingStatus")}else if(t.error){a=t.error}else if(t.totalCount>0){a=Q.text("Controls.Pager.PageStatus");a=a.replace(/{from}/,r);a=a.replace(/{to}/,n);a=a.replace(/{total}/,t.totalCount)}else a=Q.text("Controls.Pager.NoRowStatus");$(".slick-pg-stat",this.element).html(a);$(".slick-pg-size",this.element).val((t.rowsPerPage||0).toString())};return t}(e.Widget);e.SlickPager=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(){function t(e,t){var i=this;this.include={};this.grid=e;this.idField=e.getView().idField;this.options=t||{};e.getGrid().onClick.subscribe(function(t,r){if($(t.target).hasClass("select-item")){t.preventDefault();var n=e.getView().getItem(r.row);var a=n[i.idField].toString();if(i.include[a]){delete i.include[a]}else{i.include[a]=true}for(var o=0;o<e.getView().getLength();o++){e.getGrid().updateRow(o)}i.updateSelectAll()}});e.getGrid().onHeaderClick.subscribe(function(t,r){if(t.isDefaultPrevented()){return}if($(t.target).hasClass("select-all-items")){t.preventDefault();var n=e.getView();if(Object.keys(i.include).length>0){Q.clearKeys(i.include)}else{var a=e.getView().getItems();for(var o=0,l=a.filter(i.isSelectable.bind(i));o<l.length;o++){var s=l[o];var u=s[i.idField];i.include[u]=true}}i.updateSelectAll();e.getView().setItems(e.getView().getItems(),true)}});e.getView().onRowsChanged.subscribe(function(){return i.updateSelectAll()})}t.prototype.updateSelectAll=function(){var e=this.grid.getElement().find(".select-all-header .slick-column-name .select-all-items");if(e){var t=Object.keys(this.include);e.toggleClass("checked",t.length>0&&this.grid.getView().getItems().filter(this.isSelectable.bind(this)).length<=t.length)}};t.prototype.clear=function(){Q.clearKeys(this.include);this.updateSelectAll()};t.prototype.resetCheckedAndRefresh=function(){this.include={};this.updateSelectAll();this.grid.getView().populate()};t.prototype.selectKeys=function(e){for(var t=0,i=e;t<i.length;t++){var r=i[t];this.include[r]=true}this.updateSelectAll()};t.prototype.getSelectedKeys=function(){return Object.keys(this.include)};t.prototype.getSelectedAsInt32=function(){return Object.keys(this.include).map(function(e){return parseInt(e,10)})};t.prototype.getSelectedAsInt64=function(){return Object.keys(this.include).map(function(e){return parseInt(e,10)})};t.prototype.setSelectedKeys=function(e){this.clear();for(var t=0,i=e;t<i.length;t++){var r=i[t];this.include[r]=true}this.updateSelectAll()};t.prototype.isSelectable=function(e){return e&&(this.options.selectable==null||this.options.selectable(e))};t.createSelectColumn=function(e){return{name:'<span class="select-all-items check-box no-float "></span>',toolTip:" ",field:"__select__",width:27,minWidth:27,headerCssClass:"select-all-header",sortable:false,format:function(t){var i=t.item;var r=e();if(!r||!r.isSelectable(i)){return""}var n=r.include[t.item[r.idField]];return'<span class="select-item check-box no-float '+(n?" checked":"")+'"></span>'}}};t=__decorate([e.Decorators.registerClass("Serenity.GridRowSelectionMixin")],t);return t}();e.GridRowSelectionMixin=t;var i=function(){function t(e,t){var i=this;this.include={};this.grid=e;this.idField=e.getView().idField;this.options=t||{};e.getGrid().onClick.subscribe(function(t,r){if($(t.target).hasClass("rad-select-item")){t.preventDefault();var n=e.getView().getItem(r.row);if(!i.isSelectable(n)){return}var a=n[i.idField].toString();if(i.include[a]==true){Q.clearKeys(i.include)}else{Q.clearKeys(i.include);i.include[a]=true}for(var o=0;o<e.getView().getLength();o++){e.getGrid().updateRow(o)}}})}t.prototype.isSelectable=function(e){return e&&(this.options.selectable==null||this.options.selectable(e))};t.prototype.clear=function(){Q.clearKeys(this.include)};t.prototype.resetCheckedAndRefresh=function(){this.include={};this.grid.getView().populate()};t.prototype.getSelectedKey=function(){var e=Object.keys(this.include);if(e!=null&&e.length>0){return e[0]}return null};t.prototype.getSelectedAsInt32=function(){var e=Object.keys(this.include).map(function(e){return parseInt(e,10)});if(e!=null&&e.length>0){return e[0]}return null};t.prototype.getSelectedAsInt64=function(){var e=Object.keys(this.include).map(function(e){return parseInt(e,10)});if(e!=null&&e.length>0){return e[0]}return null};t.prototype.setSelectedKey=function(e){this.clear();this.include[e]=true};t.createSelectColumn=function(e){return{name:"",toolTip:" ",field:"__select__",width:27,minWidth:27,headerCssClass:"",sortable:false,formatter:function(t,i,r,n,a){var o=e();if(!o||!o.isSelectable(a)){return""}var l=o.include[a[o.idField]];return'<input type="radio" name="radio-selection-group" class="rad-select-item no-float" style="cursor: pointer;width: 13px; height:13px;" '+(l?" checked":"")+" /> "}}};t=__decorate([e.Decorators.registerClass("Serenity.GridRadioSelectionMixin")],t);return t}();e.GridRadioSelectionMixin=i;var r;(function(t){function i(t,i){var r=t.element.children(".s-Toolbar");if(r.length===0){return}var n=r.getWidget(e.Toolbar).findButton("select-all-button");var a=t.getView().getItems();n.toggleClass("checked",a.length>0&&!a.some(function(e){return!i(e)}))}t.update=i;function r(t,i,r,n,a,o){if(a==null){a=Q.coalesce(Q.tryGetText("Controls.CheckTreeEditor.SelectAll"),"Select All")}return{title:a,cssClass:"select-all-button",onClick:function(){var r=t();var a=r.getView();var l=r.element.children(".s-Toolbar").getWidget(e.Toolbar).findButton("select-all-button");var s=!l.hasClass("checked");a.beginUpdate();try{for(var u=0,c=a.getItems();u<c.length;u++){var d=c[u];n(d,s);a.updateItem(i(d),d)}o&&o()}finally{a.endUpdate()}l.toggleClass("checked",s)}}}t.define=r})(r=e.GridSelectAllButtonHelper||(e.GridSelectAllButtonHelper={}));var n;(function(t){function i(e,t,i,r,n){var a=$('<div><a href="#"></a></div>').addClass("s-ToggleButton").addClass(t).prependTo(e);a.children("a").click(function(e){e.preventDefault();a.toggleClass("pressed");var t=a.hasClass("pressed");i&&i(t)}).attr("title",Q.coalesce(r,""));if(n){a.addClass("pressed")}}t.addToggleButton=i;function r(e,t,r,n){var a=false;var o=t.onSubmit;t.onSubmit=function(e){e.params.IncludeDeleted=a;if(o!=null){return o(e)}return true};if(r==null)r=Q.text("Controls.EntityGrid.IncludeDeletedToggle");i(e,"s-IncludeDeletedToggle",function(e){a=e;t.seekToPage=1;t.populate()},r,n);e.bind("remove",function(){t.onSubmit=null;o=null})}t.addIncludeDeletedToggle=r;function n(e,t,i,r){var n=t.onSubmit;var o;t.onSubmit=function(e){var t;if(o){var i=o.get_value();if(i&&i.length>0){e.params.ContainsText=i}else{delete e.params["ContainsText"]}var r=(t=o.get_field())===null||t===void 0?void 0:t.name;if(r!=null&&r.length>0){e.params.ContainsField=r}else{delete e.params["ContainsField"]}}if(n!=null)return n(e);return true};var l=null;o=a(e,function(e,i,n){r&&r();t.seekToPage=1;l=n;t.populate()},i);t.onDataLoaded.subscribe(function(e,i){if(l!=null){l(t.getLength()>0);l=null}})}t.addQuickSearchInput=n;function a(t,i,r){var n=$('<div><input type="text"/></div>').addClass("s-QuickSearchBar").prependTo(t);if(r!=null&&r.length>0){n.addClass("has-quick-search-fields")}return new e.QuickSearchInput(n.children(),{fields:r,onSearch:i})}t.addQuickSearchInputCustom=a;function o(e,t){var i=new Slick.RowMoveManager({cancelEditOnDrag:true});i.onBeforeMoveRows.subscribe(function(e,t){for(var i=0;!!(i<t.rows.length);i++){if(!!(t.rows[i]===t.insertBefore||t.rows[i]===t.insertBefore-1)){e.stopPropagation();return false}}return true});i.onMoveRows.subscribe(function(i,r){t(r.rows,r.insertBefore);try{e.setSelectedRows([])}catch(n){}});e.registerPlugin(i)}t.makeOrderable=o;function l(e,t,i,r,n){o(e.slickGrid,function(a,o){if(a.length===0){return}var l;var s=o;if(s<0){l=1}else if(o>=e.rowCount()){l=Q.coalesce(i(e.itemAt(e.rowCount()-1)),0);if(l===0){l=o+1}else{l=l+1}}else{l=Q.coalesce(i(e.itemAt(o)),0);if(l===0){l=o+1}}var u=0;var c=null;c=function(){Q.serviceCall({service:r,request:n(t(e.itemAt(a[u])),l++),onSuccess:function(t){u++;if(u<a.length){c()}else{e.view.populate()}}})};c()})}t.makeOrderableWithUpdateRequest=l})(n=e.GridUtils||(e.GridUtils={}));var a;(function(t){function i(e){var t=[];if(e==null){return t}for(var i=0;i<e.length;i++){t.push(r(e[i]))}return t}t.toSlickColumns=i;function r(t){var i={field:t.name,sourceItem:t,cssClass:t.cssClass,headerCssClass:t.headerCssClass,sortable:t.sortable!==false,sortOrder:Q.coalesce(t.sortOrder,0),width:t.width!=null?t.width:80,minWidth:Q.coalesce(t.minWidth,30),maxWidth:t.maxWidth==null||t.maxWidth===0?null:t.maxWidth,resizable:t.resizable==null||!!t.resizable};i.visible=t.visible!==false&&t.filterOnly!==true&&(t.readPermission==null||Q.Authorization.hasPermission(t.readPermission));var r=Q.tryGetText(t.title);if(r==null)r=t.title;i.name=r;if(t.alignment!=null&&t.alignment.length>0){if(!Q.isEmptyOrNull(i.cssClass)){i.cssClass+=" align-"+t.alignment}else{i.cssClass="align-"+t.alignment}}if(t.formatterType!=null&&t.formatterType.length>0){var n=e.FormatterTypeRegistry.get(t.formatterType);var a=new n;if(t.formatterParams!=null){e.ReflectionOptionsSetter.set(a,t.formatterParams)}var o=Q.safeCast(a,e.IInitializeColumn);if(o!=null){o.initializeColumn(i)}i.format=function(e){return a.format(e)}}return i}t.toSlickColumn=r})(a=e.PropertyItemSlickConverter||(e.PropertyItemSlickConverter={}));var o;(function(t){function i(t,i){return e.EnumFormatter.getText(t,i)}t.getEnumText=i;function r(e,t,i){return function(r){var n=i(r);var a=e();var o=Q.coalesce(r.item._indent,0);var l='<span class="s-TreeIndent" style="width:'+15*o+'px"></span>';var s=t(r.item);var u=a.getIdxById(s);var c=a.getItemByIdx(u+1);if(c!=null){var d=Q.coalesce(c._indent,0);if(d>o){if(!!!!r.item._collapsed){return l+'<span class="s-TreeToggle s-TreeExpand"></span>'+n}else{return l+'<span class="s-TreeToggle s-TreeCollapse"></span>'+n}}}return l+'<span class="s-TreeToggle"></span>'+n}}t.treeToggle=r;function n(t){if(t==null){t=Q.Culture.dateFormat}return function(i){return Q.htmlEncode(e.DateFormatter.format(i.value,t))}}t.date=n;function a(t){if(t==null){t=Q.Culture.dateTimeFormat}return function(i){return Q.htmlEncode(e.DateFormatter.format(i.value,t))}}t.dateTime=a;function o(){return function(e){return'<span class="check-box no-float '+(!!e.value?" checked":"")+'"></span>'}}t.checkBox=o;function l(t){return function(i){return e.NumberFormatter.format(i.value,t)}}t.number=l;function s(e){return e.data("item-type")}t.getItemType=s;function u(e){var t=e.data("item-id");return t==null?null:t.toString()}t.getItemId=u;function c(e,t,i,r,n){return"<a"+(t!=null?' href="#'+Q.replaceAll(e,".","-")+"/"+t+'"':"")+' data-item-type="'+Q.attrEncode(e)+'"'+' data-item-id="'+Q.attrEncode(t)+'"'+' class="s-EditLink s-'+Q.replaceAll(e,".","-")+"Link"+(Q.isEmptyOrNull(r)?"":" "+r)+'">'+(n?Q.htmlEncode(Q.coalesce(i,"")):Q.coalesce(i,""))+"</a>"}t.itemLinkText=c;function d(e,t,i,r,n){return function(a){return c(e,a.item[t],i==null?a.value:i(a),r==null?"":r(a),n)}}t.itemLink=d})(o=e.SlickFormatting||(e.SlickFormatting={}));var l;(function(e){function t(e,t){for(var r=0,n=e;r<n.length;r++){var a=n[r];a.sortable=a.sortable!=null?a.sortable:true;var o=a.id;if(o==null){o=a.field}a.id=o;if(t!=null&&a.id!=null&&(a.name==null||Q.startsWith(a.name,"~"))){var l=a.name!=null?a.name.substr(1):a.id;a.name=Q.text(t+l)}if(a.formatter==null&&a.format!=null){a.formatter=i(a.format)}else if(a.formatter==null){a.formatter=function(e,t,i,r,n){return Q.htmlEncode(i)}}}return e}e.setDefaults=t;function i(e){if(e==null){return null}else{return function(t,i,r,n,a){return e({row:t,cell:i,value:r,column:n,item:a})}}}e.convertToFormatter=i})(l=e.SlickHelper||(e.SlickHelper={}));var s;(function(e){function t(e,t){var i=t(e);var r=0;while(i!=null){if(!!i._collapsed){return false}i=t(i);if(r++>1e3){throw new Error("Possible infinite loop, check parents has no circular reference!")}}return true}e.filterCustom=t;function i(e,i,r){return t(e,function(e){var t=r(e);if(t==null){return null}return i.getItemById(t)})}e.filterById=i;function r(e,t){if(e!=null){for(var i=0,r=e;i<r.length;i++){var n=r[i];n._collapsed=t}}}e.setCollapsed=r;function n(e,t){e._collapsed=t
}e.setCollapsedFlag=n;function a(e,t,i,r){var n=0;var a={};for(var o=0;o<e.length;o++){var l=e[o];if(o>0){var s=i(l);if(s!=null&&s===t(e[o-1])){n+=1}else if(s==null){n=0}else if(s!==i(e[o-1])){if(a[s]!=null){n=a[s]+1}else{n=0}}}a[t(l)]=n;l._indent=n;if(r!=null){l._collapsed=r}}}e.setIndents=a;function o(e,t,i,n,a){var o=$(e.target);if(!o.hasClass("s-TreeToggle")){return}if(o.hasClass("s-TreeCollapse")||o.hasClass("s-TreeExpand")){var l=n.getItem(t);if(l!=null){if(!!!l._collapsed){l._collapsed=true}else{l._collapsed=false}n.updateItem(a(l),l)}if(e.shiftKey){n.beginUpdate();try{r(n.getItems(),!!l._collapsed);n.setItems(n.getItems(),true)}finally{n.endUpdate()}}}}e.toggleClick=o})(s=e.SlickTreeHelper||(e.SlickTreeHelper={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(){function t(){}t=__decorate([e.Decorators.registerInterface("Serenity.IInitializeColumn")],t);return t}();e.IInitializeColumn=t;var i=e.Decorators.option;function r(t,i){return e.Decorators.registerFormatter("Serenity."+t+"Formatter",i)}var n=function(){function e(){}e.prototype.format=function(e){if(e.value==null){return""}var t;if(!!e.value){t=Q.tryGetText(this.trueText);if(t==null){t=this.trueText;if(t==null){t=Q.coalesce(Q.tryGetText("Dialogs.YesButton"),"Yes")}}}else{t=Q.tryGetText(this.falseText);if(t==null){t=this.falseText;if(t==null){t=Q.coalesce(Q.tryGetText("Dialogs.NoButton"),"No")}}}return Q.htmlEncode(t)};__decorate([i()],e.prototype,"falseText",void 0);__decorate([i()],e.prototype,"trueText",void 0);e=__decorate([r("Boolean")],e);return e}();e.BooleanFormatter=n;var a=function(){function e(){}e.prototype.format=function(e){return'<span class="check-box no-float readonly '+(!!e.value?" checked":"")+'"></span>'};e=__decorate([r("Checkbox")],e);return e}();e.CheckboxFormatter=a;var o=function(){function e(){this.displayFormat=Q.Culture.dateFormat}t=e;e.format=function(e,t){if(e==null){return""}var i;if(e instanceof Date){i=e}else if(typeof e==="string"){i=Q.parseISODateTime(e);if(i==null){return Q.htmlEncode(e)}}else{return e.toString()}return Q.htmlEncode(Q.formatDate(i,t))};e.prototype.format=function(e){return t.format(e.value,this.displayFormat)};var t;__decorate([i()],e.prototype,"displayFormat",void 0);e=t=__decorate([r("Date")],e);return e}();e.DateFormatter=o;var l=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.displayFormat=Q.Culture.dateTimeFormat;return t}t=__decorate([r("DateTime")],t);return t}(o);e.DateTimeFormatter=l;var s=function(){function t(){}n=t;t.prototype.format=function(t){return n.format(e.EnumTypeRegistry.get(this.enumKey),t.value)};t.format=function(t,i){if(i==null){return""}var r=Q.Enum.toString(t,i);var a=Q.getAttributes(t,e.EnumKeyAttribute,false);var o=a.length>0?a[0].value:Q.getTypeFullName(t);return n.getText(o,r)};t.getText=function(e,t){if(Q.isEmptyOrNull(t)){return""}return Q.htmlEncode(Q.coalesce(Q.tryGetText("Enums."+e+"."+t),t))};t.getName=function(e,t){if(t==null){return""}return Q.Enum.toString(e,t)};var n;__decorate([i()],t.prototype,"enumKey",void 0);t=n=__decorate([r("Enum")],t);return t}();e.EnumFormatter=s;var u=function(){function n(){}a=n;n.prototype.format=function(e){var t=Q.safeCast(e.value,String);if(Q.isEmptyOrNull(t)){return""}var i=a.dbFileUrl(t);var r=!Q.isEmptyOrNull(this.originalNameProperty)?Q.safeCast(e.item[this.originalNameProperty],String):null;r=Q.coalesce(r,"");var n=Q.format(Q.coalesce(this.displayFormat,"{0}"),r,t,i);return"<a class='file-download-link' target='_blank' href='"+Q.attrEncode(i)+"'>"+Q.htmlEncode(n)+"</a>"};n.dbFileUrl=function(e){e=Q.replaceAll(Q.coalesce(e,""),"\\","/");return Q.resolveUrl("~/upload/")+e};n.prototype.initializeColumn=function(e){e.referencedFields=e.referencedFields||[];if(!Q.isEmptyOrNull(this.originalNameProperty)){e.referencedFields.push(this.originalNameProperty);return}};var a;__decorate([i()],n.prototype,"displayFormat",void 0);__decorate([i()],n.prototype,"originalNameProperty",void 0);n=a=__decorate([r("FileDownload",[e.ISlickFormatter,t])],n);return n}();e.FileDownloadFormatter=u;var c=function(){function e(){}t=e;e.prototype.format=function(e){return t.format(e.value)};e.format=function(e){var t=Math.floor(e/60);var i=e-t*60;var r,n;if(e==null||isNaN(e))return"";if(t<10)r="0"+t;else r=t.toString();if(i<10)n="0"+i;else n=i.toString();return Q.format("{0}:{1}",r,n)};var t;e=t=__decorate([r("Minute")],e);return e}();e.MinuteFormatter=c;var d=function(){function e(){}t=e;e.prototype.format=function(e){return t.format(e.value,this.displayFormat)};e.format=function(e,t){t=Q.coalesce(t,"0.##");if(e==null)return"";if(typeof e==="number"){if(isNaN(e))return"";return Q.htmlEncode(Q.formatNumber(e,t))}var i=Q.parseDecimal(e.toString());if(i==null)return"";return Q.htmlEncode(e.toString())};var t;__decorate([i()],e.prototype,"displayFormat",void 0);e=t=__decorate([r("Number")],e);return e}();e.NumberFormatter=d;var f=function(){function n(){}n.prototype.format=function(e){var t=!Q.isEmptyOrNull(this.urlProperty)?Q.coalesce(e.item[this.urlProperty],"").toString():Q.coalesce(e.value,"").toString();if(Q.isEmptyOrNull(t))return"";if(!Q.isEmptyOrNull(this.urlFormat))t=Q.format(this.urlFormat,t);if(t!=null&&Q.startsWith(t,"~/"))t=Q.resolveUrl(t);var i=!Q.isEmptyOrNull(this.displayProperty)?Q.coalesce(e.item[this.displayProperty],"").toString():Q.coalesce(e.value,"").toString();if(!Q.isEmptyOrNull(this.displayFormat))i=Q.format(this.displayFormat,i);var r="<a href='"+Q.attrEncode(t)+"'";if(!Q.isEmptyOrNull(this.target))r+=" target='"+this.target+"'";r+=">"+Q.htmlEncode(i)+"</a>";return r};n.prototype.initializeColumn=function(e){e.referencedFields=e.referencedFields||[];if(!Q.isEmptyOrNull(this.displayProperty)){e.referencedFields.push(this.displayProperty);return}if(!Q.isEmptyOrNull(this.urlProperty)){e.referencedFields.push(this.urlProperty);return}};__decorate([i()],n.prototype,"displayProperty",void 0);__decorate([i()],n.prototype,"displayFormat",void 0);__decorate([i()],n.prototype,"urlProperty",void 0);__decorate([i()],n.prototype,"urlFormat",void 0);__decorate([i()],n.prototype,"target",void 0);n=__decorate([r("Url",[e.ISlickFormatter,t])],n);return n}();e.UrlFormatter=f;var p;(function(t){var i;function r(){var e="formatter";for(var t=0,r=Object.keys(i);t<r.length;t++){var n=r[t];if(!Q.endsWith(n,e))continue;var a=n.substr(0,n.length-e.length);if(Q.isEmptyOrNull(a))continue;if(i[a]!=null)continue;i[a]=i[n]}}function n(){if(i){return}i={};var t=Q.getTypes();for(var n=0,a=t;n<a.length;n++){var o=a[n];if(!Q.isAssignableFrom(e.ISlickFormatter,o))continue;var l=Q.getTypeFullName(o).toLowerCase();i[l]=o;for(var s=0,u=Q.Config.rootNamespaces;s<u.length;s++){var c=u[s];if(Q.startsWith(l,c.toLowerCase()+".")){var d=l.substr(c.length+1).toLowerCase();if(i[d]==null){i[d]=o}}}}r()}function a(e){if(Q.isEmptyOrNull(e))throw new Q.ArgumentNullException("key");n();var t=i[e.toLowerCase()];if(t==null){throw new Q.Exception(Q.format("Can't find {0} formatter type!",e))}return t}t.get=a;function o(){i=null}t.reset=o})(p=e.FormatterTypeRegistry||(e.FormatterTypeRegistry={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(){function t(){}t=__decorate([e.Decorators.registerInterface("Serenity.IDataGrid")],t);return t}();e.IDataGrid=t;var i=function(i){__extends(r,i);function r(e,t){var r=i.call(this,e,t)||this;r.restoringSettings=0;var n=r;r.element.addClass("s-DataGrid").html("");r.element.addClass("s-"+Q.getTypeName(Q.getInstanceType(r)));var a=function(){n.layout();if(n.layoutTimer!=null)Q.LayoutTimer.store(n.layoutTimer)};r.element.addClass("require-layout").on("layout."+r.uniqueName,a);if(r.useLayoutTimer())r.layoutTimer=Q.LayoutTimer.onSizeChange(function(){return r.element&&r.element[0]},Q.debounce(a,50));r.setTitle(r.getInitialTitle());var o=r.getButtons();if(o!=null){r.createToolbar(o)}r.slickContainer=r.createSlickContainer();r.view=r.createView();r.slickGrid=r.createSlickGrid();if(r.enableFiltering()){r.createFilterBar()}if(r.usePager()){r.createPager()}r.bindToSlickEvents();r.bindToViewEvents();if(o!=null){r.createToolbarExtensions()}r.createQuickFilters();r.updateDisabledState();r.updateInterface();r.initialSettings=r.getCurrentSettings(null);r.restoreSettings(null,null);window.setTimeout(function(){return r.initialPopulate()},0);return r}n=r;r.prototype.useLayoutTimer=function(){return true};r.prototype.attrs=function(e){return Q.getAttributes(Q.getInstanceType(this),e,true)};r.prototype.layout=function(){if(!this.element||!this.element.is(":visible")||this.slickContainer==null)return;var e=this.element.hasClass("responsive-height");var t=this.slickGrid!=null&&this.slickGrid.getOptions().autoHeight;var i=e&&window.innerWidth<768;if(i){if(this.element[0]&&this.element[0].style.height!="auto")this.element[0].style.height="auto";if(!t){this.slickContainer.css("height","auto").children(".slick-pane").each(function(e,t){if(t.style.height!=null&&t.style.height!="auto")t.style.height="auto"});this.slickGrid.setOptions({autoHeight:true})}}else{if(t){this.slickContainer.children(".slick-viewport").css("height","auto");this.slickGrid.setOptions({autoHeight:false})}Q.layoutFillHeight(this.slickContainer)}this.slickGrid.resizeCanvas()};r.prototype.getInitialTitle=function(){return null};r.prototype.createToolbarExtensions=function(){};r.prototype.ensureQuickFilterBar=function(){if(this.quickFiltersDiv==null)this.createQuickFilters([]);return this.quickFiltersBar};r.prototype.createQuickFilters=function(t){var i=this;if(this.quickFiltersDiv==null&&(t!=null||(t=this.getQuickFilters())&&t!=null&&t.length)){this.quickFiltersDiv=$("<div/>").addClass("quick-filters-bar");if(this.toolbar){$("<div/>").addClass("clear").appendTo(this.toolbar.element);this.quickFiltersDiv.appendTo(this.toolbar.element)}else{this.quickFiltersDiv.appendTo($("<div/>").addClass("s-Toolbar").insertBefore(this.slickContainer))}this.quickFiltersBar=new e.QuickFilterBar(this.quickFiltersDiv,{filters:t,getTitle:function(e){return i.determineText(function(t){return t+e.field})},idPrefix:this.uniqueName+"_QuickFilter_"});this.quickFiltersBar.onChange=function(e){return i.quickFilterChange(e)}}};r.prototype.getQuickFilters=function(){return this.allColumns.filter(function(e){return e.sourceItem&&e.sourceItem.quickFilter===true&&(e.sourceItem.readPermission==null||Q.Authorization.hasPermission(e.sourceItem.readPermission))}).map(function(e){return n.propertyItemToQuickFilter(e.sourceItem)}).filter(function(e){return e!=null})};r.propertyItemToQuickFilter=function(t){var i={};var r=t.name;var n=Q.tryGetText(t.title);if(n==null){n=t.title;if(n==null){n=r}}var a=e.FilteringTypeRegistry.get(Q.coalesce(t.filteringType,"String"));if(a===e.DateFiltering){i=e.QuickFilterBar.dateRange(r,n)}else if(a===e.DateTimeFiltering){i=e.QuickFilterBar.dateTimeRange(r,n)}else if(a===e.BooleanFiltering){var o=t.quickFilterParams||{};var l=t.filteringParams||{};var s=o["trueText"];if(s==null){s=l["trueText"]}var u=o["falseText"];if(u==null){u=l["falseText"]}i=e.QuickFilterBar.boolean(r,n,s,u)}else{var c=new a;if(c&&Q.isInstanceOfType(c,e.IQuickFiltering)){e.ReflectionOptionsSetter.set(c,t.filteringParams);c.set_field(t);c.set_operator({key:e.FilterOperators.EQ});c.initQuickFilter(i);i.options=Q.extend(Q.deepClone(i.options),t.quickFilterParams)}else{return null}}if(!!t.quickFilterSeparator){i.separator=true}i.cssClass=t.quickFilterCssClass;return i};r.prototype.findQuickFilter=function(e,t){if(this.quickFiltersBar!=null)return this.quickFiltersBar.find(e,t);return $("#"+this.uniqueName+"_QuickFilter_"+t).getWidget(e)};r.prototype.tryFindQuickFilter=function(e,t){if(this.quickFiltersBar!=null)return this.quickFiltersBar.tryFind(e,t);var i=$("#"+this.uniqueName+"_QuickFilter_"+t);if(!i.length)return null;return i.tryGetWidget(e)};r.prototype.createIncludeDeletedButton=function(){if(!Q.isEmptyOrNull(this.getIsActiveProperty())||!Q.isEmptyOrNull(this.getIsDeletedProperty())){e.GridUtils.addIncludeDeletedToggle(this.toolbar.element,this.view,null,false)}};r.prototype.getQuickSearchFields=function(){return null};r.prototype.createQuickSearchInput=function(){var t=this;e.GridUtils.addQuickSearchInput(this.toolbar.element,this.view,this.getQuickSearchFields(),function(){return t.persistSettings(null)})};r.prototype.destroy=function(){if(this.layoutTimer){this.layoutTimer=Q.LayoutTimer.off(this.layoutTimer)}if(this.quickFiltersBar){this.quickFiltersBar.destroy();this.quickFiltersBar=null}if(this.toolbar){this.toolbar.destroy();this.toolbar=null}if(this.slickGrid){this.slickGrid.onClick.clear();this.slickGrid.onSort.clear();this.slickGrid.onColumnsResized.clear();this.slickGrid.onColumnsReordered.clear();this.slickGrid.destroy();this.slickGrid=null}if(this.view){this.view.onDataChanged.clear();this.view.onSubmit=null;this.view.setFilter(null);this.view=null}this.titleDiv=null;i.prototype.destroy.call(this)};r.prototype.getItemCssClass=function(e,t){var i=this.getIsActiveProperty();var r=this.getIsDeletedProperty();if(Q.isEmptyOrNull(i)&&Q.isEmptyOrNull(r)){return null}if(i){var n=e[i];if(n==null){return null}if(typeof n==="number"){if(n<0){return"deleted"}else if(n===0){return"inactive"}}else if(typeof n==="boolean"){if(n===false){return"deleted"}}}else{return e[r]?"deleted":null}return null};r.prototype.getItemMetadata=function(e,t){var i=this.getItemCssClass(e,t);if(Q.isEmptyOrNull(i)){return new Object}return{cssClasses:i}};r.prototype.postProcessColumns=function(t){e.SlickHelper.setDefaults(t,this.getLocalTextDbPrefix());return t};r.prototype.initialPopulate=function(){var t=this;if(this.populateWhenVisible()){e.LazyLoadHelper.executeEverytimeWhenShown(this.element,function(){t.refreshIfNeeded()},false);if(this.element.is(":visible")&&this.view){this.view.populate()}}else if(this.view){this.view.populate()}};r.prototype.canFilterColumn=function(e){return e.sourceItem!=null&&e.sourceItem.notFilterable!==true&&(e.sourceItem.readPermission==null||Q.Authorization.hasPermission(e.sourceItem.readPermission))};r.prototype.initializeFilterBar=function(){var t=this;this.filterBar.set_store(new e.FilterStore(this.allColumns.filter(function(e){return t.canFilterColumn(e)}).map(function(e){return e.sourceItem})));this.filterBar.get_store().add_changed(function(e,i){if(t.restoringSettings<=0){t.persistSettings(null);t.view&&(t.view.seekToPage=1);t.refresh()}})};r.prototype.createSlickGrid=function(){var e;this.allColumns=this.getColumns();e=this.postProcessColumns(this.allColumns).filter(function(e){return e.visible!==false});var t=this.getSlickOptions();var i=new Slick.Grid(this.slickContainer,this.view,e,t);i.registerPlugin(new Slick.AutoTooltips({enableForHeaderCells:true}));this.slickGrid=i;this.rows=this.slickGrid;this.setInitialSortOrder();return i};r.prototype.setInitialSortOrder=function(){var e=this.getDefaultSortBy();if(this.view){this.view.sortBy=Array.prototype.slice.call(e)}var t=e.map(function(e){var t={};if(e&&Q.endsWith(e.toLowerCase()," desc")){t.columnId=Q.trimEnd(e.substr(0,e.length-5));t.sortAsc=false}else{t.columnId=e;t.sortAsc=true}return t});this.slickGrid.setSortColumns(t)};r.prototype.itemAt=function(e){return this.slickGrid.getDataItem(e)};r.prototype.rowCount=function(){return this.slickGrid.getDataLength()};r.prototype.getItems=function(){return this.view.getItems()};r.prototype.setItems=function(e){this.view.setItems(e,true)};r.prototype.bindToSlickEvents=function(){var e=this;var t=this;this.slickGridOnSort=function(i,r){t.view.populateLock();try{var n=[];var a;if(!!r.multiColumnSort){for(var o=0;!!(o<r.sortCols.length);o++){var l=r.sortCols[o];a=l.sortCol;if(a==null){a={}}n.push(a.field+(!!l.sortAsc?"":" DESC"))}}else{var a=r.sortCol;if(a==null){a={}}n.push(a.field+(!!r.sortAsc?"":" DESC"))}t.view.seekToPage=1;t.view.sortBy=n}finally{t.view.populateUnlock()}if(t.view.getLocalSort&&t.view.getLocalSort()){t.view.sort()}else{t.view.populate()}e.persistSettings(null)};this.slickGrid.onSort.subscribe(this.slickGridOnSort);this.slickGridOnClick=function(e,i){t.onClick(e,i.row,i.cell)};this.slickGrid.onClick.subscribe(this.slickGridOnClick);this.slickGrid.onColumnsReordered.subscribe(function(t,i){return e.persistSettings(null)});this.slickGrid.onColumnsResized.subscribe(function(t,i){return e.persistSettings(null)})};r.prototype.getAddButtonCaption=function(){return Q.coalesce(Q.tryGetText("Controls.DataGrid.NewButton"),"New")};r.prototype.getButtons=function(){return[]};r.prototype.editItem=function(e){throw new Error("Not Implemented!")};r.prototype.editItemOfType=function(e,t){if(e===this.getItemType()){this.editItem(t);return}throw new Error("Not Implemented!")};r.prototype.onClick=function(t,i,r){if(t.isDefaultPrevented()){return}var n=$(t.target);if(!n.hasClass("s-EditLink")){n=n.closest("a")}if(n.hasClass("s-EditLink")){t.preventDefault();this.editItemOfType(e.SlickFormatting.getItemType(n),e.SlickFormatting.getItemId(n))}};r.prototype.viewDataChanged=function(e,t){this.markupReady();this.layout()};r.prototype.bindToViewEvents=function(){var e=this;this.view.onDataChanged.subscribe(function(t,i){return e.viewDataChanged(t,i)});this.view.onSubmit=function(t){return e.onViewSubmit()};this.view.setFilter(function(t,i){return e.onViewFilter(t)});this.view.onProcessData=function(t,i){return e.onViewProcessData(t)}};r.prototype.onViewProcessData=function(e){return e};r.prototype.onViewFilter=function(e){return true};r.prototype.getIncludeColumns=function(e){var t=this.slickGrid.getColumns();for(var i=0,r=t;i<r.length;i++){var n=r[i];if(n.field){e[n.field]=true}if(n.referencedFields){for(var a=0,o=n.referencedFields;a<o.length;a++){var l=o[a];e[l]=true}}}};r.prototype.setCriteriaParameter=function(){delete this.view.params["Criteria"];if(this.filterBar){var t=this.filterBar.get_store().get_activeCriteria();if(!e.Criteria.isEmpty(t)){this.view.params.Criteria=t}}};r.prototype.setEquality=function(e,t){Q.setEquality(this.view.params,e,t)};r.prototype.setIncludeColumnsParameter=function(){var e={};this.getIncludeColumns(e);var t=[];for(var i=0,r=Object.keys(e);i<r.length;i++){var n=r[i];t.push(n)}this.view.params.IncludeColumns=t};r.prototype.onViewSubmit=function(){if(this.isDisabled||!this.getGridCanLoad()){return false}this.setCriteriaParameter();this.setIncludeColumnsParameter();this.invokeSubmitHandlers();return true};r.prototype.markupReady=function(){};r.prototype.createSlickContainer=function(){return $('<div class="grid-container"></div>').appendTo(this.element)};r.prototype.createView=function(){var e=this.getViewOptions();return new Slick.RemoteView(e)};r.prototype.getDefaultSortBy=function(){if(this.slickGrid){var e=this.slickGrid.getColumns().filter(function(e){return e.sortOrder&&e.sortOrder!==0});if(e.length>0){e.sort(function(e,t){return e.sortOrder<t.sortOrder?-1:e.sortOrder>t.sortOrder?1:0});var t=[];for(var i=0;i<e.length;i++){var r=e[i];t.push(r.field+(r.sortOrder<0?" DESC":""))}return t}}return[]};r.prototype.usePager=function(){return false};r.prototype.enableFiltering=function(){var t=this.attrs(e.FilterableAttribute);return t.length>0&&t[0].value};r.prototype.populateWhenVisible=function(){return false};r.prototype.createFilterBar=function(){var t=$("<div/>").appendTo(this.element);this.filterBar=new e.FilterDisplayBar(t);this.initializeFilterBar()};r.prototype.getPagerOptions=function(){return{view:this.view,rowsPerPage:20,rowsPerPageOptions:[20,100,500,2500]}};r.prototype.createPager=function(){var t=$("<div></div>").appendTo(this.element);new e.SlickPager(t,this.getPagerOptions())};r.prototype.getViewOptions=function(){var e=this;var t={};t.idField=this.getIdProperty();t.sortBy=this.getDefaultSortBy();if(!this.usePager()){t.rowsPerPage=0}else if(this.element.hasClass("responsive-height")){t.rowsPerPage=$(window.window).width()<768?20:100}else{t.rowsPerPage=100}t.getItemMetadata=function(t,i){return e.getItemMetadata(t,i)};return t};r.prototype.createToolbar=function(t){var i=$('<div class="grid-toolbar"></div>').appendTo(this.element);this.toolbar=new e.Toolbar(i,{buttons:t,hotkeyContext:this.element[0]})};r.prototype.getTitle=function(){if(!this.titleDiv){return null}return this.titleDiv.children(".title-text").text()};r.prototype.setTitle=function(e){if(e!==this.getTitle()){if(e==null){if(this.titleDiv){this.titleDiv.remove();this.titleDiv=null}}else{if(!this.titleDiv){this.titleDiv=$('<div class="grid-title"><div class="title-text"></div></div>').prependTo(this.element)}this.titleDiv.children(".title-text").text(e)}this.layout()}};r.prototype.getItemType=function(){return"Item"};r.prototype.itemLink=function(t,i,r,n,a){if(a===void 0){a=true}if(t==null){t=this.getItemType()}if(i==null){i=this.getIdProperty()}return e.SlickFormatting.itemLink(t,i,r,n,a)};r.prototype.getColumnsKey=function(){var t=this.attrs(e.ColumnsKeyAttribute);if(t&&t.length>0){return t[0].value}return null};r.prototype.getPropertyItems=function(){var t=this.attrs(e.ColumnsKeyAttribute);var i=this.getColumnsKey();if(!Q.isEmptyOrNull(i)){return Q.getColumns(i)}return[]};r.prototype.getColumns=function(){var e=this.getPropertyItems();return this.propertyItemsToSlickColumns(e)};r.prototype.propertyItemsToSlickColumns=function(t){var i=e.PropertyItemSlickConverter.toSlickColumns(t);for(var r=0;r<t.length;r++){var n=t[r];var a=i[r];if(n.editLink===true){var o={$:a.format};var l={$:n.editLinkCssClass!=null?n.editLinkCssClass:null};a.format=this.itemLink(n.editLinkItemType!=null?n.editLinkItemType:null,n.editLinkIdField!=null?n.editLinkIdField:null,function(e){if(this.oldFormat.$!=null){return this.oldFormat.$(e)}return Q.htmlEncode(e.value)}.bind({oldFormat:o}),function(e){return Q.coalesce(this.css.$,"")}.bind({css:l}),false);if(!Q.isEmptyOrNull(n.editLinkIdField)){a.referencedFields=a.referencedFields||[];a.referencedFields.push(n.editLinkIdField)}}}return i};r.prototype.getSlickOptions=function(){var t={};t.multiSelect=false;t.multiColumnSort=true;t.enableCellNavigation=false;t.headerRowHeight=e.DataGrid.defaultHeaderHeight;t.rowHeight=e.DataGrid.defaultRowHeight;return t};r.prototype.populateLock=function(){this.view.populateLock()};r.prototype.populateUnlock=function(){this.view.populateUnlock()};r.prototype.getGridCanLoad=function(){return true};r.prototype.refresh=function(){if(!this.populateWhenVisible()){this.internalRefresh();return}if(this.slickContainer.is(":visible")){this.slickContainer.data("needsRefresh",false);this.internalRefresh();return}this.slickContainer.data("needsRefresh",true)};r.prototype.refreshIfNeeded=function(){if(!!this.slickContainer.data("needsRefresh")){this.slickContainer.data("needsRefresh",false);this.internalRefresh()}};r.prototype.internalRefresh=function(){this.view.populate()};r.prototype.setIsDisabled=function(e){if(this.isDisabled!==e){this.isDisabled=e;if(this.isDisabled){this.view.setItems([],true)}this.updateDisabledState()}};Object.defineProperty(r.prototype,"readOnly",{get:function(){return this.get_readOnly()},set:function(e){this.set_readOnly(e)},enumerable:true,configurable:true});r.prototype.get_readOnly=function(){return!!this._readonly};r.prototype.set_readOnly=function(e){if(!!this._readonly!=!!e){this._readonly=!!e;this.updateInterface()}};r.prototype.updateInterface=function(){this.toolbar&&this.toolbar.updateInterface()};r.prototype.getLocalTextDbPrefix=function(){if(this.localTextDbPrefix==null){this.localTextDbPrefix=Q.coalesce(this.getLocalTextPrefix(),"");if(this.localTextDbPrefix.length>0&&!Q.endsWith(this.localTextDbPrefix,".")){this.localTextDbPrefix="Db."+this.localTextDbPrefix+"."}}return this.localTextDbPrefix};r.prototype.getLocalTextPrefix=function(){var t=this.attrs(e.LocalTextPrefixAttribute);if(t.length>=1)return t[0].value;return""};r.prototype.getIdProperty=function(){if(this.idProperty==null){var t=this.attrs(e.IdPropertyAttribute);if(t.length===1){this.idProperty=t[0].value}else{this.idProperty="ID"}}return this.idProperty};r.prototype.getIsDeletedProperty=function(){return null};r.prototype.getIsActiveProperty=function(){if(this.isActiveProperty==null){var t=this.attrs(e.IsActivePropertyAttribute);if(t.length===1){this.isActiveProperty=t[0].value}else{this.isActiveProperty=""}}return this.isActiveProperty};r.prototype.updateDisabledState=function(){this.slickContainer.toggleClass("ui-state-disabled",!!this.isDisabled)};r.prototype.resizeCanvas=function(){this.slickGrid.resizeCanvas()};r.prototype.subDialogDataChange=function(){this.refresh()};r.prototype.addFilterSeparator=function(){this.ensureQuickFilterBar().addSeparator()};r.prototype.determineText=function(e){var t=this.getLocalTextDbPrefix();if(!Q.isEmptyOrNull(t)){var i=Q.tryGetText(e(t));if(i!=null){return i}}return null};r.prototype.addQuickFilter=function(e){return this.ensureQuickFilterBar().add(e)};r.prototype.addDateRangeFilter=function(e,t){return this.ensureQuickFilterBar().addDateRange(e,t)};r.prototype.dateRangeQuickFilter=function(t,i){return e.QuickFilterBar.dateRange(t,i)};r.prototype.addDateTimeRangeFilter=function(e,t){return this.ensureQuickFilterBar().addDateTimeRange(e,t)};r.prototype.dateTimeRangeQuickFilter=function(t,i){return e.QuickFilterBar.dateTimeRange(t,i)};r.prototype.addBooleanFilter=function(e,t,i,r){return this.ensureQuickFilterBar().addBoolean(e,t,i,r)};r.prototype.booleanQuickFilter=function(t,i,r,n){return e.QuickFilterBar.boolean(t,i,r,n)};r.prototype.invokeSubmitHandlers=function(){if(this.quickFiltersBar!=null){this.quickFiltersBar.onSubmit(this.view.params)}};r.prototype.quickFilterChange=function(e){this.persistSettings(null);this.view&&(this.view.seekToPage=1);this.refresh()};r.prototype.getPersistanceStorage=function(){return e.DataGrid.defaultPersistanceStorage};r.prototype.getPersistanceKey=function(){var e="GridSettings:";var t=window.location.pathname;if(!Q.isEmptyOrNull(t)){e+=t.substr(1).split(String.fromCharCode(47)).slice(0,2).join("/")+":"}e+=Q.getTypeFullName(Q.getInstanceType(this));return e};r.prototype.gridPersistanceFlags=function(){return{}};r.prototype.canShowColumn=function(e){if(e==null){return false}var t=e.sourceItem;if(t==null){return true}if(t.filterOnly===true){return false}if(t.readPermission==null){return true}return Q.Authorization.hasPermission(t.readPermission)};r.prototype.getPersistedSettings=function(){var e=this.getPersistanceStorage();if(e==null)return null;var t=Q.trimToNull(e.getItem(this.getPersistanceKey()));if(t!=null&&Q.startsWith(t,"{")&&Q.endsWith(t,"}"))return JSON.parse(t);return null};r.prototype.restoreSettings=function(t,i){var r=this;if(!this.slickGrid)return;if(t==null){t=this.getPersistedSettings();if(t==null)return}var n=this.slickGrid.getColumns();var a=null;var o=function(e){a={};for(var t=0;t<e.length;t++){var i=e[t];a[i.id]=i}};this.view.beginUpdate();this.restoringSettings++;try{i=i||this.gridPersistanceFlags();if(t.columns!=null){if(i.columnVisibility!==false){var l={};o(this.allColumns);var s=[];for(var u=0;u<t.columns.length;u++){var c=t.columns[u];if(c.id!=null&&c.visible===true){var d=a[c.id];if(this.canShowColumn(d)){d.visible=true;s.push(d);delete a[c.id]}}}for(var f=0;f<this.allColumns.length;f++){var p=this.allColumns[f];if(a[p.id]!=null){p.visible=false;s.push(p)}}this.allColumns=s;n=this.allColumns.filter(function(e){return e.visible===true})}if(i.columnWidths!==false){o(n);for(var h=0;h<t.columns.length;h++){var g=t.columns[h];if(g.id!=null&&g.width!=null&&g.width!==0){var v=a[g.id];if(v!=null){v.width=g.width}}}}if(i.sortColumns!==false){o(n);var y=[];var m=t.columns.filter(function(e){return e.id!=null&&Q.coalesce(e.sort,0)!==0});m.sort(function(e,t){return Math.abs(e.sort)-Math.abs(t.sort)});for(var b=0;b<m.length;b++){var C=m[b];var _=a[C.id];if(_!=null){y.push({columnId:C.id,sortAsc:C.sort>0})}}this.view.sortBy=y.map(function(e){return e.columnId+(e.sortAsc===false?" DESC":"")});this.slickGrid.setSortColumns(y)}this.slickGrid.setColumns(n);this.slickGrid.invalidate()}if(t.filterItems!=null&&i.filterItems!==false&&this.filterBar!=null&&this.filterBar.get_store()!=null){var S=this.filterBar.get_store().get_items();S.length=0;S.push.apply(S,t.filterItems);this.filterBar.get_store().raiseChanged()}if(t.includeDeleted!=null&&i.includeDeleted!==false){var x=this.element.find(".s-IncludeDeletedToggle");if(!!t.includeDeleted!==x.hasClass("pressed")){x.children("a").click()}}if(t.quickFilters!=null&&i.quickFilters!==false&&this.quickFiltersDiv!=null&&this.quickFiltersDiv.length>0){this.quickFiltersDiv.find(".quick-filter-item").each(function(i,n){var a=$(n).data("qffield");if(Q.isEmptyOrNull(a)){return}var o=$("#"+r.uniqueName+"_QuickFilter_"+a).tryGetWidget(e.Widget);if(o==null){return}var l=t.quickFilters[a];var s=$(n).data("qfloadstate");if(s!=null){s(o,l)}else{e.EditorUtils.setValue(o,l)}})}if(i.quickSearch===true&&(t.quickSearchField!==undefined||t.quickSearchText!==undefined)){var w=this.toolbar.element.find(".s-QuickSearchInput").first();if(w.length>0){var T=w.tryGetWidget(e.QuickSearchInput);T&&T.restoreState(t.quickSearchText,t.quickSearchField)}}}finally{this.restoringSettings--;this.view.endUpdate()}};r.prototype.persistSettings=function(e){var t=this.getPersistanceStorage();if(!t){return}var i=this.getCurrentSettings(e);t.setItem(this.getPersistanceKey(),$.toJSON(i))};r.prototype.getCurrentSettings=function(t){var i=this;t=t||this.gridPersistanceFlags();var r={};if(t.columnVisibility!==false||t.columnWidths!==false||t.sortColumns!==false){r.columns=[];var n=this.slickGrid.getSortColumns();var a=this.slickGrid.getColumns();for(var o=0,l=a;o<l.length;o++){var s=l[o];var u={id:s.id};if(t.columnVisibility!==false){u.visible=true}if(t.columnWidths!==false){u.width=s.width}if(t.sortColumns!==false){var c=Q.indexOf(n,function(e){return e.columnId==s.id});u.sort=c>=0?n[c].sortAsc!==false?c+1:-c-1:0}r.columns.push(u)}}if(t.includeDeleted!==false){r.includeDeleted=this.element.find(".s-IncludeDeletedToggle").hasClass("pressed")}if(t.filterItems!==false&&this.filterBar!=null&&this.filterBar.get_store()!=null){r.filterItems=this.filterBar.get_store().get_items().slice()}if(t.quickSearch===true){var d=this.toolbar.element.find(".s-QuickSearchInput").first();if(d.length>0){var f=d.tryGetWidget(e.QuickSearchInput);if(f!=null){r.quickSearchField=f.get_field();r.quickSearchText=f.element.val()}}}if(t.quickFilters!==false&&this.quickFiltersDiv!=null&&this.quickFiltersDiv.length>0){r.quickFilters={};this.quickFiltersDiv.find(".quick-filter-item").each(function(n,a){var o=$(a).data("qffield");if(Q.isEmptyOrNull(o)){return}var l=$("#"+i.uniqueName+"_QuickFilter_"+o).tryGetWidget(e.Widget);if(l==null){return}var s=$(a).data("qfsavestate");var u=s!=null?s(l):e.EditorUtils.getValue(l);r.quickFilters[o]=u;if(t.quickFilterText===true&&$(a).hasClass("quick-filter-active")){var c=$(a).data("qfdisplaytext");var d=$(a).find(".quick-filter-label").text();var f;if(c!=null){f=c(l,d)}else{f=d+" = "+e.EditorUtils.getDisplayText(l)}if(!Q.isEmptyOrNull(f)){if(!Q.isEmptyOrNull(r.quickFilterText)){r.quickFilterText+=" "+Q.coalesce(Q.tryGetText("Controls.FilterPanel.And"),"and")+" ";r.quickFilterText+=f}else{r.quickFilterText=f}}}})}return r};r.prototype.getElement=function(){return this.element};r.prototype.getGrid=function(){return this.slickGrid};r.prototype.getView=function(){return this.view};r.prototype.getFilterStore=function(){return this.filterBar==null?null:this.filterBar.get_store()};var n;r=n=__decorate([e.Decorators.registerClass("Serenity.DataGrid",[t,e.IReadOnly]),e.Decorators.element("<div/>")],r);return r}(e.Widget);e.DataGrid=i})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(){var i=t.call(this)||this;new e.QuickSearchInput(i.byId("Search"),{onSearch:function(e,t,r){t=Q.trimToNull(t);if(t!=null)t=Select2.util.stripDiacritics(t.toLowerCase());i.element.find("li").each(function(e,i){$(i).toggle(!t||Select2.util.stripDiacritics($(i).text().toLowerCase()).indexOf(t)>=0)});r&&r(true)}});i.ulVisible=i.byId("VisibleCols");i.ulHidden=i.byId("HiddenCols");i.dialogTitle=Q.text("Controls.ColumnPickerDialog.Title");
return i}i.createToolButton=function(t){function i(){var i=new e.ColumnPickerDialog;i.allColumns=t.allColumns;if(t.initialSettings){var r=t.initialSettings;if(r.columns&&r.columns.length)i.defaultColumns=r.columns.map(function(e){return e.id})}i.visibleColumns=t.slickGrid.getColumns().map(function(e){return e.id});i.done=function(){t.allColumns=i.allColumns;var e=i.allColumns.filter(function(e){return e.visible===true});t.slickGrid.setColumns(e);t.persistSettings();t.refresh()};Q["Router"]&&Q["Router"].dialog&&Q["Router"].dialog(t.element,i.element,function(){return"columns"});i.dialogOpen()}t.element.on("handleroute."+t.uniqueName,function(e,t){if(t&&!t.handled&&t.route=="columns"){i()}});return{hint:Q.text("Controls.ColumnPickerDialog.Title"),cssClass:"column-picker-button",onClick:i}};i.prototype.getDialogButtons=function(){var e=this;return[{text:Q.text("Controls.ColumnPickerDialog.RestoreDefaults"),click:function(){var t={};e.ulVisible.children().add(e.ulHidden.children()).each(function(e,i){var r=$(i);t[r.data("key")]=r});var i=null;for(var r=0,n=e.defaultColumns;r<n.length;r++){var a=n[r];var o=t[a];if(!o)continue;if(i==null)o.prependTo(e.ulVisible);else o.insertAfter(i);i=o;var l=o.data("key");delete t[l]}for(var l in t)t[l].appendTo(e.ulHidden);e.updateListStates()}},{text:Q.text("Dialogs.OkButton"),click:function(){var t=[];for(var i=0,r=e.allColumns;i<r.length;i++){var n=r[i];n.visible=false}e.visibleColumns=e.ulVisible.children().toArray().map(function(i){var r=$(i).data("key");var n=e.colById[r];n.visible=true;t.push(n);return r});for(var a=0,o=e.allColumns;a<o.length;a++){var n=o[a];if(!n.visible)t.push(n)}e.allColumns=t;e.done&&e.done();e.dialogClose()}},{text:Q.text("Dialogs.CancelButton"),click:function(){e.dialogClose()}}]};i.prototype.getDialogOptions=function(){var e=t.prototype.getDialogOptions.call(this);e.width=600;return e};i.prototype.getTitle=function(e){if(e.id=="__select__")return"[x]";return e.name||e.toolTip||e.id};i.prototype.allowHide=function(e){return e.sourceItem==null||e.sourceItem.allowHide==null||e.sourceItem.allowHide};i.prototype.createLI=function(e){var t=this.allowHide(e);return $('\n<li data-key="'+e.id+'" class="'+(t?"":"cant-hide")+'">\n  <span class="drag-handle">☰</span>\n  '+Q.htmlEncode(this.getTitle(e))+"\n  "+(t?'<i class="js-hide" title="'+Q.text("Controls.ColumnPickerDialog.HideHint")+'">✖</i>':"")+'\n  <i class="js-show fa fa-eye" title="'+Q.text("Controls.ColumnPickerDialog.ShowHint")+'"></i>\n</li>')};i.prototype.updateListStates=function(){this.ulVisible.children().removeClass("bg-info").addClass("bg-success");this.ulHidden.children().removeClass("bg-success").addClass("bg-info")};i.prototype.setupColumns=function(){var e=this;this.allColumns=this.allColumns||[];this.visibleColumns=this.visibleColumns||[];var t={};for(var i=0,r=this.visibleColumns;i<r.length;i++){var n=r[i];t[n]=true}this.colById={};for(var a=0,o=this.allColumns;a<o.length;a++){var l=o[a];this.colById[l.id]=l}if(this.defaultColumns==null)this.defaultColumns=this.visibleColumns.slice(0);var s=[];for(var u=0,c=this.allColumns;u<c.length;u++){var d=c[u];if(!t[d.id]&&(!d.sourceItem||d.sourceItem.filterOnly!==true&&(d.sourceItem.readPermission==null||Q.Authorization.hasPermission(d.sourceItem.readPermission)))){s.push(d)}}var f=s.sort(function(t,i){return Q.Culture.stringCompare(e.getTitle(t),e.getTitle(i))});for(var p=0,h=this.visibleColumns;p<h.length;p++){var n=h[p];var g=this.colById[n];if(!g)continue;this.createLI(g).appendTo(this.ulVisible)}for(var v=0,y=f;v<y.length;v++){var m=y[v];this.createLI(m).appendTo(this.ulHidden)}this.updateListStates();if(typeof Sortable!=="undefined"&&Sortable.create){Sortable.create(this.ulVisible[0],{group:this.uniqueName+"_group",filter:".js-hide",onFilter:function(t){$(t.item).appendTo(e.ulHidden);e.updateListStates()},onMove:function(t){if($(t.dragged).hasClass("cant-hide")&&t.from==e.ulVisible[0]&&t.to!==t.from)return false;return true},onEnd:function(t){return e.updateListStates()}});Sortable.create(this.ulHidden[0],{group:this.uniqueName+"_group",sort:false,filter:".js-show",onFilter:function(t){$(t.item).appendTo(e.ulVisible);e.updateListStates()},onEnd:function(t){return e.updateListStates()}})}};i.prototype.onDialogOpen=function(){t.prototype.onDialogOpen.call(this);this.element.find("input").removeAttr("disabled");this.element.closest(".ui-dialog").children(".ui-dialog-buttonpane").find("button").eq(0).addClass("restore-defaults").next().focus();this.setupColumns();Q.centerDialog(this.element)};i.prototype.getTemplate=function(){return'\n<div class="search"><input id="~_Search" type="text" disabled /></div>\n<div class="columns-container">\n<div class="column-list visible-list bg-success">\n  <h5><i class="fa fa-eye"></i> '+Q.text("Controls.ColumnPickerDialog.VisibleColumns")+'</h5>\n  <ul id="~_VisibleCols"></ul>\n</div>\n<div class="column-list hidden-list bg-info">\n  <h5><i class="fa fa-list"></i> '+Q.text("Controls.ColumnPickerDialog.HiddenColumns")+'</h5>\n  <ul id="~_HiddenCols"></ul>\n</div>\n</div>'};i=__decorate([e.Decorators.registerClass(),e.Decorators.resizable(),e.Decorators.responsive()],i);return i}(e.TemplatedDialog);e.ColumnPickerDialog=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(e,i){var r=t.call(this,e,i)||this;r.element.addClass("route-handler").on("handleroute."+r.uniqueName,function(e,t){if(!!t.handled)return;if(!!(t.route==="new")){t.handled=true;r.addButtonClick();return}var i=t.route.split("/");if(!!(i.length===2&&i[0]==="edit")){t.handled=true;r.editItem(i[1]);return}if(!!(i.length===2&&i[1]==="new")){t.handled=true;r.editItemOfType(Q.cast(i[0],String),null);return}if(!!(i.length===3&&i[1]==="edit")){t.handled=true;r.editItemOfType(Q.cast(i[0],String),i[2])}});return r}i.prototype.usePager=function(){return true};i.prototype.createToolbarExtensions=function(){this.createIncludeDeletedButton();this.createQuickSearchInput()};i.prototype.getInitialTitle=function(){return this.getDisplayName()};i.prototype.getLocalTextPrefix=function(){var e=t.prototype.getLocalTextPrefix.call(this);if(Q.isEmptyOrNull(e)){return this.getEntityType()}return e};i.prototype.getEntityType=function(){if(this.entityType!=null)return this.entityType;var t=this.attrs(e.EntityTypeAttribute);if(t.length===1){return this.entityType=t[0].value}var i=Q.getTypeFullName(Q.getInstanceType(this));var r=i.indexOf(".");if(r>=0){i=i.substring(r+1)}if(Q.endsWith(i,"Grid")){i=i.substr(0,i.length-4)}else if(Q.endsWith(i,"SubGrid")){i=i.substr(0,i.length-7)}this.entityType=i;return this.entityType};i.prototype.getDisplayName=function(){if(this.displayName!=null)return this.displayName;var e=this.attrs(System.ComponentModel.DisplayNameAttribute);if(e.length>=1){this.displayName=e[0].displayName;this.displayName=Q.LT.getDefault(this.displayName,this.displayName)}else{this.displayName=Q.tryGetText(this.getLocalTextDbPrefix()+"EntityPlural");if(this.displayName==null)this.displayName=this.getEntityType()}return this.displayName};i.prototype.getItemName=function(){if(this.itemName!=null)return this.itemName;var t=this.attrs(e.ItemNameAttribute);if(t.length>=1){this.itemName=t[0].value;this.itemName=Q.LT.getDefault(this.itemName,this.itemName)}else{this.itemName=Q.tryGetText(this.getLocalTextDbPrefix()+"EntitySingular");if(this.itemName==null)this.itemName=this.getEntityType()}return this.itemName};i.prototype.getAddButtonCaption=function(){return Q.format(Q.text("Controls.EntityGrid.NewButton"),this.getItemName())};i.prototype.getButtons=function(){var t=this;var i=[];i.push({title:this.getAddButtonCaption(),cssClass:"add-button",hotkey:"alt+n",onClick:function(){t.addButtonClick()},disabled:function(){return!t.hasInsertPermission()||t.readOnly}});i.push(this.newRefreshButton(true));i.push(e.ColumnPickerDialog.createToolButton(this));return i};i.prototype.newRefreshButton=function(e){var t=this;return{title:e?null:Q.text("Controls.EntityGrid.RefreshButton"),hint:e?Q.text("Controls.EntityGrid.RefreshButton"):null,cssClass:"refresh-button",onClick:function(){t.refresh()}}};i.prototype.addButtonClick=function(){this.editItem(new Object)};i.prototype.editItem=function(t){var i=this;this.createEntityDialog(this.getItemType(),function(r){var n=Q.safeCast(r,e["IEditDialog"]);if(n!=null){n.load(t,function(){n.dialogOpen(i.openDialogsAsPanel)});return}throw new Error(Q.format("{0} doesn't implement IEditDialog!",Q.getTypeFullName(Q.getInstanceType(r))))})};i.prototype.editItemOfType=function(t,i){var r=this;if(t===this.getItemType()){this.editItem(i);return}this.createEntityDialog(t,function(t){var n=Q.safeCast(t,e["IEditDialog"]);if(n!=null){n.load(i,function(){return n.dialogOpen(r.openDialogsAsPanel)});return}throw new Error(Q.format("{0} doesn't implement IEditDialog!",Q.getTypeFullName(Q.getInstanceType(t))))})};i.prototype.getService=function(){if(this.service!=null)return this.service;var t=this.attrs(e.ServiceAttribute);if(t.length>=1)this.service=t[0].value;else this.service=Q.replaceAll(this.getEntityType(),".","/");return this.service};i.prototype.getViewOptions=function(){var e=t.prototype.getViewOptions.call(this);e.url=Q.resolveUrl("~/Services/"+this.getService()+"/List");return e};i.prototype.getItemType=function(){return this.getEntityType()};i.prototype.routeDialog=function(e,t){var i=this;Q["Router"]&&Q["Router"].dialog&&Q["Router"].dialog(this.element,t.element,function(){var r="";if(e!==i.getItemType())r=e+"/";if(!!(t!=null&&t.entityId!=null))r+="edit/"+t.entityId.toString();else r+="new";return r})};i.prototype.getInsertPermission=function(){return null};i.prototype.hasInsertPermission=function(){var e=this.getInsertPermission();return e==null||Q.Authorization.hasPermission(this.getInsertPermission())};i.prototype.transferDialogReadOnly=function(t){if(this.readOnly)e.EditorUtils.setReadOnly(t,true)};i.prototype.initDialog=function(t){var i=this;e.SubDialogHelper.bindToDataChange(t,this,function(e,t){i.subDialogDataChange()},true);this.transferDialogReadOnly(t);this.routeDialog(this.getItemType(),t)};i.prototype.initEntityDialog=function(t,i){var r=this;if(t===this.getItemType()){this.initDialog(i);return}e.SubDialogHelper.bindToDataChange(i,this,function(e,t){r.subDialogDataChange()},true);this.transferDialogReadOnly(i);this.routeDialog(t,i)};i.prototype.createEntityDialog=function(t,i){var r=this;var n=this.getDialogTypeFor(t);var a=e.Widget.create({type:n,options:this.getDialogOptionsFor(t),init:function(e){r.initEntityDialog(t,e);i&&i(e)}});return a};i.prototype.getDialogOptions=function(){return{}};i.prototype.getDialogOptionsFor=function(e){if(e===this.getItemType())return this.getDialogOptions();return{}};i.prototype.getDialogTypeFor=function(t){if(t===this.getItemType()){return this.getDialogType()}return e.DialogTypeRegistry.get(t)};i.prototype.getDialogType=function(){if(this.dialogType!=null)return this.dialogType;var t=this.attrs(e.DialogTypeAttribute);if(t.length>=1)this.dialogType=t[0].value;else this.dialogType=e.DialogTypeRegistry.get(this.getEntityType());return this.dialogType};i=__decorate([e.Decorators.registerClass("Serenity.EntityGrid")],i);return i}(e.DataGrid);e.EntityGrid=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(){function t(i){this.options=i;var r=this.dataGrid=i.grid;var n=r.getIdProperty();var a=this.getId=function(e){return e[n]};r.element.find(".grid-container").on("click",function(t){if($(t.target).hasClass("s-TreeToggle")){var i=r.slickGrid.getCellFromEvent(t);if(i.cell>=0&&i.row>=0){e.SlickTreeHelper.toggleClick(t,i.row,i.row,r.view,a)}}});var o=r.onViewFilter;r.onViewFilter=function(t){if(!o.apply(this,[t]))return false;return e.SlickTreeHelper.filterById(t,r.view,i.getParentId)};var l=r.onViewProcessData;r.onViewProcessData=function(r){r=l.apply(this,[r]);r.Entities=t.applyTreeOrdering(r.Entities,a,i.getParentId);e.SlickTreeHelper.setIndents(r.Entities,a,i.getParentId,i.initialCollapse&&i.initialCollapse()||false);return r};if(i.toggleField){var s=Q.tryFirst(r["allColumns"]||r.slickGrid.getColumns()||[],function(e){return e.field==i.toggleField});if(s){s.format=e.SlickFormatting.treeToggle(function(){return r.view},a,s.format||function(e){return Q.htmlEncode(e.value)});s.formatter=e.SlickHelper.convertToFormatter(s.format)}}}t.prototype.toggleAll=function(){e.SlickTreeHelper.setCollapsed(this.dataGrid.view.getItems(),!this.dataGrid.view.getItems().every(function(e){return e._collapsed==true}));this.dataGrid.view.setItems(this.dataGrid.view.getItems(),true)};t.prototype.collapseAll=function(){e.SlickTreeHelper.setCollapsed(this.dataGrid.view.getItems(),true);this.dataGrid.view.setItems(this.dataGrid.view.getItems(),true)};t.prototype.expandAll=function(){e.SlickTreeHelper.setCollapsed(this.dataGrid.view.getItems(),false);this.dataGrid.view.setItems(this.dataGrid.view.getItems(),true)};t.applyTreeOrdering=function(e,t,i){var r=[];var n=Q.toGrouping(e,t);var a=Q.toGrouping(e,i);var o={};function l(e){if(o[e])return;o[e]=true;for(var i=0,n=a[e]||[];i<n.length;i++){var s=n[i];r.push(s);l(t(s))}}for(var s=0,u=e;s<u.length;s++){var c=u[s];var d=i(c);if(d==null||!(n[d]||[]).length){r.push(c);l(t(c))}}return r};return t}();e.TreeGridMixin=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(e,i){var r=t.call(this,e,i)||this;e.addClass("s-CheckTreeEditor");r.updateItems();return r}i.prototype.getIdProperty=function(){return"id"};i.prototype.getTreeItems=function(){return[]};i.prototype.updateItems=function(){var e=this.getTreeItems();var t={};for(var i=0;i<e.length;i++){var r=e[i];r.children=[];if(!Q.isEmptyOrNull(r.id)){t[r.id]=r}if(!Q.isEmptyOrNull(r.parentId)){var n=t[r.parentId];if(n!=null){n.children.push(r)}}}this.view.addData({Entities:e,Skip:0,Take:0,TotalCount:e.length});this.updateSelectAll();this.updateFlags()};i.prototype.getEditValue=function(e,t){if(this.getDelimited())t[e.name]=this.get_value().join(",");else t[e.name]=this.get_value()};i.prototype.setEditValue=function(e,t){var i=e[t.name];this.set_value(i)};i.prototype.getButtons=function(){var t=this;var i=this.getSelectAllText();if(Q.isEmptyOrNull(i)){return null}var r=this;var n=[];n.push(e.GridSelectAllButtonHelper.define(function(){return r},function(e){return e.id},function(e){return e.isSelected},function(e,i){if(e.isSelected!==i){e.isSelected=i;t.itemSelectedChanged(e)}},null,function(){t.updateFlags()}));return n};i.prototype.itemSelectedChanged=function(e){};i.prototype.getSelectAllText=function(){return Q.coalesce(Q.tryGetText("Controls.CheckTreeEditor.SelectAll"),"Select All")};i.prototype.isThreeStateHierarchy=function(){return false};i.prototype.createSlickGrid=function(){this.element.addClass("slick-no-cell-border").addClass("slick-no-odd-even");var e=t.prototype.createSlickGrid.call(this);this.element.addClass("slick-hide-header");e.resizeCanvas();return e};i.prototype.onViewFilter=function(i){if(!t.prototype.onViewFilter.call(this,i)){return false}var r=this.view.getItems();var n=this;return e.SlickTreeHelper.filterCustom(i,function(e){if(e.parentId==null){return null}if(n.byId==null){n.byId={};for(var t=0;t<r.length;t++){var i=r[t];if(i.id!=null){n.byId[i.id]=i}}}return n.byId[e.parentId]})};i.prototype.getInitialCollapse=function(){return false};i.prototype.onViewProcessData=function(i){i=t.prototype.onViewProcessData.call(this,i);this.byId=null;e.SlickTreeHelper.setIndents(i.Entities,function(e){return e.id},function(e){return e.parentId},this.getInitialCollapse());return i};i.prototype.onClick=function(i,r,n){t.prototype.onClick.call(this,i,r,n);if(!i.isDefaultPrevented()){e.SlickTreeHelper.toggleClick(i,r,n,this.view,function(e){return e.id})}if(i.isDefaultPrevented()){return}var a=$(i.target);if(a.hasClass("check-box")){i.preventDefault();if(this._readOnly)return;var o=a.hasClass("checked")||a.hasClass("partial");var l=this.itemAt(r);var s=l.isSelected!==!o;this.view.beginUpdate();try{if(l.isSelected!==!o){l.isSelected=!o;this.view.updateItem(l.id,l);this.itemSelectedChanged(l)}s=this.setAllSubTreeSelected(l,l.isSelected)||s;this.updateSelectAll();this.updateFlags()}finally{this.view.endUpdate()}if(s){this.element.triggerHandler("change")}}};i.prototype.updateSelectAll=function(){e.GridSelectAllButtonHelper.update(this,function(e){return e.isSelected})};i.prototype.updateFlags=function(){var e=this.view;var t=e.getItems();var i=this.isThreeStateHierarchy();if(!i){return}e.beginUpdate();try{for(var r=0;r<t.length;r++){var n=t[r];if(n.children==null||n.children.length===0){var a=this.getDescendantsSelected(n);if(a!==n.isAllDescendantsSelected){n.isAllDescendantsSelected=a;e.updateItem(n.id,n)}continue}var o=this.allDescendantsSelected(n);var l=o||this.anyDescendantsSelected(n);if(o!==n.isAllDescendantsSelected||l!==n.isSelected){var s=n.isSelected!==l;n.isAllDescendantsSelected=o;n.isSelected=l;e.updateItem(n.id,n);if(s){this.itemSelectedChanged(n)}}}}finally{e.endUpdate()}};i.prototype.getDescendantsSelected=function(e){return true};i.prototype.setAllSubTreeSelected=function(e,t){var i=false;for(var r=0;r<e.children.length;r++){var n=e.children[r];if(n.isSelected!==t){i=true;n.isSelected=t;this.view.updateItem(n.id,n);this.itemSelectedChanged(n)}if(n.children.length>0){i=this.setAllSubTreeSelected(n,t)||i}}return i};i.prototype.allItemsSelected=function(){for(var e=0;e<this.rowCount();e++){var t=this.itemAt(e);if(!t.isSelected){return false}}return this.rowCount()>0};i.prototype.allDescendantsSelected=function(e){if(e.children.length>0){for(var t=0;t<e.children.length;t++){var i=e.children[t];if(!i.isSelected){return false}if(!this.allDescendantsSelected(i)){return false}}}return true};i.prototype.getDelimited=function(){return!!!!this.options["delimited"]};i.prototype.anyDescendantsSelected=function(e){if(e.children.length>0){for(var t=0;t<e.children.length;t++){var i=e.children[t];if(i.isSelected){return true}if(this.anyDescendantsSelected(i)){return true}}}return false};i.prototype.getColumns=function(){var t=this;var i=this;var r=[];r.push({field:"text",name:"Kayıt",width:80,format:e.SlickFormatting.treeToggle(function(){return i.view},function(e){return e.id},function(e){var i="check-box";var r=e.item;if(r.hideCheckBox){return t.getItemText(e)}var n=t.isThreeStateHierarchy();if(r.isSelected){if(n&&!r.isAllDescendantsSelected){i+=" partial"}else{i+=" checked"}}if(t._readOnly)i+=" readonly";return'<span class="'+i+'"></span>'+t.getItemText(e)})});return r};i.prototype.getItemText=function(e){return Q.htmlEncode(e.value)};i.prototype.getSlickOptions=function(){var e=t.prototype.getSlickOptions.call(this);e.forceFitColumns=true;return e};i.prototype.sortItems=function(){if(!this.moveSelectedUp()){return}var e={};var t=this.view.getItems();var i=0;for(var r=0;r<t.length;r++){var n=t[r];e[n.id]=i++}t.sort(function(t,i){if(t.isSelected&&!i.isSelected){return-1}if(i.isSelected&&!t.isSelected){return 1}var r=Q.Culture.stringCompare(t.text,i.text);if(r!==0){return r}return e[t.id]<e[i.id]?-1:e[t.id]>e[i.id]?1:0});this.view.setItems(t,true)};i.prototype.moveSelectedUp=function(){return false};i.prototype.get_readOnly=function(){return this._readOnly};i.prototype.set_readOnly=function(e){if(!!this._readOnly!=!!e){this._readOnly=!!e;this.view.refresh()}};i.prototype.get_value=function(){var e=[];var t=this.view.getItems();for(var i=0;i<t.length;i++){if(t[i].isSelected){e.push(t[i].id)}}return e};Object.defineProperty(i.prototype,"value",{get:function(){return this.get_value()},set:function(e){this.set_value(e)},enumerable:true,configurable:true});i.prototype.set_value=function(e){var t={};if(e!=null){if(typeof e=="string"){e=e.split(",").map(function(e){return Q.trimToNull(e)}).filter(function(e){return e!=null})}for(var i=0;i<e.length;i++){t[e[i]]=true}}this.view.beginUpdate();try{var r=this.view.getItems();for(var n=0;n<r.length;n++){var a=r[n];var o=t[a.id];if(o!==a.isSelected){a.isSelected=o;this.view.updateItem(a.id,a)}}this.updateSelectAll();this.updateFlags();this.sortItems()}finally{this.view.endUpdate()}};i=__decorate([e.Decorators.registerEditor("Serenity.CheckTreeEditor",[e.IGetEditValue,e.ISetEditValue,e.IReadOnly]),e.Decorators.element("<div/>")],i);return i}(e.DataGrid);e.CheckTreeEditor=t;var i=function(t){__extends(i,t);function i(e,i){var r=t.call(this,e,i)||this;r.enableUpdateItems=true;r.setCascadeFrom(r.options.cascadeFrom);r.updateItems();Q.ScriptData.bindToChange("Lookup."+r.getLookupKey(),r.uniqueName,function(){return r.updateItems()});return r}i.prototype.updateItems=function(){if(this.enableUpdateItems)t.prototype.updateItems.call(this)};i.prototype.getLookupKey=function(){return this.options.lookupKey};i.prototype.getButtons=function(){return Q.coalesce(t.prototype.getButtons.call(this),this.options.hideSearch?null:[])};i.prototype.createToolbarExtensions=function(){var i=this;t.prototype.createToolbarExtensions.call(this);e.GridUtils.addQuickSearchInputCustom(this.toolbar.element,function(e,t){i.searchText=Select2.util.stripDiacritics(t||"").toUpperCase();i.view.setItems(i.view.getItems(),true)})};i.prototype.getSelectAllText=function(){if(!this.options.showSelectAll)return null;return t.prototype.getSelectAllText.call(this)};i.prototype.cascadeItems=function(t){var i=this.get_cascadeValue();if(i==null||i===""){if(!Q.isEmptyOrNull(this.get_cascadeField())){return[]}return t}var r=i.toString();var n=this.get_cascadeField();return t.filter(function(t){var i=Q.coalesce(t[n],e.ReflectionUtils.getPropertyValue(t,n));return!!(i!=null&&i.toString()===r)})};i.prototype.filterItems=function(t){var i=this.get_filterValue();if(i==null||i===""){return t}var r=i.toString();var n=this.get_filterField();return t.filter(function(t){var i=Q.coalesce(t[n],e.ReflectionUtils.getPropertyValue(t,n));return!!(i!=null&&i.toString()===r)})};i.prototype.getLookupItems=function(e){return this.filterItems(this.cascadeItems(e.items))};i.prototype.getTreeItems=function(){var e=Q.getLookup(this.options.lookupKey);var t=this.getLookupItems(e);return t.map(function(t){return{id:Q.coalesce(t[e.idField],"").toString(),text:Q.coalesce(t[e.textField],"").toString(),source:t}})};i.prototype.onViewFilter=function(e){return t.prototype.onViewFilter.call(this,e)&&(Q.isEmptyOrNull(this.searchText)||Select2.util.stripDiacritics(e.text||"").toUpperCase().indexOf(this.searchText)>=0)};i.prototype.moveSelectedUp=function(){return this.options.checkedOnTop};i.prototype.get_cascadeFrom=function(){return this.options.cascadeFrom};Object.defineProperty(i.prototype,"cascadeFrom",{get:function(){return this.get_cascadeFrom()},set:function(e){this.set_cascadeFrom(e)},enumerable:true,configurable:true});i.prototype.getCascadeFromValue=function(t){return e.EditorUtils.getValue(t)};i.prototype.setCascadeFrom=function(t){var i=this;if(Q.isEmptyOrNull(t)){if(this.cascadeLink!=null){this.cascadeLink.set_parentID(null);this.cascadeLink=null}this.options.cascadeFrom=null;return}this.cascadeLink=new e.CascadedWidgetLink(e.Widget,this,function(e){i.set_cascadeValue(i.getCascadeFromValue(e))});this.cascadeLink.set_parentID(t);this.options.cascadeFrom=t};i.prototype.set_cascadeFrom=function(e){if(e!==this.options.cascadeFrom){this.setCascadeFrom(e);this.updateItems()}};i.prototype.get_cascadeField=function(){return Q.coalesce(this.options.cascadeField,this.options.cascadeFrom)};Object.defineProperty(i.prototype,"cascadeField",{get:function(){return this.get_cascadeField()},set:function(e){this.set_cascadeField(e)},enumerable:true,configurable:true});i.prototype.set_cascadeField=function(e){this.options.cascadeField=e};i.prototype.get_cascadeValue=function(){return this.options.cascadeValue};Object.defineProperty(i.prototype,"cascadeValue",{get:function(){return this.get_cascadeValue()},set:function(e){this.set_cascadeValue(e)},enumerable:true,configurable:true});i.prototype.set_cascadeValue=function(e){if(this.options.cascadeValue!==e){this.options.cascadeValue=e;this.value=[];this.updateItems()}};i.prototype.get_filterField=function(){return this.options.filterField};Object.defineProperty(i.prototype,"filterField",{get:function(){return this.get_filterField()},set:function(e){this.set_filterField(e)},enumerable:true,configurable:true});i.prototype.set_filterField=function(e){this.options.filterField=e};i.prototype.get_filterValue=function(){return this.options.filterValue};Object.defineProperty(i.prototype,"filterValue",{get:function(){return this.get_filterValue()},set:function(e){this.set_filterValue(e)},enumerable:true,configurable:true});i.prototype.set_filterValue=function(e){if(this.options.filterValue!==e){this.options.filterValue=e;this.value=null;this.updateItems()}};i=__decorate([e.Decorators.registerEditor("Serenity.CheckLookupEditor")],i);return i}(t);e.CheckLookupEditor=i})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(t){var i=function(t){__extends(i,t);function i(e){var i=t.call(this,e)||this;if(e.reportKey){i.loadReport(e.reportKey)}return i}i.prototype.createPropertyGrid=function(){if(this.propertyGrid){this.byId("PropertyGrid").html("").attr("class","");this.propertyGrid=null}this.propertyGrid=new e.PropertyGrid(this.byId("PropertyGrid"),{idPrefix:this.idPrefix,useCategories:true,items:this.propertyItems}).init(null)};i.prototype.loadReport=function(e){var t=this;Q.serviceCall({service:"Report/Retrieve",request:{ReportKey:e},onSuccess:function(i){t.reportKey=Q.coalesce(i.ReportKey,e);t.propertyItems=i.Properties||[];t.dialogTitle=i.Title;t.createPropertyGrid();var r=i.InitialSettings;if(r==null){r=new Object}t.propertyGrid.load(r);t.toolbar.findButton("print-preview-button").toggle(!i.IsDataOnlyReport);t.toolbar.findButton("export-pdf-button").toggle(!i.IsDataOnlyReport);t.toolbar.findButton("export-docx-button").toggle(!i.IsDataOnlyReport);t.dialogOpen(null)}})};i.prototype.executeReport=function(e,t){if(!this.validateForm()){return}var i=new Object;this.propertyGrid.save(i);Q.postToService({service:"Report/Execute",request:{ReportKey:this.reportKey,DesignId:"Default",ExportType:t,Parameters:i},target:e})};i.prototype.getToolbarButtons=function(){var e=this;var t=[];t.push({title:"Önizleme",cssClass:"print-preview-button",onClick:function(){e.executeReport("_blank",null)}});t.push({title:"PDF",cssClass:"export-pdf-button",onClick:function(){e.executeReport("","Pdf")}});t.push({title:"Excel",cssClass:"export-xlsx-button",onClick:function(){e.executeReport("","Xlsx")}});t.push({title:"Word",cssClass:"export-docx-button",onClick:function(){e.executeReport("","Docx")}});return t};i=__decorate([e.Decorators.registerClass("Serenity.Reporting.ReportDialog")],i);return i}(e.TemplatedDialog);t.ReportDialog=i;var r=function(t){__extends(r,t);function r(i){var r=t.call(this,i)||this;$(".report-link").click(function(e){return r.reportLinkClick(e)});$("div.line").click(function(e){return r.categoryClick(e)});var n=r;new e.QuickSearchInput($("#QuickSearchInput"),{onSearch:function(e,t,i){n.updateMatchFlags(t);i(true)}});return r}r.prototype.updateMatchFlags=function(e){var t=$("#ReportList").find("li").removeClass("non-match");e=Q.trimToNull(e);if(e==null){t.children("ul").hide();t.show().removeClass("expanded");return}var i=e.replace(","," ").split(" ");for(var r=0;r<i.length;r++){i[r]=Q.trimToNull(Select2.util.stripDiacritics(i[r]).toUpperCase())}var n=t.filter(".report-item");n.each(function(e,t){var r=$(t);var n=Select2.util.stripDiacritics(Q.coalesce(r.text(),"").toUpperCase());for(var a=0;a<i.length;a++){var o=i[a];if(o!=null&&!(n.indexOf(o)!==-1)){r.addClass("non-match");break}}});var a=n.not(".non-match");var o=a.parents("li").add(a);var l=t.not(o);l.hide().addClass("non-match");o.show();if(o.length<=100){t.children("ul").show();t.addClass("expanded")}};r.prototype.categoryClick=function(e){var t=$(e.target).closest("li");if(t.hasClass("expanded")){t.find("ul").hide("fast");t.removeClass("expanded");t.find("li").removeClass("expanded")}else{t.addClass("expanded");t.children("ul").show("fast");if(t.children("ul").children("li").length===1&&!t.children("ul").children("li").hasClass("expanded")){t.children("ul").children("li").children(".line").click()}}};r.prototype.reportLinkClick=function(e){e.preventDefault();var t=new i({reportKey:$(e.target).data("key")})};r=__decorate([e.Decorators.registerClass("Serenity.Reporting.ReportPage")],r);return r}(e.Widget);t.ReportPage=r})(t=e.Reporting||(e.Reporting={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(e,i){return t.call(this,e,i)||this}i.prototype.getLookupKey=function(){return Q.coalesce(this.options.lookupKey,t.prototype.getLookupKey.call(this))};i=__decorate([e.Decorators.registerEditor("Serenity.AsyncLookupEditor",[e.ISetEditValue,e.IGetEditValue,e.IStringValue,e.IReadOnly])],i);return i}(e.LookupEditorBase);e.AsyncLookupEditor=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(){function t(){}t=__decorate([e.Decorators.registerClass("Serenity.ScriptContext")],t);return t}();e.ScriptContext=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(){function t(){}t=__decorate([e.Decorators.registerInterface("Serenity.IAsyncInit")],t);return t}();e.IAsyncInit=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(t){function i(e,t){return e.getWidget(t)}t.getWidget=i;t.getWidgetName=e.Widget.getWidgetName;function r(e){return!!!(typeof e.originalEvent==="undefined")}t.hasOriginalEvent=r;function n(e,t){e.change(t)}t.change=n;function a(e,t){e.changeSelect2(t)}t.changeSelect2=a;function o(e){return e.getGridField()}t.getGridField=o})(t=e.WX||(e.WX={}))})(Serenity||(Serenity={}));$.fn.flexHeightOnly=function(e){if(e===void 0){e=1}return this.flexWidthHeight(0,e)};$.fn.flexWidthOnly=function(e){if(e===void 0){e=1}return this.flexWidthHeight(e,0)};$.fn.flexWidthHeight=function(e,t){if(e===void 0){e=1}if(t===void 0){t=1}return this.addClass("flexify").data("flex-x",e).data("flex-y",t)};$.fn.flexX=function(e){return this.data("flex-x",e)};$.fn.flexY=function(e){return this.data("flex-y",e)};var Serenity;(function(e){var t=function(){function t(e){if(e===void 0){e=true}this.value=e}t=__decorate([e.Decorators.registerClass("Serenity.FlexifyAttribute")],t);return t}();e.FlexifyAttribute=t;var i=function(t){__extends(i,t);function i(i,r){var n=t.call(this,i,r)||this;n.xDifference=0;n.yDifference=0;e.LazyLoadHelper.executeOnceWhenShown(i,function(){n.storeInitialSize()});return n}i.prototype.storeInitialSize=function(){var e=this;if(!!this.element.data("flexify-init")){return}var t=this.options.designWidth;if(t==null)t=this.element.width();this.element.data("flexify-width",t);var i=this.options.designHeight;if(i==null)i=this.element.height();this.element.data("flexify-height",i);this.element.data("flexify-init",true);this.element.bind("resize."+this.uniqueName,function(){return e.resizeElements()});this.element.bind("resizestop."+this.uniqueName,function(){return e.resizeElements()});var r=this.element.find(".ui-tabs");if(r.length>0){r.bind("tabsactivate."+this.uniqueName,function(){return e.resizeElements()})}if(this.options.designWidth!=null||this.options.designHeight!=null)this.resizeElements()};i.prototype.getXFactor=function(e){var t=null;if(this.options.getXFactor!=null)t=this.options.getXFactor(e);if(t==null)t=e.data("flex-x");return Q.coalesce(t,1)};i.prototype.getYFactor=function(e){var t=null;if(this.options.getYFactor!=null)t=this.options.getYFactor(e);if(t==null)t=e.data("flex-y");return Q.coalesce(t,0)};i.prototype.resizeElements=function(){var e=this;var t=this.element.width();var i=this.element.data("flexify-width");if(i==null){this.element.data("flexify-width",t);i=t}var r=this.element.height();var n=this.element.data("flexify-height");if(n==null){this.element.data("flexify-height",r);n=r}this.xDifference=t-i;this.yDifference=r-n;var a=this.element;var o=this.element.find(".ui-tabs-panel");if(o.length>0){a=o.filter(":visible")}a.find(".flexify").add(o.filter(".flexify:visible")).each(function(t,i){e.resizeElement($(i))
})};i.prototype.resizeElement=function(e){var t=this.getXFactor(e);if(t!==0){var i=e.data("flexify-width");if(i==null){var r=e.width();e.data("flexify-width",r);i=r}e.width(i+t*this.xDifference|0)}var n=this.getYFactor(e);if(n!==0){var a=e.data("flexify-height");if(a==null){var o=e.height();e.data("flexify-height",o);a=o}e.height(a+n*this.yDifference|0)}if(e.hasClass("require-layout")){e.triggerHandler("layout")}};return i}(e.Widget);e.Flexify=i})(Serenity||(Serenity={}));(function(e){var t;(function(t){function i(i){if(i===void 0){i=true}return function(r){t.addAttribute(r,new e.FlexifyAttribute(i))}}t.flexify=i})(t=e.Decorators||(e.Decorators={}))})(Serenity||(Serenity={}));(function(e){var t;(function(t){function i(t){new e.Flexify(t.closest(".ui-dialog"),{});return t}t.dialogFlexify=i})(t=e.DialogExtensions||(e.DialogExtensions={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(i,r){var n=t.call(this,i,r)||this;var a=new google.maps.LatLng(Q.coalesce(n.options.latitude,0),Q.coalesce(n.options.longitude,0));var o=new Object;o.center=a;o.mapTypeId=Q.coalesce(n.options.mapTypeId,"roadmap");o.zoom=Q.coalesce(n.options.zoom,15);o.zoomControl=true;n.map=new google.maps.Map(i[0],o);if(n.options.markerTitle!=null){var l=new Object;var s=n.options.markerLatitude;if(s==null){s=Q.coalesce(n.options.latitude,0)}var u=n.options.markerLongitude;if(u==null){u=Q.coalesce(n.options.longitude,0)}l.position=new google.maps.LatLng(s,u);l.map=n.map;l.title=n.options.markerTitle;l.animation=2;new google.maps.Marker(l)}e.LazyLoadHelper.executeOnceWhenShown(i,function(){google.maps.event.trigger(n.map,"resize",[]);n.map.setCenter(a)});return n}i.prototype.get_map=function(){return this.map};i=__decorate([e.Decorators.registerEditor("Serenity.GoogleMap",[]),e.Decorators.element("<div/>")],i);return i}(e.Widget);e.GoogleMap=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(i,t);function i(i,r){var n=t.call(this,i,r)||this;n.pageSize=50;var a=n.emptyItemText();if(a!=null)i.attr("placeholder",a);i.select2(n.getSelect2Options());i.attr("type","text");i.on("change."+n.uniqueName,function(t,r){if(e.WX.hasOriginalEvent(t)||!r){if(e.ValidationHelper.getValidator(i)!=null)i.valid()}});return n}i.prototype.emptyItemText=function(){var e=this.element.attr("placeholder");if(e==null){e=Q.text("Controls.SelectEditor.EmptyItemText")}return e};i.prototype.getService=function(){throw new Error("Not implemented!")};i.prototype.query=function(e,t){var i={blockUI:false,service:this.getService()+"/List",request:e,onSuccess:function(e){t(e)}};this.executeQuery(i)};i.prototype.executeQuery=function(e){Q.serviceCall(e)};i.prototype.queryByKey=function(e,t){var i={blockUI:false,service:this.getService()+"/Retrieve",request:{EntityId:e},onSuccess:function(e){t(e.Entity)}};this.executeQueryByKey(i)};i.prototype.executeQueryByKey=function(e){Q.serviceCall(e)};i.prototype.getItemKey=function(e){return null};i.prototype.getItemText=function(e){return null};i.prototype.getTypeDelay=function(){return 500};i.prototype.getSelect2Options=function(){var e=this;var t=this.emptyItemText();var i=0;return{minimumResultsForSearch:10,placeHolder:!Q.isEmptyOrNull(t)?t:null,allowClear:Q.isValue(t),query:function(t){var r={ContainsText:Q.trimToNull(t.term),Skip:(t.page-1)*e.pageSize,Take:e.pageSize+1};if(i!==0){window.clearTimeout(i)}i=window.setTimeout(function(){e.query(r,function(i){t.callback({results:i.Entities.slice(0,e.pageSize).map(function(t){return{id:e.getItemKey(t),text:e.getItemText(t),source:t}}),more:i.Entities.length>=e.pageSize})})},e.getTypeDelay())},initSelection:function(t,i){var r=t.val();if(Q.isEmptyOrNull(r)){i(null);return}e.queryByKey(r,function(t){i(t==null?null:{id:e.getItemKey(t),text:e.getItemText(t),source:t})})}}};i.prototype.addInplaceCreate=function(e){var t=this;$("<a><b/></a>").addClass("inplace-button inplace-create").attr("title",e).insertAfter(this.element).click(function(e){t.inplaceCreateClick(e)});this.get_select2Container().add(this.element).addClass("has-inplace-button")};i.prototype.inplaceCreateClick=function(e){};i.prototype.get_select2Container=function(){return this.element.prevAll(".select2-container")};i.prototype.get_value=function(){return Q.safeCast(this.element.select2("val"),String)};Object.defineProperty(i.prototype,"value",{get:function(){return this.get_value()},set:function(e){this.set_value(e)},enumerable:true,configurable:true});i.prototype.set_value=function(e){if(e!==this.get_value()){var t=this.element;t.select2("val",e);t.data("select2-change-triggered",true);t.triggerHandler("change",[true]);t.data("select2-change-triggered",false)}};i=__decorate([e.Decorators.registerEditor("Serenity.Select2AjaxEditor",[e.IStringValue]),e.Decorators.element('<input type="hidden" />')],i);return i}(e.Widget);e.Select2AjaxEditor=t})(Serenity||(Serenity={}));