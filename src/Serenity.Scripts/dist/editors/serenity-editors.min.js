var Serenity;(function(e){var t=function(t){__extends(r,t);function r(e){return t.call(this,e)||this}Object.defineProperty(r.prototype,"value",{get:function(){return this.element.val()},set:function(e){this.element.val(e)},enumerable:true,configurable:true});r.prototype.get_value=function(){return this.value};r.prototype.set_value=function(e){this.value=e};r=__decorate([e.Decorators.registerEditor("Serenity.StringEditor",[e.IStringValue]),e.Decorators.element('<input type="text"/>')],r);return r}(e.Widget);e.StringEditor=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(r,t);function r(e){var r=t.call(this,e)||this;e.attr("type","password");return r}r=__decorate([e.Decorators.registerEditor("Serenity.PasswordEditor")],r);return r}(e.StringEditor);e.PasswordEditor=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(r,t);function r(e,r){var i=t.call(this,e,r)||this;if(i.options.cols!==0){e.attr("cols",Q.coalesce(i.options.cols,80))}if(i.options.rows!==0){e.attr("rows",Q.coalesce(i.options.rows,6))}return i}Object.defineProperty(r.prototype,"value",{get:function(){return this.element.val()},set:function(e){this.element.val(e)},enumerable:true,configurable:true});r.prototype.get_value=function(){return this.value};r.prototype.set_value=function(e){this.value=e};r=__decorate([e.Decorators.registerEditor("Sereniy.TextAreaEditor",[e.IStringValue]),e.Decorators.element("<textarea />")],r);return r}(e.Widget);e.TextAreaEditor=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(r,t);function r(){return t!==null&&t.apply(this,arguments)||this}Object.defineProperty(r.prototype,"value",{get:function(){return this.element.is(":checked")},set:function(e){this.element.prop("checked",!!e)},enumerable:true,configurable:true});r.prototype.get_value=function(){return this.value};r.prototype.set_value=function(e){this.value=e};r=__decorate([e.Decorators.registerEditor("Serenity.BooleanEditor",[e.IBooleanValue]),e.Decorators.element('<input type="checkbox"/>')],r);return r}(e.Widget);e.BooleanEditor=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(r,t);function r(r,i){var n=t.call(this,r,i)||this;r.addClass("decimalQ");var a=Q.extend(e.DecimalEditor.defaultAutoNumericOptions(),{vMin:Q.coalesce(n.options.minValue,n.options.allowNegatives?n.options.maxValue!=null?"-"+n.options.maxValue:"-999999999999.99":"0.00"),vMax:Q.coalesce(n.options.maxValue,"999999999999.99")});if(n.options.decimals!=null){a.mDec=n.options.decimals}if(n.options.padDecimals!=null){a.aPad=n.options.padDecimals}if($.fn.autoNumeric)r.autoNumeric(a);return n}r.prototype.get_value=function(){if($.fn.autoNumeric){var e=this.element.autoNumeric("get");if(!!(e==null||e===""))return null;return parseFloat(e)}var e=this.element.val();return Q.parseDecimal(e)};Object.defineProperty(r.prototype,"value",{get:function(){return this.get_value()},set:function(e){this.set_value(e)},enumerable:true,configurable:true});r.prototype.set_value=function(e){if(e==null||e===""){this.element.val("")}else if($.fn.autoNumeric){this.element.autoNumeric("set",e)}else this.element.val(Q.formatNumber(e))};r.prototype.get_isValid=function(){return!isNaN(this.get_value())};r.defaultAutoNumericOptions=function(){return{aDec:Q.Culture.decimalSeparator,altDec:Q.Culture.decimalSeparator==="."?",":".",aSep:Q.Culture.decimalSeparator==="."?",":".",aPad:true}};r=__decorate([e.Decorators.registerEditor("Serenity.DecimalEditor",[e.IDoubleValue]),e.Decorators.element('<input type="text"/>')],r);return r}(e.Widget);e.DecimalEditor=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(r,t);function r(r,i){var n=t.call(this,r,i)||this;r.addClass("integerQ");var a=Q.extend(e.DecimalEditor.defaultAutoNumericOptions(),{vMin:Q.coalesce(n.options.minValue,n.options.allowNegatives?n.options.maxValue!=null?"-"+n.options.maxValue:"-2147483647":"0"),vMax:Q.coalesce(n.options.maxValue,2147483647),aSep:null});if($.fn.autoNumeric)r.autoNumeric(a);return n}r.prototype.get_value=function(){if($.fn.autoNumeric){var e=this.element.autoNumeric("get");if(!!Q.isTrimmedEmpty(e))return null;else return parseInt(e,10)}else{var e=Q.trimToNull(this.element.val());if(e==null)return null;return Q.parseInteger(e)}};Object.defineProperty(r.prototype,"value",{get:function(){return this.get_value()},set:function(e){this.set_value(e)},enumerable:true,configurable:true});r.prototype.set_value=function(e){if(e==null||e==="")this.element.val("");else if($.fn.autoNumeric)this.element.autoNumeric("set",e);else this.element.val(Q.formatNumber(e))};r.prototype.get_isValid=function(){return!isNaN(this.get_value())};r=__decorate([e.Decorators.registerEditor("Serenity.IntegerEditor",[e.IDoubleValue]),e.Decorators.element('<input type="text"/>')],r);return r}(e.Widget);e.IntegerEditor=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=e.Decorators.option;e.datePickerIconSvg='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 17 17"><g></g><path d="M14 2v-1h-3v1h-5v-1h-3v1h-3v15h17v-15h-3zM12 2h1v2h-1v-2zM4 2h1v2h-1v-2zM16 16h-15v-8.921h15v8.921zM1 6.079v-3.079h2v2h3v-2h5v2h3v-2h2v3.079h-15z" fill="#000000"></path></svg>';var r=function(r){__extends(i,r);function i(t){var i=r.call(this,t)||this;if(typeof flatpickr!=="undefined"&&(n.useFlatpickr||!$.fn.datepicker)){flatpickr(t[0],n.flatPickrOptions(t))}else if($.fn.datepicker){t.datepicker({showOn:"button",beforeShow:function(e,r){return!t.hasClass("readonly")},yearRange:Q.coalesce(i.yearRange,"-100:+50")})}else{t.attr("type","date")}t.on("keyup."+i.uniqueName,function(t){if(t.which===32&&!i.get_readOnly()){if(i.get_valueAsDate()!=Q.today()){i.set_valueAsDate(Q.today());i.element.trigger("change")}}else{e.DateEditor.dateInputKeyup(t)}});t.on("change."+i.uniqueName,e.DateEditor.dateInputChange);Q.addValidationRule(t,i.uniqueName,function(e){var t=i.get_value();if(Q.isEmptyOrNull(t)){return null}if(!Q.isEmptyOrNull(i.get_minValue())&&Q.Invariant.stringCompare(t,i.get_minValue())<0){return Q.format(Q.text("Validation.MinDate"),Q.formatDate(i.get_minValue(),null))}if(!Q.isEmptyOrNull(i.get_maxValue())&&Q.Invariant.stringCompare(t,i.get_maxValue())>=0){return Q.format(Q.text("Validation.MaxDate"),Q.formatDate(i.get_maxValue(),null))}return null});i.set_sqlMinMax(true);return i}n=i;i.flatPickrOptions=function(e){return{clickOpens:true,allowInput:true,dateFormat:Q.Culture.dateOrder.split("").join(Q.Culture.dateSeparator).replace("y","Y"),onChange:function(){e.triggerHandler("change")}}};i.prototype.get_value=function(){var e=this.element.val().trim();if(e!=null&&e.length===0){return null}return Q.formatDate(e,"yyyy-MM-dd")};Object.defineProperty(i.prototype,"value",{get:function(){return this.get_value()},set:function(e){this.set_value(e)},enumerable:true,configurable:true});i.prototype.set_value=function(e){if(e==null){this.element.val("")}else if(e.toLowerCase()==="today"||e.toLowerCase()==="now"){this.element.val(Q.formatDate(Q.today(),null))}else{this.element.val(Q.formatDate(e,null))}};i.prototype.get_valueAsDate=function(){if(Q.isEmptyOrNull(this.get_value())){return null}return Q.parseISODateTime(this.get_value())};Object.defineProperty(i.prototype,"valueAsDate",{get:function(){return this.get_valueAsDate()},set:function(e){this.set_valueAsDate(e)},enumerable:true,configurable:true});i.prototype.set_valueAsDate=function(e){if(e==null){this.set_value(null)}this.set_value(Q.formatDate(e,"yyyy-MM-dd"))};i.prototype.get_readOnly=function(){return this.element.hasClass("readonly")};i.prototype.set_readOnly=function(e){if(e!==this.get_readOnly()){if(e){this.element.addClass("readonly").attr("readonly","readonly");this.element.nextAll(".ui-datepicker-trigger").css("opacity","0.1")}else{this.element.removeClass("readonly").removeAttr("readonly");this.element.nextAll(".ui-datepicker-trigger").css("opacity","1")}}};i.prototype.get_minValue=function(){return this.minValue};i.prototype.set_minValue=function(e){this.minValue=e};i.prototype.get_maxValue=function(){return this.maxValue};i.prototype.set_maxValue=function(e){this.maxValue=e};i.prototype.get_minDate=function(){return Q.parseISODateTime(this.get_minValue())};i.prototype.set_minDate=function(e){this.set_minValue(Q.formatDate(e,"yyyy-MM-dd"))};i.prototype.get_maxDate=function(){return Q.parseISODateTime(this.get_maxValue())};i.prototype.set_maxDate=function(e){this.set_maxValue(Q.formatDate(e,"yyyy-MM-dd"))};i.prototype.get_sqlMinMax=function(){return this.get_minValue()==="1753-01-01"&&this.get_maxValue()==="9999-12-31"};i.prototype.set_sqlMinMax=function(e){if(e){this.set_minValue("1753-01-01");this.set_maxValue("9999-12-31")}else{this.set_minValue(null);this.set_maxValue(null)}};i.flatPickrTrigger=function(t){return $('<i class="ui-datepicker-trigger" href="javascript:;">'+e.datePickerIconSvg+"</i>").insertAfter(t).click(function(){if(!t.hasClass("readonly"))t[0]._flatpickr.open()})};i.dateInputKeyup=function(e){if(Q.Culture.dateOrder!=="dmy"){return}var t=$(e.target);if(!t.is(":input")||t.attr("type")=="date"){return}if(t.is("[readonly]")||t.is(":disabled")){return}var r=Q.coalesce(t.val(),"");if(!!(r.length===0||t[0].selectionEnd!==r.length)){return}if(r.indexOf(Q.Culture.dateSeparator+Q.Culture.dateSeparator)!==-1){t.val(Q.replaceAll(r,Q.Culture.dateSeparator+Q.Culture.dateSeparator,Q.Culture.dateSeparator));return}function i(e){return e>=48&&e<=57}if(e.which===47||e.which===111){if(r.length>=2&&r.charAt(r.length-1)===Q.Culture.dateSeparator&&r.charAt(r.length-2)===Q.Culture.dateSeparator){t.val(r.substr(0,r.length-1));return}if(r.charAt(r.length-1)!==Q.Culture.dateSeparator){return}switch(r.length){case 2:{if(i(r.charCodeAt(0))){r="0"+r;break}else{return}}case 4:{if(i(r.charCodeAt(0))&&i(r.charCodeAt(2))&&r.charAt(1)==Q.Culture.dateSeparator){r="0"+r.charAt(0)+Q.Culture.dateSeparator+"0"+r.charAt(2)+Q.Culture.dateSeparator;break}else{return}}case 5:{if(i(r.charCodeAt(0))&&i(r.charCodeAt(2))&&i(r.charCodeAt(3))&&r.charAt(1)===Q.Culture.dateSeparator){r="0"+r;break}else if(i(r.charCodeAt(0))&&i(r.charCodeAt(1))&&i(r.charCodeAt(3))&&r.charAt(2)===Q.Culture.dateSeparator){r=r.charAt(0)+r.charAt(1)+Q.Culture.dateSeparator+"0"+r.charAt(3)+Q.Culture.dateSeparator;break}else{break}}default:{return}}t.val(r)}if(r.length<6&&(e.which>=48&&e.which<=57||e.which>=96&&e.which<=105)&&i(r.charCodeAt(r.length-1))){switch(r.length){case 1:{if(r.charCodeAt(0)<=51){return}r="0"+r;break}case 2:{if(!i(r.charCodeAt(0))){return}break}case 3:{if(!i(r.charCodeAt(0))||r.charAt(1)!==Q.Culture.dateSeparator||r.charCodeAt(2)<=49){return}r="0"+r.charAt(0)+Q.Culture.dateSeparator+"0"+r.charAt(2);break}case 4:{if(r.charAt(1)==Q.Culture.dateSeparator){if(!i(r.charCodeAt(0))||!i(r.charCodeAt(2))){return}r="0"+r;break}else if(r.charAt(2)==Q.Culture.dateSeparator){if(!i(r.charCodeAt(0))||!i(r.charCodeAt(1))||r.charCodeAt(3)<=49){return}r=r.charAt(0)+r.charAt(1)+Q.Culture.dateSeparator+"0"+r.charAt(3);break}else{return}}case 5:{if(r.charAt(2)!==Q.Culture.dateSeparator||!i(r.charCodeAt(0))||!i(r.charCodeAt(1))||!i(r.charCodeAt(3))){return}break}default:{return}}t.val(r+Q.Culture.dateSeparator)}};var n;i.dateInputChange=function(e){if(Q.Culture.dateOrder!=="dmy"){return}var t=$(e.target);if(!t.is(":input")||t.attr("type")=="date"){return}var r=Q.coalesce(t.val(),"");var i={};if(r.length>=6&&/^[0-9]*$/g.test(r)){t.val(r.substr(0,2)+Q.Culture.dateSeparator+r.substr(2,2)+Q.Culture.dateSeparator+r.substr(4))}r=Q.coalesce(t.val(),"");if(!!(r.length>=5&&Q.parseDate(r)!==false)){var n=Q.parseDate(r);t.val(Q.formatDate(n,null))}};__decorate([t()],i.prototype,"yearRange",void 0);__decorate([t()],i.prototype,"get_minValue",null);__decorate([t()],i.prototype,"get_maxValue",null);__decorate([t()],i.prototype,"get_maxDate",null);__decorate([t()],i.prototype,"get_sqlMinMax",null);i=n=__decorate([e.Decorators.registerEditor("Serenity.DateEditor",[e.IStringValue,e.IReadOnly]),e.Decorators.element('<input type="text"/>')],i);return i}(e.Widget);e.DateEditor=r;function i(){if(!$.datepicker||!$.datepicker.regional||!$.datepicker.regional.en)return false;var t=Q.Culture.dateOrder;var r=Q.Culture.dateSeparator;var i=($("html").attr("lang")||"en").toLowerCase();if(!$.datepicker.regional[i]){i=i.split("-")[0];if(!$.datepicker.regional[i]){i="en"}}$.datepicker.setDefaults($.datepicker.regional["en"]);$.datepicker.setDefaults($.datepicker.regional[i]);$.datepicker.setDefaults({dateFormat:t=="mdy"?"mm"+r+"dd"+r+"yy":t=="ymd"?"yy"+r+"mm"+r+"dd":"dd"+r+"mm"+r+"yy",buttonImage:"data:image/svg+xml,"+encodeURIComponent(e.datePickerIconSvg),buttonImageOnly:true,showOn:"both",showButtonPanel:true,changeMonth:true,changeYear:true});return true}typeof $!=="undefined"&&!i()&&$(i)})(Serenity||(Serenity={}));var Serenity;(function(e){var t=e.Decorators.option;var r=function(r){__extends(i,r);function i(t,i){var a=r.call(this,t,i)||this;t.addClass("s-DateTimeEditor");if(a.options.inputOnly){t.addClass("dateTimeQ")}else if(typeof flatpickr!=="undefined"&&(e.DateEditor.useFlatpickr||!$.fn.datepicker||a.options.seconds)){t.addClass("dateTimeQ");flatpickr(t[0],a.getFlatpickrOptions())}else if($.fn.datepicker){t.addClass("dateQ");t.datepicker({showOn:"button",beforeShow:function(){return!t.hasClass("readonly")},yearRange:Q.coalesce(a.options.yearRange,"-100:+50")});t.bind("change."+a.uniqueName,function(t){a.lastSetValue=null;e.DateEditor.dateInputChange(t)});a.time=$("<select/>").addClass("editor s-DateTimeEditor time");var o=t.next(".ui-datepicker-trigger");if(o.length>0){a.time.insertAfter(o)}else{o=t.prev(".ui-datepicker-trigger");if(o.length>0){a.time.insertBefore(o)}else{a.time.insertAfter(t)}}a.time.on("change",function(e){this.lastSetValue=null;t.triggerHandler("change")});var l=n.getTimeOptions(Q.coalesce(a.options.startHour,0),0,Q.coalesce(a.options.endHour,23),59,Q.coalesce(a.options.intervalMinutes,5));for(var s=0,u=l;s<u.length;s++){var c=u[s];Q.addOption(a.time,c,c)}Q.addValidationRule(t,a.uniqueName,function(e){var t=a.get_value();if(Q.isEmptyOrNull(t)){return null}if(!Q.isEmptyOrNull(a.get_minValue())&&Q.Invariant.stringCompare(t,a.get_minValue())<0){return Q.format(Q.text("Validation.MinDate"),Q.formatDate(a.get_minValue(),null))}if(!Q.isEmptyOrNull(a.get_maxValue())&&Q.Invariant.stringCompare(t,a.get_maxValue())>=0){return Q.format(Q.text("Validation.MaxDate"),Q.formatDate(a.get_maxValue(),null))}return null})}else t.attr("type","datetime").addClass("dateTimeQ");t.bind("keyup."+a.uniqueName,function(t){if(a.get_readOnly())return;if(a.time){if(t.which===32){if(a.get_valueAsDate()!==new Date){a.set_valueAsDate(new Date);a.element.trigger("change")}}else{var r=a.element.val();e.DateEditor.dateInputKeyup(t);if(r!=a.element.val())a.lastSetValue=null}}});a.set_sqlMinMax(true);if(!a.options.inputOnly){$("<i class='inplace-button inplace-now'><b></b></div>").attr("title",a.getInplaceNowText()).insertAfter(a.time).click(function(e){if(a.element.hasClass("readonly")){return}a.lastSetValue=null;a.set_valueAsDate(new Date);t.triggerHandler("change")})}return a}n=i;i.prototype.getFlatpickrOptions=function(){var e=this;var t;return{clickOpens:true,allowInput:true,enableTime:true,time_24hr:true,enableSeconds:!!this.options.seconds,minuteIncrement:(t=this.options.intervalMinutes)!==null&&t!==void 0?t:5,dateFormat:Q.Culture.dateOrder.split("").join(Q.Culture.dateSeparator).replace("y","Y")+" H:i"+(this.options.seconds?":S":""),onChange:function(){e.lastSetValue=null;e.element&&e.element.triggerHandler("change")}}};i.prototype.get_value=function(){var e=this.element.val().trim();if(e!=null&&e.length===0){return null}var t;if(this.time){var r=Q.formatDate(e,"yyyy-MM-dd");var i=this.time.val();t=r+"T"+i+":00.000"}else t=Q.formatDate(Q.parseDate(this.element.val()),"yyyy-MM-ddTHH:mm:ss.fff");if(this.options.useUtc)t=Q.formatISODateTimeUTC(Q.parseISODateTime(t));if(this.lastSetValue!=null&&this.lastSetValueGet==t)return this.lastSetValue;return t};Object.defineProperty(i.prototype,"value",{get:function(){return this.get_value()},set:function(e){this.set_value(e)},enumerable:true,configurable:true});i.prototype.set_value=function(t){if(Q.isEmptyOrNull(t)){this.element.val("");this.time&&this.time.val("00:00")}else if(t.toLowerCase()==="today"){if(this.time){this.element.val(Q.formatDate(Q.today(),null));this.time.val("00:00")}else{this.element.val(this.getDisplayFormat())}}else{var r=t.toLowerCase()==="now"?new Date:Q.parseISODateTime(t);if(this.time){r=e.DateTimeEditor.roundToMinutes(r,Q.coalesce(this.options.intervalMinutes,5));this.element.val(Q.formatDate(r,null));this.time.val(Q.formatDate(r,"HH:mm"))}else this.element.val(Q.formatDate(r,this.getDisplayFormat()))}this.lastSetValue=null;if(!Q.isEmptyOrNull(t)&&t.toLowerCase()!="today"&&t.toLowerCase()!="now"){this.lastSetValueGet=this.get_value();this.lastSetValue=t}};i.prototype.getInplaceNowText=function(){return Q.coalesce(Q.tryGetText("Controls.DateTimeEditor.SetToNow"),"set to now")};i.prototype.getDisplayFormat=function(){return this.options.seconds?Q.Culture.dateTimeFormat:Q.Culture.dateTimeFormat.replace(":ss","")};i.prototype.get_valueAsDate=function(){if(Q.isEmptyOrNull(this.get_value())){return null}return Q.parseISODateTime(this.get_value())};Object.defineProperty(i.prototype,"valueAsDate",{get:function(){return this.get_valueAsDate()},set:function(e){this.set_valueAsDate(e)},enumerable:true,configurable:true});i.prototype.set_valueAsDate=function(e){if(e==null){this.set_value(null)}this.set_value(Q.formatDate(e,"yyyy-MM-ddTHH:mm"+(this.options.seconds?":ss":"")))};i.prototype.get_minValue=function(){return this.minValue};i.prototype.set_minValue=function(e){this.minValue=e};i.prototype.get_maxValue=function(){return this.maxValue};i.prototype.set_maxValue=function(e){this.maxValue=e};i.prototype.get_minDate=function(){return Q.parseISODateTime(this.get_minValue())};i.prototype.set_minDate=function(e){this.set_minValue(Q.formatDate(e,"yyyy-MM-ddTHH:mm:ss"))};i.prototype.get_maxDate=function(){return Q.parseISODateTime(this.get_maxValue())};i.prototype.set_maxDate=function(e){this.set_maxValue(Q.formatDate(e,"yyyy-MM-ddTHH:mm:ss"))};i.prototype.get_sqlMinMax=function(){return this.get_minValue()==="1753-01-01"&&this.get_maxValue()==="9999-12-31"};i.prototype.set_sqlMinMax=function(e){if(e){this.set_minValue("1753-01-01");this.set_maxValue("9999-12-31")}else{this.set_minValue(null);this.set_maxValue(null)}};i.prototype.get_readOnly=function(){return this.element.hasClass("readonly")};i.prototype.set_readOnly=function(t){if(t!==this.get_readOnly()){if(t){this.element.addClass("readonly").attr("readonly","readonly");this.element.nextAll(".ui-datepicker-trigger").css("opacity","0.1");this.element.nextAll(".inplace-now").css("opacity","0.1")}else{this.element.removeClass("readonly").removeAttr("readonly");this.element.nextAll(".ui-datepicker-trigger").css("opacity","1");this.element.nextAll(".inplace-now").css("opacity","1")}this.time&&e.EditorUtils.setReadonly(this.time,t)}};i.roundToMinutes=function(e,t){e=new Date(e.getTime());var r=Q.trunc(Q.round(e.getMinutes()/t)*t);e.setMinutes(r);e.setSeconds(0);e.setMilliseconds(0);return e};var n;i.getTimeOptions=function(e,t,r,i,n){var a=[];if(r>=23){r=23}if(i>=60){i=59}var o=e;var l=t;while(true){if(o>r||o===r&&l>i){break}var s=(o>=10?"":"0")+o+":"+(l>=10?"":"0")+l;a.push(s);l+=n;if(l>=60){l-=60;o++}}return a};__decorate([t()],i.prototype,"get_minValue",null);__decorate([t()],i.prototype,"get_maxValue",null);__decorate([t()],i.prototype,"get_maxDate",null);__decorate([t()],i.prototype,"get_sqlMinMax",null);i=n=__decorate([e.Decorators.registerEditor("Serenity.DateTimeEditor",[e.IStringValue,e.IReadOnly]),e.Decorators.element('<input type="text"/>')],i);return i}(e.Widget);e.DateTimeEditor=r})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(r,t);function r(e,r){var i=t.call(this,e,r)||this;e.addClass("editor s-TimeEditor hour");if(!i.options.noEmptyOption){Q.addOption(e,"","--")}for(var n=i.options.startHour||0;n<=(i.options.endHour||23);n++){Q.addOption(e,n.toString(),n<10?"0"+n:n.toString())}i.minutes=$("<select/>").addClass("editor s-TimeEditor minute").insertAfter(e);i.minutes.change(function(){return i.element.trigger("change")});for(var a=0;a<=59;a+=i.options.intervalMinutes||5){Q.addOption(i.minutes,a.toString(),a<10?"0"+a:a.toString())}return i}Object.defineProperty(r.prototype,"value",{get:function(){var e=Q.toId(this.element.val());var t=Q.toId(this.minutes.val());if(e==null||t==null){return null}return e*60+t},set:function(e){if(!e){if(this.options.noEmptyOption){this.element.val(this.options.startHour);this.minutes.val("0")}else{this.element.val("");this.minutes.val("0")}}else{this.element.val(Math.floor(e/60).toString());this.minutes.val(e%60)}},enumerable:true,configurable:true});r.prototype.get_value=function(){return this.value};r.prototype.set_value=function(e){this.value=e};r.prototype.get_readOnly=function(){return this.element.hasClass("readonly")};r.prototype.set_readOnly=function(t){if(t!==this.get_readOnly()){if(t){this.element.addClass("readonly").attr("readonly","readonly")}else{this.element.removeClass("readonly").removeAttr("readonly")}e.EditorUtils.setReadonly(this.minutes,t)}};r=__decorate([e.Decorators.registerEditor("Serenity.TimeEditor",[e.IDoubleValue,e.IReadOnly]),e.Decorators.element("<select />")],r);return r}(e.Widget);e.TimeEditor=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(r,t);function r(e){var r=t.call(this,e)||this;e.attr("type","email").addClass("email");return r}r=__decorate([e.Decorators.registerEditor("Serenity.EmailAddressEditor")],r);return r}(e.StringEditor);e.EmailAddressEditor=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(r,t);function r(e,r){var n=t.call(this,e,r)||this;i.registerValidationMethods();e.addClass("emailuser");var a=$("<span/>").text("@").addClass("emailat").insertAfter(e);var o=$('<input type="text"/>').addClass("emaildomain").insertAfter(a);o.bind("blur."+n.uniqueName,function(){var t=o.closest("form").data("validator");if(t!=null){t.element(e[0])}});if(!Q.isEmptyOrNull(n.options.domain)){o.val(n.options.domain)}if(n.options.readOnlyDomain){o.attr("readonly","readonly").addClass("disabled").attr("tabindex","-1")}e.bind("keypress."+n.uniqueName,function(e){if(e.which===64){e.preventDefault();if(!n.options.readOnlyDomain){o.focus();o.select()}}});o.bind("keypress."+n.uniqueName,function(e){if(e.which===64){e.preventDefault()}});if(!n.options.readOnlyDomain){e.change(function(t){return n.set_value(e.val())})}return n}i=r;r.registerValidationMethods=function(){var e;if(!$.validator||!$.validator.methods||$.validator.methods["emailuser"]!=null)return;$.validator.addMethod("emailuser",function(e,t){var r=$(t).nextAll(".emaildomain");if(r.length>0&&r.attr("readonly")==null){if(this.optional(t)&&this.optional(r[0])){return true}return $.validator.methods.email.call(this,e+"@"+r.val(),t)}else{return $.validator.methods.email.call(this,e+"@dummy.com",t)}},(e=Q.tryGetText("Validation.Email"))!==null&&e!==void 0?e:$.validator.messages.email)};r.prototype.get_value=function(){var e=this.element.nextAll(".emaildomain");var t=this.element.val();var r=e.val();if(Q.isEmptyOrNull(t)){if(this.options.readOnlyDomain||Q.isEmptyOrNull(r)){return""}return"@"+r}return t+"@"+r};Object.defineProperty(r.prototype,"value",{get:function(){return this.get_value()},set:function(e){this.set_value(e)},enumerable:true,configurable:true});r.prototype.set_value=function(e){var t=this.element.nextAll(".emaildomain");e=Q.trimToNull(e);if(e==null){if(!this.options.readOnlyDomain)t.val("");this.element.val("")}else{var r=e.split("@");if(r.length>1){if(!this.options.readOnlyDomain){t.val(r[1]);this.element.val(r[0])}else if(!Q.isEmptyOrNull(this.options.domain)){if(r[1]!==this.options.domain)this.element.val(e);else this.element.val(r[0])}else this.element.val(r[0])}else this.element.val(r[0])}};r.prototype.get_readOnly=function(){var e=this.element.nextAll(".emaildomain");return!(this.element.attr("readonly")==null&&(!this.options.readOnlyDomain||e.attr("readonly")==null))};r.prototype.set_readOnly=function(e){var t=this.element.nextAll(".emaildomain");if(e){this.element.attr("readonly","readonly").addClass("readonly");if(!this.options.readOnlyDomain){t.attr("readonly","readonly").addClass("readonly")}}else{this.element.removeAttr("readonly").removeClass("readonly");if(!this.options.readOnlyDomain){t.removeAttr("readonly").removeClass("readonly")}}};var i;r=i=__decorate([e.Decorators.registerEditor("Serenity.EmailEditor",[e.IStringValue,e.IReadOnly]),e.Decorators.element('<input type="text"/>')],r);return r}(e.Widget);e.EmailEditor=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(r,t);function r(e){var r=t.call(this,e)||this;e.addClass("url").attr("title","URL should be entered in format: 'http://www.site.com/page'.");e.on("blur."+r.uniqueName,function(t){var r=e.closest("form").data("validator");if(r==null)return;if(!e.hasClass("error"))return;var i=Q.trimToNull(e.val());if(!i)return;i="http://"+i;if($.validator.methods["url"].call(r,i,e[0])==true){e.val(i);r.element(e)}});return r}r=__decorate([e.Decorators.registerEditor("Serenity.URLEditor",[e.IStringValue])],r);return r}(e.StringEditor);e.URLEditor=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(r,t);function r(r,i){var n=t.call(this,r,i)||this;if(Q.isEmptyOrNull(n.options.enumKey)&&n.options.enumType==null&&Q.isEmptyOrNull(n.options.lookupKey)){return n}if(!Q.isEmptyOrNull(n.options.lookupKey)){var a=Q.getLookup(n.options.lookupKey);for(var o=0,l=a.items;o<l.length;o++){var s=l[o];var u=s[a.textField];var c=u==null?"":u.toString();var d=s[a.idField];var p=d==null?"":d.toString();n.addRadio(p,c)}}else{var f=n.options.enumType||e.EnumTypeRegistry.get(n.options.enumKey);var h=n.options.enumKey;if(h==null&&f!=null){var m=Q.getAttributes(f,e.EnumKeyAttribute,false);if(m.length>0){h=m[0].value}}var y=Q.Enum.getValues(f);for(var g=0,v=y;g<v.length;g++){var _=v[g];var S=Q.Enum.toString(f,_);n.addRadio(_.toString(),Q.coalesce(Q.tryGetText("Enums."+h+"."+S),S))}}return n}r.prototype.addRadio=function(e,t){var r=$("<label/>").text(t);$('<input type="radio"/>').attr("name",this.uniqueName).attr("id",this.uniqueName+"_"+e).attr("value",e).prependTo(r);r.appendTo(this.element)};r.prototype.get_value=function(){return this.element.find("input:checked").first().val()};Object.defineProperty(r.prototype,"value",{get:function(){return this.get_value()},set:function(e){this.set_value(e)},enumerable:true,configurable:true});r.prototype.set_value=function(e){if(e!==this.get_value()){var t=this.element.find("input");var r=t.filter(":checked");if(r.length>0){r[0].checked=false}if(!Q.isEmptyOrNull(e)){r=t.filter("[value="+e+"]");if(r.length>0){r[0].checked=true}}}};r.prototype.get_readOnly=function(){return this.element.attr("disabled")!=null};r.prototype.set_readOnly=function(e){if(this.get_readOnly()!==e){if(e){this.element.attr("disabled","disabled").find("input").attr("disabled","disabled")}else{this.element.removeAttr("disabled").find("input").removeAttr("disabled")}}};r=__decorate([e.Decorators.registerEditor("Serenity.RadioButtonEditor",[e.IStringValue,e.IReadOnly]),e.Decorators.element("<div/>")],r);return r}(e.Widget);e.RadioButtonEditor=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(r,t);function r(e,r){var i=t.call(this,e,r)||this;i._items=[];i._itemById={};var n=i.emptyItemText();if(n!=null){e.attr("placeholder",n)}var a=i.getSelect2Options();e.select2(a);e.attr("type","text");e.on("change."+i.uniqueName,function(t){if(!$(t.target).hasClass("select2-change-triggered")&&e.closest("form").data("validator")){e.valid()}});i.setCascadeFrom(i.options.cascadeFrom);if(i.useInplaceAdd())i.addInplaceCreate(Q.text("Controls.SelectEditor.InplaceAdd"),null);return i}i=r;r.prototype.destroy=function(){if(this.element!=null){this.element.select2("destroy")}t.prototype.destroy.call(this)};r.prototype.hasAsyncSource=function(){return false};r.prototype.asyncSearch=function(e,t){t({items:[],more:false});return null};r.prototype.getTypeDelay=function(){return Q.coalesce(this.options["typeDelay"],500)};r.prototype.emptyItemText=function(){return Q.coalesce(this.element.attr("placeholder"),Q.text("Controls.SelectEditor.EmptyItemText"))};r.prototype.getPageSize=function(){var e;return(e=this.options["pageSize"])!==null&&e!==void 0?e:100};r.prototype.getIdField=function(){return this.options["idField"]};r.prototype.itemId=function(e){var t=e[this.getIdField()];if(t==null)return"";return t.toString()};r.prototype.getTextField=function(){var e;return(e=this.options["textField"])!==null&&e!==void 0?e:this.getIdField()};r.prototype.itemText=function(e){var t=e[this.getTextField()];if(t==null)return"";return t.toString()};r.prototype.itemDisabled=function(e){return false};r.prototype.mapItem=function(e){return{id:this.itemId(e),text:this.itemText(e),disabled:this.itemDisabled(e),source:e}};r.prototype.mapItems=function(e){return e.map(this.mapItem.bind(this))};r.prototype.allowClear=function(){return this.options.allowClear!=null?!!this.options.allowClear:this.emptyItemText()!=null};r.prototype.isMultiple=function(){return!!this.options.multiple};r.prototype.getSelect2Options=function(){var e=this;var t=this.emptyItemText();var r={multiple:this.isMultiple(),placeHolder:!Q.isEmptyOrNull(t)?t:null,allowClear:this.allowClear(),createSearchChoicePosition:"bottom"};if(this.hasAsyncSource()){var n=0;var a=null;r.query=function(t){var r=e.getPageSize();var i={searchTerm:Q.trimToNull(t.term),skip:(t.page-1)*r,take:r,checkMore:true};a&&a.abort&&a.abort();a=null;if(n!=null)clearTimeout(n);var o=$(e.element).data("select2");o&&o.search&&o.search.removeClass("select2-active");n=setTimeout(function(){a&&a.abort&&a.abort();o&&o.search.addClass("select2-active");a=e.asyncSearch(i,function(r){a=null;t.callback({results:e.mapItems(r.items),more:r.more})});(a&&(a.catch||a.fail)).call(a,function(){a=null;o&&o.search&&o.search.removeClass("select2-active")})},!t.term?0:e.getTypeDelay())};var o=null;r.initSelection=function(t,r){var i=t.val();if(i==null||i==""){r(null);return}var n=e.isMultiple();var a=n?i.split(","):[i];var l={idList:a};o&&o.abort&&o.abort();o=e.asyncSearch(l,function(t){o=null;if(n){var l=(t.items||[]).map(function(t){return e.mapItem(t)});e._itemById=e._itemById||{};for(var s=0,u=l;s<u.length;s++){var c=u[s];e._itemById[c.id]=c}if(e.isAutoComplete&&l.length!=a.length){for(var d=0,p=a;d<p.length;d++){var f=p[d];if(!Q.any(l,function(e){return e.id==f})){l.push({id:f,text:f})}}}r(l)}else if(!t.items||!t.items.length){if(e.isAutoComplete){r({id:i,text:i})}else r(null)}else{var c=e.mapItem(t.items[0]);e._itemById=e._itemById||{};e._itemById[c.id]=c;r(c)}});(o&&(o.catch||o.fail)).call(o,function(){o=null})}}else{r.data=this._items;r.query=function(t){var r=i.filterByText(e._items,function(e){return e.text},t.term);var n=e.getPageSize();t.callback({results:r.slice((t.page-1)*n,t.page*n),more:r.length>=t.page*n})};r.initSelection=function(t,r){var i=t.val();var n=e.isAutoComplete();if(e.isMultiple()){var a=[];for(var o=0,l=i.split(",");o<l.length;o++){var s=l[o];var u=e._itemById[s];if(u==null&&n){u={id:s,text:s};e.addItem(u)}if(u!=null){a.push(u)}}r(a);return}var c=e._itemById[i];if(c==null&&n){c={id:i,text:i};e.addItem(c)}r(c)}}if(this.options.minimumResultsForSearch!=null)r.minimumResultsForSearch=this.options.minimumResultsForSearch;if(this.isAutoComplete()||this.useInplaceAdd())r.createSearchChoice=this.getCreateSearchChoice(null);return r};r.prototype.get_delimited=function(){return!!this.options.delimited};Object.defineProperty(r.prototype,"items",{get:function(){if(this.hasAsyncSource())throw new Error("Can't read items property of an async select editor!");
return this._items||[]},set:function(e){if(this.hasAsyncSource())throw new Error("Can't set items of an async select editor!");this._items=e||[];this._itemById={};for(var t=0,r=this._items;t<r.length;t++){var i=r[t];this._itemById[i.id]=i}},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"itemById",{get:function(){if(this.hasAsyncSource())throw new Error("Can't read items property of an async select editor!");return this._itemById},set:function(e){if(this.hasAsyncSource())throw new Error("Can't set itemById of an async select editor!");this._itemById=e||{}},enumerable:true,configurable:true});r.prototype.clearItems=function(){if(this.hasAsyncSource())throw new Error("Can't clear items of an async select editor!");this._items.length=0;this._itemById={}};r.prototype.addItem=function(e){if(this.hasAsyncSource())throw new Error("Can't add item to an async select editor!");this._items.push(e);this._itemById[e.id]=e};r.prototype.addOption=function(e,t,r,i){this.addItem({id:e,text:t,source:r,disabled:i})};r.prototype.addInplaceCreate=function(e,t){var r=this;var i=this;e=Q.coalesce(e,Q.text("Controls.SelectEditor.InplaceAdd"));t=Q.coalesce(t,Q.text("Controls.SelectEditor.InplaceEdit"));var n=$("<a><b/></a>").addClass("inplace-button inplace-create").attr("title",e).insertAfter(this.element).click(function(e){i.inplaceCreateClick(e)});this.get_select2Container().add(this.element).addClass("has-inplace-button");this.element.change(function(){var i=r.isMultiple()||Q.isEmptyOrNull(r.get_value());n.attr("title",i?e:t).toggleClass("edit",!i)});this.element.change(function(e){if($(e.target).hasClass("select2-change-triggered"))return;if(r.isMultiple()){var t=r.get_values();if(t.length>0&&t[t.length-1]==(-2147483648).toString()){r.set_values(t.slice(0,t.length-1));r.inplaceCreateClick(e)}}else if(r.get_value()==(-2147483648).toString()){r.set_value(null);r.inplaceCreateClick(e)}});if(this.isMultiple()){this.get_select2Container().on("dblclick."+this.uniqueName,".select2-search-choice",function(e){var t=$(e.target);if(!t.hasClass("select2-search-choice")){t=t.closest(".select2-search-choice")}var i=t.index();var n=r.get_values();if(i<0||i>=r.get_values().length){return}e["editItem"]=n[i];r.inplaceCreateClick(e)})}};r.prototype.useInplaceAdd=function(){return!this.isAutoComplete()&&this.options.inplaceAdd&&(this.options.inplaceAddPermission==null||Q.Authorization.hasPermission(this.options.inplaceAddPermission))};r.prototype.isAutoComplete=function(){return!!this.options.autoComplete};r.prototype.getCreateSearchChoice=function(e){var t=this;return function(r){t.lastCreateTerm=r;r=Q.coalesce(Select2.util.stripDiacritics(r),"").toLowerCase();if(Q.isTrimmedEmpty(r)){return null}var i=false;if(Q.any(t._items||[],function(t){var i=e?e(t.source):t.text;return Select2.util.stripDiacritics(Q.coalesce(i,"")).toLowerCase()==r}))return null;if(!Q.any(t._items||[],function(e){return Q.coalesce(Select2.util.stripDiacritics(e.text),"").toLowerCase().indexOf(r)!==-1})){if(t.isAutoComplete()){return{id:t.lastCreateTerm,text:t.lastCreateTerm}}return{id:(-2147483648).toString(),text:Q.text("Controls.SelectEditor.NoResultsClickToDefine")}}if(t.isAutoComplete()){return{id:t.lastCreateTerm,text:t.lastCreateTerm}}return{id:(-2147483648).toString(),text:Q.text("Controls.SelectEditor.ClickToDefine")}}};r.prototype.setEditValue=function(e,t){var r=e[t.name];if(Q.isArray(r)){this.set_values(r)}else{this.set_value(r==null?null:r.toString())}};r.prototype.getEditValue=function(e,t){if(!this.isMultiple()||this.get_delimited()){t[e.name]=this.get_value()}else{t[e.name]=this.get_values()}};r.prototype.get_select2Container=function(){return this.element.prevAll(".select2-container")};r.prototype.get_items=function(){return this.items};r.prototype.get_itemByKey=function(){return this.itemById};r.filterByText=function(e,t,r){if(r==null||r.length==0)return e;r=Select2.util.stripDiacritics(r).toUpperCase();var i=[];function n(e){var n=t(e);if(n==null||!n.length)return false;n=Select2.util.stripDiacritics(n).toUpperCase();if(Q.startsWith(n,r))return true;if(n.indexOf(r)>=0)i.push(e);return false}return e.filter(n).concat(i)};r.prototype.get_value=function(){var e;if(this.element.data("select2")){e=this.element.select2("val");if(e!=null&&Q.isArray(e)){return e.join(",")}}else e=this.element.val();return e};Object.defineProperty(r.prototype,"value",{get:function(){return this.get_value()},set:function(e){this.set_value(e)},enumerable:true,configurable:true});r.prototype.set_value=function(e){if(e!=this.get_value()){var t=e;if(!Q.isEmptyOrNull(e)&&this.isMultiple()){t=e.split(String.fromCharCode(44)).map(function(e){return Q.trimToNull(e)}).filter(function(e){return e!=null})}var r=this.element;r.select2("val",t);r.data("select2-change-triggered",true);try{r.triggerHandler("change")}finally{r.data("select2-change-triggered",false)}this.updateInplaceReadOnly()}};Object.defineProperty(r.prototype,"selectedItem",{get:function(){var e=this.get_value();if(e&&this._itemById){var t=this._itemById[e];if(t)return t.source}return null},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"selectedItems",{get:function(){var e=this.values;var t=[];for(var r=0,i=e;r<i.length;r++){var n=i[r];if(n&&this._itemById){var a=this._itemById[n];if(a&&a.source)t.push(a.source);else t.push(null)}}return t},enumerable:true,configurable:true});r.prototype.get_values=function(){var e=this.element.select2("val");if(e==null){return[]}if(Q.isArray(e)){return e}var t=e;if(Q.isEmptyOrNull(t)){return[]}return[t]};Object.defineProperty(r.prototype,"values",{get:function(){return this.get_values()},set:function(e){this.set_values(e)},enumerable:true,configurable:true});r.prototype.set_values=function(e){if(e==null||e.length===0){this.set_value(null);return}this.set_value(e.join(","))};r.prototype.get_text=function(){return Q.coalesce(this.element.select2("data"),{}).text};Object.defineProperty(r.prototype,"text",{get:function(){return this.get_text()},enumerable:true,configurable:true});r.prototype.get_readOnly=function(){return!Q.isEmptyOrNull(this.element.attr("readonly"))};Object.defineProperty(r.prototype,"readOnly",{get:function(){return this.get_readOnly()},set:function(e){this.set_readOnly(e)},enumerable:true,configurable:true});r.prototype.updateInplaceReadOnly=function(){var e=this.get_readOnly()&&(this.isMultiple()||!this.value);this.element.nextAll(".inplace-create").attr("disabled",e?"disabled":"").css("opacity",e?"0.1":"").css("cursor",e?"default":"")};r.prototype.set_readOnly=function(e){if(e!==this.get_readOnly()){this.element.attr("readonly",e?"readonly":null);this.updateInplaceReadOnly()}};r.prototype.getCascadeFromValue=function(t){return e.EditorUtils.getValue(t)};r.prototype.setCascadeFrom=function(t){var r=this;if(Q.isEmptyOrNull(t)){if(this.cascadeLink!=null){this.cascadeLink.set_parentID(null);this.cascadeLink=null}this.options.cascadeFrom=null;return}this.cascadeLink=new e.CascadedWidgetLink(e.Widget,this,function(e){r.set_cascadeValue(r.getCascadeFromValue(e))});this.cascadeLink.set_parentID(t);this.options.cascadeFrom=t};r.prototype.get_cascadeFrom=function(){return this.options.cascadeFrom};Object.defineProperty(r.prototype,"cascadeFrom",{get:function(){return this.get_cascadeFrom()},set:function(e){this.set_cascadeFrom(e)},enumerable:true,configurable:true});r.prototype.set_cascadeFrom=function(e){if(e!==this.options.cascadeFrom){this.setCascadeFrom(e);this.updateItems()}};r.prototype.get_cascadeField=function(){return Q.coalesce(this.options.cascadeField,this.options.cascadeFrom)};Object.defineProperty(r.prototype,"cascadeField",{get:function(){return this.get_cascadeField()},set:function(e){this.set_cascadeField(e)},enumerable:true,configurable:true});r.prototype.set_cascadeField=function(e){this.options.cascadeField=e};r.prototype.get_cascadeValue=function(){return this.options.cascadeValue};Object.defineProperty(r.prototype,"cascadeValue",{get:function(){return this.get_cascadeValue()},set:function(e){this.set_cascadeValue(e)},enumerable:true,configurable:true});r.prototype.set_cascadeValue=function(e){if(this.options.cascadeValue!==e){this.options.cascadeValue=e;this.set_value(null);this.updateItems()}};r.prototype.get_filterField=function(){return this.options.filterField};Object.defineProperty(r.prototype,"filterField",{get:function(){return this.get_filterField()},set:function(e){this.set_filterField(e)},enumerable:true,configurable:true});r.prototype.set_filterField=function(e){this.options.filterField=e};r.prototype.get_filterValue=function(){return this.options.filterValue};Object.defineProperty(r.prototype,"filterValue",{get:function(){return this.get_filterValue()},set:function(e){this.set_filterValue(e)},enumerable:true,configurable:true});r.prototype.set_filterValue=function(e){if(this.options.filterValue!==e){this.options.filterValue=e;this.set_value(null);this.updateItems()}};r.prototype.cascadeItems=function(t){var r=this.get_cascadeValue();if(r==null||r===""){if(!Q.isEmptyOrNull(this.get_cascadeField())){return[]}return t}var i=r.toString();var n=this.get_cascadeField();return t.filter(function(t){var r=Q.coalesce(t[n],e.ReflectionUtils.getPropertyValue(t,n));return!!(r!=null&&r.toString()===i)})};r.prototype.filterItems=function(t){var r=this.get_filterValue();if(r==null||r===""){return t}var i=r.toString();var n=this.get_filterField();return t.filter(function(t){var r=Q.coalesce(t[n],e.ReflectionUtils.getPropertyValue(t,n));return!!(r!=null&&r.toString()===i)})};r.prototype.updateItems=function(){};r.prototype.getDialogTypeKey=function(){if(this.options.dialogType!=null){return this.options.dialogType}return null};r.prototype.createEditDialog=function(t){var r=this.getDialogTypeKey();var i=e.DialogTypeRegistry.get(r);e.Widget.create({type:i,init:function(e){return t(e)}})};r.prototype.initNewEntity=function(e){if(!Q.isEmptyOrNull(this.get_cascadeField())){e[this.get_cascadeField()]=this.get_cascadeValue()}if(!Q.isEmptyOrNull(this.get_filterField())){e[this.get_filterField()]=this.get_filterValue()}if(this.onInitNewEntity!=null){this.onInitNewEntity(e)}};r.prototype.setEditDialogReadOnly=function(e){e.element&&e.element.find(".tool-button.delete-button").addClass("disabled").unbind("click")};r.prototype.editDialogDataChange=function(){};r.prototype.setTermOnNewEntity=function(e,t){};r.prototype.inplaceCreateClick=function(t){var r=this;if(this.get_readOnly()&&(this.isMultiple()&&!t["editItem"]||!this.value))return;this.createEditDialog(function(i){if(r.get_readOnly())r.setEditDialogReadOnly(i);e.SubDialogHelper.bindToDataChange(i,r,function(e,t){r.editDialogDataChange();r.updateItems();r.lastCreateTerm=null;if((t.type==="create"||t.type==="update")&&t.entityId!=null){var i=t.entityId.toString();if(r.isMultiple()){var n=r.get_values().slice();if(n.indexOf(i)<0){n.push(i)}r.set_values(null);r.set_values(n.slice())}else{r.set_value(null);r.set_value(i)}}else if(r.isMultiple()&&t.type==="delete"&&t.entityId!=null){var a=t.entityId.toString();var o=r.get_values().slice();var l=o.indexOf(a);if(l>=0)o.splice(l,1);r.set_values(o.slice())}else if(!r.isMultiple()){r.set_value(null)}},true);var n=t["editItem"];if(n!=null){i.load(n,function(){i.dialogOpen(r.openDialogAsPanel)},null)}else if(r.isMultiple()||Q.isEmptyOrNull(r.get_value())){var a={};r.setTermOnNewEntity(a,Q.trimToEmpty(r.lastCreateTerm));r.initNewEntity(a);i.load(a,function(){i.dialogOpen(r.openDialogAsPanel)},null)}else{i.load(r.get_value(),function(){i.dialogOpen(r.openDialogAsPanel)},null)}})};var i;r=i=__decorate([e.Decorators.registerClass("Serenity.Select2Editor",[e.ISetEditValue,e.IGetEditValue,e.IStringValue,e.IReadOnly]),e.Decorators.element('<input type="hidden"/>')],r);return r}(e.Widget);e.Select2Editor=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(r,t);function r(e,r){var i=t.call(this,e,r)||this;i.updateItems();return i}r.prototype.getItems=function(){return this.options.items||[]};r.prototype.emptyItemText=function(){if(!Q.isEmptyOrNull(this.options.emptyOptionText)){return this.options.emptyOptionText}return t.prototype.emptyItemText.call(this)};r.prototype.updateItems=function(){var e=this.getItems();this.clearItems();if(e.length>0){var t=typeof e[0]==="string";for(var r=0,i=e;r<i.length;r++){var n=i[r];var a=t?n:n[0];var o=t?n:Q.coalesce(n[1],n[0]);this.addOption(a,o,n,false)}}};r=__decorate([e.Decorators.registerClass("Serenity.SelectEditor")],r);return r}(e.Select2Editor);e.SelectEditor=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(r,t);function r(e,r){var i=t.call(this,e,r)||this;i.updateItems();return i}r.prototype.getItems=function(){var e=this.options;if(e.items!=null&&e.items.length>=1){return e.items}var t=[];var r=(new Date).getFullYear();var i=(new Date).getFullYear();e.minYear=Q.coalesce(e.minYear,"-10").toString();if(Q.startsWith(e.minYear,"-")){r-=parseInt(e.minYear.substr(1),10)}else if(Q.startsWith(e.minYear,"+")){r+=parseInt(e.minYear.substr(1),10)}else{r=parseInt(e.minYear,10)}e.maxYear=Q.coalesce(e.maxYear,"+10").toString();if(Q.startsWith(e.maxYear,"-")){i-=parseInt(e.maxYear.substr(1),10)}else if(Q.startsWith(e.maxYear,"+")){i+=parseInt(e.maxYear.substr(1),10)}else{i=parseInt(e.maxYear,10)}if(e.descending){for(var n=i;n>=r;n--){t.push(n.toString())}}else{for(var a=r;a<=i;a++){t.push(a.toString())}}return t};r=__decorate([e.Decorators.registerEditor("Serenity.DateYearEditor")],r);return r}(e.SelectEditor);e.DateYearEditor=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(r,t);function r(e,r){var i=t.call(this,e,r)||this;i.updateItems();return i}r.prototype.updateItems=function(){this.clearItems();var t=this.options.enumType||e.EnumTypeRegistry.get(this.options.enumKey);var r=this.options.enumKey;if(r==null&&t!=null){var i=Q.getAttributes(t,e.EnumKeyAttribute,false);if(i.length>0){r=i[0].value}}var n=Q.Enum.getValues(t);for(var a=0,o=n;a<o.length;a++){var l=o[a];var s=Q.Enum.toString(t,l);this.addOption(parseInt(l,10).toString(),Q.coalesce(Q.tryGetText("Enums."+r+"."+s),s),null,false)}};r.prototype.allowClear=function(){return Q.coalesce(this.options.allowClear,true)};r=__decorate([e.Decorators.registerEditor("Serenity.EnumEditor")],r);return r}(e.Select2Editor);e.EnumEditor=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(r,t);function r(e,r){var i=t.call(this,e,r)||this;if(!i.hasAsyncSource()){i.updateItems();var n=i;Q.ScriptData.bindToChange("Lookup."+i.getLookupKey(),i.uniqueName,function(){n.updateItems()})}return i}r.prototype.hasAsyncSource=function(){return!!this.options.async};r.prototype.destroy=function(){if(!this.hasAsyncSource())Q.ScriptData.unbindFromChange(this.uniqueName);t.prototype.destroy.call(this)};r.prototype.getLookupKey=function(){if(this.options.lookupKey!=null){return this.options.lookupKey}var e=Q.getTypeFullName(Q.getInstanceType(this));var t=e.indexOf(".");if(t>=0){e=e.substring(t+1)}if(Q.endsWith(e,"Editor")){e=e.substr(0,e.length-6)}return e};r.prototype.getLookupAsync=function(){return Q.getLookupAsync(this.getLookupKey())};r.prototype.getLookup=function(){return Q.getLookup(this.getLookupKey())};r.prototype.getItems=function(e){return this.filterItems(this.cascadeItems(e.items))};r.prototype.getIdField=function(){return this.lookup!=null?this.lookup.idField:t.prototype.getIdField.call(this)};r.prototype.getItemText=function(e,r){if(r==null)return t.prototype.itemText.call(this,e);var i=r.textFormatter?r.textFormatter(e):e[r.textField];return i==null?"":i.toString()};r.prototype.mapItem=function(e){return{id:this.itemId(e),text:this.getItemText(e,this.lookup),disabled:this.getItemDisabled(e,this.lookup),source:e}};r.prototype.getItemDisabled=function(e,r){return t.prototype.itemDisabled.call(this,e)};r.prototype.updateItems=function(){this.clearItems();this.lookup=this.getLookup();var e=this.getItems(this.lookup);for(var t=0,r=e;t<r.length;t++){var i=r[t];this.addItem(this.mapItem(i))}};r.prototype.asyncSearch=function(t,r){var i=this;return this.getLookupAsync().then(function(n){i.lookup=n;var a=i.getItems(i.lookup);if(t.idList!=null){a=a.filter(function(e){return t.idList.indexOf(i.itemId(e))>=0})}function o(e){return this.getItemText(e,this.lookup)}a=e.Select2Editor.filterByText(a,o.bind(i),t.searchTerm);r({items:a.slice(t.skip,t.take),more:a.length>=t.take})})};r.prototype.getDialogTypeKey=function(){var e=t.prototype.getDialogTypeKey.call(this);if(e)return e;return this.getLookupKey()};r.prototype.setCreateTermOnNewEntity=function(e,t){e[this.getLookup().textField]=t};r.prototype.editDialogDataChange=function(){Q.reloadLookup(this.getLookupKey())};r=__decorate([e.Decorators.registerEditor("Serenity.LookupEditorBase")],r);return r}(e.Select2Editor);e.LookupEditorBase=t;var r=function(t){__extends(r,t);function r(e,r){return t.call(this,e,r)||this}r=__decorate([e.Decorators.registerEditor("Serenity.LookupEditor")],r);return r}(t);e.LookupEditor=r})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(r,t);function r(e,r){return t.call(this,e,r)||this}r.prototype.getDialogTypeKey=function(){var e=t.prototype.getDialogTypeKey.call(this);if(e)return e;var r=this.getService();if(Q.startsWith(r,"~/Services/"))r=r.substr("~/Services/".length);if(r.split("/").length==3)r=r.substr(0,r.lastIndexOf("/"));return r.replace("/",".")};r.prototype.getService=function(){return this.options.service};r.prototype.getServiceUrl=function(){var e=this.getService();if(e==null)throw new Error("ServiceLookupEditor requires 'service' option to be configured!");if(!Q.startsWith(e,"~")&&!Q.startsWith(e,"/")&&e.indexOf("://")<0)e="~/Services/"+e;if(Q.startsWith(e,"~"))e=Q.resolveUrl(e);return e};r.prototype.getIncludeColumns=function(){var e=this.options.includeColumns||[];var t=this.getIdField();if(t&&e.indexOf(t)<0)e.push(t);var r=this.getTextField();if(r&&e.indexOf(r)<0)e.push(r);return e};r.prototype.getSort=function(){return this.options.sort||(this.getTextField()?[this.getTextField()]:null)};r.prototype.getCascadeCriteria=function(){var e=this.get_cascadeValue();if(e==null||e===""){if(!Q.isEmptyOrNull(this.get_cascadeField())){return["1","=","0"]}return null}var t=this.get_cascadeField();return[[t],"=",e]};r.prototype.getFilterCriteria=function(){var e=this.get_filterValue();if(e==null||e===""){return null}var t=this.get_filterField();return[[t],"=",e]};r.prototype.getIdListCriteria=function(e){if(e==null)return null;if(e.length==0)return["0","=","1"];var t=this.getIdField();if(t==null)throw new Error("ServiceLookupEditor requires 'idField' option to be configured!");return[[t],"in",[e]]};r.prototype.getCriteria=function(t){return e.Criteria.and(e.Criteria.and(this.getIdListCriteria(t.idList),this.options.criteria),e.Criteria.and(this.getCascadeCriteria(),this.getFilterCriteria()))};r.prototype.getListRequest=function(e){var t={};if(e.searchTerm)t.ContainsText=e.searchTerm;t.Sort=this.getSort();t.ColumnSelection=this.options.columnSelection||1;t.IncludeColumns=this.getIncludeColumns();t.ExcludeColumns=this.options.excludeColumns;t.ContainsField=this.options.containsField;t.EqualityFilter=this.options.equalityFilter;t.Criteria=this.getCriteria(e);t.Skip=e.skip||0;t.Take=e.take?e.checkMore?e.take+1:e.take:0;t.IncludeDeleted=this.options.includeDeleted;t.ExcludeTotalCount=true;return t};r.prototype.getServiceCallOptions=function(e,t){return{blockUI:false,url:this.getServiceUrl(),request:this.getListRequest(e),onSuccess:function(r){var i=r.Entities||[];if(i&&e.take&&e.checkMore&&r.Entities.length>i.length)i=i.slice(0,e.take);t({items:i.slice(0,e.take),more:e.checkMore&&e.take&&i.length>e.take})}}};r.prototype.hasAsyncSource=function(){return true};r.prototype.asyncSearch=function(e,t){var r=this.getServiceCallOptions(e,t);return Q.serviceCall(r)};r=__decorate([e.Decorators.registerEditor("Serenity.ServiceLookupEditorBase")],r);return r}(e.Select2Editor);e.ServiceLookupEditorBase=t;var r=function(t){__extends(r,t);function r(e,r){return t.call(this,e,r)||this}r=__decorate([e.Decorators.registerEditor("Serenity.ServiceLookupEditor")],r);return r}(t);e.ServiceLookupEditor=r})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(r,t);function r(r,n){var a=t.call(this,r,n)||this;a._instanceReady=false;i.includeCKEditor();var o=r.attr("id");if(Q.isTrimmedEmpty(o)){r.attr("id",a.uniqueName);o=a.uniqueName}if(a.options.cols!=null)r.attr("cols",a.options.cols);if(a.options.rows!=null)r.attr("rows",a.options.rows);a.addValidationRule(a.uniqueName,function(e){if(e.hasClass("required")){var t=Q.trimToNull(a.get_value());if(t==null)return Q.text("Validation.Required")}return null});e.LazyLoadHelper.executeOnceWhenShown(a.element,function(){var e=a.getConfig();window["CKEDITOR"]&&window["CKEDITOR"].replace(o,e)});return a}i=r;r.prototype.instanceReady=function(e){this._instanceReady=true;$(e.editor.container.$).addClass(this.element.attr("class"));this.element.addClass("select2-offscreen").css("display","block");e.editor.setData(this.element.val());e.editor.setReadOnly(this.get_readOnly())};r.prototype.getLanguage=function(){if(!window["CKEDITOR"])return"en";var e=window["CKEDITOR"];var t=Q.coalesce(Q.trimToNull($("html").attr("lang")),"en");if(!!e.lang.languages[t]){return t}if(t.indexOf(String.fromCharCode(45))>=0){t=t.split(String.fromCharCode(45))[0]}if(!!e.lang.languages[t]){return t}return"en"};r.prototype.getConfig=function(){var e=this;return{customConfig:"",language:this.getLanguage(),bodyClass:"s-HtmlContentBody",on:{instanceReady:function(t){return e.instanceReady(t)},change:function(t){t.editor.updateElement();e.element.triggerHandler("change")}},toolbarGroups:[{name:"clipboard",groups:["clipboard","undo"]},{name:"editing",groups:["find","selection","spellchecker"]},{name:"insert",groups:["links","insert","blocks","bidi","list","indent"]},{name:"forms",groups:["forms","mode","document","doctools","others","about","tools"]},{name:"colors"},{name:"basicstyles",groups:["basicstyles","cleanup"]},{name:"align"},{name:"styles"}],removeButtons:"SpecialChar,Anchor,Subscript,Styles",format_tags:"p;h1;h2;h3;pre",removeDialogTabs:"image:advanced;link:advanced",removePlugins:"uploadimage,image2",contentsCss:Q.resolveUrl("~/Content/site/site.htmlcontent.css"),entities:false,entities_latin:false,entities_greek:false,autoUpdateElement:true,height:this.options.rows==null||this.options.rows===0?null:this.options.rows*20+"px"}};r.prototype.getEditorInstance=function(){var e=this.element.attr("id");return window["CKEDITOR"].instances[e]};r.prototype.destroy=function(){var e=this.getEditorInstance();e&&e.destroy(true);t.prototype.destroy.call(this)};r.prototype.get_value=function(){var e=this.getEditorInstance();if(this._instanceReady&&e){return e.getData()}else{return this.element.val()}};Object.defineProperty(r.prototype,"value",{get:function(){return this.get_value()},set:function(e){this.set_value(e)},enumerable:true,configurable:true});r.prototype.set_value=function(e){var t=this.getEditorInstance();this.element.val(e);if(this._instanceReady&&t)t.setData(e)};r.prototype.get_readOnly=function(){return!Q.isEmptyOrNull(this.element.attr("disabled"))};r.prototype.set_readOnly=function(e){if(this.get_readOnly()!==e){if(e){this.element.attr("disabled","disabled")}else{this.element.removeAttr("disabled")}var t=this.getEditorInstance();if(this._instanceReady&&t)t.setReadOnly(e)}};r.includeCKEditor=function(){if(window["CKEDITOR"]){return}var e=$("#CKEditorScript");if(e.length>0){return}$("<script/>").attr("type","text/javascript").attr("id","CKEditorScript").attr("src",Q.resolveUrl("~/Scripts/CKEditor/ckeditor.js?v="+i.CKEditorVer)).appendTo(window.document.head)};var i;r.CKEditorVer="4.7.1";r=i=__decorate([e.Decorators.registerEditor("Serenity.HtmlContentEditor",[e.IStringValue,e.IReadOnly]),e.Decorators.element("<textarea/>")],r);return r}(e.Widget);e.HtmlContentEditor=t;var r=function(t){__extends(r,t);function r(e,r){return t.call(this,e,r)||this}r.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this);e.removeButtons+=",Cut,Copy,Paste,BulletedList,NumberedList,"+"Indent,Outdent,SpecialChar,Subscript,Superscript,Styles,PasteText,"+"PasteFromWord,Strike,Link,Unlink,CreatePlaceholder,Image,Table,"+"HorizontalRule,Source,Maximize,Format,Font,FontSize,Anchor,Blockquote,"+"CreatePlaceholder,BGColor,JustifyLeft,JustifyCenter,"+"JustifyRight,JustifyBlock,Superscript,RemoveFormat";e.removePlugins="elementspath,uploadimage,image2";return e};r=__decorate([e.Decorators.registerEditor("Serenity.HtmlNoteContentEditor")],r);return r}(t);e.HtmlNoteContentEditor=r;var i=function(t){__extends(r,t);function r(e,r){return t.call(this,e,r)||this}r.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this);e.removeButtons+=",Cut,Copy,Paste,BulletedList,NumberedList,"+"Indent,Outdent,SpecialChar,Subscript,Superscript,Styles,"+"PasteText,PasteFromWord,Strike,Link,Unlink,CreatePlaceholder,"+"Image,Table,HorizontalRule,Source,Maximize,Format,Font,FontSize,"+"Anchor,Blockquote,CreatePlaceholder,BGColor,JustifyLeft,JustifyCenter,"+"JustifyRight,JustifyBlock,Superscript,RemoveFormat";e.removePlugins="elementspath,uploadimage,image2";return e};r=__decorate([e.Decorators.registerEditor("Serenity.HtmlReportContentEditor")],r);return r}(t);e.HtmlReportContentEditor=i})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(r,t);function r(e,r){var i=t.call(this,e,r)||this;e.mask(i.options.mask||"",{placeholder:Q.coalesce(i.options.placeholder,"_")});return i}Object.defineProperty(r.prototype,"value",{get:function(){this.element.triggerHandler("blur.mask");return this.element.val()},set:function(e){this.element.val(e)},enumerable:true,configurable:true});r.prototype.get_value=function(){return this.value};r.prototype.set_value=function(e){this.value=e};r=__decorate([e.Decorators.registerEditor("Serenity.MaskedEditor",[e.IStringValue]),e.Decorators.element('<input type="text"/>')],r);return r}(e.Widget);e.MaskedEditor=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(r,t);function r(e,r){var i=t.call(this,e,r)||this;i.element.addClass("g-recaptcha").attr("data-sitekey",i.options.siteKey);if(!!(window["grecaptcha"]==null&&$("script#RecaptchaInclude").length===0)){var n="https://www.google.com/recaptcha/api.js";var a=i.options.language;if(a==null){a=Q.coalesce($("html").attr("lang"),"")}n+="?hl="+a;$("<script/>").attr("id","RecaptchaInclude").attr("src",n).appendTo(document.body)}var o=$("<input />").insertBefore(i.element).attr("id",i.uniqueName+"_validate").val("x");var l={};l["visibility"]="hidden";l["width"]="0px";l["height"]="0px";l["padding"]="0px";var s=o.css(l);var u=i;Q.addValidationRule(s,i.uniqueName,function(e){if(Q.isEmptyOrNull(i.get_value())){return Q.text("Validation.Required")}return null});return i}r.prototype.get_value=function(){return this.element.find(".g-recaptcha-response").val()};r.prototype.set_value=function(e){};r=__decorate([e.Decorators.registerEditor("Serenity.Recaptcha",[e.IStringValue]),e.Decorators.element("<div/>")],r);return r}(e.Widget);e.Recaptcha=t})(Serenity||(Serenity={}));var Serenity;(function(e){var t=function(t){__extends(r,t);function r(r,i){var n=t.call(this,r,i)||this;if(!i||i.allowNonImage==null)n.options.allowNonImage=true;r.addClass("s-FileUploadEditor");if(Q.isEmptyOrNull(n.options.originalNameProperty))r.addClass("hide-original-name");n.toolbar=new e.Toolbar($("<div/>").appendTo(n.element),{buttons:n.getToolButtons()});var a=$("<div><div></div></div>").addClass("upload-progress").prependTo(n.toolbar.element);var o=n.getUploadInputOptions();n.uploadInput=e.UploadHelper.addUploadInput(o);n.fileSymbols=$("<ul/>").appendTo(n.element);n.updateInterface();return n}r.prototype.getUploadInputOptions=function(){var t=this;return{container:this.toolbar.findButton("add-file-button"),zone:this.element,inputName:this.uniqueName,progress:this.progress,fileDone:function(r,i,n){if(!e.UploadHelper.checkImageConstraints(r,t.options)){return}var a={OriginalName:i,Filename:r.TemporaryFile};t.entity=a;t.populate();t.updateInterface()}}};r.prototype.addFileButtonText=function(){return Q.text("Controls.ImageUpload.AddFileButton")};r.prototype.getToolButtons=function(){var e=this;return[{title:this.addFileButtonText(),cssClass:"add-file-button",onClick:function(){}},{title:"",hint:Q.text("Controls.ImageUpload.DeleteButtonHint"),cssClass:"delete-button",onClick:function(){e.entity=null;e.populate();e.updateInterface()}}]};r.prototype.populate=function(){var t=this.options.displayFileName||!Q.isTrimmedEmpty(this.options.originalNameProperty);if(this.entity==null){e.UploadHelper.populateFileSymbols(this.fileSymbols,null,t,this.options.urlPrefix)}else{e.UploadHelper.populateFileSymbols(this.fileSymbols,[this.entity],t,this.options.urlPrefix)}};r.prototype.updateInterface=function(){var e=this.toolbar.findButton("add-file-button");var t=this.toolbar.findButton("delete-button");e.toggleClass("disabled",this.get_readOnly());t.toggleClass("disabled",this.get_readOnly()||this.entity==null)};r.prototype.get_readOnly=function(){return this.uploadInput.attr("disabled")!=null};r.prototype.set_readOnly=function(e){if(this.get_readOnly()!==e){if(e){this.uploadInput.attr("disabled","disabled").fileupload("disable")}else{this.uploadInput.removeAttr("disabled").fileupload("enable")}this.updateInterface()}};r.prototype.get_value=function(){if(this.entity==null){return null}var e=Q.extend({},this.entity);return e};Object.defineProperty(r.prototype,"value",{get:function(){return this.get_value()},set:function(e){this.set_value(e)},enumerable:true,configurable:true});r.prototype.set_value=function(e){if(e!=null){if(e.Filename==null){this.entity=null}else{this.entity=Q.extend({},e)}}else{this.entity=null}this.populate();this.updateInterface()};r.prototype.getEditValue=function(e,t){t[e.name]=this.entity==null?null:Q.trimToNull(this.entity.Filename)};r.prototype.setEditValue=function(e,t){var r={};r.Filename=e[t.name];if(Q.isEmptyOrNull(this.options.originalNameProperty)){if(this.options.displayFileName){var i=Q.coalesce(r.Filename,"");var n=Q.replaceAll(i,"\\","/").lastIndexOf("/");if(n>=0){r.OriginalName=i.substr(n+1)}else{r.OriginalName=i}}}else{r.OriginalName=e[this.options.originalNameProperty]}this.set_value(r)};r=__decorate([e.Decorators.registerEditor("Serenity.FileUploadEditor",[e.IReadOnly]),e.Decorators.element("<div/>")],r);return r}(e.Widget);e.FileUploadEditor=t;var r=function(t){__extends(r,t);function r(e,r){var i=t.call(this,e,r)||this;if(r&&r.allowNonImage==null)i.options.allowNonImage=false;e.addClass("s-ImageUploadEditor");return i}r=__decorate([e.Decorators.registerEditor("Serenity.ImageUploadEditor")],r);return r}(t);e.ImageUploadEditor=r;var i=function(t){__extends(r,t);function r(r,i){var n=t.call(this,r,i)||this;n.entities=[];r.addClass("s-MultipleFileUploadEditor");var a=n;n.toolbar=new e.Toolbar($("<div/>").appendTo(n.element),{buttons:n.getToolButtons()});var o=$("<div><div></div></div>").addClass("upload-progress").prependTo(n.toolbar.element);var l=n.toolbar.findButton("add-file-button");n.uploadInput=e.UploadHelper.addUploadInput({container:l,zone:n.element,inputName:n.uniqueName,progress:o,fileDone:function(t,r,i){if(!e.UploadHelper.checkImageConstraints(t,n.options)){return}var o={OriginalName:r,Filename:t.TemporaryFile};a.entities.push(o);a.populate();a.updateInterface()}});n.fileSymbols=$("<ul/>").appendTo(n.element);n.updateInterface();return n}r.prototype.addFileButtonText=function(){return Q.text("Controls.ImageUpload.AddFileButton")};r.prototype.getToolButtons=function(){return[{title:this.addFileButtonText(),cssClass:"add-file-button",onClick:function(){}}]};r.prototype.populate=function(){var t=this;e.UploadHelper.populateFileSymbols(this.fileSymbols,this.entities,true,this.options.urlPrefix);this.fileSymbols.children().each(function(e,r){var i=e;
$("<a class='delete'></a>").appendTo($(r).children(".filename")).click(function(e){e.preventDefault();t.entities.splice(i,1);t.populate()})})};r.prototype.updateInterface=function(){var e=this.toolbar.findButton("add-file-button");e.toggleClass("disabled",this.get_readOnly());this.fileSymbols.find("a.delete").toggle(!this.get_readOnly())};r.prototype.get_readOnly=function(){return this.uploadInput.attr("disabled")!=null};r.prototype.set_readOnly=function(e){if(this.get_readOnly()!==e){if(e){this.uploadInput.attr("disabled","disabled").fileupload("disable")}else{this.uploadInput.removeAttr("disabled").fileupload("enable")}this.updateInterface()}};r.prototype.get_value=function(){return this.entities.map(function(e){return Q.extend({},e)})};Object.defineProperty(r.prototype,"value",{get:function(){return this.get_value()},set:function(e){this.set_value(e)},enumerable:true,configurable:true});r.prototype.set_value=function(e){this.entities=(e||[]).map(function(e){return Q.extend({},e)});this.populate();this.updateInterface()};r.prototype.getEditValue=function(e,t){if(this.jsonEncodeValue){t[e.name]=$.toJSON(this.get_value())}else{t[e.name]=this.get_value()}};r.prototype.setEditValue=function(e,t){var r=e[t.name];if(Q.isInstanceOfType(r,String)){var i=Q.coalesce(Q.trimToNull(r),"[]");if(Q.startsWith(i,"[")&&Q.endsWith(i,"]")){this.set_value($.parseJSON(i))}else{this.set_value([{Filename:i,OriginalName:"UnknownFile"}])}}else{this.set_value(r)}};__decorate([e.Decorators.option()],r.prototype,"jsonEncodeValue",void 0);r=__decorate([e.Decorators.registerEditor("Serenity.MultipleFileUploadEditor",[e.IReadOnly]),e.Decorators.element("<div/>")],r);return r}(e.Widget);e.MultipleFileUploadEditor=i;var n=function(t){__extends(r,t);function r(e,r){var i=t.call(this,e,r)||this;e.addClass("s-MultipleImageUploadEditor");return i}r=__decorate([e.Decorators.registerEditor("Serenity.MultipleImageUploadEditor")],r);return r}(i);e.MultipleImageUploadEditor=n})(Serenity||(Serenity={}));